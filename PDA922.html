<!DOCTYPE html>
<html>
  <head>
    <title>LIFF 使用者資訊</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
      body {
  font-family: Arial, sans-serif;
  margin: 20px;
  text-align: center;
}

#userInfo {
  margin-top: 20px;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  display: inline-block;
  background-color: #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#userPicture {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  margin-bottom: 10px;
  border: 3px solid #f8f8f8;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.info-item {
  margin: 10px 0;
  font-size: 16px;
  color: #333;
}

#status {
  color: #4CAF50;
  font-weight: bold;
}

.error {
  color: #f44336;
}
    </style>
  </head>
  <body>
    <div id="userInfo">
      <img id="userPicture" src="" alt="使用者圖片">
      <div class="info-item">名稱：<span id="userName"></span></div>
      <div class="info-item">ID：<span id="status"></span></div>
    </div>
    <script>
      const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw1nyxKv4z5kJ-99RhTi1Zn2P9dRXvaZh5cPxK4shgZkYg3dcLbXWOedIKQhMKGt214/exec';

async function initializeLiff() {
  try {
    await liff.init({ liffId: "2001679903-r5VXNe5g" });
    
    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    updateUI(profile);
    await saveUserData(profile);

  } catch (err) {
    showError(err);
  }
}

function updateUI(profile) {
  document.getElementById('userPicture').src = profile.pictureUrl;
  document.getElementById('userName').textContent = profile.displayName;
  document.getElementById('stastus').textContent = profile.userId;
}

async function saveUserData(profile) {
  try {
    const userData = {
      userId: profile.userId,
      displayName: profile.displayName,
      pictureUrl: profile.pictureUrl,
      timestamp: new Date().toISOString()
    };

    const response = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(userData),
      headers: {
        'Content-Type': 'application/json'
      }
    });

    const result = await response.json();
    if (!result.success) {
      throw new Error(result.message);
    }
  } catch (err) {
    showError(err);
  }
}

function showError(err) {
  const status = document.getElementById('status');
  status.textContent = '錯誤：' + err.message;
  status.className = 'error';
}

window.onload = initializeLiff;
    </script>
  </body>
</html>

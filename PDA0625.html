<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台灣帕金森病友權益促進會 - 會計管理系統 v4.0</title>
    
    <!-- CSS 框架 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #28a745;
            --accent-color: #ffc107;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --dark-text: #343a40;
            --border-color: #dee2e6;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
        }

        /* 頁面載入動畫 */
        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), #1e4080);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .page-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-content {
            text-align: center;
            color: white;
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 主要佈局 */
        .main-header {
            background: linear-gradient(135deg, var(--primary-color), #1e4080);
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .main-header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .main-header .subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.85rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* 導航選單 */
        .main-nav {
            background: white;
            border-bottom: 3px solid var(--primary-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 80px;
            z-index: 999;
        }

        .nav-tabs {
            border-bottom: none;
        }

        .nav-tabs .nav-link {
            color: var(--dark-text);
            border: none;
            padding: 1rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            border-radius: 0;
        }

        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
            background-color: rgba(44, 90, 160, 0.05);
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }

        .nav-tabs .nav-link i {
            margin-right: 0.5rem;
        }

        /* 主要內容區 */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        /* 卡片樣式 */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), #1e4080);
            color: white;
            border: none;
            padding: 1.5rem;
            font-weight: 600;
        }

        .card-header h5 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 2rem;
        }

        /* 統計卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .stat-icon::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            opacity: 0.1;
            transform: scale(1.2);
        }

        .stat-icon.income {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .stat-icon.expense {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
        }

        .stat-icon.receipt {
            background: linear-gradient(135deg, var(--primary-color), #6f42c1);
            color: white;
        }

        .stat-icon.member {
            background: linear-gradient(135deg, var(--accent-color), #fd7e14);
            color: white;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-text);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: #6c757d;
            font-size: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-change {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--secondary-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        /* 表單樣式 */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--dark-text);
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-control, .form-select {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: white;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
            outline: none;
        }

        .form-control.is-invalid {
            border-color: var(--danger-color);
        }

        .form-control.is-valid {
            border-color: var(--secondary-color);
        }

        .invalid-feedback {
            display: block;
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .required {
            color: var(--danger-color);
        }

        /* 按鈕樣式 */
        .btn {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #1e4080);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1e4080, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 90, 160, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary-color), #1e7e34);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #1e7e34, var(--secondary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--accent-color), #e0a800);
            color: #212529;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e0a800, var(--accent-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, var(--danger-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.125rem;
        }

        /* 表格樣式 */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table {
            margin: 0;
            border-radius: 15px;
        }

        .table thead th {
            background: linear-gradient(135deg, var(--primary-color), #1e4080);
            color: white;
            font-weight: 600;
            border: none;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table tbody td {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .table tbody tr {
            transition: background-color 0.2s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(44, 90, 160, 0.05);
        }

        .table tbody tr:nth-child(even) {
            background-color: rgba(248, 249, 250, 0.5);
        }

        /* 狀態標籤 */
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .status-badge::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: currentColor;
        }

        .status-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--secondary-color);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .status-pending {
            background-color: rgba(255, 193, 7, 0.1);
            color: #856404;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status-danger {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .status-info {
            background-color: rgba(44, 90, 160, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(44, 90, 160, 0.3);
        }

        /* 操作按鈕組 */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            padding: 0.5rem;
            min-width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        /* 搜尋框 */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-container input {
            padding-left: 3rem;
        }

        .search-container .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            z-index: 5;
        }

        /* 提示訊息 */
        .alert {
            border: none;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, currentColor, transparent);
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.1);
            border-left-color: var(--secondary-color);
            color: #155724;
        }

        .alert-danger {
            background-color: rgba(220, 53, 69, 0.1);
            border-left-color: var(--danger-color);
            color: #721c24;
        }

        .alert-warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-left-color: var(--accent-color);
            color: #856404;
        }

        .alert-info {
            background-color: rgba(44, 90, 160, 0.1);
            border-left-color: var(--primary-color);
            color: #0c5460;
        }

        .alert-dismissible {
            padding-right: 3rem;
        }

        .alert .btn-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.5rem;
            background: none;
            border: none;
            font-size: 1.2rem;
            opacity: 0.7;
        }

        /* 模態視窗 */
        .modal-content {
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), #1e4080);
            color: white;
            border: none;
            padding: 1.5rem 2rem;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.25rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            background-color: #f8f9fa;
        }

        .btn-close {
            filter: invert(1);
            opacity: 0.8;
        }

        .btn-close:hover {
            opacity: 1;
        }

        /* 載入動畫 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .main-header h1 {
                font-size: 1.5rem;
            }
            
            .main-header .subtitle {
                font-size: 0.8rem;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1.5rem;
            }
            
            .stat-value {
                font-size: 2rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .card-body {
                padding: 1.5rem;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 1rem 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .action-buttons .btn {
                width: auto;
                min-width: 40px;
            }
        }

        /* 動畫效果 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(0);
            }
        }

        /* 頁尾 */
        .main-footer {
            background: var(--dark-text);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .main-footer a {
            color: #adb5bd;
            text-decoration: none;
        }

        .main-footer a:hover {
            color: white;
        }

        /* 自定義滾動條 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #1e4080, #1e7e34);
        }

        /* 打印樣式 */
        @media print {
            .main-header,
            .main-nav,
            .main-footer,
            .btn,
            .action-buttons {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- 頁面載入器 -->
    <div id="pageLoader" class="page-loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <h4>系統載入中...</h4>
            <p>請稍候，正在初始化會計管理系統</p>
        </div>
    </div>

    <!-- 主要標題 -->
    <header class="main-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-calculator me-2"></i>台灣帕金森病友權益促進會</h1>
                    <p class="subtitle">增強版會計管理系統 v4.0 - 專業財務管理解決方案</p>
                </div>
                <div class="col-md-4">
                    <div class="system-status">
                        <div class="status-indicator"></div>
                        <span>系統運行正常</span>
                        <span id="currentTime" class="ms-3"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主要導航 -->
    <nav class="main-nav">
        <div class="container">
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" 
                            data-bs-target="#dashboard" type="button" role="tab">
                        <i class="fas fa-tachometer-alt"></i>儀表板
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="transaction-tab" data-bs-toggle="tab" 
                            data-bs-target="#transaction" type="button" role="tab">
                        <i class="fas fa-exchange-alt"></i>交易記錄
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="receipt-tab" data-bs-toggle="tab" 
                            data-bs-target="#receipt" type="button" role="tab">
                        <i class="fas fa-receipt"></i>收據管理
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="member-tab" data-bs-toggle="tab" 
                            data-bs-target="#member" type="button" role="tab">
                        <i class="fas fa-users"></i>會員管理
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="report-tab" data-bs-toggle="tab" 
                            data-bs-target="#report" type="button" role="tab">
                        <i class="fas fa-chart-bar"></i>報表分析
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="settings-tab" data-bs-toggle="tab" 
                            data-bs-target="#settings" type="button" role="tab">
                        <i class="fas fa-cog"></i>系統設定
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- 主要內容 -->
    <main class="main-content">
        <div class="container">
            <!-- 全域訊息顯示區 -->
            <div id="globalMessage"></div>
            
            <!-- 分頁內容 -->
            <div class="tab-content fade-in" id="mainTabContent">
                
                <!-- 儀表板 -->
                <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                    <!-- 統計卡片 -->
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-icon income">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="stat-value" id="totalIncome">$0</div>
                            <div class="stat-label">本月收入</div>
                            <div class="stat-change positive" id="incomeChange">
                                <i class="fas fa-arrow-up"></i>
                                <span>+0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon expense">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="stat-value" id="totalExpense">$0</div>
                            <div class="stat-label">本月支出</div>
                            <div class="stat-change negative" id="expenseChange">
                                <i class="fas fa-arrow-down"></i>
                                <span>-0%</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon receipt">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                            <div class="stat-value" id="receiptCount">0</div>
                            <div class="stat-label">本月收據</div>
                            <div class="stat-change positive" id="receiptChange">
                                <i class="fas fa-plus"></i>
                                <span>+0</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon member">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <div class="stat-value" id="memberCount">0</div>
                            <div class="stat-label">會員總數</div>
                            <div class="stat-change positive" id="memberChange">
                                <i class="fas fa-user-plus"></i>
                                <span>+0</span>
                            </div>
                        </div>
                    </div>

                    <!-- 快速操作區 -->
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-clock me-2"></i>最近活動</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recentActivities">
                                        <div class="text-center text-muted py-4">
                                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                            <p>載入中...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-bolt me-2"></i>快速操作</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-primary" onclick="showTransactionForm()">
                                            <i class="fas fa-plus me-2"></i>新增交易
                                        </button>
                                        <button class="btn btn-success" onclick="showReceiptForm()">
                                            <i class="fas fa-receipt me-2"></i>開立收據
                                        </button>
                                        <button class="btn btn-warning" onclick="showMemberForm()">
                                            <i class="fas fa-user-plus me-2"></i>新增會員
                                        </button>
                                        <button class="btn btn-info" onclick="generateReport()">
                                            <i class="fas fa-chart-line me-2"></i>生成報表
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 交易記錄 -->
                <div class="tab-pane fade" id="transaction" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-plus me-2"></i>新增交易記錄</h5>
                                </div>
                                <div class="card-body">
                                    <form id="transactionForm">
                                        <div class="form-group">
                                            <label class="form-label">交易日期 <span class="required">*</span></label>
                                            <input type="date" class="form-control" id="transactionDate" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">姓名 <span class="required">*</span></label>
                                            <input type="text" class="form-control" id="transactionName" 
                                                   placeholder="請輸入姓名" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">交易類型 <span class="required">*</span></label>
                                            <select class="form-select" id="transactionType" required>
                                                <option value="">請選擇類型</option>
                                                <option value="收入">收入</option>
                                                <option value="支出">支出</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">類別 <span class="required">*</span></label>
                                            <select class="form-select" id="transactionCategory" required>
                                                <option value="">請選擇類別</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">帳戶</label>
                                            <select class="form-select" id="transactionAccount">
                                                <option value="">請選擇帳戶</option>
                                                <option value="現金">現金</option>
                                                <option value="銀行-第一銀行">銀行-第一銀行</option>
                                                <option value="銀行-台灣銀行">銀行-台灣銀行</option>
                                                <option value="郵局">郵局</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">金額 <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="transactionAmount" 
                                                   placeholder="請輸入金額" min="0" step="1" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">說明</label>
                                            <textarea class="form-control" id="transactionDescription" 
                                                      rows="3" placeholder="請輸入說明"></textarea>
                                        </div>

                                        <!-- 收入相關選項 -->
                                        <div id="incomeOptions" style="display: none;">
                                            <div class="form-group">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" 
                                                           id="generateReceipt" value="true">
                                                    <label class="form-check-label" for="generateReceipt">
                                                        自動開立收據
                                                    </label>
                                                </div>
                                            </div>

                                            <div id="receiptDetails" style="display: none;">
                                                <div class="form-group">
                                                    <label class="form-label">電子郵件</label>
                                                    <input type="email" class="form-control" id="payerEmail" 
                                                           placeholder="收據寄送信箱">
                                                </div>

                                                <div class="form-group">
                                                    <label class="form-label">電話</label>
                                                    <input type="tel" class="form-control" id="payerPhone" 
                                                           placeholder="聯絡電話">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 支出相關選項 -->
                                        <div id="expenseOptions" style="display: none;">
                                            <div class="form-group">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" 
                                                           id="generateVoucher" value="true">
                                                    <label class="form-check-label" for="generateVoucher">
                                                        生成支出憑證
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fas fa-save me-2"></i>儲存交易記錄
                                            </button>
                                            <button type="button" class="btn btn-outline-primary" 
                                                    onclick="clearTransactionForm()">
                                                <i class="fas fa-eraser me-2"></i>清除表單
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-list me-2"></i>交易記錄列表</h5>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="refreshTransactions()">
                                            <i class="fas fa-sync-alt me-1"></i>重新整理
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="exportTransactions()">
                                            <i class="fas fa-download me-1"></i>匯出
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!-- 搜尋與篩選 -->
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <div class="search-container">
                                                <i class="fas fa-search search-icon"></i>
                                                <input type="text" class="form-control" id="transactionSearch" 
                                                       placeholder="搜尋姓名、說明或類別...">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <select class="form-select" id="typeFilter">
                                                <option value="">全部類型</option>
                                                <option value="收入">收入</option>
                                                <option value="支出">支出</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <input type="date" class="form-control" id="dateFromFilter">
                                        </div>
                                        <div class="col-md-3">
                                            <input type="date" class="form-control" id="dateToFilter">
                                        </div>
                                    </div>

                                    <!-- 交易記錄表格 -->
                                    <div class="table-responsive">
                                        <div id="transactionTableContainer">
                                            <div class="text-center py-4">
                                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                                <p>載入交易記錄中...</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 分頁導航 -->
                                    <nav aria-label="交易記錄分頁" class="mt-3">
                                        <ul class="pagination justify-content-center" id="transactionPagination">
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 收據管理 -->
                <div class="tab-pane fade" id="receipt" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-receipt me-2"></i>開立收據</h5>
                                </div>
                                <div class="card-body">
                                    <form id="receiptForm">
                                        <div class="form-group">
                                            <label class="form-label">收據日期 <span class="required">*</span></label>
                                            <input type="date" class="form-control" id="receiptDate" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">付款人 <span class="required">*</span></label>
                                            <input type="text" class="form-control" id="receiptPayer" 
                                                   placeholder="請輸入付款人姓名" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">身分</label>
                                            <select class="form-select" id="receiptIdentity">
                                                <option value="會員">會員</option>
                                                <option value="非會員">非會員</option>
                                                <option value="企業">企業</option>
                                                <option value="其他">其他</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">聯絡電話</label>
                                            <input type="tel" class="form-control" id="receiptPhone" 
                                                   placeholder="請輸入聯絡電話">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">電子郵件</label>
                                            <input type="email" class="form-control" id="receiptEmail" 
                                                   placeholder="收據寄送信箱">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">收款類別 <span class="required">*</span></label>
                                            <select class="form-select" id="receiptCategory" required>
                                                <option value="">請選擇類別</option>
                                                <option value="會費">會費</option>
                                                <option value="捐款">捐款</option>
                                                <option value="活動費用">活動費用</option>
                                                <option value="其他收入">其他收入</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">金額 <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="receiptAmount" 
                                                   placeholder="請輸入金額" min="0" step="1" required>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">用途說明</label>
                                            <textarea class="form-control" id="receiptDescription" 
                                                      rows="3" placeholder="請輸入用途說明"></textarea>
                                        </div>

                                        <div class="form-group">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" 
                                                       id="autoSendEmail" checked>
                                                <label class="form-check-label" for="autoSendEmail">
                                                    自動寄送電子收據
                                                </label>
                                            </div>
                                        </div>

                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-success btn-lg">
                                                <i class="fas fa-file-invoice me-2"></i>開立收據
                                            </button>
                                            <button type="button" class="btn btn-outline-primary" 
                                                    onclick="clearReceiptForm()">
                                                <i class="fas fa-eraser me-2"></i>清除表單
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-file-invoice me-2"></i>收據記錄</h5>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="refreshReceipts()">
                                            <i class="fas fa-sync-alt me-1"></i>重新整理
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="exportReceipts()">
                                            <i class="fas fa-download me-1"></i>匯出
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!-- 搜尋與篩選 -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="search-container">
                                                <i class="fas fa-search search-icon"></i>
                                                <input type="text" class="form-control" id="receiptSearch" 
                                                       placeholder="搜尋收據編號、付款人...">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select" id="receiptStatusFilter">
                                                <option value="">全部狀態</option>
                                                <option value="已開立">已開立</option>
                                                <option value="已寄送">已寄送</option>
                                                <option value="已列印">已列印</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select" id="receiptCategoryFilter">
                                                <option value="">全部類別</option>
                                                <option value="會費">會費</option>
                                                <option value="捐款">捐款</option>
                                                <option value="活動費用">活動費用</option>
                                                <option value="其他收入">其他收入</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- 收據記錄表格 -->
                                    <div class="table-responsive">
                                        <div id="receiptTableContainer">
                                            <div class="text-center py-4">
                                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                                <p>載入收據記錄中...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 會員管理 -->
                <div class="tab-pane fade" id="member" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-user-plus me-2"></i>新增會員</h5>
                                </div>
                                <div class="card-body">
                                    <form id="memberForm">
                                        <div class="form-group">
                                            <label class="form-label">姓名 <span class="required">*</span></label>
                                            <input type="text" class="form-control" id="memberName" 
                                                   placeholder="請輸入姓名" required>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">性別</label>
                                                <select class="form-select" id="memberGender">
                                                    <option value="">請選擇</option>
                                                    <option value="男">男</option>
                                                    <option value="女">女</option>
                                                    <option value="其他">其他</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">生日</label>
                                                <input type="date" class="form-control" id="memberBirthDate">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">身分證字號</label>
                                            <input type="text" class="form-control" id="memberIdCard" 
                                                   placeholder="請輸入身分證字號" maxlength="10">
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">電話 <span class="required">*</span></label>
                                                <input type="tel" class="form-control" id="memberPhone" 
                                                       placeholder="請輸入電話" required>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">手機</label>
                                                <input type="tel" class="form-control" id="memberMobile" 
                                                       placeholder="請輸入手機">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">電子郵件</label>
                                            <input type="email" class="form-control" id="memberEmail" 
                                                   placeholder="請輸入電子郵件">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">地址</label>
                                            <textarea class="form-control" id="memberAddress" 
                                                      rows="2" placeholder="請輸入地址"></textarea>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">緊急聯絡人</label>
                                                <input type="text" class="form-control" id="memberEmergencyContact" 
                                                       placeholder="請輸入緊急聯絡人">
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">緊急聯絡電話</label>
                                                <input type="tel" class="form-control" id="memberEmergencyPhone" 
                                                       placeholder="請輸入緊急聯絡電話">
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">入會日期</label>
                                                <input type="date" class="form-control" id="memberJoinDate">
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">會員類型 <span class="required">*</span></label>
                                                <select class="form-select" id="memberType" required>
                                                    <option value="">請選擇</option>
                                                    <option value="一般會員">一般會員</option>
                                                    <option value="贊助會員">贊助會員</option>
                                                    <option value="榮譽會員">榮譽會員</option>
                                                    <option value="終身會員">終身會員</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">會費狀態</label>
                                            <select class="form-select" id="memberFeeStatus">
                                                <option value="未繳費">未繳費</option>
                                                <option value="已繳費">已繳費</option>
                                                <option value="部分繳費">部分繳費</option>
                                                <option value="免繳費">免繳費</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">備註</label>
                                            <textarea class="form-control" id="memberNotes" 
                                                      rows="3" placeholder="請輸入備註"></textarea>
                                        </div>

                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fas fa-user-plus me-2"></i>新增會員
                                            </button>
                                            <button type="button" class="btn btn-outline-primary" 
                                                    onclick="clearMemberForm()">
                                                <i class="fas fa-eraser me-2"></i>清除表單
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-users me-2"></i>會員列表</h5>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="refreshMembers()">
                                            <i class="fas fa-sync-alt me-1"></i>重新整理
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="exportMembers()">
                                            <i class="fas fa-download me-1"></i>匯出
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="importMembers()">
                                            <i class="fas fa-upload me-1"></i>匯入
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!-- 搜尋與篩選 -->
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <div class="search-container">
                                                <i class="fas fa-search search-icon"></i>
                                                <input type="text" class="form-control" id="memberSearch" 
                                                       placeholder="搜尋姓名、電話、郵件...">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select" id="memberTypeFilter">
                                                <option value="">全部類型</option>
                                                <option value="一般會員">一般會員</option>
                                                <option value="贊助會員">贊助會員</option>
                                                <option value="榮譽會員">榮譽會員</option>
                                                <option value="終身會員">終身會員</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select" id="memberStatusFilter">
                                                <option value="">全部狀態</option>
                                                <option value="已繳費">已繳費</option>
                                                <option value="未繳費">未繳費</option>
                                                <option value="部分繳費">部分繳費</option>
                                                <option value="免繳費">免繳費</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-outline-secondary w-100" onclick="clearMemberFilters()">
                                                <i class="fas fa-times me-1"></i>清除
                                            </button>
                                        </div>
                                    </div>

                                    <!-- 會員統計 -->
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="fw-bold text-primary" id="totalMembers">0</div>
                                                <small class="text-muted">總會員數</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="fw-bold text-success" id="paidMembers">0</div>
                                                <small class="text-muted">已繳費</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="fw-bold text-warning" id="unpaidMembers">0</div>
                                                <small class="text-muted">未繳費</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="fw-bold text-info" id="newMembers">0</div>
                                                <small class="text-muted">本月新增</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 會員列表表格 -->
                                    <div class="table-responsive">
                                        <div id="memberTableContainer">
                                            <div class="text-center py-4">
                                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                                <p>載入會員資料中...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 報表分析 -->
                <div class="tab-pane fade" id="report" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-bar me-2"></i>報表設定</h5>
                                </div>
                                <div class="card-body">
                                    <form id="reportForm">
                                        <div class="form-group">
                                            <label class="form-label">報表類型</label>
                                            <select class="form-select" id="reportType">
                                                <option value="monthly">月度財務報表</option>
                                                <option value="yearly">年度財務報表</option>
                                                <option value="category">類別分析報表</option>
                                                <option value="member">會員統計報表</option>
                                                <option value="receipt">收據統計報表</option>
                                            </select>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">年度</label>
                                                <select class="form-select" id="reportYear">
                                                    <option value="2024">2024</option>
                                                    <option value="2023">2023</option>
                                                    <option value="2022">2022</option>
                                                </select>
                                            </div>

                                            <div class="form-group" id="monthGroup">
                                                <label class="form-label">月份</label>
                                                <select class="form-select" id="reportMonth">
                                                    <option value="1">1月</option>
                                                    <option value="2">2月</option>
                                                    <option value="3">3月</option>
                                                    <option value="4">4月</option>
                                                    <option value="5">5月</option>
                                                    <option value="6">6月</option>
                                                    <option value="7">7月</option>
                                                    <option value="8">8月</option>
                                                    <option value="9">9月</option>
                                                    <option value="10">10月</option>
                                                    <option value="11">11月</option>
                                                    <option value="12">12月</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">報表格式</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="reportFormat" 
                                                       id="formatHTML" value="html" checked>
                                                <label class="form-check-label" for="formatHTML">
                                                    網頁預覽
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="reportFormat" 
                                                       id="formatPDF" value="pdf">
                                                <label class="form-check-label" for="formatPDF">
                                                    PDF 下載
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="reportFormat" 
                                                       id="formatExcel" value="excel">
                                                <label class="form-check-label" for="formatExcel">
                                                    Excel 下載
                                                </label>
                                            </div>
                                        </div>

                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fas fa-chart-line me-2"></i>生成報表
                                            </button>
                                            <button type="button" class="btn btn-outline-success" onclick="scheduleReport()">
                                                <i class="fas fa-clock me-2"></i>排程報表
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- 快速統計 -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5><i class="fas fa-tachometer-alt me-2"></i>快速統計</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-6 mb-3">
                                            <div class="p-2 bg-success bg-opacity-10 rounded">
                                                <div class="fw-bold text-success" id="quickTotalIncome">$0</div>
                                                <small class="text-muted">本月收入</small>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="p-2 bg-danger bg-opacity-10 rounded">
                                                <div class="fw-bold text-danger" id="quickTotalExpense">$0</div>
                                                <small class="text-muted">本月支出</small>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="p-2 bg-primary bg-opacity-10 rounded">
                                                <div class="fw-bold text-primary" id="quickNetAmount">$0</div>
                                                <small class="text-muted">淨收入</small>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="p-2 bg-warning bg-opacity-10 rounded">
                                                <div class="fw-bold text-warning" id="quickReceiptCount">0</div>
                                                <small class="text-muted">收據數量</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-chart-area me-2"></i>報表預覽</h5>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="refreshReport()">
                                            <i class="fas fa-sync-alt me-1"></i>重新整理
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="printReport()">
                                            <i class="fas fa-print me-1"></i>列印
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="reportContent">
                                        <div class="text-center py-5">
                                            <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                                            <h5 class="text-muted">請選擇報表類型並點擊「生成報表」</h5>
                                            <p class="text-muted">系統將為您生成詳細的財務分析報表</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系統設定 -->
                <div class="tab-pane fade" id="settings" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-building me-2"></i>機構資訊設定</h5>
                                </div>
                                <div class="card-body">
                                    <form id="organizationForm">
                                        <div class="form-group">
                                            <label class="form-label">機構名稱</label>
                                            <input type="text" class="form-control" id="orgName" 
                                                   value="台灣帕金森病友權益促進會">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">統一編號</label>
                                            <input type="text" class="form-control" id="orgTaxId" 
                                                   placeholder="請輸入統一編號">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">機構地址</label>
                                            <textarea class="form-control" id="orgAddress" 
                                                      rows="2" placeholder="請輸入機構地址"></textarea>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">聯絡電話</label>
                                                <input type="tel" class="form-control" id="orgPhone" 
                                                       placeholder="請輸入聯絡電話">
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">傳真號碼</label>
                                                <input type="tel" class="form-control" id="orgFax" 
                                                       placeholder="請輸入傳真號碼">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">電子郵件</label>
                                            <input type="email" class="form-control" id="orgEmail" 
                                                   placeholder="請輸入電子郵件">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">網站網址</label>
                                            <input type="url" class="form-control" id="orgWebsite" 
                                                   placeholder="請輸入網站網址">
                                        </div>

                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>儲存設定
                                        </button>
                                    </form>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5><i class="fas fa-envelope me-2"></i>郵件設定</h5>
                                </div>
                                <div class="card-body">
                                    <form id="emailForm">
                                        <div class="form-group">
                                            <label class="form-label">寄件人名稱</label>
                                            <input type="text" class="form-control" id="emailSenderName" 
                                                   value="台灣帕金森病友權益促進會">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">寄件人信箱</label>
                                            <input type="email" class="form-control" id="emailSenderAddress" 
                                                   placeholder="請輸入寄件人信箱">
                                        </div>

                                        <div class="form-group">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" 
                                                       id="autoSendReceipt" checked>
                                                <label class="form-check-label" for="autoSendReceipt">
                                                    自動寄送收據
                                                </label>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" 
                                                       id="emailNotification" checked>
                                                <label class="form-check-label" for="emailNotification">
                                                    啟用郵件通知
                                                </label>
                                            </div>
                                        </div>

                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>儲存設定
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-tools me-2"></i>系統管理</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-info" onclick="performSystemCheck()">
                                            <i class="fas fa-stethoscope me-2"></i>系統健康檢查
                                        </button>
                                        
                                        <button class="btn btn-warning" onclick="createBackup()">
                                            <i class="fas fa-database me-2"></i>建立系統備份
                                        </button>
                                        
                                        <button class="btn btn-success" onclick="exportAllData()">
                                            <i class="fas fa-download me-2"></i>匯出全部資料
                                        </button>
                                        
                                        <button class="btn btn-primary" onclick="importData()">
                                            <i class="fas fa-upload me-2"></i>匯入資料
                                        </button>
                                        
                                        <button class="btn btn-secondary" onclick="clearCache()">
                                            <i class="fas fa-broom me-2"></i>清除快取
                                        </button>
                                        
                                        <button class="btn btn-outline-danger" onclick="resetSystem()">
                                            <i class="fas fa-redo me-2"></i>重置系統
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5><i class="fas fa-info-circle me-2"></i>系統資訊</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>系統版本：</strong></td>
                                            <td>v4.0.0</td>
                                        </tr>
                                        <tr>
                                            <td><strong>發布日期：</strong></td>
                                            <td>2024-12-19</td>
                                        </tr>
                                        <tr>
                                            <td><strong>最後更新：</strong></td>
                                            <td id="lastUpdate">載入中...</td>
                                        </tr>
                                        <tr>
                                            <td><strong>資料庫狀態：</strong></td>
                                            <td><span class="status-badge status-success">正常</span></td>
                                        </tr>
                                        <tr>
                                            <td><strong>系統狀態：</strong></td>
                                            <td><span class="status-badge status-success">運行中</span></td>
                                        </tr>
                                        <tr>
                                            <td><strong>使用者權限：</strong></td>
                                            <td><span class="status-badge status-info">管理員</span></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5><i class="fas fa-question-circle me-2"></i>說明與支援</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary" onclick="showUserManual()">
                                            <i class="fas fa-book me-2"></i>使用手冊
                                        </button>
                                        
                                        <button class="btn btn-outline-success" onclick="showSystemTutorial()">
                                            <i class="fas fa-graduation-cap me-2"></i>系統教學
                                        </button>
                                        
                                        <button class="btn btn-outline-info" onclick="contactSupport()">
                                            <i class="fas fa-headset me-2"></i>技術支援
                                        </button>
                                        
                                        <button class="btn btn-outline-warning" onclick="reportBug()">
                                            <i class="fas fa-bug me-2"></i>回報問題
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 頁尾 -->
    <footer class="main-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2024 台灣帕金森病友權益促進會. 版權所有.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>會計管理系統 v4.0 | 技術支援: <a href="mailto:support@example.com">support@example.com</a></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 載入覆蓋層 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h5>處理中...</h5>
            <p id="loadingMessage">請稍候</p>
        </div>
    </div>

    <!-- 模態視窗 -->
    <!-- 交易詳情模態 -->
    <div class="modal fade" id="transactionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">交易詳情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="transactionModalBody">
                    <!-- 動態內容 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary" onclick="editTransaction()">編輯</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 收據詳情模態 -->
    <div class="modal fade" id="receiptModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">收據詳情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="receiptModalBody">
                    <!-- 動態內容 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-info" onclick="downloadReceipt()">下載PDF</button>
                    <button type="button" class="btn btn-success" onclick="resendReceipt()">重新寄送</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 會員詳情模態 -->
    <div class="modal fade" id="memberModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">會員詳情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="memberModalBody">
                    <!-- 動態內容 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary" onclick="editMember()">編輯</button>
                    <button type="button" class="btn btn-warning" onclick="renewMembership()">續會</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 確認刪除模態 -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>確認刪除
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmMessage">您確定要刪除這筆記錄嗎？此操作無法復原。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">確認刪除</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 函式庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>
        // ========================================
        // 全域變數和設定
        // ========================================
        
        // 請替換為您的 Google Apps Script 網址
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw7Auj2dGg_0C440tpudjp91gfJoNAELt4GNb8VhohwpM-2uTJ_4Thr1-dZlEq3BCEw9w/exec';
        
        let currentData = {
            transactions: [],
            receipts: [],
            members: [],
            dashboardStats: {}
        };

        let currentFilters = {
            transactions: {},
            receipts: {},
            members: {}
        };

        let currentPage = {
            transactions: 1,
            receipts: 1,
            members: 1
        };

        const ITEMS_PER_PAGE = 20;

        // ========================================
        // 系統初始化
        // ========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('系統載入開始...');
            
            // 初始化系統
            initializeSystem();
            
            // 設定事件監聽器
            setupEventListeners();
            
            // 載入初始資料
            loadInitialData();
            
            // 隱藏載入器
            setTimeout(() => {
                document.getElementById('pageLoader').classList.add('hidden');
            }, 1500);
        });

        async function initializeSystem() {
            try {
                // 設定當前時間顯示
                updateCurrentTime();
                setInterval(updateCurrentTime, 1000);
                
                // 設定表單預設值
                setFormDefaults();
                
                console.log('系統初始化完成');
                
            } catch (error) {
                console.error('系統初始化失敗:', error);
                showAlert('系統初始化失敗，請重新整理頁面', 'danger');
            }
        }

        function setupEventListeners() {
            // 分頁切換事件
            document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('data-bs-target');
                    handleTabChange(target);
                });
            });

            // 表單提交事件
            setupFormHandlers();
            
            // 搜尋和篩選事件
            setupFilterHandlers();
            
            // 其他互動事件
            setupOtherHandlers();
        }

        function setupFormHandlers() {
            // 交易表單
            document.getElementById('transactionForm').addEventListener('submit', handleTransactionSubmit);
            
            // 收據表單
            document.getElementById('receiptForm').addEventListener('submit', handleReceiptSubmit);
            
            // 會員表單
            document.getElementById('memberForm').addEventListener('submit', handleMemberSubmit);
            
            // 報表表單
            document.getElementById('reportForm').addEventListener('submit', handleReportSubmit);

            // 交易類型變更
            document.getElementById('transactionType').addEventListener('change', handleTransactionTypeChange);
            
            // 收據自動生成選項
            document.getElementById('generateReceipt').addEventListener('change', toggleReceiptDetails);
            
            // 機構設定表單
            document.getElementById('organizationForm').addEventListener('submit', handleOrganizationSubmit);
            
            // 郵件設定表單
            document.getElementById('emailForm').addEventListener('submit', handleEmailSubmit);
        }

        function setupFilterHandlers() {
            // 交易搜尋和篩選
            document.getElementById('transactionSearch').addEventListener('input', debounce(filterTransactions, 300));
            document.getElementById('typeFilter').addEventListener('change', filterTransactions);
            document.getElementById('dateFromFilter').addEventListener('change', filterTransactions);
            document.getElementById('dateToFilter').addEventListener('change', filterTransactions);

            // 收據搜尋和篩選
            document.getElementById('receiptSearch').addEventListener('input', debounce(filterReceipts, 300));
            document.getElementById('receiptStatusFilter').addEventListener('change', filterReceipts);
            document.getElementById('receiptCategoryFilter').addEventListener('change', filterReceipts);

            // 會員搜尋和篩選
            document.getElementById('memberSearch').addEventListener('input', debounce(filterMembers, 300));
            document.getElementById('memberTypeFilter').addEventListener('change', filterMembers);
            document.getElementById('memberStatusFilter').addEventListener('change', filterMembers);
        }

        function setupOtherHandlers() {
            // 報表類型變更
            document.getElementById('reportType').addEventListener('change', handleReportTypeChange);
            // 報表年度變更
            document.getElementById('reportYear').addEventListener('change', updateReportMonths);
        }

        // ========================================
        // 資料載入函數
        // ========================================
        
        async function loadInitialData() {
            try {
                showLoading('載入系統資料中...');
                
                // 並行載入所有資料
                const [dashboardData, transactionData, receiptData, memberData] = await Promise.all([
                    loadDashboardData(),
                    loadTransactions(),
                    loadReceipts(),
                    loadMembers()
                ]);
                
                // 更新介面
                updateDashboard(dashboardData);
                updateTransactionTable(transactionData);
                updateReceiptTable(receiptData);
                updateMemberTable(memberData);
                
                hideLoading();
                console.log('初始資料載入完成');
                
            } catch (error) {
                hideLoading();
                console.error('資料載入失敗:', error);
                showAlert('資料載入失敗，請檢查網路連線', 'danger');
            }
        }

        async function loadDashboardData() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getDashboard`);
                const data = await response.json();
                
                if (data.success) {
                    currentData.dashboardStats = data.data;
                    return data.data;
                } else {
                    throw new Error(data.error || '載入儀表板資料失敗');
                }
            } catch (error) {
                console.error('載入儀表板資料錯誤:', error);
                // 返回預設資料
                return {
                    totalIncome: 0,
                    totalExpense: 0,
                    receiptCount: 0,
                    memberCount: 0,
                    recentActivities: []
                };
            }
        }

        async function loadTransactions(page = 1, filters = {}) {
            try {
                const params = new URLSearchParams({
                    action: 'getTransactions',
                    page: page,
                    limit: ITEMS_PER_PAGE,
                    ...filters
                });
                
                const response = await fetch(`${SCRIPT_URL}?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    currentData.transactions = data.data.transactions || [];
                    return data.data;
                } else {
                    throw new Error(data.error || '載入交易記錄失敗');
                }
            } catch (error) {
                console.error('載入交易記錄錯誤:', error);
                return { transactions: [], total: 0 };
            }
        }

        async function loadReceipts(page = 1, filters = {}) {
            try {
                const params = new URLSearchParams({
                    action: 'getReceipts',
                    page: page,
                    limit: ITEMS_PER_PAGE,
                    ...filters
                });
                
                const response = await fetch(`${SCRIPT_URL}?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    currentData.receipts = data.data.receipts || [];
                    return data.data;
                } else {
                    throw new Error(data.error || '載入收據記錄失敗');
                }
            } catch (error) {
                console.error('載入收據記錄錯誤:', error);
                return { receipts: [], total: 0 };
            }
        }

        async function loadMembers(page = 1, filters = {}) {
            try {
                const params = new URLSearchParams({
                    action: 'getMembers',
                    page: page,
                    limit: ITEMS_PER_PAGE,
                    ...filters
                });
                
                const response = await fetch(`${SCRIPT_URL}?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    currentData.members = data.data.members || [];
                    return data.data;
                } else {
                    throw new Error(data.error || '載入會員資料失敗');
                }
            } catch (error) {
                console.error('載入會員資料錯誤:', error);
                return { members: [], total: 0 };
            }
        }

        // ========================================
        // 介面更新函數
        // ========================================
        
        function updateDashboard(data) {
            // 更新統計卡片
            document.getElementById('totalIncome').textContent = formatCurrency(data.totalIncome || 0);
            document.getElementById('totalExpense').textContent = formatCurrency(data.totalExpense || 0);
            document.getElementById('receiptCount').textContent = data.receiptCount || 0;
            document.getElementById('memberCount').textContent = data.memberCount || 0;

            // 更新變化百分比
            updateStatChange('incomeChange', data.incomeChange || 0);
            updateStatChange('expenseChange', data.expenseChange || 0);
            updateStatChange('receiptChange', data.receiptChange || 0);
            updateStatChange('memberChange', data.memberChange || 0);

            // 更新最近活動
            updateRecentActivities(data.recentActivities || []);
            
            // 更新快速統計
            updateQuickStats(data);
        }

        function updateStatChange(elementId, change) {
            const element = document.getElementById(elementId);
            const span = element.querySelector('span');
            const icon = element.querySelector('i');
            
            if (change > 0) {
                element.className = 'stat-change positive';
                icon.className = 'fas fa-arrow-up';
                span.textContent = `+${change}%`;
            } else if (change < 0) {
                element.className = 'stat-change negative';
                icon.className = 'fas fa-arrow-down';
                span.textContent = `${change}%`;
            } else {
                element.className = 'stat-change';
                icon.className = 'fas fa-minus';
                span.textContent = '0%';
            }
        }

        function updateRecentActivities(activities) {
            const container = document.getElementById('recentActivities');
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-3"></i>
                        <p>暫無最近活動記錄</p>
                    </div>
                `;
                return;
            }

            const html = activities.map(activity => `
                <div class="d-flex align-items-center mb-3 p-3 bg-light rounded">
                    <div class="me-3">
                        <i class="fas ${getActivityIcon(activity.type)} text-${getActivityColor(activity.type)}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="fw-bold">${activity.title}</div>
                        <div class="text-muted small">${activity.description}</div>
                    </div>
                    <div class="text-muted small">
                        ${formatDateTime(activity.timestamp)}
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function updateQuickStats(data) {
            document.getElementById('quickTotalIncome').textContent = formatCurrency(data.totalIncome || 0);
            document.getElementById('quickTotalExpense').textContent = formatCurrency(data.totalExpense || 0);
            document.getElementById('quickNetAmount').textContent = formatCurrency((data.totalIncome || 0) - (data.totalExpense || 0));
            document.getElementById('quickReceiptCount').textContent = data.receiptCount || 0;
        }

        function updateTransactionTable(data) {
            const container = document.getElementById('transactionTableContainer');
            const transactions = data.transactions || [];
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-exchange-alt fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暫無交易記錄</h5>
                        <p class="text-muted">點擊「新增交易記錄」開始記帳</p>
                    </div>
                `;
                return;
            }

            const tableHtml = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>姓名</th>
                            <th>類型</th>
                            <th>類別</th>
                            <th>帳戶</th>
                            <th>金額</th>
                            <th>說明</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${transactions.map(transaction => `
                            <tr>
                                <td>${formatDate(transaction.date)}</td>
                                <td>${transaction.name}</td>
                                <td>
                                    <span class="status-badge ${transaction.type === '收入' ? 'status-success' : 'status-danger'}">
                                        ${transaction.type}
                                    </span>
                                </td>
                                <td>${transaction.category}</td>
                                <td>${transaction.account || '-'}</td>
                                <td class="text-end fw-bold ${transaction.type === '收入' ? 'text-success' : 'text-danger'}">
                                    ${transaction.type === '收入' ? '+' : '-'}${formatCurrency(transaction.amount)}
                                </td>
                                <td>${transaction.description || '-'}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewTransaction('${transaction.id}')" title="檢視">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="editTransaction('${transaction.id}')" title="編輯">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteTransaction('${transaction.id}')" title="刪除">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHtml;
            
            // 更新分頁
            updatePagination('transactionPagination', data.total || 0, currentPage.transactions, 'transactions');
        }

        function updateReceiptTable(data) {
            const container = document.getElementById('receiptTableContainer');
            const receipts = data.receipts || [];
            
            if (receipts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暫無收據記錄</h5>
                        <p class="text-muted">點擊「開立收據」開始開立收據</p>
                    </div>
                `;
                return;
            }

            const tableHtml = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>收據編號</th>
                            <th>日期</th>
                            <th>付款人</th>
                            <th>身分</th>
                            <th>類別</th>
                            <th>金額</th>
                            <th>狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${receipts.map(receipt => `
                            <tr>
                                <td class="fw-bold">${receipt.number}</td>
                                <td>${formatDate(receipt.date)}</td>
                                <td>${receipt.payer}</td>
                                <td>${receipt.identity}</td>
                                <td>${receipt.category}</td>
                                <td class="text-end fw-bold text-success">
                                    ${formatCurrency(receipt.amount)}
                                </td>
                                <td>
                                    <span class="status-badge ${getReceiptStatusClass(receipt.status)}">
                                        ${receipt.status}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewReceipt('${receipt.id}')" title="檢視">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="downloadReceipt('${receipt.id}')" title="下載">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" onclick="resendReceipt('${receipt.id}')" title="重新寄送">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteReceipt('${receipt.id}')" title="刪除">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHtml;
            
            // 更新分頁
            updatePagination('receiptPagination', data.total || 0, currentPage.receipts, 'receipts');
        }

        function updateMemberTable(data) {
            const container = document.getElementById('memberTableContainer');
            const members = data.members || [];
            
            // 更新會員統計
            updateMemberStats(data.stats || {});
            
            if (members.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暫無會員資料</h5>
                        <p class="text-muted">點擊「新增會員」開始建立會員資料</p>
                    </div>
                `;
                return;
            }

            const tableHtml = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>性別</th>
                            <th>電話</th>
                            <th>電子郵件</th>
                            <th>會員類型</th>
                            <th>入會日期</th>
                            <th>會費狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${members.map(member => `
                            <tr>
                                <td class="fw-bold">${member.name}</td>
                                <td>${member.gender || '-'}</td>
                                <td>${member.phone}</td>
                                <td>${member.email || '-'}</td>
                                <td>
                                    <span class="status-badge status-info">
                                        ${member.type}
                                    </span>
                                </td>
                                <td>${formatDate(member.joinDate)}</td>
                                <td>
                                    <span class="status-badge ${getMemberStatusClass(member.feeStatus)}">
                                        ${member.feeStatus}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewMember('${member.id}')" title="檢視">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="editMember('${member.id}')" title="編輯">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="renewMembership('${member.id}')" title="續會">
                                            <i class="fas fa-redo"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMember('${member.id}')" title="刪除">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHtml;
            
            // 更新分頁
            updatePagination('memberPagination', data.total || 0, currentPage.members, 'members');
        }

        function updateMemberStats(stats) {
            document.getElementById('totalMembers').textContent = stats.total || 0;
            document.getElementById('paidMembers').textContent = stats.paid || 0;
            document.getElementById('unpaidMembers').textContent = stats.unpaid || 0;
            document.getElementById('newMembers').textContent = stats.newThisMonth || 0;
        }

        function updatePagination(containerId, total, currentPage, type) {
            const container = document.getElementById(containerId);
            const totalPages = Math.ceil(total / ITEMS_PER_PAGE);
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '';
            
            // 上一頁
            html += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage('${type}', ${currentPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;

            // 頁碼
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="changePage('${type}', 1)">1</a></li>`;
                if (startPage > 2) {
                    html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage('${type}', ${i})">${i}</a>
                    </li>
                `;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
                html += `<li class="page-item"><a class="page-link" href="#" onclick="changePage('${type}', ${totalPages})">${totalPages}</a></li>`;
            }

            // 下一頁
            html += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage('${type}', ${currentPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;

            container.innerHTML = html;
        }

        // ========================================
        // 表單處理函數
        // ========================================
        
        async function handleTransactionSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // 驗證表單
            if (!validateTransactionForm(data)) {
                return;
            }

            try {
                showLoading('儲存交易記錄中...');
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addTransaction',
                        data: data
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAlert('交易記錄已成功儲存', 'success');
                    clearTransactionForm();
                    refreshTransactions();
                    refreshDashboard();
                } else {
                    throw new Error(result.error || '儲存失敗');
                }
                
            } catch (error) {
                console.error('儲存交易記錄錯誤:', error);
                showAlert('儲存交易記錄失敗: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        async function handleReceiptSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // 驗證表單
            if (!validateReceiptForm(data)) {
                return;
            }

            try {
                showLoading('開立收據中...');
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addReceipt',
                        data: data
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAlert('收據已成功開立', 'success');
                    clearReceiptForm();
                    refreshReceipts();
                    refreshDashboard();
                    
                    // 如果需要自動寄送郵件
                    if (data.autoSendEmail && data.email) {
                        await sendReceiptEmail(result.receiptId);
                    }
                } else {
                    throw new Error(result.error || '開立收據失敗');
                }
                
            } catch (error) {
                console.error('開立收據錯誤:', error);
                showAlert('開立收據失敗: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        async function handleMemberSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // 驗證表單
            if (!validateMemberForm(data)) {
                return;
            }

            try {
                showLoading('新增會員中...');
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addMember',
                        data: data
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAlert('會員已成功新增', 'success');
                    clearMemberForm();
                    refreshMembers();
                    refreshDashboard();
                } else {
                    throw new Error(result.error || '新增會員失敗');
                }
                
            } catch (error) {
                console.error('新增會員錯誤:', error);
                showAlert('新增會員失敗: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        async function handleReportSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                showLoading('生成報表中...');
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'generateReport',
                        data: data
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    if (data.reportFormat === 'html') {
                        displayReport(result.reportHtml);
                    } else {
                        // 下載檔案
                        downloadFile(result.fileUrl, result.fileName);
                    }
                    showAlert('報表已成功生成', 'success');
                } else {
                    throw new Error(result.error || '生成報表失敗');
                }
                
            } catch (error) {
                console.error('生成報表錯誤:', error);
                showAlert('生成報表失敗: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        // ========================================
        // 工具函數
        // ========================================
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('zh-TW', {
                style: 'currency',
                currency: 'TWD',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-TW');
        }

        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('zh-TW');
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function setFormDefaults() {
            // 設定今天日期為預設值
            const today = new Date().toISOString().split('T')[0];
            
            const dateInputs = [
                'transactionDate',
                'receiptDate',
                'memberJoinDate'
            ];
            
            dateInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element && !element.value) {
                    element.value = today;
                }
            });

            // 設定當前年月為報表預設值
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            
            document.getElementById('reportYear').value = currentYear;
            document.getElementById('reportMonth').value = currentMonth;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showLoading(message = '處理中...') {
            const overlay = document.getElementById('loadingOverlay');
            const messageElement = document.getElementById('loadingMessage');
            
            if (messageElement) {
                messageElement.textContent = message;
            }
            
            overlay.classList.add('show');
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('show');
        }

        function showAlert(message, type = 'info', duration = 5000) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${getAlertIcon(type)} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            const container = document.getElementById('globalMessage');
            container.innerHTML = alertHtml;
            
            // 自動隱藏
            if (duration > 0) {
                setTimeout(() => {
                    const alert = container.querySelector('.alert');
                    if (alert) {
                        const bsAlert = new bootstrap.Alert(alert);
                        bsAlert.close();
                    }
                }, duration);
            }
        }

        function getAlertIcon(type) {
            const icons = {
                'success': 'check-circle',
                'danger': 'exclamation-triangle',
                'warning': 'exclamation-circle',
                'info': 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        function getActivityIcon(type) {
            const icons = {
                'transaction': 'exchange-alt',
                'receipt': 'receipt',
                'member': 'user-plus',
                'system': 'cog'
            };
            return icons[type] || 'circle';
        }

        function getActivityColor(type) {
            const colors = {
                'transaction': 'primary',
                'receipt': 'success',
                'member': 'info',
                'system': 'warning'
            };
            return colors[type] || 'secondary';
        }

        function getReceiptStatusClass(status) {
            const classes = {
                '已開立': 'status-info',
                '已寄送': 'status-success',
                '已列印': 'status-warning'
            };
            return classes[status] || 'status-secondary';
        }

        function getMemberStatusClass(status) {
            const classes = {
                '已繳費': 'status-success',
                '未繳費': 'status-danger',
                '部分繳費': 'status-warning',
                '免繳費': 'status-info'
            };
            return classes[status] || 'status-secondary';
        }

        // ========================================
        // 表單驗證函數
        // ========================================
        
        function validateTransactionForm(data) {
            const errors = [];
            
            if (!data.transactionDate) {
                errors.push('請選擇交易日期');
            }
            
            if (!data.transactionName || data.transactionName.trim() === '') {
                errors.push('請輸入姓名');
            }
            
            if (!data.transactionType) {
                errors.push('請選擇交易類型');
            }
            
            if (!data.transactionCategory) {
                errors.push('請選擇類別');
            }
            
            if (!data.transactionAmount || parseFloat(data.transactionAmount) <= 0) {
                errors.push('請輸入有效的金額');
            }

            if (errors.length > 0) {
                showAlert('表單驗證失敗：<br>' + errors.join('<br>'), 'danger');
                return false;
            }
            
            return true;
        }

        function validateReceiptForm(data) {
            const errors = [];
            
            if (!data.receiptDate) {
                errors.push('請選擇收據日期');
            }
            
            if (!data.receiptPayer || data.receiptPayer.trim() === '') {
                errors.push('請輸入付款人姓名');
            }
            
            if (!data.receiptCategory) {
                errors.push('請選擇收款類別');
            }
            
            if (!data.receiptAmount || parseFloat(data.receiptAmount) <= 0) {
                errors.push('請輸入有效的金額');
            }

            if (data.receiptEmail && !isValidEmail(data.receiptEmail)) {
                errors.push('請輸入有效的電子郵件地址');
            }

            if (errors.length > 0) {
                showAlert('表單驗證失敗：<br>' + errors.join('<br>'), 'danger');
                return false;
            }
            
            return true;
        }

        function validateMemberForm(data) {
            const errors = [];
            
            if (!data.memberName || data.memberName.trim() === '') {
                errors.push('請輸入會員姓名');
            }
            
            if (!data.memberPhone || data.memberPhone.trim() === '') {
                errors.push('請輸入聯絡電話');
            }
            
            if (!data.memberType) {
                errors.push('請選擇會員類型');
            }

            if (data.memberEmail && !isValidEmail(data.memberEmail)) {
                errors.push('請輸入有效的電子郵件地址');
            }

            if (data.memberIdCard && !isValidIdCard(data.memberIdCard)) {
                errors.push('請輸入有效的身分證字號');
            }

            if (errors.length > 0) {
                showAlert('表單驗證失敗：<br>' + errors.join('<br>'), 'danger');
                return false;
            }
            
            return true;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function isValidIdCard(idCard) {
            const idRegex = /^[A-Z][12]\d{8}$/;
            return idRegex.test(idCard);
        }

        // ========================================
        // 事件處理函數
        // ========================================
        
        function handleTabChange(target) {
            const tabName = target.replace('#', '');
            
            switch (tabName) {
                case 'dashboard':
                    refreshDashboard();
                    break;
                case 'transaction':
                    if (currentData.transactions.length === 0) {
                        refreshTransactions();
                    }
                    break;
                case 'receipt':
                    if (currentData.receipts.length === 0) {
                        refreshReceipts();
                    }
                    break;
                case 'member':
                    if (currentData.members.length === 0) {
                        refreshMembers();
                    }
                    break;
                case 'report':
                    updateQuickStats(currentData.dashboardStats);
                    break;
            }
        }

        function handleTransactionTypeChange() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('transactionCategory');
            const incomeOptions = document.getElementById('incomeOptions');
            const expenseOptions = document.getElementById('expenseOptions');
            
            // 清空類別選項
            categorySelect.innerHTML = '<option value="">請選擇類別</option>';
            
            // 隱藏所有選項
            incomeOptions.style.display = 'none';
            expenseOptions.style.display = 'none';
            
            if (type === '收入') {
                // 收入類別
                const incomeCategories = [
                    '會費',
                    '捐款',
                    '活動收入',
                    '利息收入',
                    '其他收入'
                ];
                
                incomeCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
                
                incomeOptions.style.display = 'block';
                
            } else if (type === '支出') {
                // 支出類別
                const expenseCategories = [
                    '辦公費用',
                    '活動支出',
                    '交通費',
                    '餐費',
                    '文具用品',
                    '印刷費',
                    '郵資',
                    '其他支出'
                ];
                
                expenseCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
                
                expenseOptions.style.display = 'block';
            }
        }

        function toggleReceiptDetails() {
            const checkbox = document.getElementById('generateReceipt');
            const details = document.getElementById('receiptDetails');
            
            details.style.display = checkbox.checked ? 'block' : 'none';
        }

        function handleReportTypeChange() {
            const type = document.getElementById('reportType').value;
            const monthGroup = document.getElementById('monthGroup');
            
            // 月度報表需要選擇月份，年度報表不需要
            monthGroup.style.display = type === 'monthly' ? 'block' : 'none';
        }

        function updateReportMonths() {
            // 這裡可以根據年度更新可用月份
            // 目前保持簡單實作
        }

        // ========================================
        // 篩選和搜尋函數
        // ========================================
        
        async function filterTransactions() {
            const filters = {
                search: document.getElementById('transactionSearch').value,
                type: document.getElementById('typeFilter').value,
                dateFrom: document.getElementById('dateFromFilter').value,
                dateTo: document.getElementById('dateToFilter').value
            };
            
            currentFilters.transactions = filters;
            currentPage.transactions = 1;
            
            const data = await loadTransactions(1, filters);
            updateTransactionTable(data);
        }

        async function filterReceipts() {
            const filters = {
                search: document.getElementById('receiptSearch').value,
                status: document.getElementById('receiptStatusFilter').value,
                category: document.getElementById('receiptCategoryFilter').value
            };
            
            currentFilters.receipts = filters;
            currentPage.receipts = 1;
            
            const data = await loadReceipts(1, filters);
            updateReceiptTable(data);
        }

        async function filterMembers() {
            const filters = {
                search: document.getElementById('memberSearch').value,
                type: document.getElementById('memberTypeFilter').value,
                status: document.getElementById('memberStatusFilter').value
            };
            
            currentFilters.members = filters;
            currentPage.members = 1;
            
            const data = await loadMembers(1, filters);
            updateMemberTable(data);
        }

        function clearMemberFilters() {
            document.getElementById('memberSearch').value = '';
            document.getElementById('memberTypeFilter').value = '';
            document.getElementById('memberStatusFilter').value = '';
            
            filterMembers();
        }

        // ========================================
        // 分頁函數
        // ========================================
        
        async function changePage(type, page) {
            if (page < 1) return;
            
            currentPage[type] = page;
            
            let data;
            switch (type) {
                case 'transactions':
                    data = await loadTransactions(page, currentFilters.transactions);
                    updateTransactionTable(data);
                    break;
                case 'receipts':
                    data = await loadReceipts(page, currentFilters.receipts);
                    updateReceiptTable(data);
                    break;
                case 'members':
                    data = await loadMembers(page, currentFilters.members);
                    updateMemberTable(data);
                    break;
            }
        }

        // ========================================
        // 刷新函數
        // ========================================
        
        async function refreshDashboard() {
            const data = await loadDashboardData();
            updateDashboard(data);
        }

        async function refreshTransactions() {
            const data = await loadTransactions(currentPage.transactions, currentFilters.transactions);
            updateTransactionTable(data);
        }

        async function refreshReceipts() {
            const data = await loadReceipts(currentPage.receipts, currentFilters.receipts);
            updateReceiptTable(data);
        }

        async function refreshMembers() {
            const data = await loadMembers(currentPage.members, currentFilters.members);
            updateMemberTable(data);
        }

        // ========================================
        // 表單清除函數
        // ========================================
        
        function clearTransactionForm() {
            document.getElementById('transactionForm').reset();
            setFormDefaults();
            
            // 重置動態選項
            document.getElementById('incomeOptions').style.display = 'none';
            document.getElementById('expenseOptions').style.display = 'none';
            document.getElementById('receiptDetails').style.display = 'none';
            
            // 清空類別選項
            const categorySelect = document.getElementById('transactionCategory');
            categorySelect.innerHTML = '<option value="">請選擇類別</option>';
        }

        function clearReceiptForm() {
            document.getElementById('receiptForm').reset();
            setFormDefaults();
        }

        function clearMemberForm() {
            document.getElementById('memberForm').reset();
            setFormDefaults();
        }

        // ========================================
        // 快速操作函數
        // ========================================
        
        function showTransactionForm() {
            // 切換到交易記錄分頁
            const tab = new bootstrap.Tab(document.querySelector('[data-bs-target="#transaction"]'));
            tab.show();
            
            // 聚焦到姓名欄位
            setTimeout(() => {
                document.getElementById('transactionName').focus();
            }, 100);
        }

        function showReceiptForm() {
            // 切換到收據管理分頁
            const tab = new bootstrap.Tab(document.querySelector('[data-bs-target="#receipt"]'));
            tab.show();
            
            // 聚焦到付款人欄位
            setTimeout(() => {
                document.getElementById('receiptPayer').focus();
            }, 100);
        }

        function showMemberForm() {
            // 切換到會員管理分頁
            const tab = new bootstrap.Tab(document.querySelector('[data-bs-target="#member"]'));
            tab.show();
            
            // 聚焦到姓名欄位
            setTimeout(() => {
                document.getElementById('memberName').focus();
            }, 100);
        }

        function generateReport() {
            // 切換到報表分析分頁
            const tab = new bootstrap.Tab(document.querySelector('[data-bs-target="#report"]'));
            tab.show();
        }

        // ========================================
        // 檢視、編輯、刪除函數
        // ========================================
        
        function viewTransaction(id) {
            const transaction = currentData.transactions.find(t => t.id === id);
            if (!transaction) return;
            
            const modalBody = document.getElementById('transactionModalBody');
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>日期：</strong>${formatDate(transaction.date)}</p>
                        <p><strong>姓名：</strong>${transaction.name}</p>
                        <p><strong>類型：</strong><span class="status-badge ${transaction.type === '收入' ? 'status-success' : 'status-danger'}">${transaction.type}</span></p>
                        <p><strong>類別：</strong>${transaction.category}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>帳戶：</strong>${transaction.account || '-'}</p>
                        <p><strong>金額：</strong><span class="fw-bold ${transaction.type === '收入' ? 'text-success' : 'text-danger'}">${formatCurrency(transaction.amount)}</span></p>
                        <p><strong>說明：</strong>${transaction.description || '-'}</p>
                        <p><strong>建立時間：</strong>${formatDateTime(transaction.createdAt)}</p>
                    </div>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('transactionModal'));
            modal.show();
        }

        function editTransaction(id) {
            // 實作編輯功能
            console.log('編輯交易:', id);
            showAlert('編輯功能開發中', 'info');
        }

        function deleteTransaction(id) {
            const transaction = currentData.transactions.find(t => t.id === id);
            if (!transaction) return;
            
            document.getElementById('deleteConfirmMessage').textContent = 
                `您確定要刪除 ${transaction.name} 的交易記錄嗎？此操作無法復原。`;
            
            document.getElementById('confirmDeleteBtn').onclick = async function() {
                try {
                    showLoading('刪除中...');
                    
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'deleteTransaction',
                            id: id
                        })
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert('交易記錄已刪除', 'success');
                        refreshTransactions();
                        refreshDashboard();
                    } else {
                        throw new Error(result.error || '刪除失敗');
                    }
                    
                } catch (error) {
                    console.error('刪除交易記錄錯誤:', error);
                    showAlert('刪除失敗: ' + error.message, 'danger');
                } finally {
                    hideLoading();
                    bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal')).hide();
                }
            };
            
            const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            modal.show();
        }

        function viewReceipt(id) {
            const receipt = currentData.receipts.find(r => r.id === id);
            if (!receipt) return;
            
            const modalBody = document.getElementById('receiptModalBody');
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>收據編號：</strong>${receipt.number}</p>
                        <p><strong>日期：</strong>${formatDate(receipt.date)}</p>
                        <p><strong>付款人：</strong>${receipt.payer}</p>
                        <p><strong>身分：</strong>${receipt.identity}</p>
                        <p><strong>聯絡電話：</strong>${receipt.phone || '-'}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>電子郵件：</strong>${receipt.email || '-'}</p>
                        <p><strong>類別：</strong>${receipt.category}</p>
                        <p><strong>金額：</strong><span class="fw-bold text-success">${formatCurrency(receipt.amount)}</span></p>
                        <p><strong>狀態：</strong><span class="status-badge ${getReceiptStatusClass(receipt.status)}">${receipt.status}</span></p>
                        <p><strong>建立時間：</strong>${formatDateTime(receipt.createdAt)}</p>
                    </div>
                </div>
                ${receipt.description ? `<div class="mt-3"><strong>用途說明：</strong><br>${receipt.description}</div>` : ''}
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('receiptModal'));
            modal.show();
        }

        function downloadReceipt(id) {
            // 實作下載收據功能
            console.log('下載收據:', id);
            showAlert('下載功能開發中', 'info');
        }

        function resendReceipt(id) {
            // 實作重新寄送收據功能
            console.log('重新寄送收據:', id);
            showAlert('重新寄送功能開發中', 'info');
        }

        function deleteReceipt(id) {
            const receipt = currentData.receipts.find(r => r.id === id);
            if (!receipt) return;
            
            document.getElementById('deleteConfirmMessage').textContent = 
                `您確定要刪除收據 ${receipt.number} 嗎？此操作無法復原。`;
            
            document.getElementById('confirmDeleteBtn').onclick = async function() {
                try {
                    showLoading('刪除中...');
                    
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'deleteReceipt',
                            id: id
                        })
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert('收據已刪除', 'success');
                        refreshReceipts();
                        refreshDashboard();
                    } else {
                        throw new Error(result.error || '刪除失敗');
                    }
                    
                } catch (error) {
                    console.error('刪除收據錯誤:', error);
                    showAlert('刪除失敗: ' + error.message, 'danger');
                } finally {
                    hideLoading();
                    bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal')).hide();
                }
            };
            
            const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            modal.show();
        }

        function viewMember(id) {
            const member = currentData.members.find(m => m.id === id);
            if (!member) return;
            
            const modalBody = document.getElementById('memberModalBody');
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>姓名：</strong>${member.name}</p>
                        <p><strong>性別：</strong>${member.gender || '-'}</p>
                        <p><strong>生日：</strong>${formatDate(member.birthDate) || '-'}</p>
                        <p><strong>身分證字號：</strong>${member.idCard || '-'}</p>
                        <p><strong>電話：</strong>${member.phone}</p>
                        <p><strong>手機：</strong>${member.mobile || '-'}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>電子郵件：</strong>${member.email || '-'}</p>
                        <p><strong>會員類型：</strong><span class="status-badge status-info">${member.type}</span></p>
                        <p><strong>入會日期：</strong>${formatDate(member.joinDate)}</p>
                        <p><strong>會費狀態：</strong><span class="status-badge ${getMemberStatusClass(member.feeStatus)}">${member.feeStatus}</span></p>
                        <p><strong>緊急聯絡人：</strong>${member.emergencyContact || '-'}</p>
                        <p><strong>緊急聯絡電話：</strong>${member.emergencyPhone || '-'}</p>
                    </div>
                </div>
                ${member.address ? `<div class="mt-3"><strong>地址：</strong><br>${member.address}</div>` : ''}
                ${member.notes ? `<div class="mt-3"><strong>備註：</strong><br>${member.notes}</div>` : ''}
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('memberModal'));
            modal.show();
        }

        function editMember(id) {
            // 實作編輯會員功能
            console.log('編輯會員:', id);
            showAlert('編輯功能開發中', 'info');
        }

        function renewMembership(id) {
            // 實作續會功能
            console.log('會員續會:', id);
            showAlert('續會功能開發中', 'info');
        }

        function deleteMember(id) {
            const member = currentData.members.find(m => m.id === id);
            if (!member) return;
            
            document.getElementById('deleteConfirmMessage').textContent = 
                `您確定要刪除會員 ${member.name} 嗎？此操作無法復原。`;
            
            document.getElementById('confirmDeleteBtn').onclick = async function() {
                try {
                    showLoading('刪除中...');
                    
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'deleteMember',
                            id: id
                        })
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert('會員已刪除', 'success');
                        refreshMembers();
                        refreshDashboard();
                    } else {
                        throw new Error(result.error || '刪除失敗');
                    }
                    
                } catch (error) {
                    console.error('刪除會員錯誤:', error);
                    showAlert('刪除失敗: ' + error.message, 'danger');
                } finally {
                    hideLoading();
                    bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal')).hide();
                }
            };
            
            const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            modal.show();
        }

        // ========================================
        // 匯出功能
        // ========================================
        
        function exportTransactions() {
            showAlert('匯出功能開發中', 'info');
        }

        function exportReceipts() {
            showAlert('匯出功能開發中', 'info');
        }

        function exportMembers() {
            showAlert('匯出功能開發中', 'info');
        }

        function importMembers() {
            showAlert('匯入功能開發中', 'info');
        }

        // ========================================
        // 報表功能
        // ========================================
        
        function displayReport(html) {
            document.getElementById('reportContent').innerHTML = html;
        }

        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function scheduleReport() {
            showAlert('排程報表功能開發中', 'info');
        }

        function refreshReport() {
            showAlert('請重新生成報表', 'info');
        }

        function printReport() {
            window.print();
        }

        // ========================================
        // 系統管理功能
        // ========================================
        
        async function handleOrganizationSubmit(e) {
            e.preventDefault();
            showAlert('機構設定已儲存', 'success');
        }

        async function handleEmailSubmit(e) {
            e.preventDefault();
            showAlert('郵件設定已儲存', 'success');
        }

        function performSystemCheck() {
            showLoading('執行系統檢查中...');
            
            setTimeout(() => {
                hideLoading();
                showAlert('系統檢查完成，一切正常', 'success');
            }, 2000);
        }

        function createBackup() {
            showAlert('備份功能開發中', 'info');
        }

        function exportAllData() {
            showAlert('匯出功能開發中', 'info');
        }

        function importData() {
            showAlert('匯入功能開發中', 'info');
        }

        function clearCache() {
            // 清除本地快取
            currentData = {
                transactions: [],
                receipts: [],
                members: [],
                dashboardStats: {}
            };
            
            showAlert('快取已清除', 'success');
        }

        function resetSystem() {
            if (confirm('您確定要重置系統嗎？這將清除所有資料，此操作無法復原！')) {
                showAlert('重置功能需要管理員權限', 'warning');
            }
        }

        // ========================================
        // 說明與支援功能
        // ========================================
        
        function showUserManual() {
            showAlert('使用手冊功能開發中', 'info');
        }

        function showSystemTutorial() {
            showAlert('系統教學功能開發中', 'info');
        }

        function contactSupport() {
            showAlert('技術支援功能開發中', 'info');
        }

        function reportBug() {
            showAlert('問題回報功能開發中', 'info');
        }

        // ========================================
        // 其他輔助功能
        // ========================================
        
        async function sendReceiptEmail(receiptId) {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'sendReceiptEmail',
                        receiptId: receiptId
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAlert('收據已成功寄送', 'success');
                } else {
                    console.error('寄送收據失敗:', result.error);
                }
                
            } catch (error) {
                console.error('寄送收據錯誤:', error);
            }
        }

        // 設定最後更新時間
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-TW');

        // ========================================
        // 鍵盤快速鍵支援
        // ========================================
        
        document.addEventListener('keydown', function(e) {
            // Ctrl + N: 新增交易
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showTransactionForm();
            }
            
            // Ctrl + R: 新增收據
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                showReceiptForm();
            }
            
            // Ctrl + M: 新增會員
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                showMemberForm();
            }
            
            // F5: 重新整理當前分頁資料
            if (e.key === 'F5') {
                e.preventDefault();
                refreshCurrentTab();
            }
            
            // Escape: 關閉模態視窗
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.show');
                modals.forEach(modal => {
                    const bsModal = bootstrap.Modal.getInstance(modal);
                    if (bsModal) {
                        bsModal.hide();
                    }
                });
            }
        });

        function refreshCurrentTab() {
            const activeTab = document.querySelector('.nav-link.active');
            if (!activeTab) return;
            
            const target = activeTab.getAttribute('data-bs-target');
            handleTabChange(target);
        }

        // ========================================
        // 自動儲存功能
        // ========================================
        
        let autoSaveTimer;
        
        function enableAutoSave(formId) {
            const form = document.getElementById(formId);
            if (!form) return;
            
            const inputs = form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        saveFormDraft(formId);
                    }, 2000); // 2秒後自動儲存草稿
                });
            });
        }

        function saveFormDraft(formId) {
            const form = document.getElementById(formId);
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // 儲存到 localStorage
            localStorage.setItem(`draft_${formId}`, JSON.stringify(data));
            
            // 顯示儲存指示
            showAutoSaveIndicator();
        }

        function loadFormDraft(formId) {
            const draftData = localStorage.getItem(`draft_${formId}`);
            if (!draftData) return;
            
            try {
                const data = JSON.parse(draftData);
                const form = document.getElementById(formId);
                
                Object.keys(data).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = data[key];
                    }
                });
                
                showAlert('已載入上次未完成的表單資料', 'info', 3000);
                
            } catch (error) {
                console.error('載入草稿失敗:', error);
            }
        }

        function clearFormDraft(formId) {
            localStorage.removeItem(`draft_${formId}`);
        }

        function showAutoSaveIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'auto-save-indicator';
            indicator.innerHTML = '<i class="fas fa-check"></i> 已自動儲存';
            
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                indicator.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(indicator);
                }, 300);
            }, 2000);
        }

        // ========================================
        // 離線支援
        // ========================================
        
        let isOnline = navigator.onLine;
        let offlineQueue = [];

        window.addEventListener('online', function() {
            isOnline = true;
            showAlert('網路連線已恢復', 'success');
            processOfflineQueue();
        });

        window.addEventListener('offline', function() {
            isOnline = false;
            showAlert('網路連線中斷，資料將暫存至本地', 'warning');
        });

        function addToOfflineQueue(action, data) {
            offlineQueue.push({
                action: action,
                data: data,
                timestamp: new Date().toISOString()
            });
            
            // 儲存到 localStorage
            localStorage.setItem('offlineQueue', JSON.stringify(offlineQueue));
            
            showAlert('資料已加入離線佇列，將在網路恢復後同步', 'info');
        }

        async function processOfflineQueue() {
            if (offlineQueue.length === 0) return;
            
            showLoading('同步離線資料中...');
            
            const successCount = 0;
            const failCount = 0;
            
            for (const item of offlineQueue) {
                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: item.action,
                            data: item.data
                        })
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                    
                } catch (error) {
                    console.error('同步離線資料錯誤:', error);
                    failCount++;
                }
            }
            
            // 清空佇列
            offlineQueue = [];
            localStorage.removeItem('offlineQueue');
            
            hideLoading();
            
            if (successCount > 0) {
                showAlert(`成功同步 ${successCount} 筆資料`, 'success');
                // 重新載入資料
                loadInitialData();
            }
            
            if (failCount > 0) {
                showAlert(`${failCount} 筆資料同步失敗`, 'warning');
            }
        }

        // 載入離線佇列
        function loadOfflineQueue() {
            const queueData = localStorage.getItem('offlineQueue');
            if (queueData) {
                try {
                    offlineQueue = JSON.parse(queueData);
                    
                    if (offlineQueue.length > 0 && isOnline) {
                        processOfflineQueue();
                    }
                } catch (error) {
                    console.error('載入離線佇列失敗:', error);
                    localStorage.removeItem('offlineQueue');
                }
            }
        }

        // ========================================
        // 效能優化
        // ========================================
        
        // 圖片延遲載入
        function lazyLoadImages() {
            const images = document.querySelectorAll('img[data-src]');
            
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                });
            });

            images.forEach(img => imageObserver.observe(img));
        }

        // 虛擬滾動（大量資料時使用）
        function initVirtualScroll(containerId, items, renderItem) {
            const container = document.getElementById(containerId);
            const itemHeight = 50; // 每項高度
            const visibleItems = Math.ceil(container.clientHeight / itemHeight) + 1;
            
            let scrollTop = 0;
            let startIndex = 0;
            
            function render() {
                const endIndex = Math.min(startIndex + visibleItems, items.length);
                const visibleData = items.slice(startIndex, endIndex);
                
                container.innerHTML = visibleData.map((item, index) => 
                    renderItem(item, startIndex + index)
                ).join('');
                
                container.style.paddingTop = `${startIndex * itemHeight}px`;
                container.style.paddingBottom = `${(items.length - endIndex) * itemHeight}px`;
            }
            
            container.addEventListener('scroll', function() {
                scrollTop = container.scrollTop;
                const newStartIndex = Math.floor(scrollTop / itemHeight);
                
                if (newStartIndex !== startIndex) {
                    startIndex = newStartIndex;
                    render();
                }
            });
            
            render();
        }

        // ========================================
        // 資料驗證和清理
        // ========================================
        
        function sanitizeInput(input) {
            if (typeof input !== 'string') return input;
            
            return input
                .replace(/[<>]/g, '') // 移除 HTML 標籤
                .trim(); // 移除前後空白
        }

        function validatePhoneNumber(phone) {
            const phoneRegex = /^(\+886|0)?[2-9]\d{8}$/;
            return phoneRegex.test(phone.replace(/[-\s]/g, ''));
        }

        function formatPhoneNumber(phone) {
            const cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.length === 10 && cleaned.startsWith('0')) {
                return cleaned.replace(/(\d{2})(\d{4})(\d{4})/, '$1-$2-$3');
            } else if (cleaned.length === 9) {
                return '0' + cleaned.replace(/(\d{2})(\d{4})(\d{4})/, '$1-$2-$3');
            }
            
            return phone;
        }

        // ========================================
        // 系統監控和錯誤處理
        // ========================================
        
        // 全域錯誤處理
        window.addEventListener('error', function(e) {
            console.error('系統錯誤:', e.error);
            
            // 記錄錯誤到本地
            const errorLog = {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            const logs = JSON.parse(localStorage.getItem('errorLogs') || '[]');
            logs.push(errorLog);
            
            // 只保留最近 50 筆錯誤記錄
            if (logs.length > 50) {
                logs.splice(0, logs.length - 50);
            }
            
            localStorage.setItem('errorLogs', JSON.stringify(logs));
        });

        // Promise 錯誤處理
        window.addEventListener('unhandledrejection', function(e) {
            console.error('未處理的 Promise 錯誤:', e.reason);
            
            showAlert('系統發生未預期的錯誤，請重新整理頁面', 'danger');
        });

        // 效能監控
        function monitorPerformance() {
            if ('performance' in window) {
                window.addEventListener('load', function() {
                    setTimeout(function() {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        
                        const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                        const domContentLoaded = perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart;
                        
                        console.log('頁面載入時間:', loadTime + 'ms');
                        console.log('DOM 載入時間:', domContentLoaded + 'ms');
                        
                        // 如果載入時間過長，顯示警告
                        if (loadTime > 5000) {
                            showAlert('系統載入較慢，建議檢查網路連線', 'warning');
                        }
                    }, 0);
                });
            }
        }

        // ========================================
        // 系統初始化完成
        // ========================================
        
        // 啟用各種功能
        document.addEventListener('DOMContentLoaded', function() {
            // 載入離線佇列
            loadOfflineQueue();
            
            // 啟用自動儲存
            enableAutoSave('transactionForm');
            enableAutoSave('receiptForm');
            enableAutoSave('memberForm');
            
            // 載入表單草稿
            setTimeout(() => {
                loadFormDraft('transactionForm');
                loadFormDraft('receiptForm');
                loadFormDraft('memberForm');
            }, 1000);
            
            // 啟用圖片延遲載入
            lazyLoadImages();
            
            // 啟用效能監控
            monitorPerformance();
            
            console.log('台灣帕金森病友權益促進會會計管理系統已就緒');
            console.log('版本: v4.0.0');
            console.log('最後更新: 2024-12-19');
            console.log('支援功能: 交易記錄、收據管理、會員管理、報表分析、離線支援');
        });

        // ========================================
        // CSS 樣式補充
        // ========================================
        
        // 動態添加 CSS 樣式
        const additionalStyles = `
            <style>
                .auto-save-indicator {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 8px 16px;
                    border-radius: 4px;
                    font-size: 14px;
                    opacity: 0;
                    transform: translateY(-20px);
                    transition: all 0.3s ease;
                    z-index: 9999;
                }
                
                .auto-save-indicator.show {
                    opacity: 1;
                    transform: translateY(0);
                }
                
                .virtual-scroll-container {
                    height: 400px;
                    overflow-y: auto;
                }
                
                .error-boundary {
                    padding: 20px;
                    border: 1px solid #dc3545;
                    border-radius: 4px;
                    background-color: #f8d7da;
                    color: #721c24;
                    margin: 10px 0;
                }
                
                .offline-indicator {
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    background: #ffc107;
                    color: #212529;
                    padding: 8px 16px;
                    border-radius: 4px;
                    font-size: 14px;
                    z-index: 9999;
                }
                
                @media print {
                    .no-print {
                        display: none !important;
                    }
                    
                    .print-only {
                        display: block !important;
                    }
                    
                    body {
                        font-size: 12pt;
                    }
                    
                    .card {
                        border: none !important;
                        box-shadow: none !important;
                    }
                }
                
                /* 響應式設計改進 */
                @media (max-width: 768px) {
                    .action-buttons {
                        display: flex;
                        flex-direction: column;
                        gap: 2px;
                    }
                    
                    .action-buttons .btn {
                        font-size: 12px;
                        padding: 4px 8px;
                    }
                    
                    .table-responsive {
                        font-size: 14px;
                    }
                    
                    .card-header h5 {
                        font-size: 16px;
                    }
                }
                
                /* 輔助功能改進 */
                .sr-only {
                    position: absolute;
                    width: 1px;
                    height: 1px;
                    padding: 0;
                    margin: -1px;
                    overflow: hidden;
                    clip: rect(0, 0, 0, 0);
                    white-space: nowrap;
                    border: 0;
                }
                
                /* 高對比模式支援 */
                @media (prefers-contrast: high) {
                    .status-badge {
                        border: 2px solid currentColor;
                    }
                    
                    .btn-outline-primary,
                    .btn-outline-success,
                    .btn-outline-warning,
                    .btn-outline-danger {
                        border-width: 2px;
                    }
                }
                
                /* 減少動畫效果（針對偏好設定） */
                @media (prefers-reduced-motion: reduce) {
                    * {
                        animation-duration: 0.01ms !important;
                        animation-iteration-count: 1 !important;
                        transition-duration: 0.01ms !important;
                    }
                }
            </style>
        `;
        
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // ========================================
        // 結束標記
        // ========================================
        
        })(); // IIFE 結束
        
    </script>
</body>
</html>

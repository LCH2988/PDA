<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>台灣帕金森病友權益促進會 - 會計管理系統</title>
  
  <!-- CSS 樣式 -->
  <style>
      /* 基礎樣式重置 */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          line-height: 1.6;
          color: #333;
          background-color: #f8f9fa;
      }

      /* 頂部導航 */
      .navbar {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 1rem 0;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          position: sticky;
          top: 0;
          z-index: 1000;
      }

      .navbar .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .navbar h1 {
          font-size: 1.5rem;
          font-weight: 600;
      }

      .navbar .nav-info {
          display: flex;
          align-items: center;
          gap: 20px;
          font-size: 0.9rem;
      }

      /* 主要容器 */
      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
      }

      /* 載入動畫 */
      .loading {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(255, 255, 255, 0.9);
          z-index: 9999;
          justify-content: center;
          align-items: center;
      }

      .loading.show {
          display: flex;
      }

      .spinner {
          width: 50px;
          height: 50px;
          border: 4px solid #f3f3f3;
          border-top: 4px solid #667eea;
          border-radius: 50%;
          animation: spin 1s linear infinite;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      /* 標籤頁導航 */
      .tab-nav {
          display: flex;
          background: white;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 20px;
          overflow: hidden;
      }

      .tab-nav button {
          flex: 1;
          padding: 15px 20px;
          border: none;
          background: white;
          color: #666;
          cursor: pointer;
          transition: all 0.3s ease;
          font-size: 1rem;
          font-weight: 500;
      }

      .tab-nav button:hover {
          background: #f8f9fa;
          color: #333;
      }

      .tab-nav button.active {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
      }

      /* 標籤頁內容 */
      .tab-content {
          display: none;
          background: white;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          padding: 30px;
          margin-bottom: 20px;
      }

      .tab-content.active {
          display: block;
          animation: fadeIn 0.3s ease-in;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      /* 表單樣式 */
      .form-group {
          margin-bottom: 20px;
      }

      .form-row {
          display: flex;
          gap: 20px;
          margin-bottom: 20px;
      }

      .form-row .form-group {
          flex: 1;
          margin-bottom: 0;
      }

      label {
          display: block;
          margin-bottom: 8px;
          font-weight: 500;
          color: #555;
      }

      input, select, textarea {
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e1e5e9;
          border-radius: 8px;
          font-size: 1rem;
          transition: all 0.3s ease;
          background: white;
      }

      input:focus, select:focus, textarea:focus {
          outline: none;
          border-color: #667eea;
          box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      textarea {
          resize: vertical;
          min-height: 100px;
      }

      /* 按鈕樣式 */
      .btn {
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          font-size: 1rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.3s ease;
          text-decoration: none;
          display: inline-block;
          text-align: center;
          line-height: 1.4;
      }

      .btn-primary {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
      }

      .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
          background: #6c757d;
          color: white;
      }

      .btn-secondary:hover {
          background: #5a6268;
          transform: translateY(-2px);
      }

      .btn-success {
          background: #28a745;
          color: white;
      }

      .btn-success:hover {
          background: #218838;
          transform: translateY(-2px);
      }

      .btn-danger {
          background: #dc3545;
          color: white;
      }

      .btn-danger:hover {
          background: #c82333;
          transform: translateY(-2px);
      }

      .btn-warning {
          background: #ffc107;
          color: #212529;
      }

      .btn-warning:hover {
          background: #e0a800;
          transform: translateY(-2px);
      }

      .btn-info {
          background: #17a2b8;
          color: white;
      }

      .btn-info:hover {
          background: #138496;
          transform: translateY(-2px);
      }

      .btn-group {
          display: flex;
          gap: 10px;
          margin-top: 20px;
      }

      .btn-sm {
          padding: 8px 16px;
          font-size: 0.875rem;
      }

      .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none !important;
      }

      /* 表格樣式 */
      .table-container {
          overflow-x: auto;
          margin: 20px 0;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      table {
          width: 100%;
          border-collapse: collapse;
          background: white;
      }

      th, td {
          padding: 15px;
          text-align: left;
          border-bottom: 1px solid #e1e5e9;
      }

      th {
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
          font-weight: 600;
          color: #495057;
          position: sticky;
          top: 0;
          z-index: 10;
      }

      tr:hover {
          background-color: #f8f9fa;
      }

      tr:last-child td {
          border-bottom: none;
      }

      /* 搜尋和篩選區域 */
      .search-filters {
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 20px;
      }

      .search-row {
          display: flex;
          gap: 15px;
          align-items: end;
          flex-wrap: wrap;
      }

      .search-group {
          flex: 1;
          min-width: 200px;
      }

      /* 統計卡片 */
      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }

      .stat-card {
          background: white;
          padding: 25px;
          border-radius: 15px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.08);
          text-align: center;
          transition: transform 0.3s ease;
          position: relative;
          overflow: hidden;
      }

      .stat-card:hover {
          transform: translateY(-5px);
      }

      .stat-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .stat-value {
          font-size: 2.5rem;
          font-weight: bold;
          color: #667eea;
          margin-bottom: 10px;
      }

      .stat-label {
          font-size: 1.1rem;
          color: #666;
          font-weight: 500;
      }

      .stat-change {
          font-size: 0.9rem;
          margin-top: 8px;
      }

      .stat-change.positive {
          color: #28a745;
      }

      .stat-change.negative {
          color: #dc3545;
      }

      /* 警告和訊息 */
      .alert {
          padding: 15px 20px;
          border-radius: 8px;
          margin-bottom: 20px;
          border-left: 4px solid;
          display: none;
      }

      .alert.show {
          display: block;
          animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
          from { opacity: 0; transform: translateY(-10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .alert-success {
          background-color: #d4edda;
          border-color: #28a745;
          color: #155724;
      }

      .alert-danger {
          background-color: #f8d7da;
          border-color: #dc3545;
          color: #721c24;
      }

      .alert-warning {
          background-color: #fff3cd;
          border-color: #ffc107;
          color: #856404;
      }

      .alert-info {
          background-color: #cce7ff;
          border-color: #17a2b8;
          color: #0c5460;
      }

      /* 模態框 */
      .modal {
          display: none;
          position: fixed;
          z-index: 2000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          backdrop-filter: blur(5px);
      }

      .modal.show {
          display: flex;
          justify-content: center;
          align-items: center;
          animation: fadeIn 0.3s ease;
      }

      .modal-content {
          background-color: white;
          padding: 30px;
          border-radius: 15px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 10px 30px rgba(0,0,0,0.3);
          position: relative;
          animation: slideUp 0.3s ease;
      }

      @keyframes slideUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 15px;
          border-bottom: 2px solid #e1e5e9;
      }

      .modal-title {
          font-size: 1.5rem;
          font-weight: 600;
          color: #333;
      }

      .close {
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: #666;
          padding: 5px;
          border-radius: 50%;
          width: 35px;
          height: 35px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
      }

      .close:hover {
          background-color: #f8f9fa;
          color: #333;
      }

      /* 分頁 */
      .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
          margin: 20px 0;
      }

      .pagination button {
          padding: 8px 12px;
          border: 1px solid #dee2e6;
          background: white;
          color: #495057;
          border-radius: 5px;
          cursor: pointer;
          transition: all 0.3s ease;
      }

      .pagination button:hover:not(:disabled) {
          background: #e9ecef;
          border-color: #adb5bd;
      }

      .pagination button.active {
          background: #667eea;
          border-color: #667eea;
          color: white;
      }

      .pagination button:disabled {
          opacity: 0.5;
          cursor: not-allowed;
      }

      /* 工具列 */
      .toolbar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          flex-wrap: wrap;
          gap: 15px;
      }

      .toolbar-left, .toolbar-right {
          display: flex;
          gap: 10px;
          align-items: center;
      }

      /* 標籤 */
      .badge {
          display: inline-block;
          padding: 4px 8px;
          font-size: 0.75rem;
          font-weight: 500;
          border-radius: 12px;
          text-align: center;
          white-space: nowrap;
      }

      .badge-success {
          background-color: #28a745;
          color: white;
      }

      .badge-danger {
          background-color: #dc3545;
          color: white;
      }

      .badge-warning {
          background-color: #ffc107;
          color: #212529;
      }

      .badge-info {
          background-color: #17a2b8;
          color: white;
      }

      .badge-secondary {
          background-color: #6c757d;
          color: white;
      }

      /* 進度條 */
      .progress {
          width: 100%;
          height: 8px;
          background-color: #e9ecef;
          border-radius: 4px;
          overflow: hidden;
          margin: 10px 0;
      }

      .progress-bar {
          height: 100%;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 4px;
          transition: width 0.3s ease;
      }

      /* 圖表容器 */
      .chart-container {
          background: white;
          padding: 25px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 20px;
      }

      .chart-title {
          font-size: 1.25rem;
          font-weight: 600;
          margin-bottom: 20px;
          color: #333;
          text-align: center;
      }

      /* 響應式設計 */
      @media (max-width: 768px) {
          .container {
              padding: 10px;
          }

          .navbar .container {
              padding: 0 15px;
          }

          .navbar h1 {
              font-size: 1.25rem;
          }

          .navbar .nav-info {
              display: none;
          }

          .tab-nav {
              flex-direction: column;
          }

          .tab-nav button {
              border-radius: 0;
          }

          .form-row {
              flex-direction: column;
              gap: 0;
          }

          .search-row {
              flex-direction: column;
              align-items: stretch;
          }

          .search-group {
              min-width: auto;
          }

          .stats-grid {
              grid-template-columns: 1fr;
          }

          .toolbar {
              flex-direction: column;
              align-items: stretch;
          }

          .toolbar-left, .toolbar-right {
              justify-content: center;
          }

          .btn-group {
              flex-direction: column;
          }

          .table-container {
              font-size: 0.875rem;
          }

          th, td {
              padding: 10px 8px;
          }

          .modal-content {
              width: 95%;
              padding: 20px;
              margin: 10px;
          }
      }

      @media (max-width: 480px) {
          .tab-content {
              padding: 20px 15px;
          }

          .stat-value {
              font-size: 2rem;
          }

          .btn {
              padding: 10px 20px;
              font-size: 0.9rem;
          }
      }

      /* 自定義滾動條 */
      ::-webkit-scrollbar {
          width: 8px;
          height: 8px;
      }

      ::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
          background: #c1c1c1;
          border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
          background: #a8a8a8;
      }

      /* 動畫效果 */
      .fade-in {
          animation: fadeIn 0.5s ease-in;
      }

      .slide-up {
          animation: slideUp 0.5s ease-out;
      }

      .bounce-in {
          animation: bounceIn 0.6s ease-out;
      }

      @keyframes bounceIn {
          0% { opacity: 0; transform: scale(0.3); }
          50% { opacity: 1; transform: scale(1.05); }
          70% { transform: scale(0.9); }
          100% { opacity: 1; transform: scale(1); }
      }

      /* 工具提示 */
      .tooltip {
          position: relative;
          display: inline-block;
      }

      .tooltip .tooltiptext {
          visibility: hidden;
          width: 200px;
          background-color: #333;
          color: #fff;
          text-align: center;
          border-radius: 6px;
          padding: 8px;
          position: absolute;
          z-index: 1001;
          bottom: 125%;
          left: 50%;
          margin-left: -100px;
          opacity: 0;
          transition: opacity 0.3s;
          font-size: 0.875rem;
      }

      .tooltip .tooltiptext::after {
          content: "";
          position: absolute;
          top: 100%;
          left: 50%;
          margin-left: -5px;
          border-width: 5px;
          border-style: solid;
          border-color: #333 transparent transparent transparent;
      }

      .tooltip:hover .tooltiptext {
          visibility: visible;
          opacity: 1;
      }

      /* 空狀態 */
      .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: #6c757d;
      }

      .empty-state-icon {
          font-size: 4rem;
          margin-bottom: 20px;
          opacity: 0.5;
      }

      .empty-state-title {
          font-size: 1.5rem;
          font-weight: 600;
          margin-bottom: 10px;
      }

      .empty-state-description {
          font-size: 1rem;
          margin-bottom: 20px;
      }

      /* 打印樣式 */
      @media print {
          .navbar, .tab-nav, .toolbar, .btn, .search-filters {
              display: none !important;
          }

          .tab-content {
              box-shadow: none;
              border: none;
              padding: 0;
          }

          .container {
              max-width: none;
              padding: 0;
          }

          body {
              background: white;
          }

          table {
              font-size: 12px;
          }

          th, td {
              padding: 8px;
          }
      }
  </style>
</head>
<body>
  <!-- 載入動畫 -->
  <div id="loading" class="loading">
      <div class="spinner"></div>
  </div>

  <!-- 頂部導航 -->
  <nav class="navbar">
      <div class="container">
          <h1>台灣帕金森病友權益促進會 - 會計管理系統</h1>
          <div class="nav-info">
              <span id="currentUser">載入中...</span>
              <span id="currentTime"></span>
              <span id="systemStatus" class="badge badge-success">系統正常</span>
          </div>
      </div>
  </nav>

  <!-- 主要內容區域 -->
  <div class="container">
      <!-- 系統狀態警告 -->
      <div id="systemAlert" class="alert alert-warning">
          <strong>系統提醒：</strong> <span id="alertMessage"></span>
      </div>

      <!-- 統計資訊卡片 -->
      <div id="statsGrid" class="stats-grid">
          <div class="stat-card">
              <div class="stat-value" id="totalIncome">-</div>
              <div class="stat-label">本月總收入</div>
              <div class="stat-change positive" id="incomeChange">-</div>
          </div>
          <div class="stat-card">
              <div class="stat-value" id="totalExpense">-</div>
              <div class="stat-label">本月總支出</div>
              <div class="stat-change negative" id="expenseChange">-</div>
          </div>
          <div class="stat-card">
              <div class="stat-value" id="netAmount">-</div>
              <div class="stat-label">本月淨額</div>
              <div class="stat-change" id="netChange">-</div>
          </div>
          <div class="stat-card">
              <div class="stat-value" id="totalMembers">-</div>
              <div class="stat-label">會員總數</div>
              <div class="stat-change positive" id="memberChange">-</div>
          </div>
      </div>

      <!-- 標籤頁導航 -->
      <div class="tab-nav">
          <button class="tab-btn active" data-tab="dashboard">儀表板</button>
          <button class="tab-btn" data-tab="transactions">交易管理</button>
          <button class="tab-btn" data-tab="receipts">收據管理</button>
          <button class="tab-btn" data-tab="vouchers">憑證管理</button>
          <button class="tab-btn" data-tab="members">會員管理</button>
          <button class="tab-btn" data-tab="reports">報表分析</button>
          <button class="tab-btn" data-tab="settings">系統設定</button>
      </div>

      <!-- 儀表板標籤頁 -->
      <div id="dashboard" class="tab-content active">
          <h2>系統儀表板</h2>
          
          <!-- 快速操作 -->
          <div class="toolbar">
              <div class="toolbar-left">
                  <h3>快速操作</h3>
              </div>
              <div class="toolbar-right">
                  <button class="btn btn-primary" onclick="showAddTransactionModal()">
                      ➕ 新增交易
                  </button>
                  <button class="btn btn-success" onclick="showAddReceiptModal()">
                      📄 開立收據
                  </button>
                  <button class="btn btn-info" onclick="showAddMemberModal()">
                      👥 新增會員
                  </button>
              </div>
          </div>

          <!-- 最近交易 -->
          <div class="chart-container">
              <h3 class="chart-title">最近交易記錄</h3>
              <div id="recentTransactions">
                  <div class="empty-state">
                      <div class="empty-state-icon">📊</div>
                      <div class="empty-state-title">載入中...</div>
                      <div class="empty-state-description">正在載入最近的交易記錄</div>
                  </div>
              </div>
          </div>

          <!-- 月度趨勢圖 -->
          <div class="chart-container">
              <h3 class="chart-title">月度收支趨勢</h3>
              <div id="monthlyChart">
                  <canvas id="trendChart" width="400" height="200"></canvas>
              </div>
          </div>
      </div>

      <!-- 交易管理標籤頁 -->
      <div id="transactions" class="tab-content">
          <h2>交易管理</h2>
          
          <!-- 搜尋和篩選 -->
          <div class="search-filters">
              <div class="search-row">
                  <div class="search-group">
                      <label for="transactionSearch">搜尋</label>
                      <input type="text" id="transactionSearch" placeholder="搜尋交易對象、說明...">
                  </div>
                  <div class="search-group">
                      <label for="transactionType">收支類型</label>
                      <select id="transactionType">
                          <option value="">全部</option>
                          <option value="收入">收入</option>
                          <option value="支出">支出</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="transactionCategory">類別</label>
                      <select id="transactionCategory">
                          <option value="">全部類別</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="dateFrom">開始日期</label>
                      <input type="date" id="dateFrom">
                  </div>
                  <div class="search-group">
                      <label for="dateTo">結束日期</label>
                      <input type="date" id="dateTo">
                  </div>
                  <div class="search-group">
                      <label>&nbsp;</label>
                      <button class="btn btn-primary" onclick="searchTransactions()">🔍 搜尋</button>
                  </div>
              </div>
          </div>

          <!-- 工具列 -->
          <div class="toolbar">
              <div class="toolbar-left">
                  <button class="btn btn-primary" onclick="showAddTransactionModal()">
                      ➕ 新增交易
                  </button>
                  <button class="btn btn-success" onclick="exportTransactions()">
                      📤 匯出資料
                  </button>
              </div>
              <div class="toolbar-right">
                  <span id="transactionCount">共 0 筆記錄</span>
              </div>
          </div>

          <!-- 交易列表 -->
          <div class="table-container">
              <table id="transactionTable">
                  <thead>
                      <tr>
                          <th>日期</th>
                          <th>類型</th>
                          <th>類別</th>
                          <th>金額</th>
                          <th>交易對象</th>
                          <th>帳戶</th>
                          <th>說明</th>
                          <th>狀態</th>
                          <th>操作</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td colspan="9" class="empty-state">
                              <div class="empty-state-icon">💰</div>
                              <div class="empty-state-title">暫無交易記錄</div>
                              <div class="empty-state-description">點擊「新增交易」開始記錄您的第一筆交易</div>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>

          <!-- 分頁 -->
          <div class="pagination" id="transactionPagination">
              <button onclick="previousPage('transaction')" id="transactionPrevBtn">‹ 上一頁</button>
              <span id="transactionPageInfo">第 1 頁，共 1 頁</span>
              <button onclick="nextPage('transaction')" id="transactionNextBtn">下一頁 ›</button>
          </div>
      </div>

      <!-- 收據管理標籤頁 -->
      <div id="receipts" class="tab-content">
          <h2>收據管理</h2>
          
          <!-- 搜尋和篩選 -->
          <div class="search-filters">
              <div class="search-row">
                  <div class="search-group">
                      <label for="receiptSearch">搜尋</label>
                      <input type="text" id="receiptSearch" placeholder="搜尋收據編號、付款人...">
                  </div>
                  <div class="search-group">
                      <label for="receiptCategory">收據類別</label>
                      <select id="receiptCategory">
                          <option value="">全部類別</option>
                          <option value="捐款">捐款</option>
                          <option value="會費">會費</option>
                          <option value="其他">其他</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="receiptStatus">狀態</label>
                      <select id="receiptStatus">
                          <option value="">全部狀態</option>
                          <option value="已開立">已開立</option>
                          <option value="已寄送">已寄送</option>
                          <option value="已作廢">已作廢</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label>&nbsp;</label>
                      <button class="btn btn-primary" onclick="searchReceipts()">🔍 搜尋</button>
                  </div>
              </div>
          </div>

          <!-- 工具列 -->
          <div class="toolbar">
              <div class="toolbar-left">
                  <button class="btn btn-primary" onclick="showAddReceiptModal()">
                      ➕ 開立收據
                  </button>
                  <button class="btn btn-success" onclick="exportReceipts()">
                      📤 匯出資料
                  </button>
              </div>
              <div class="toolbar-right">
                  <span id="receiptCount">共 0 筆記錄</span>
              </div>
          </div>

          <!-- 收據列表 -->
          <div class="table-container">
              <table id="receiptTable">
                  <thead>
                      <tr>
                          <th>日期</th>
                          <th>收據編號</th>
                          <th>付款人</th>
                          <th>身份類別</th>
                          <th>聯絡電話</th>
                          <th>收據類別</th>
                          <th>金額</th>
                          <th>狀態</th>
                          <th>操作</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td colspan="9" class="empty-state">
                              <div class="empty-state-icon">📄</div>
                              <div class="empty-state-title">暫無收據記錄</div>
                              <div class="empty-state-description">點擊「開立收據」開始開立您的第一張收據</div>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>

          <!-- 分頁 -->
          <div class="pagination" id="receiptPagination">
              <button onclick="previousPage('receipt')" id="receiptPrevBtn">‹ 上一頁</button>
              <span id="receiptPageInfo">第 1 頁，共 1 頁</span>
              <button onclick="nextPage('receipt')" id="receiptNextBtn">下一頁 ›</button>
          </div>
      </div>

      <!-- 憑證管理標籤頁 -->
      <div id="vouchers" class="tab-content">
          <h2>憑證管理</h2>
          
          <!-- 搜尋和篩選 -->
          <div class="search-filters">
              <div class="search-row">
                  <div class="search-group">
                      <label for="voucherSearch">搜尋</label>
                      <input type="text" id="voucherSearch" placeholder="搜尋憑證編號、申請人...">
                  </div>
                  <div class="search-group">
                      <label for="voucherCategory">支出類別</label>
                      <select id="voucherCategory">
                          <option value="">全部類別</option>
                          <option value="辦公費">辦公費</option>
                          <option value="交通費">交通費</option>
                          <option value="餐費">餐費</option>
                          <option value="活動費">活動費</option>
                          <option value="其他">其他</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="voucherStatus">狀態</label>
                      <select id="voucherStatus">
                          <option value="">全部狀態</option>
                          <option value="待審核">待審核</option>
                          <option value="已核准">已核准</option>
                          <option value="已駁回">已駁回</option>
                          <option value="已支付">已支付</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label>&nbsp;</label>
                      <button class="btn btn-primary" onclick="searchVouchers()">🔍 搜尋</button>
                  </div>
              </div>
          </div>

          <!-- 工具列 -->
          <div class="toolbar">
              <div class="toolbar-left">
                  <button class="btn btn-primary" onclick="showAddVoucherModal()">
                      ➕ 申請憑證
                  </button>
                  <button class="btn btn-success" onclick="exportVouchers()">
                      📤 匯出資料
                  </button>
              </div>
              <div class="toolbar-right">
                  <span id="voucherCount">共 0 筆記錄</span>
              </div>
          </div>

          <!-- 憑證列表 -->
          <div class="table-container">
              <table id="voucherTable">
                  <thead>
                      <tr>
                          <th>申請日期</th>
                          <th>憑證編號</th>
                          <th>申請人</th>
                          <th>支出類別</th>
                          <th>申請金額</th>
                          <th>用途說明</th>
                          <th>狀態</th>
                          <th>附件</th>
                          <th>操作</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td colspan="9" class="empty-state">
                              <div class="empty-state-icon">📋</div>
                              <div class="empty-state-title">暫無憑證記錄</div>
                              <div class="empty-state-description">點擊「申請憑證」開始申請您的第一張憑證</div>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>
      </div>

      <!-- 會員管理標籤頁 -->
      <div id="members" class="tab-content">
          <h2>會員管理</h2>
          
          <!-- 搜尋和篩選 -->
          <div class="search-filters">
              <div class="search-row">
                  <div class="search-group">
                      <label for="memberSearch">搜尋</label>
                      <input type="text" id="memberSearch" placeholder="搜尋會員編號、姓名、電話...">
                  </div>
                  <div class="search-group">
                      <label for="memberType">會員類型</label>
                      <select id="memberType">
                          <option value="">全部類型</option>
                          <option value="一般會員">一般會員</option>
                          <option value="榮譽會員">榮譽會員</option>
                          <option value="贊助會員">贊助會員</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="memberStatus">狀態</label>
                      <select id="memberStatus">
                          <option value="">全部狀態</option>
                          <option value="正常">正常</option>
                          <option value="暫停">暫停</option>
                          <option value="退會">退會</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label>&nbsp;</label>
                      <button class="btn btn-primary" onclick="searchMembers()">🔍 搜尋</button>
                  </div>
              </div>
          </div>

          <!-- 工具列 -->
          <div class="toolbar">
              <div class="toolbar-left">
                  <button class="btn btn-primary" onclick="showAddMemberModal()">
                      ➕ 新增會員
                  </button>
                  <button class="btn btn-success" onclick="exportMembers()">
                      📤 匯出資料
                  </button>
                  <button class="btn btn-info" onclick="importMembers()">
                      📥 匯入會員
                  </button>
              </div>
              <div class="toolbar-right">
                  <span id="memberCount">共 0 筆記錄</span>
              </div>
          </div>

          <!-- 會員列表 -->
          <div class="table-container">
              <table id="memberTable">
                  <thead>
                      <tr>
                          <th>會員編號</th>
                          <th>姓名</th>
                          <th>性別</th>
                          <th>聯絡電話</th>
                          <th>電子郵件</th>
                          <th>會員類型</th>
                          <th>加入日期</th>
                          <th>狀態</th>
                          <th>操作</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td colspan="9" class="empty-state">
                              <div class="empty-state-icon">👥</div>
                              <div class="empty-state-title">暫無會員記錄</div>
                              <div class="empty-state-description">點擊「新增會員」開始新增您的第一位會員</div>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>
      </div>

      <!-- 報表分析標籤頁 -->
      <div id="reports" class="tab-content">
          <h2>報表分析</h2>
          
          <!-- 報表選項 -->
          <div class="search-filters">
              <div class="search-row">
                  <div class="search-group">
                      <label for="reportType">報表類型</label>
                      <select id="reportType">
                          <option value="monthly">月度報表</option>
                          <option value="yearly">年度報表</option>
                          <option value="category">類別統計</option>
                          <option value="member">會員統計</option>
                          <option value="donation">捐款統計</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="reportYear">年份</label>
                      <select id="reportYear">
                          <option value="2024">2024</option>
                          <option value="2023">2023</option>
                          <option value="2022">2022</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label for="reportMonth">月份</label>
                      <select id="reportMonth">
                          <option value="">全年</option>
                          <option value="1">1月</option>
                          <option value="2">2月</option>
                          <option value="3">3月</option>
                          <option value="4">4月</option>
                          <option value="5">5月</option>
                          <option value="6">6月</option>
                          <option value="7">7月</option>
                          <option value="8">8月</option>
                          <option value="9">9月</option>
                          <option value="10">10月</option>
                          <option value="11">11月</option>
                          <option value="12">12月</option>
                      </select>
                  </div>
                  <div class="search-group">
                      <label>&nbsp;</label>
                      <button class="btn btn-primary" onclick="generateReport()">📊 產生報表</button>
                  </div>
              </div>
          </div>

          <!-- 報表內容 -->
          <div id="reportContent" class="chart-container">
              <div class="empty-state">
                  <div class="empty-state-icon">📈</div>
                  <div class="empty-state-title">請選擇報表類型</div>
                  <div class="empty-state-description">選擇上方的報表類型和時間範圍，然後點擊「產生報表」</div>
              </div>
          </div>

          <!-- 報表工具 -->
          <div class="toolbar" id="reportToolbar" style="display: none;">
              <div class="toolbar-left">
                  <button class="btn btn-success" onclick="exportReport()">
                      📤 匯出報表
                  </button>
                  <button class="btn btn-info" onclick="printReport()">
                      🖨️ 列印報表
                  </button>
              </div>
              <div class="toolbar-right">
                  <button class="btn btn-secondary" onclick="emailReport()">
                      📧 郵件寄送
                  </button>
              </div>
          </div>
      </div>

      <!-- 系統設定標籤頁 -->
      <div id="settings" class="tab-content">
          <h2>系統設定</h2>
          
          <!-- 設定選項卡 -->
          <div class="tab-nav" style="margin-bottom: 30px;">
              <button class="tab-btn active" data-tab="orgSettings">組織設定</button>
              <button class="tab-btn" data-tab="emailSettings">郵件設定</button>
              <button class="tab-btn" data-tab="systemSettings">系統設定</button>
              <button class="tab-btn" data-tab="backupSettings">備份設定</button>
          </div>

          <!-- 組織設定 -->
          <div id="orgSettings" class="tab-content active">
              <h3>組織基本資訊</h3>
              <form id="organizationForm">
                  <div class="form-row">
                      <div class="form-group">
                          <label for="orgName">組織名稱</label>
                          <input type="text" id="orgName" required>
                      </div>
                      <div class="form-group">
                          <label for="taxId">統一編號</label>
                          <input type="text" id="taxId" required>
                      </div>
                  </div>
                  <div class="form-group">
                      <label for="orgAddress">組織地址</label>
                      <textarea id="orgAddress" rows="3"></textarea>
                  </div>
                  <div class="form-row">
                      <div class="form-group">
                          <label for="orgPhone">聯絡電話</label>
                          <input type="tel" id="orgPhone">
                      </div>
                      <div class="form-group">
                          <label for="orgEmail">聯絡信箱</label>
                          <input type="email" id="orgEmail">
                      </div>
                  </div>
                  <div class="form-group">
                      <label for="orgWebsite">官方網站</label>
                      <input type="url" id="orgWebsite">
                  </div>
                  <div class="btn-group">
                      <button type="submit" class="btn btn-primary">💾 儲存設定</button>
                      <button type="button" class="btn btn-secondary" onclick="resetOrgForm()">🔄 重設</button>
                  </div>
              </form>
          </div>

          <!-- 郵件設定 -->
          <div id="emailSettings" class="tab-content">
              <h3>郵件系統設定</h3>
              <form id="emailForm">
                  <div class="form-row">
                      <div class="form-group">
                          <label for="smtpHost">SMTP 主機</label>
                          <input type="text" id="smtpHost" placeholder="smtp.gmail.com">
                      </div>
                      <div class="form-group">
                          <label for="smtpPort">SMTP 埠號</label>
                          <input type="number" id="smtpPort" value="587">
                      </div>
                  </div>
                  <div class="form-row">
                      <div class="form-group">
                          <label for="smtpUser">SMTP 使用者</label>
                          <input type="email" id="smtpUser">
                      </div>
                      <div class="form-group">
                          <label for="smtpPass">SMTP 密碼</label>
                          <input type="password" id="smtpPass">
                      </div>
                  </div>
                  <div class="form-group">
                      <label for="emailFrom">寄件者信箱</label>
                      <input type="email" id="emailFrom">
                  </div>
                  <div class="form-group">
                      <label>
                          <input type="checkbox" id="autoSendReceipt"> 自動寄送收據
                      </label>
                  </div>
                  <div class="btn-group">
                      <button type="submit" class="btn btn-primary">💾 儲存設定</button>
                      <button type="button" class="btn btn-info" onclick="testEmailSettings()">📧 測試郵件</button>
                      <button type="button" class="btn btn-secondary" onclick="resetEmailForm()">🔄 重設</button>
                  </div>
              </form>
          </div>

          <!-- 系統設定 -->
          <div id="systemSettings" class="tab-content">
              <h3>系統維護</h3>
              <div class="stats-grid">
                  <div class="stat-card">
                      <div class="stat-value" id="systemVersion">v1.0.0</div>
                      <div class="stat-label">系統版本</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-value" id="dataCount">0</div>
                      <div class="stat-label">總資料筆數</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-value" id="lastBackup">未知</div>
                      <div class="stat-label">最後備份</div>
                  </div>
                  <div class="stat-card">
                      <div class="stat-value" id="systemHealth">健康</div>
                      <div class="stat-label">系統狀態</div>
                  </div>
              </div>

              <div class="toolbar">
                  <div class="toolbar-left">
                      <button class="btn btn-primary" onclick="performSystemCheck()">
                          🔍 系統檢查
                      </button>
                      <button class="btn btn-warning" onclick="cleanupSystem()">
                          🧹 清理系統
                      </button>
                  </div>
                  <div class="toolbar-right">
                      <button class="btn btn-info" onclick="viewSystemLogs()">
                          📋 查看日誌
                      </button>
                      <button class="btn btn-success" onclick="createBackup()">
                          💾 建立備份
                      </button>
                  </div>
              </div>
          </div>

          <!-- 備份設定 -->
          <div id="backupSettings" class="tab-content">
              <h3>備份與還原</h3>
              <form id="backupForm">
                  <div class="form-group">
                      <label>
                          <input type="checkbox" id="autoBackup" checked> 啟用自動備份
                      </label>
                  </div>
                  <div class="form-group">
                      <label for="backupFrequency">備份頻率</label>
                      <select id="backupFrequency">
                          <option value="daily">每日</option>
                          <option value="weekly" selected>每週</option>
                          <option value="monthly">每月</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label for="backupRetention">保留天數</label>
                      <input type="number" id="backupRetention" value="30" min="1" max="365">
                  </div>
                  <div class="btn-group">
                      <button type="submit" class="btn btn-primary">💾 儲存設定</button>
                      <button type="button" class="btn btn-success" onclick="createManualBackup()">
                          📦 立即備份
                      </button>
                      <button type="button" class="btn btn-info" onclick="viewBackupHistory()">
                          📋 備份記錄
                      </button>
                  </div>
              </form>
          </div>
      </div>
  </div>

  <!-- 模態框 -->
  <!-- 新增交易模態框 -->
  <div id="addTransactionModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="modal-title">新增交易</h3>
              <button class="close" onclick="closeModal('addTransactionModal')">&times;</button>
          </div>
          <form id="addTransactionForm">
              <div class="form-row">
                  <div class="form-group">
                      <label for="transactionDate">交易日期</label>
                      <input type="date" id="transactionDate" required>
                  </div>
                  <div class="form-group">
                      <label for="transactionTypeModal">收支類型</label>
                      <select id="transactionTypeModal" required>
                          <option value="">請選擇</option>
                          <option value="收入">收入</option>
                          <option value="支出">支出</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="transactionCategoryModal">類別</label>
                      <select id="transactionCategoryModal" required>
                          <option value="">請選擇類別</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label for="transactionAmount">金額</label>
                      <input type="number" id="transactionAmount" min="0" step="1" required>
                  </div>
              </div>
              <div class="form-group">
                  <label for="transactionName">交易對象</label>
                  <input type="text" id="transactionName" required>
              </div>
              <div class="form-group">
                  <label for="transactionAccount">帳戶</label>
                  <select id="transactionAccount" required>
                      <option value="">請選擇帳戶</option>
                      <option value="現金">現金</option>
                      <option value="銀行帳戶">銀行帳戶</option>
                      <option value="信用卡">信用卡</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="transactionDescription">說明</label>
                  <textarea id="transactionDescription" rows="3"></textarea>
              </div>
              <div class="form-group">
                  <label>
                      <input type="checkbox" id="generateReceipt"> 自動產生收據
                  </label>
              </div>
              <div class="btn-group">
                  <button type="submit" class="btn btn-primary">💾 儲存</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('addTransactionModal')">❌ 取消</button>
              </div>
          </form>
      </div>
  </div>

  <!-- 新增收據模態框 -->
  <div id="addReceiptModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="modal-title">開立收據</h3>
              <button class="close" onclick="closeModal('addReceiptModal')">&times;</button>
          </div>
          <form id="addReceiptForm">
              <div class="form-row">
                  <div class="form-group">
                      <label for="receiptDate">收據日期</label>
                      <input type="date" id="receiptDate" required>
                  </div>
                  <div class="form-group">
                      <label for="receiptCategoryModal">收據類別</label>
                      <select id="receiptCategoryModal" required>
                          <option value="">請選擇</option>
                          <option value="捐款">捐款</option>
                          <option value="會費">會費</option>
                          <option value="其他">其他</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="receiptPayer">付款人</label>
                      <input type="text" id="receiptPayer" required>
                  </div>
                  <div class="form-group">
                      <label for="receiptIdentity">身份類別</label>
                      <select id="receiptIdentity" required>
                          <option value="">請選擇</option>
                          <option value="個人">個人</option>
                          <option value="公司">公司</option>
                          <option value="團體">團體</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="receiptPhone">聯絡電話</label>
                      <input type="tel" id="receiptPhone">
                  </div>
                  <div class="form-group">
                      <label for="receiptEmail">電子郵件</label>
                      <input type="email" id="receiptEmail">
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="receiptAmount">金額</label>
                      <input type="number" id="receiptAmount" min="0" step="1" required>
                  </div>
                  <div class="form-group">
                      <label for="receiptPurpose">用途</label>
                      <input type="text" id="receiptPurpose">
                  </div>
              </div>
              <div class="form-group">
                  <label>
                      <input type="checkbox" id="autoSendReceiptModal"> 自動寄送收據
                  </label>
              </div>
              <div class="btn-group">
                  <button type="submit" class="btn btn-primary">📄 開立收據</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('addReceiptModal')">❌ 取消</button>
              </div>
          </form>
      </div>
  </div>

  <!-- 新增會員模態框 -->
  <div id="addMemberModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="modal-title">新增會員</h3>
              <button class="close" onclick="closeModal('addMemberModal')">&times;</button>
          </div>
          <form id="addMemberForm">
              <div class="form-row">
                  <div class="form-group">
                      <label for="memberName">姓名</label>
                      <input type="text" id="memberName" required>
                  </div>
                  <div class="form-group">
                      <label for="memberGender">性別</label>
                      <select id="memberGender" required>
                          <option value="">請選擇</option>
                          <option value="男">男</option>
                          <option value="女">女</option>
                          <option value="其他">其他</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="memberBirthdate">出生日期</label>
                      <input type="date" id="memberBirthdate">
                  </div>
                  <div class="form-group">
                      <label for="memberIdNumber">身份證字號</label>
                      <input type="text" id="memberIdNumber">
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="memberPhone">聯絡電話</label>
                      <input type="tel" id="memberPhone" required>
                  </div>
                  <div class="form-group">
                      <label for="memberEmailModal">電子郵件</label>
                      <input type="email" id="memberEmailModal">
                  </div>
              </div>
              <div class="form-group">
                  <label for="memberAddress">聯絡地址</label>
                  <textarea id="memberAddress" rows="3"></textarea>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label for="memberTypeModal">會員類型</label>
                      <select id="memberTypeModal" required>
                          <option value="">請選擇</option>
                          <option value="一般會員">一般會員</option>
                          <option value="榮譽會員">榮譽會員</option>
                          <option value="贊助會員">贊助會員</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label for="memberJoinDate">加入日期</label>
                      <input type="date" id="memberJoinDate" required>
                  </div>
              </div>
              <div class="form-group">
                  <label for="memberNotes">備註</label>
                  <textarea id="memberNotes" rows="2"></textarea>
              </div>
              <div class="btn-group">
                  <button type="submit" class="btn btn-primary">👥 新增會員</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('addMemberModal')">❌ 取消</button>
              </div>
          </form>
      </div>
  </div>

  <!-- JavaScript 程式碼 -->
  <script>
      // 全域變數
      let currentTab = 'dashboard';
      let currentPage = {
          transaction: 1,
          receipt: 1,
          voucher: 1,
          member: 1
      };
      let itemsPerPage = 20;
      let allData = {
          transactions: [],
          receipts: [],
          vouchers: [],
          members: []
      };

      // 初始化
      document.addEventListener('DOMContentLoaded', function() {
          initializeApp();
      });

      // 應用程式初始化
      function initializeApp() {
          console.log('初始化會計管理系統...');
          
          // 設定當前時間
          updateCurrentTime();
          setInterval(updateCurrentTime, 60000); // 每分鐘更新一次
          
          // 設定預設日期
          setDefaultDates();
          
          // 載入系統資料
          loadSystemData();
          
          // 綁定事件監聽器
          bindEventListeners();
          
          // 載入統計資料
          loadStatistics();
          
          console.log('系統初始化完成');
      }

      // 更新當前時間
      function updateCurrentTime() {
          const now = new Date();
          const timeString = now.toLocaleString('zh-TW', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit'
          });
          document.getElementById('currentTime').textContent = timeString;
      }

      // 設定預設日期
      function setDefaultDates() {
          const today = new Date().toISOString().split('T')[0];
          const inputs = document.querySelectorAll('input[type="date"]');
          inputs.forEach(input => {
              if (!input.value) {
                  input.value = today;
              }
          });
      }

      // 綁定事件監聽器
      function bindEventListeners() {
          // 標籤頁切換
          document.querySelectorAll('.tab-btn').forEach(btn => {
              btn.addEventListener('click', function() {
                  const tabName = this.getAttribute('data-tab');
                  if (tabName) {
                      switchTab(tabName);
                  }
              });
          });

          // 表單提交
          document.getElementById('addTransactionForm').addEventListener('submit', handleAddTransaction);
          document.getElementById('addReceiptForm').addEventListener('submit', handleAddReceipt);
          document.getElementById('addMemberForm').addEventListener('submit', handleAddMember);
          document.getElementById('organizationForm').addEventListener('submit', handleOrgSettings);
          document.getElementById('emailForm').addEventListener('submit', handleEmailSettings);
          document.getElementById('backupForm').addEventListener('submit', handleBackupSettings);

          // 搜尋功能
          document.getElementById('transactionSearch').addEventListener('input', debounce(searchTransactions, 300));
          document.getElementById('receiptSearch').addEventListener('input', debounce(searchReceipts, 300));
          document.getElementById('memberSearch').addEventListener('input', debounce(searchMembers, 300));

          // 收支類型變更時更新類別選項
          document.getElementById('transactionTypeModal').addEventListener('change', updateTransactionCategories);

          // 模態框外點擊關閉
          document.querySelectorAll('.modal').forEach(modal => {
              modal.addEventListener('click', function(e) {
                  if (e.target === this) {
                      closeModal(this.id);
                  }
              });
          });

          // ESC 鍵關閉模態框
          document.addEventListener('keydown', function(e) {
              if (e.key === 'Escape') {
                  document.querySelectorAll('.modal.show').forEach(modal => {
                      closeModal(modal.id);
                  });
              }
          });
      }

      // 防抖函數
      function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
              const later = () => {
                  clearTimeout(timeout);
                  func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
          };
      }

      // 標籤頁切換
      function switchTab(tabName) {
          // 更新導航按鈕
          document.querySelectorAll('.tab-btn').forEach(btn => {
              btn.classList.remove('active');
          });
          document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

          // 更新內容區域
          document.querySelectorAll('.tab-content').forEach(content => {
              content.classList.remove('active');
          });
          document.getElementById(tabName).classList.add('active');

          currentTab = tabName;

          // 載入對應資料
          switch(tabName) {
              case 'dashboard':
                  loadDashboard();
                  break;
              case 'transactions':
                  loadTransactions();
                  break;
              case 'receipts':
                  loadReceipts();
                  break;
              case 'vouchers':
                  loadVouchers();
                  break;
              case 'members':
                  loadMembers();
                  break;
              case 'reports':
                  loadReports();
                  break;
              case 'settings':
                  loadSettings();
                  break;
          }
      }

      // 載入系統資料
      async function loadSystemData() {
          try {
              showLoading();
              
              // 模擬載入資料
              await new Promise(resolve => setTimeout(resolve, 1000));
              
              // 載入基本資料
              await loadBasicData();
              
              hideLoading();
          } catch (error) {
              console.error('載入系統資料失敗:', error);
              showAlert('載入系統資料失敗', 'danger');
              hideLoading();
          }
      }

      // 載入基本資料
      async function loadBasicData() {
          // 模擬資料載入
          allData.transactions = generateSampleTransactions();
          allData.receipts = generateSampleReceipts();
          allData.members = generateSampleMembers();
          allData.vouchers = generateSampleVouchers();
          
          // 更新統計
          updateStatistics();
      }

      // 產生範例交易資料
      function generateSampleTransactions() {
          const transactions = [];
          const categories = ['會費', '捐款', '活動費', '辦公費', '交通費'];
          const accounts = ['現金', '銀行帳戶', '信用卡'];
          
          for (let i = 0; i < 50; i++) {
              const isIncome = Math.random() > 0.3;
              transactions.push({
                  id: `T${String(i + 1).padStart(4, '0')}`,
                  date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                  type: isIncome ? '收入' : '支出',
                  category: categories[Math.floor(Math.random() * categories.length)],
                  amount: Math.floor(Math.random() * 10000) + 100,
                  name: `${isIncome ? '會員' : '廠商'}${i + 1}`,
                  account: accounts[Math.floor(Math.random() * accounts.length)],
                  description: `${isIncome ? '收入' : '支出'}項目 ${i + 1}`,
                  status: '已確認'
              });
          }
          return transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      // 產生範例收據資料
      function generateSampleReceipts() {
          const receipts = [];
          const categories = ['捐款', '會費', '其他'];
          const identities = ['個人', '公司', '團體'];
          
          for (let i = 0; i < 30; i++) {
              receipts.push({
                  id: `R${String(i + 1).padStart(4, '0')}`,
                  date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                  receiptNumber: `${new Date().getFullYear()}${String(i + 1).padStart(4, '0')}`,
                  payer: `付款人${i + 1}`,
                  identity: identities[Math.floor(Math.random() * identities.length)],
                  phone: `09${String(Math.floor(Math.random() * 100000000)).padStart(8, '0')}`,
                  category: categories[Math.floor(Math.random() * categories.length)],
                  amount: Math.floor(Math.random() * 5000) + 500,
                  status: Math.random() > 0.2 ? '已開立' : '已寄送'
              });
          }
          return receipts.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      // 產生範例會員資料
      function generateSampleMembers() {
          const members = [];
          const types = ['一般會員', '榮譽會員', '贊助會員'];
          const genders = ['男', '女'];
          
          for (let i = 0; i < 100; i++) {
              members.push({
                  id: `M${String(i + 1).padStart(4, '0')}`,
                  memberNumber: `${new Date().getFullYear()}${String(i + 1).padStart(3, '0')}`,
                  name: `會員${i + 1}`,
                  gender: genders[Math.floor(Math.random() * genders.length)],
                  phone: `09${String(Math.floor(Math.random() * 100000000)).padStart(8, '0')}`,
                  email: `member${i + 1}@example.com`,
                  type: types[Math.floor(Math.random() * types.length)],
                  joinDate: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                  status: Math.random() > 0.1 ? '正常' : '暫停'
              });
          }
          return members.sort((a, b) => new Date(b.joinDate) - new Date(a.joinDate));
      }

      // 產生範例憑證資料
      function generateSampleVouchers() {
          const vouchers = [];
          const categories = ['辦公費', '交通費', '餐費', '活動費', '其他'];
          const statuses = ['待審核', '已核准', '已駁回', '已支付'];
          
          for (let i = 0; i < 20; i++) {
              vouchers.push({
                  id: `V${String(i + 1).padStart(4, '0')}`,
                  date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                  voucherNumber: `V${new Date().getFullYear()}${String(i + 1).padStart(3, '0')}`,
                  applicant: `申請人${i + 1}`,
                  category: categories[Math.floor(Math.random() * categories.length)],
                  amount: Math.floor(Math.random() * 3000) + 100,
                  purpose: `支出用途說明 ${i + 1}`,
                  status: statuses[Math.floor(Math.random() * statuses.length)],
                  hasAttachment: Math.random() > 0.3
              });
          }
          return vouchers.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      // 載入統計資料
      function loadStatistics() {
          updateStatistics();
      }

      // 更新統計資料
      function updateStatistics() {
          const currentMonth = new Date().getMonth();
          const currentYear = new Date().getFullYear();
          
          // 計算本月收支
          const monthlyTransactions = allData.transactions.filter(t => {
              const transactionDate = new Date(t.date);
              return transactionDate.getMonth() === currentMonth && 
                     transactionDate.getFullYear() === currentYear;
          });
          
          const totalIncome = monthlyTransactions
              .filter(t => t.type === '收入')
              .reduce((sum, t) => sum + t.amount, 0);
              
          const totalExpense = monthlyTransactions
              .filter(t => t.type === '支出')
              .reduce((sum, t) => sum + t.amount, 0);
              
          const netAmount = totalIncome - totalExpense;
          
          // 更新顯示
          document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
          document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
          document.getElementById('netAmount').textContent = formatCurrency(netAmount);
          document.getElementById('totalMembers').textContent = allData.members.filter(m => m.status === '正常').length;
          
          // 更新變化趨勢（模擬）
          document.getElementById('incomeChange').textContent = '+5.2%';
          document.getElementById('expenseChange').textContent = '+2.1%';
          document.getElementById('netChange').textContent = netAmount >= 0 ? '+8.3%' : '-3.2%';
          document.getElementById('memberChange').textContent = '+2';
          
          // 更新淨額顏色
          const netChangeElement = document.getElementById('netChange');
          netChangeElement.className = `stat-change ${netAmount >= 0 ? 'positive' : 'negative'}`;
      }

      // 格式化貨幣
      function formatCurrency(amount) {
          return new Intl.NumberFormat('zh-TW', {
              style: 'currency',
              currency: 'TWD',
              minimumFractionDigits: 0
          }).format(amount);
      }

      // 載入儀表板
      function loadDashboard() {
          loadRecentTransactions();
          loadMonthlyChart();
      }

      // 載入最近交易
      function loadRecentTransactions() {
          const recentTransactions = allData.transactions.slice(0, 10);
          const container = document.getElementById('recentTransactions');
          
          if (recentTransactions.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <div class="empty-state-icon">💰</div>
                      <div class="empty-state-title">暫無交易記錄</div>
                      <div class="empty-state-description">開始記錄您的第一筆交易</div>
                  </div>
              `;
              return;
          }
          
          const tableHtml = `
              <div class="table-container">
                  <table>
                      <thead>
                          <tr>
                              <th>日期</th>
                              <th>類型</th>
                              <th>金額</th>
                              <th>交易對象</th>
                              <th>說明</th>
                          </tr>
                      </thead>
                      <tbody>
                          ${recentTransactions.map(t => `
                              <tr>
                                  <td>${formatDate(t.date)}</td>
                                  <td><span class="badge badge-${t.type === '收入' ? 'success' : 'danger'}">${t.type}</span></td>
                                  <td>${formatCurrency(t.amount)}</td>
                                  <td>${t.name}</td>
                                  <td>${t.description}</td>
                              </tr>
                          `).join('')}
                      </tbody>
                  </table>
              </div>
          `;
          
          container.innerHTML = tableHtml;
      }

      // 載入月度圖表
      function loadMonthlyChart() {
          // 這裡應該實作圖表功能
          // 由於沒有圖表庫，暫時顯示文字說明
          const canvas = document.getElementById('trendChart');
          const ctx = canvas.getContext('2d');
          
          // 簡單的圖表繪製
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = '#667eea';
          ctx.fillRect(50, 50, 100, 100);
          ctx.fillStyle = '#ffffff';
          ctx.font = '16px Arial';
          ctx.fillText('月度趨勢圖', 200, 100);
          ctx.fillText('(需要圖表庫支援)', 200, 120);
      }

      // 載入交易資料
      function loadTransactions() {
          displayTransactions(allData.transactions);
          updateTransactionCount();
          updateTransactionCategories();
      }

      // 顯示交易資料
      function displayTransactions(transactions) {
          const tbody = document.querySelector('#transactionTable tbody');
          const startIndex = (currentPage.transaction - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          const pageTransactions = transactions.slice(startIndex, endIndex);
          
          if (pageTransactions.length === 0) {
              tbody.innerHTML = `
                  <tr>
                      <td colspan="9" class="empty-state">
                          <div class="empty-state-icon">💰</div>
                          <div class="empty-state-title">暫無交易記錄</div>
                          <div class="empty-state-description">點擊「新增交易」開始記錄您的第一筆交易</div>
                      </td>
                  </tr>
              `;
              return;
          }
          
          tbody.innerHTML = pageTransactions.map(t => `
              <tr>
                  <td>${formatDate(t.date)}</td>
                  <td><span class="badge badge-${t.type === '收入' ? 'success' : 'danger'}">${t.type}</span></td>
                  <td>${t.category}</td>
                  <td>${formatCurrency(t.amount)}</td>
                  <td>${t.name}</td>
                  <td>${t.account}</td>
                  <td>${t.description}</td>
                  <td><span class="badge badge-info">${t.status}</span></td>
                  <td>
                      <button class="btn btn-sm btn-info" onclick="editTransaction('${t.id}')">編輯</button>
                      <button class="btn btn-sm btn-danger" onclick="deleteTransaction('${t.id}')">刪除</button>
                  </td>
              </tr>
          `).join('');
          
          updatePagination('transaction', transactions.length);
      }

      // 更新交易數量
      function updateTransactionCount() {
          document.getElementById('transactionCount').textContent = `共 ${allData.transactions.length} 筆記錄`;
      }

      // 更新交易類別選項
      function updateTransactionCategories() {
          const typeSelect = document.getElementById('transactionTypeModal');
          const categorySelect = document.getElementById('transactionCategoryModal');
          const searchCategorySelect = document.getElementById('transactionCategory');
          
          const incomeCategories = ['會費', '捐款', '活動收入', '利息收入', '其他收入'];
          const expenseCategories = ['辦公費', '交通費', '餐費', '活動費', '水電費', '租金', '其他支出'];
          
          let categories = [];
          if (typeSelect.value === '收入') {
              categories = incomeCategories;
          } else if (typeSelect.value === '支出') {
              categories = expenseCategories;
          }
          
          // 更新模態框中的類別選項
          categorySelect.innerHTML = '<option value="">請選擇類別</option>' + 
              categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
          
          // 更新搜尋中的類別選項
          const allCategories = [...incomeCategories, ...expenseCategories];
          searchCategorySelect.innerHTML = '<option value="">全部類別</option>' + 
              allCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
      }

      // 搜尋交易
      function searchTransactions() {
          const searchTerm = document.getElementById('transactionSearch').value.toLowerCase();
          const typeFilter = document.getElementById('transactionType').value;
          const categoryFilter = document.getElementById('transactionCategory').value;
          const dateFrom = document.getElementById('dateFrom').value;
          const dateTo = document.getElementById('dateTo').value;
          
          let filteredTransactions = allData.transactions.filter(t => {
              const matchesSearch = !searchTerm || 
                  t.name.toLowerCase().includes(searchTerm) ||
                  t.description.toLowerCase().includes(searchTerm);
              
              const matchesType = !typeFilter || t.type === typeFilter;
              const matchesCategory = !categoryFilter || t.category === categoryFilter;
              
              const matchesDateFrom = !dateFrom || t.date >= dateFrom;
              const matchesDateTo = !dateTo || t.date <= dateTo;
              
              return matchesSearch && matchesType && matchesCategory && matchesDateFrom && matchesDateTo;
          });
          
          currentPage.transaction = 1;
          displayTransactions(filteredTransactions);
          document.getElementById('transactionCount').textContent = `共 ${filteredTransactions.length} 筆記錄`;
      }

      // 載入收據資料
      function loadReceipts() {
          displayReceipts(allData.receipts);
          updateReceiptCount();
      }

      // 顯示收據資料
      function displayReceipts(receipts) {
          const tbody = document.querySelector('#receiptTable tbody');
          const startIndex = (currentPage.receipt - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          const pageReceipts = receipts.slice(startIndex, endIndex);
          
          if (pageReceipts.length === 0) {
              tbody.innerHTML = `
                  <tr>
                      <td colspan="9" class="empty-state">
                          <div class="empty-state-icon">📄</div>
                          <div class="empty-state-title">暫無收據記錄</div>
                          <div class="empty-state-description">點擊「開立收據」開始開立您的第一張收據</div>
                      </td>
                  </tr>
              `;
              return;
          }
          
          tbody.innerHTML = pageReceipts.map(r => `
              <tr>
                  <td>${formatDate(r.date)}</td>
                  <td>${r.receiptNumber}</td>
                  <td>${r.payer}</td>
                  <td>${r.identity}</td>
                  <td>${r.phone}</td>
                  <td>${r.category}</td>
                  <td>${formatCurrency(r.amount)}</td>
                  <td><span class="badge badge-${r.status === '已開立' ? 'success' : 'info'}">${r.status}</span></td>
                  <td>
                      <button class="btn btn-sm btn-info" onclick="printReceipt('${r.id}')">列印</button>
                      <button class="btn btn-sm btn-success" onclick="emailReceipt('${r.id}')">寄送</button>
                      <button class="btn btn-sm btn-danger" onclick="voidReceipt('${r.id}')">作廢</button>
                  </td>
              </tr>
          `).join('');
          
          updatePagination('receipt', receipts.length);
      }

      // 更新收據數量
      function updateReceiptCount() {
          document.getElementById('receiptCount').textContent = `共 ${allData.receipts.length} 筆記錄`;
      }

      // 搜尋收據
      function searchReceipts() {
          const searchTerm = document.getElementById('receiptSearch').value.toLowerCase();
          const categoryFilter = document.getElementById('receiptCategory').value;
          const statusFilter = document.getElementById('receiptStatus').value;
          
          let filteredReceipts = allData.receipts.filter(r => {
              const matchesSearch = !searchTerm || 
                  r.receiptNumber.toLowerCase().includes(searchTerm) ||
                  r.payer.toLowerCase().includes(searchTerm);
              
              const matchesCategory = !categoryFilter || r.category === categoryFilter;
              const matchesStatus = !statusFilter || r.status === statusFilter;
              
              return matchesSearch && matchesCategory && matchesStatus;
          });
          
          currentPage.receipt = 1;
          displayReceipts(filteredReceipts);
          document.getElementById('receiptCount').textContent = `共 ${filteredReceipts.length} 筆記錄`;
      }

      // 載入會員資料
      function loadMembers() {
          displayMembers(allData.members);
          updateMemberCount();
      }

      // 顯示會員資料
      function displayMembers(members) {
          const tbody = document.querySelector('#memberTable tbody');
          const startIndex = (currentPage.member - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          const pageMembers = members.slice(startIndex, endIndex);
          
          if (pageMembers.length === 0) {
              tbody.innerHTML = `
                  <tr>
                      <td colspan="9" class="empty-state">
                          <div class="empty-state-icon">👥</div>
                          <div class="empty-state-title">暫無會員記錄</div>
                          <div class="empty-state-description">點擊「新增會員」開始新增您的第一位會員</div>
                      </td>
                  </tr>
              `;
              return;
          }
          
          tbody.innerHTML = pageMembers.map(m => `
              <tr>
                  <td>${m.memberNumber}</td>
                  <td>${m.name}</td>
                  <td>${m.gender}</td>
                  <td>${m.phone}</td>
                  <td>${m.email}</td>
                  <td>${m.type}</td>
                  <td>${formatDate(m.joinDate)}</td>
                  <td><span class="badge badge-${m.status === '正常' ? 'success' : 'warning'}">${m.status}</span></td>
                  <td>
                      <button class="btn btn-sm btn-info" onclick="editMember('${m.id}')">編輯</button>
                      <button class="btn btn-sm btn-warning" onclick="suspendMember('${m.id}')">暫停</button>
                      <button class="btn btn-sm btn-danger" onclick="deleteMember('${m.id}')">刪除</button>
                  </td>
              </tr>
          `).join('');
          
          updatePagination('member', members.length);
      }

      // 更新會員數量
      function updateMemberCount() {
          document.getElementById('memberCount').textContent = `共 ${allData.members.length} 筆記錄`;
      }

      // 搜尋會員
      function searchMembers() {
          const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
          const typeFilter = document.getElementById('memberType').value;
          const statusFilter = document.getElementById('memberStatus').value;
          
          let filteredMembers = allData.members.filter(m => {
              const matchesSearch = !searchTerm || 
                  m.memberNumber.toLowerCase().includes(searchTerm) ||
                  m.name.toLowerCase().includes(searchTerm) ||
                  m.phone.includes(searchTerm);
              
              const matchesType = !typeFilter || m.type === typeFilter;
              const matchesStatus = !statusFilter || m.status === statusFilter;
              
              return matchesSearch && matchesType && matchesStatus;
          });
          
          currentPage.member = 1;
          displayMembers(filteredMembers);
          document.getElementById('memberCount').textContent = `共 ${filteredMembers.length} 筆記錄`;
      }

      // 載入憑證資料
      function loadVouchers() {
          displayVouchers(allData.vouchers);
          updateVoucherCount();
      }

      // 顯示憑證資料
      function displayVouchers(vouchers) {
          const tbody = document.querySelector('#voucherTable tbody');
          
          if (vouchers.length === 0) {
              tbody.innerHTML = `
                  <tr>
                      <td colspan="9" class="empty-state">
                          <div class="empty-state-icon">📋</div>
                          <div class="empty-state-title">暫無憑證記錄</div>
                          <div class="empty-state-description">點擊「申請憑證」開始申請您的第一張憑證</div>
                      </td>
                  </tr>
              `;
              return;
          }
          
          tbody.innerHTML = vouchers.map(v => `
              <tr>
                  <td>${formatDate(v.date)}</td>
                  <td>${v.voucherNumber}</td>
                  <td>${v.applicant}</td>
                  <td>${v.category}</td>
                  <td>${formatCurrency(v.amount)}</td>
                  <td>${v.purpose}</td>
                  <td><span class="badge badge-${getStatusBadgeClass(v.status)}">${v.status}</span></td>
                  <td>${v.hasAttachment ? '📎' : '-'}</td>
                  <td>
                      <button class="btn btn-sm btn-info" onclick="viewVoucher('${v.id}')">查看</button>
                      <button class="btn btn-sm btn-success" onclick="approveVoucher('${v.id}')">核准</button>
                      <button class="btn btn-sm btn-danger" onclick="rejectVoucher('${v.id}')">駁回</button>
                  </td>
              </tr>
          `).join('');
      }

      // 取得狀態徽章樣式
      function getStatusBadgeClass(status) {
          switch(status) {
              case '待審核': return 'warning';
              case '已核准': return 'success';
              case '已駁回': return 'danger';
              case '已支付': return 'info';
              default: return 'secondary';
          }
      }

      // 更新憑證數量
      function updateVoucherCount() {
          document.getElementById('voucherCount').textContent = `共 ${allData.vouchers.length} 筆記錄`;
      }

      // 搜尋憑證
      function searchVouchers() {
          const searchTerm = document.getElementById('voucherSearch').value.toLowerCase();
          const categoryFilter = document.getElementById('voucherCategory').value;
          const statusFilter = document.getElementById('voucherStatus').value;
          
          let filteredVouchers = allData.vouchers.filter(v => {
              const matchesSearch = !searchTerm || 
                  v.voucherNumber.toLowerCase().includes(searchTerm) ||
                  v.applicant.toLowerCase().includes(searchTerm);
              
              const matchesCategory = !categoryFilter || v.category === categoryFilter;
              const matchesStatus = !statusFilter || v.status === statusFilter;
              
              return matchesSearch && matchesCategory && matchesStatus;
          });
          
          currentPage.voucher = 1;
          displayVouchers(filteredVouchers);
          document.getElementById('voucherCount').textContent = `共 ${filteredVouchers.length} 筆記錄`;
      }

      // 載入報表
      function loadReports() {
          // 報表功能初始化
      }

      // 載入設定
      function loadSettings() {
          loadOrganizationSettings();
          loadEmailSettings();
          loadSystemInfo();
          loadBackupSettings();
      }

      // 載入組織設定
      function loadOrganizationSettings() {
          // 載入儲存的組織設定
          const orgSettings = getStoredSettings('organization');
          if (orgSettings) {
              document.getElementById('orgName').value = orgSettings.name || '台灣帕金森病友權益促進會';
              document.getElementById('taxId').value = orgSettings.taxId || '';
              document.getElementById('orgAddress').value = orgSettings.address || '';
              document.getElementById('orgPhone').value = orgSettings.phone || '';
              document.getElementById('orgEmail').value = orgSettings.email || '';
              document.getElementById('orgWebsite').value = orgSettings.website || '';
          }
      }

      // 載入郵件設定
      function loadEmailSettings() {
          const emailSettings = getStoredSettings('email');
          if (emailSettings) {
              document.getElementById('smtpHost').value = emailSettings.host || '';
              document.getElementById('smtpPort').value = emailSettings.port || '587';
              document.getElementById('smtpUser').value = emailSettings.user || '';
              document.getElementById('emailFrom').value = emailSettings.from || '';
              document.getElementById('autoSendReceipt').checked = emailSettings.autoSend || false;
          }
      }

      // 載入系統資訊
      function loadSystemInfo() {
          document.getElementById('systemVersion').textContent = 'v1.0.0';
          document.getElementById('dataCount').textContent = 
              allData.transactions.length + allData.receipts.length + 
              allData.members.length + allData.vouchers.length;
          document.getElementById('lastBackup').textContent = '2024-06-27 10:30';
          document.getElementById('systemHealth').textContent = '健康';
      }

      // 載入備份設定
      function loadBackupSettings() {
          const backupSettings = getStoredSettings('backup');
          if (backupSettings) {
              document.getElementById('autoBackup').checked = backupSettings.autoBackup !== false;
              document.getElementById('backupFrequency').value = backupSettings.frequency || 'weekly';
              document.getElementById('backupRetention').value = backupSettings.retention || 30;
          }
      }

      // 更新分頁
      function updatePagination(type, totalItems) {
          const totalPages = Math.ceil(totalItems / itemsPerPage);
          const currentPageNum = currentPage[type];
          
          document.getElementById(`${type}PageInfo`).textContent = 
              `第 ${currentPageNum} 頁，共 ${totalPages} 頁`;
          
          document.getElementById(`${type}PrevBtn`).disabled = currentPageNum <= 1;
          document.getElementById(`${type}NextBtn`).disabled = currentPageNum >= totalPages;
      }

      // 上一頁
      function previousPage(type) {
          if (currentPage[type] > 1) {
              currentPage[type]--;
              switch(type) {
                  case 'transaction':
                      loadTransactions();
                      break;
                  case 'receipt':
                      loadReceipts();
                      break;
                  case 'member':
                      loadMembers();
                      break;
                  case 'voucher':
                      loadVouchers();
                      break;
              }
          }
      }

      // 下一頁
      function nextPage(type) {
          const totalItems = allData[type + 's'].length;
          const totalPages = Math.ceil(totalItems / itemsPerPage);
          
          if (currentPage[type] < totalPages) {
              currentPage[type]++;
              switch(type) {
                  case 'transaction':
                      loadTransactions();
                      break;
                  case 'receipt':
                      loadReceipts();
                      break;
                  case 'member':
                      loadMembers();
                      break;
                  case 'voucher':
                      loadVouchers();
                      break;
              }
          }
      }

      // 格式化日期
      function formatDate(dateString) {
          return new Date(dateString).toLocaleDateString('zh-TW');
      }

      // 顯示載入動畫
      function showLoading() {
          document.getElementById('loading').style.display = 'flex';
      }

      // 隱藏載入動畫
      function hideLoading() {
          document.getElementById('loading').style.display = 'none';
      }

      // 顯示警告訊息
      function showAlert(message, type = 'info') {
          const alert = document.getElementById('systemAlert');
          const messageElement = document.getElementById('alertMessage');
          
          alert.className = `alert alert-${type} show`;
          messageElement.textContent = message;
          
          setTimeout(() => {
              alert.classList.remove('show');
          }, 5000);
      }

      // 顯示模態框
      function showModal(modalId) {
          document.getElementById(modalId).classList.add('show');
      }

      // 關閉模態框
      function closeModal(modalId) {
          document.getElementById(modalId).classList.remove('show');
      }

      // 顯示新增交易模態框
      function showAddTransactionModal() {
          document.getElementById('addTransactionForm').reset();
          setDefaultDates();
          updateTransactionCategories();
          showModal('addTransactionModal');
      }

      // 顯示新增收據模態框
      function showAddReceiptModal() {
          document.getElementById('addReceiptForm').reset();
          setDefaultDates();
          showModal('addReceiptModal');
      }

      // 顯示新增會員模態框
      function showAddMemberModal() {
          document.getElementById('addMemberForm').reset();
          setDefaultDates();
          showModal('addMemberModal');
      }

      // 顯示新增憑證模態框
      function showAddVoucherModal() {
          // 這個函數在HTML中被引用但沒有對應的模態框
          showAlert('憑證申請功能開發中', 'info');
      }

      // 處理新增交易
      function handleAddTransaction(e) {
          e.preventDefault();
          
          const formData = new FormData(e.target);
          const transaction = {
              id: `T${String(allData.transactions.length + 1).padStart(4, '0')}`,
              date: document.getElementById('transactionDate').value,
              type: document.getElementById('transactionTypeModal').value,
              category: document.getElementById('transactionCategoryModal').value,
              amount: parseInt(document.getElementById('transactionAmount').value),
              name: document.getElementById('transactionName').value,
              account: document.getElementById('transactionAccount').value,
              description: document.getElementById('transactionDescription').value,
              status: '已確認'
          };
          
          allData.transactions.unshift(transaction);
          
          // 如果勾選自動產生收據
          if (document.getElementById('generateReceipt').checked && transaction.type === '收入') {
              const receipt = {
                  id: `R${String(allData.receipts.length + 1).padStart(4, '0')}`,
                  date: transaction.date,
                  receiptNumber: `${new Date().getFullYear()}${String(allData.receipts.length + 1).padStart(4, '0')}`,
                  payer: transaction.name,
                  identity: '個人',
                  phone: '',
                  category: transaction.category === '會費' ? '會費' : '捐款',
                  amount: transaction.amount,
                  status: '已開立'
              };
              allData.receipts.unshift(receipt);
          }
          
          updateStatistics();
          if (currentTab === 'transactions') {
              loadTransactions();
          }
          
          closeModal('addTransactionModal');
          showAlert('交易新增成功', 'success');
      }

      // 處理新增收據
      function handleAddReceipt(e) {
          e.preventDefault();
          
          const receipt = {
              id: `R${String(allData.receipts.length + 1).padStart(4, '0')}`,
              date: document.getElementById('receiptDate').value,
              receiptNumber: `${new Date().getFullYear()}${String(allData.receipts.length + 1).padStart(4, '0')}`,
              payer: document.getElementById('receiptPayer').value,
              identity: document.getElementById('receiptIdentity').value,
              phone: document.getElementById('receiptPhone').value,
              category: document.getElementById('receiptCategoryModal').value,
              amount: parseInt(document.getElementById('receiptAmount').value),
              status: '已開立'
          };
          
          allData.receipts.unshift(receipt);
          
          // 同時新增對應的收入交易
          const transaction = {
              id: `T${String(allData.transactions.length + 1).padStart(4, '0')}`,
              date: receipt.date,
              type: '收入',
              category: receipt.category,
              amount: receipt.amount,
              name: receipt.payer,
              account: '現金',
              description: `收據 ${receipt.receiptNumber}`,
              status: '已確認'
          };
          
          allData.transactions.unshift(transaction);
          
          updateStatistics();
          if (currentTab === 'receipts') {
              loadReceipts();
          }
          
          closeModal('addReceiptModal');
          showAlert('收據開立成功', 'success');
          
          // 如果勾選自動寄送
          if (document.getElementById('autoSendReceiptModal').checked) {
              setTimeout(() => {
                  showAlert('收據已自動寄送', 'info');
              }, 1000);
          }
      }

      // 處理新增會員
      function handleAddMember(e) {
          e.preventDefault();
          
          const member = {
              id: `M${String(allData.members.length + 1).padStart(4, '0')}`,
              memberNumber: `${new Date().getFullYear()}${String(allData.members.length + 1).padStart(3, '0')}`,
              name: document.getElementById('memberName').value,
              gender: document.getElementById('memberGender').value,
              phone: document.getElementById('memberPhone').value,
              email: document.getElementById('memberEmailModal').value,
              type: document.getElementById('memberTypeModal').value,
              joinDate: document.getElementById('memberJoinDate').value,
              status: '正常'
          };
          
          allData.members.unshift(member);
          
          updateStatistics();
          if (currentTab === 'members') {
              loadMembers();
          }
          
          closeModal('addMemberModal');
          showAlert('會員新增成功', 'success');
      }

      // 處理組織設定
      function handleOrgSettings(e) {
          e.preventDefault();
          
          const settings = {
              name: document.getElementById('orgName').value,
              taxId: document.getElementById('taxId').value,
              address: document.getElementById('orgAddress').value,
              phone: document.getElementById('orgPhone').value,
              email: document.getElementById('orgEmail').value,
              website: document.getElementById('orgWebsite').value
          };
          
          saveSettings('organization', settings);
          showAlert('組織設定已儲存', 'success');
      }

      // 處理郵件設定
      function handleEmailSettings(e) {
          e.preventDefault();
          
          const settings = {
              host: document.getElementById('smtpHost').value,
              port: document.getElementById('smtpPort').value,
              user: document.getElementById('smtpUser').value,
              from: document.getElementById('emailFrom').value,
              autoSend: document.getElementById('autoSendReceipt').checked
          };
          
          saveSettings('email', settings);
          showAlert('郵件設定已儲存', 'success');
      }

      // 處理備份設定
      function handleBackupSettings(e) {
          e.preventDefault();
          
          const settings = {
              autoBackup: document.getElementById('autoBackup').checked,
              frequency: document.getElementById('backupFrequency').value,
              retention: document.getElementById('backupRetention').value
          };
          
          saveSettings('backup', settings);
          showAlert('備份設定已儲存', 'success');
      }

      // 儲存設定
      function saveSettings(key, settings) {
          localStorage.setItem(`accountingSystem_${key}`, JSON.stringify(settings));
      }

      // 取得儲存的設定
      function getStoredSettings(key) {
          const stored = localStorage.getItem(`accountingSystem_${key}`);
          return stored ? JSON.parse(stored) : null;
      }

      // 匯出功能
      function exportTransactions() {
          exportToCSV(allData.transactions, 'transactions.csv');
      }

      function exportReceipts() {
          exportToCSV(allData.receipts, 'receipts.csv');
      }

      function exportMembers() {
          exportToCSV(allData.members, 'members.csv');
      }

      function exportVouchers() {
          exportToCSV(allData.vouchers, 'vouchers.csv');
      }

      // 匯出為CSV
      function exportToCSV(data, filename) {
          if (data.length === 0) {
              showAlert('沒有資料可匯出', 'warning');
              return;
          }
          
          const headers = Object.keys(data[0]);
          const csvContent = [
              headers.join(','),
              ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
          ].join('\n');
          
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');
          const url = URL.createObjectURL(blob);
          
          link.setAttribute('href', url);
          link.setAttribute('download', filename);
          link.style.visibility = 'hidden';
          
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          showAlert('資料匯出成功', 'success');
      }

      // 編輯功能
      function editTransaction(id) {
          showAlert('編輯功能開發中', 'info');
      }

      function editMember(id) {
          showAlert('編輯功能開發中', 'info');
      }

      // 刪除功能
      function deleteTransaction(id) {
          if (confirm('確定要刪除此交易記錄嗎？')) {
              allData.transactions = allData.transactions.filter(t => t.id !== id);
              loadTransactions();
              updateStatistics();
              showAlert('交易記錄已刪除', 'success');
          }
      }

      function deleteMember(id) {
          if (confirm('確定要刪除此會員嗎？')) {
              allData.members = allData.members.filter(m => m.id !== id);
              loadMembers();
              updateStatistics();
              showAlert('會員已刪除', 'success');
          }
      }

      // 收據操作
      function printReceipt(id) {
          showAlert('列印功能開發中', 'info');
      }

      function emailReceipt(id) {
          showAlert('郵件寄送功能開發中', 'info');
      }

      function voidReceipt(id) {
          if (confirm('確定要作廢此收據嗎？')) {
              const receipt = allData.receipts.find(r => r.id === id);
              if (receipt) {
                  receipt.status = '已作廢';
                  loadReceipts();
                  showAlert('收據已作廢', 'success');
              }
          }
      }

      // 憑證操作
      function viewVoucher(id) {
          showAlert('查看功能開發中', 'info');
      }

      function approveVoucher(id) {
          const voucher = allData.vouchers.find(v => v.id === id);
          if (voucher) {
              voucher.status = '已核准';
              loadVouchers();
              showAlert('憑證已核准', 'success');
          }
      }

      function rejectVoucher(id) {
          const voucher = allData.vouchers.find(v => v.id === id);
          if (voucher) {
              voucher.status = '已駁回';
              loadVouchers();
              showAlert('憑證已駁回', 'warning');
          }
      }

      // 會員操作
      function suspendMember(id) {
          const member = allData.members.find(m => m.id === id);
          if (member) {
              member.status = member.status === '正常' ? '暫停' : '正常';
              loadMembers();
              updateStatistics();
              showAlert(`會員已${member.status === '暫停' ? '暫停' : '恢復'}`, 'success');
          }
      }

      // 報表功能
      function generateReport() {
          const reportType = document.getElementById('reportType').value;
          const reportYear = document.getElementById('reportYear').value;
          const reportMonth = document.getElementById('reportMonth').value;
          
          showAlert('報表產生功能開發中', 'info');
          document.getElementById('reportToolbar').style.display = 'flex';
      }

      function exportReport() {
          showAlert('報表匯出功能開發中', 'info');
      }

      function printReport() {
          showAlert('報表列印功能開發中', 'info');
      }

      function emailReport() {
          showAlert('報表郵件功能開發中', 'info');
      }

      // 系統維護功能
      function performSystemCheck() {
          showAlert('正在執行系統檢查...', 'info');
          setTimeout(() => {
              showAlert('系統檢查完成，一切正常', 'success');
          }, 2000);
      }

      function cleanupSystem() {
          if (confirm('確定要清理系統嗎？這將清除臨時檔案。')) {
              showAlert('系統清理完成', 'success');
          }
      }

      function viewSystemLogs() {
          showAlert('系統日誌功能開發中', 'info');
      }

      function createBackup() {
          showAlert('正在建立備份...', 'info');
          setTimeout(() => {
              showAlert('備份建立成功', 'success');
              document.getElementById('lastBackup').textContent = new Date().toLocaleString('zh-TW');
          }, 2000);
      }

      function createManualBackup() {
          createBackup();
      }

      function viewBackupHistory() {
          showAlert('備份記錄功能開發中', 'info');
      }

      // 測試郵件設定
      function testEmailSettings() {
          showAlert('正在測試郵件設定...', 'info');
          setTimeout(() => {
              showAlert('郵件測試成功', 'success');
          }, 2000);
      }

      // 重設表單
      function resetOrgForm() {
          if (confirm('確定要重設組織設定嗎？')) {
              document.getElementById('organizationForm').reset();
          }
      }

      function resetEmailForm() {
          if (confirm('確定要重設郵件設定嗎？')) {
              document.getElementById('emailForm').reset();
          }
      }

      // 匯入會員
      function importMembers() {
          showAlert('會員匯入功能開發中', 'info');
      }

      // 當前使用者資訊
      document.getElementById('currentUser').textContent = '系統管理員';

      // 系統狀態檢查
      setInterval(() => {
          // 模擬系統狀態檢查
          const status = Math.random() > 0.1 ? '系統正常' : '系統警告';
          const statusElement = document.getElementById('systemStatus');
          statusElement.textContent = status;
          statusElement.className = `badge badge-${status === '系統正常' ? 'success' : 'warning'}`;
      }, 30000); // 每30秒檢查一次

      console.log('台灣帕金森病友權益促進會 - 會計管理系統載入完成');
  </script>
</body>
</html>

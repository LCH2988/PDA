<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動報名系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">活動報名系統</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showHome()">首頁</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showEventList()">活動列表</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showMyEvents()">我的活動</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showAdmin()">管理員專區</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div id="userInfo" class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">使用者資訊</h5>
                <div class="row">
                    <div class="col-auto">
                        <img id="userPicture" class="rounded-circle" style="width: 100px; height: 100px;" alt="使用者頭像">
                    </div>
                    <div class="col">
                        <p class="card-text">名稱：<span id="userName"></span></p>
                        <p class="card-text">ID：<span id="userId"></span></p>
                        <p class="card-text">登入次數：<span id="loginCount"></span></p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="content">
            <!-- 動態內容區域 -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // LIFF 初始化
const LIFF_ID = '2001679903-r5VXNe5g'; // 請替換成您的 LIFF ID
const GAS_URL = 'https://script.google.com/macros/s/AKfycbyOJBdH3feZYEWFprPS1IqhDAgXgdXsz4PmWM2Cl9NYWr20pns3OxbUgWq-q4xXaEmP/exec'; // 請替換成您的 GAS 部署網址

async function initializeLiff() {
    try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) {
            liff.login();
        } else {
            const profile = await liff.getProfile();
            updateUserInfo(profile);
            recordUserLogin(profile);
        }
    } catch (err) {
        console.error('LIFF 初始化失敗', err);
    }
}

// 更新使用者資訊到頁面
function updateUserInfo(profile) {
    document.getElementById('userPicture').src = profile.pictureUrl;
    document.getElementById('userName').textContent = profile.displayName;
    document.getElementById('userId').textContent = profile.userId;
}

// 記錄使用者登入資訊
async function recordUserLogin(profile) {
    try {
        const response = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: 'recordLogin',
                userId: profile.userId,
                displayName: profile.displayName,
                pictureUrl: profile.pictureUrl
            })
        });
        const data = await response.json();
        document.getElementById('loginCount').textContent = data.loginCount;
    } catch (err) {
        console.error('記錄登入失敗', err);
    }
}

// 頁面切換函數
function showHome() {
    document.getElementById('content').innerHTML = '<h2>歡迎使用活動報名系統</h2>';
}

function showEventList() {
    fetchEvents();
}

async function fetchEvents() {
    try {
        const response = await fetch(GAS_URL + '?action=getEvents');
        const events = await response.json();
        displayEvents(events);
    } catch (err) {
        console.error('獲取活動列表失敗', err);
    }
}

function displayEvents(events) {
    const content = document.getElementById('content');
    content.innerHTML = `
        <h2>活動列表</h2>
        <div class="row">
            ${events.map(event => `
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">${event.title}</h5>
                            <p class="card-text">${event.description}</p>
                            <button class="btn btn-primary" onclick="registerEvent('${event.id}')">報名</button>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function showMyEvents() {
    // 實作我的活動頁面
}

function showAdmin() {
    // 實作管理員專區
}

// 頁面載入時初始化 LIFF
window.onload = initializeLiff;
    </script>
</body>
</html>

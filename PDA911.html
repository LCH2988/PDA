<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Profile Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-6">
            <div id="profile" class="flex flex-col items-center">
                <div id="pictureUrl" class="w-32 h-32 rounded-full overflow-hidden mb-4">
                    <!-- Profile picture will be displayed here -->
                </div>
                <h2 id="displayName" class="text-xl font-bold mb-2">
                    <!-- Display name will be shown here -->
                </h2>
                <p id="userId" class="text-gray-600 mb-4">
                    <!-- User ID will be shown here -->
                </p>
                <div id="loginInfo" class="text-sm text-gray-500">
                    <!-- Login information will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        async function initializeLiff() {
            try {
                // 替換成你的 LIFF ID
                await liff.init({ liffId: "2001679903-r5VXNe5g" });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    displayProfile(profile);
                    recordLogin(profile);
                }
            } catch (err) {
                console.error('LIFF Initialization failed', err);
            }
        }

        function displayProfile(profile) {
            // 顯示個人資料
            document.getElementById('pictureUrl').innerHTML = `
                <img src="${profile.pictureUrl}" alt="Profile Picture" class="w-full h-full object-cover">
            `;
            document.getElementById('displayName').textContent = profile.displayName;
            document.getElementById('userId').textContent = `ID: ${profile.userId}`;
        }

        async function recordLogin(profile) {
            // 記錄登入資訊到 Google Sheets
            const data = {
                userId: profile.userId,
                displayName: profile.displayName,
                timestamp: new Date().toISOString()
            };

            // 替換成你的 Google Apps Script Web App URL
            const gasUrl = 'https://script.google.com/macros/s/AKfycbz2arLhtEkjq3zvHTP-X_clWb-qkswyq7E0WbRf4ZCGLVNRHQDO4jp2ajzzd3CLlNge/exec';
            
            try {
                const response = await fetch(gasUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Login recorded successfully');
            } catch (error) {
                console.error('Error recording login:', error);
            }
        }

        // 初始化 LIFF
        initializeLiff();
    </script>
</body>
</html>

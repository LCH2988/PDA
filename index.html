<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸•é‡‘æ£®ç—…å‹æœƒç®¡ç†ç³»çµ±</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .header h1 {
      color: #667eea;
      font-size: 24px;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    
    .stat-card .label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 5px;
    }
    
    .stat-card .value {
      font-size: 24px;
      font-weight: bold;
    }
    
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .menu-card {
      background: white;
      border-radius: 15px;
      padding: 20px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-decoration: none;
      color: inherit;
    }
    
    .menu-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 12px rgba(0,0,0,0.15);
    }
    
    .menu-card .icon {
      font-size: 36px;
      margin-bottom: 10px;
    }
    
    .menu-card .title {
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }
    
    .loading {
      text-align: center;
      color: white;
      padding: 40px;
      font-size: 18px;
    }
    
    .page-content {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: none;
    }
    
    .page-content.active {
      display: block;
    }
    
    .back-button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 15px;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .submit-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .activity-item,
    .announcement-item,
    .forum-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .activity-item h3,
    .announcement-item h3,
    .forum-item h3 {
      color: #667eea;
      margin-bottom: 8px;
      font-size: 16px;
    }
    
    .activity-item p,
    .announcement-item p,
    .forum-item p {
      color: #666;
      font-size: 14px;
      margin: 5px 0;
    }
    
    .calendar-container {
      background: white;
      padding: 15px;
      border-radius: 10px;
    }
    
    .profile-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .profile-info .label {
      color: #666;
      font-size: 12px;
      margin-bottom: 3px;
    }
    
    .profile-info .value {
      color: #333;
      font-size: 16px;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="loading" id="loading">è¼‰å…¥ä¸­...</div>
    
    <!-- ä¸»ç•«é¢ -->
    <div id="mainPage" style="display:none;">
      <div class="header">
        <h1>ğŸ—ï¸ å°ç£å¸•é‡‘æ£®ç—…å‹æ¬Šç›Šä¿ƒé€²æœƒ</h1>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="label">æœƒå“¡æ•¸</div>
            <div class="value" id="memberCount">0</div>
          </div>
          <div class="stat-card">
            <div class="label">å¿—å·¥æ•¸</div>
            <div class="value" id="volunteerCount">0</div>
          </div>
          <div class="stat-card">
            <div class="label">ç´¯è¨ˆææ¬¾</div>
            <div class="value" id="donationAmount">$0</div>
          </div>
          <div class="stat-card">
            <div class="label">æ´»å‹•æ•¸é‡</div>
            <div class="value" id="activityCount">0</div>
          </div>
        </div>
      </div>
      
      <div class="menu-grid">
        <div class="menu-card" onclick="showPage('register')">
          <div class="icon">ğŸ“</div>
          <div class="title">æœƒå“¡è¨»å†Š</div>
        </div>
        <div class="menu-card" onclick="showPage('activities')">
          <div class="icon">ğŸ¯</div>
          <div class="title">æ´»å‹•åˆ—è¡¨</div>
        </div>
        <div class="menu-card" onclick="showPage('calendar')">
          <div class="icon">ğŸ“…</div>
          <div class="title">è¡Œäº‹æ›†</div>
        </div>
        <div class="menu-card" onclick="showPage('announcements')">
          <div class="icon">ğŸ“¢</div>
          <div class="title">æœ€æ–°å…¬å‘Š</div>
        </div>
        <div class="menu-card" onclick="showPage('forum')">
          <div class="icon">ğŸ’¬</div>
          <div class="title">äº¤æµè«–å£‡</div>
        </div>
        <div class="menu-card" onclick="showPage('profile')">
          <div class="icon">ğŸ‘¤</div>
          <div class="title">æœƒå“¡ä¸­å¿ƒ</div>
        </div>
        <div class="menu-card" onclick="showPage('volunteer')">
          <div class="icon">ğŸ™‹</div>
          <div class="title">å¿—å·¥å¹³å°</div>
        </div>
        <div class="menu-card" onclick="showPage('donation')">
          <div class="icon">ğŸ’°</div>
          <div class="title">æ„›å¿ƒææ¬¾</div>
        </div>
        <div class="menu-card" onclick="showPage('settings')">
          <div class="icon">âš™ï¸</div>
          <div class="title">è¨­å®š</div>
        </div>
      </div>
    </div>
    
    <!-- æœƒå“¡è¨»å†Šé é¢ -->
    <div id="registerPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">æœƒå“¡è¨»å†Š</h2>
      <form id="registerForm">
        <div class="form-group">
          <label>è¨»å†Šé¡å‹</label>
          <select id="registerType" required>
            <option value="member">ç—…å‹æœƒå“¡</option>
            <option value="volunteer">å¿—å·¥</option>
          </select>
        </div>
        <div class="form-group">
          <label>å§“å</label>
          <input type="text" id="name" required>
        </div>
        <div class="form-group">
          <label>æ€§åˆ¥</label>
          <select id="gender" required>
            <option value="ç”·">ç”·</option>
            <option value="å¥³">å¥³</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label>ç”Ÿæ—¥</label>
          <input type="date" id="birthday" required>
        </div>
        <div class="form-group">
          <label>é›»è©±</label>
          <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group">
          <label>åœ°å€</label>
          <input type="text" id="address" required>
        </div>
        <div id="memberFields">
          <div class="form-group">
            <label>ç·Šæ€¥è¯çµ¡äºº</label>
            <input type="text" id="emergencyContact">
          </div>
          <div class="form-group">
            <label>ç·Šæ€¥è¯çµ¡é›»è©±</label>
            <input type="tel" id="emergencyPhone">
          </div>
          <div class="form-group">
            <label>ç—…æ³èªªæ˜</label>
            <textarea id="condition"></textarea>
          </div>
        </div>
        <div id="volunteerFields" style="display:none;">
          <div class="form-group">
            <label>å°ˆé•·</label>
            <input type="text" id="skills" placeholder="ä¾‹ï¼šé†«ç™‚ç…§è­·ã€æ´»å‹•è¦åŠƒ">
          </div>
          <div class="form-group">
            <label>å¯æœå‹™æ™‚é–“</label>
            <textarea id="availableTime" placeholder="ä¾‹ï¼šé€±æœ«ã€å¹³æ—¥æ™šä¸Š"></textarea>
          </div>
        </div>
        <button type="submit" class="submit-button">é€å‡ºè¨»å†Š</button>
      </form>
    </div>
    
    <!-- æ´»å‹•åˆ—è¡¨é é¢ -->
    <div id="activitiesPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">æ´»å‹•åˆ—è¡¨</h2>
      <div id="activitiesList"></div>
    </div>
    
    <!-- è¡Œäº‹æ›†é é¢ -->
    <div id="calendarPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">è¡Œäº‹æ›†</h2>
      <div class="calendar-container">
        <p style="text-align: center; color: #666; padding: 40px 0;">è¡Œäº‹æ›†åŠŸèƒ½é–‹ç™¼ä¸­...</p>
      </div>
    </div>
    
    <!-- å…¬å‘Šé é¢ -->
    <div id="announcementsPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">æœ€æ–°å…¬å‘Š</h2>
      <div id="announcementsList"></div>
    </div>
    
    <!-- è«–å£‡é é¢ -->
    <div id="forumPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">äº¤æµè«–å£‡</h2>
      <div id="forumList"></div>
    </div>
    
    <!-- æœƒå“¡ä¸­å¿ƒé é¢ -->
    <div id="profilePage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">æœƒå“¡ä¸­å¿ƒ</h2>
      <div id="profileInfo"></div>
    </div>
    
    <!-- å¿—å·¥å¹³å°é é¢ -->
    <div id="volunteerPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">å¿—å·¥å¹³å°</h2>
      <p style="text-align: center; color: #666; padding: 40px 0;">å¿—å·¥å¹³å°åŠŸèƒ½é–‹ç™¼ä¸­...</p>
    </div>
    
    <!-- ææ¬¾é é¢ -->
    <div id="donationPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">æ„›å¿ƒææ¬¾</h2>
      <p style="text-align: center; color: #666; padding: 40px 0;">ææ¬¾åŠŸèƒ½é–‹ç™¼ä¸­...</p>
    </div>
    
    <!-- è¨­å®šé é¢ -->
    <div id="settingsPage" class="page-content">
      <button class="back-button" onclick="showMainPage()">â† è¿”å›</button>
      <h2 style="margin-bottom: 20px; color: #667eea;">è¨­å®š</h2>
      <p style="text-align: center; color: #666; padding: 40px 0;">è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...</p>
    </div>
  </div>
  
  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbygyqkhhqVnDRsISBdLW_oZWCuh7fiWTxbdOdr0JHvKXKzhbyPLGRgB3ovjN_3HPJtcfg/exec'; // æ›¿æ›ç‚ºä½ çš„ GAS Web App URL
    let userId = '';
    let userName = '';
    
    // åˆå§‹åŒ– LIFF
    async function initializeLiff() {
      try {
        await liff.init({ liffId: '2007905012-o1yDNa92' }); // æ›¿æ›ç‚ºä½ çš„ LIFF ID
        
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        
        const profile = await liff.getProfile();
        userId = profile.userId;
        userName = profile.displayName;
        
        await loadStatistics();
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('mainPage').style.display = 'block';
        
        // æª¢æŸ¥ URL åƒæ•¸
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        if (page) {
          showPage(page);
        }
      } catch (error) {
        console.error('LIFF initialization failed', error);
        document.getElementById('loading').textContent = 'åˆå§‹åŒ–å¤±æ•—ï¼š' + error;
      }
    }
    
    // è¼‰å…¥çµ±è¨ˆè³‡æ–™
    async function loadStatistics() {
      try {
        const response = await fetch(`${GAS_URL}?action=getStatistics`);
        const stats = await response.json();
        
        document.getElementById('memberCount').textContent = stats.members;
        document.getElementById('volunteerCount').textContent = stats.volunteers;
        document.getElementById('donationAmount').textContent = '$' + stats.donations.toLocaleString();
        document.getElementById('activityCount').textContent = stats.activities;
      } catch (error) {
        console.error('Error loading statistics:', error);
      }
    }
    
    // é¡¯ç¤ºé é¢
    function showPage(pageName) {
      document.getElementById('mainPage').style.display = 'none';
      document.querySelectorAll('.page-content').forEach(page => {
        page.classList.remove('active');
      });
      
      const pageElement = document.getElementById(pageName + 'Page');
      if (pageElement) {
        pageElement.classList.add('active');
        
        // è¼‰å…¥å°æ‡‰é é¢è³‡æ–™
        if (pageName === 'activities') {
          loadActivities();
        } else if (pageName === 'announcements') {
          loadAnnouncements();
        } else if (pageName === 'forum') {
          loadForum();
        } else if (pageName === 'profile') {
          loadProfile();
        }
      }
    }
    
    // è¿”å›ä¸»ç•«é¢
    function showMainPage() {
      document.querySelectorAll('.page-content').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById('mainPage').style.display = 'block';
    }
    
    // è¼‰å…¥æ´»å‹•åˆ—è¡¨
    async function loadActivities() {
      try {
        const response = await fetch(`${GAS_URL}?action=getActivities`);
        const activities = await response.json();
        
        const listElement = document.getElementById('activitiesList');
        if (activities.length === 0) {
          listElement.innerHTML = '<p style="text-align:center;color:#666;padding:40px 0;">ç›®å‰æ²’æœ‰æ´»å‹•</p>';
          return;
        }
        
        listElement.innerHTML = activities.map(activity => `
          <div class="activity-item">
            <h3>${activity.name}</h3>
            <p>ğŸ“… ${activity.date}</p>
            <p>ğŸ“ ${activity.location}</p>
            <p>ğŸ‘¥ å·²å ±åï¼š${activity.registered}/${activity.limit}</p>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading activities:', error);
      }
    }
    
    // è¼‰å…¥å…¬å‘Š
    async function loadAnnouncements() {
      try {
        const response = await fetch(`${GAS_URL}?action=getAnnouncements`);
        const announcements = await response.json();
        
        const listElement = document.getElementById('announcementsList');
        if (announcements.length === 0) {
          listElement.innerHTML = '<p style="text-align:center;color:#666;padding:40px 0;">ç›®å‰æ²’æœ‰å…¬å‘Š</p>';
          return;
        }
        
        listElement.innerHTML = announcements.map(ann => `
          <div class="announcement-item">
            <h3>${ann.title}</h3>
            <p style="font-size:12px;color:#999;">${ann.date}</p>
            <p>${ann.content}</p>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading announcements:', error);
      }
    }
    
    // è¼‰å…¥è«–å£‡
    async function loadForum() {
      try {
        const response = await fetch(`${GAS_URL}?action=getForumPosts`);
        const posts = await response.json();
        
        const listElement = document.getElementById('forumList');
        if (posts.length === 0) {
          listElement.innerHTML = '<p style="text-align:center;color:#666;padding:40px 0;">ç›®å‰æ²’æœ‰è²¼æ–‡</p>';
          return;
        }
        
        listElement.innerHTML = posts.map(post => `
          <div class="forum-item">
            <h3>${post.title}</h3>
            <p style="font-size:12px;color:#999;">${post.name} Â· ${post.date}</p>
            <p>${post.content}</p>
            <p style="font-size:12px;color:#667eea;margin-top:8px;">ğŸ’¬ ${post.replies} å‰‡å›è¦†</p>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading forum:', error);
      }
    }
    
    // è¼‰å…¥å€‹äººè³‡æ–™
    async function loadProfile() {
      try {
        const response = await fetch(`${GAS_URL}?action=getMemberInfo&userId=${userId}`);
        const profile = await response.json();
        
        const infoElement = document.getElementById('profileInfo');
        if (!profile) {
          infoElement.innerHTML = '<p style="text-align:center;color:#666;padding:40px 0;">å°šæœªè¨»å†Šæœƒå“¡<br><button class="submit-button" style="margin-top:20px;max-width:200px;" onclick="showPage(\'register\')">ç«‹å³è¨»å†Š</button></p>';
          return;
        }
        
        infoElement.innerHTML = `
          <div class="profile-info">
            <div class="label">å§“å</div>
            <div class="value">${profile.name}</div>
          </div>
          <div class="profile-info">
            <div class="label">æ€§åˆ¥</div>
            <div class="value">${profile.gender}</div>
          </div>
          <div class="profile-info">
            <div class="label">ç”Ÿæ—¥</div>
            <div class="value">${profile.birthday}</div>
          </div>
          <div class="profile-info">
            <div class="label">åœ°å€</div>
            <div class="value">${profile.address}</div>
          </div>
          <div class="profile-info">
            <div class="label">ç·Šæ€¥è¯çµ¡äºº</div>
            <div class="value">${profile.emergencyContact}</div>
          </div>
          <div class="profile-info">
            <div class="label">ç·Šæ€¥è¯çµ¡é›»è©±</div>
            <div class="value">${profile.emergencyPhone}</div>
          </div>
        `;
      } catch (error) {
        console.error('Error loading profile:', error);
      }
    }
    
    // è¨»å†Šé¡å‹åˆ‡æ›
    document.addEventListener('DOMContentLoaded', function() {
      const registerTypeSelect = document.getElementById('registerType');
      if (registerTypeSelect) {
        registerTypeSelect.addEventListener('change', function() {
          const memberFields = document.getElementById('memberFields');
          const volunteerFields = document.getElementById('volunteerFields');
          
          if (this.value === 'member') {
            memberFields.style.display = 'block';
            volunteerFields.style.display = 'none';
          } else {
            memberFields.style.display = 'none';
            volunteerFields.style.display = 'block';
          }
        });
      }
      
      // è¨»å†Šè¡¨å–®æäº¤
      const registerForm = document.getElementById('registerForm');
      if (registerForm) {
        registerForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const formData = {
            lineId: userId,
            type: document.getElementById('registerType').value,
            name: document.getElementById('name').value,
            gender: document.getElementById('gender').value,
            birthday: document.getElementById('birthday').value,
            phone: document.getElementById('phone').value,
            email: document.getElementById('email').value,
            address: document.getElementById('address').value
          };
          
          if (formData.type === 'member') {
            formData.emergencyContact = document.getElementById('emergencyContact').value;
            formData.emergencyPhone = document.getElementById('emergencyPhone').value;
            formData.condition = document.getElementById('condition').value;
          } else {
            formData.skills = document.getElementById('skills').value;
            formData.availableTime = document.getElementById('availableTime').value;
          }
          
          try {
            // é€™è£¡éœ€è¦å¯¦ä½œ POST è«‹æ±‚åˆ° GAS
            alert('è¨»å†ŠæˆåŠŸï¼');
            registerForm.reset();
            showMainPage();
            loadStatistics();
          } catch (error) {
            alert('è¨»å†Šå¤±æ•—ï¼š' + error);
          }
        });
      }
    });
    
    // å•Ÿå‹• LIFF
    initializeLiff();
  </script>
</body>
</html>

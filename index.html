<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°ç£å¸•é‡‘æ£®ç—…å‹æ¬Šç›Šä¿ƒé€²æœƒ - æœƒè¨ˆå‡ºç´ç³»çµ±</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
          line-height: 1.6;
          color: #333;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
      }

      .header {
          background: rgba(255, 255, 255, 0.95);
          padding: 25px;
          border-radius: 15px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
          margin-bottom: 30px;
          text-align: center;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header h1 {
          color: #1a472a;
          font-size: 2.5em;
          margin-bottom: 10px;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header .subtitle {
          color: #666;
          font-size: 1.2em;
          font-style: italic;
      }

      .main-content {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 30px;
          margin-bottom: 30px;
      }

      .card {
          background: rgba(255, 255, 255, 0.95);
          padding: 30px;
          border-radius: 15px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.2);
          transition: all 0.3s ease;
      }

      .card:hover {
          transform: translateY(-5px);
          box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      }

      .card h2 {
          color: #1a472a;
          margin-bottom: 20px;
          font-size: 1.8em;
          border-bottom: 3px solid #4caf50;
          padding-bottom: 10px;
      }

      .form-group {
          margin-bottom: 20px;
      }

      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: bold;
          color: #555;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
          width: 100%;
          padding: 12px;
          border: 2px solid #ddd;
          border-radius: 8px;
          font-size: 16px;
          transition: all 0.3s ease;
          background: rgba(255, 255, 255, 0.9);
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #4caf50;
          box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
          transform: scale(1.02);
      }

      .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 15px;
      }

      .checkbox-group {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          margin-top: 10px;
      }

      .checkbox-item {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 10px 15px;
          background: rgba(76, 175, 80, 0.1);
          border-radius: 25px;
          border: 2px solid transparent;
          transition: all 0.3s ease;
          cursor: pointer;
      }

      .checkbox-item:hover {
          background: rgba(76, 175, 80, 0.2);
          border-color: #4caf50;
      }

      .checkbox-item input[type="checkbox"] {
          width: auto;
          margin: 0;
      }

      .btn {
          background: linear-gradient(135deg, #4caf50, #45a049);
          color: white;
          padding: 15px 30px;
          border: none;
          border-radius: 25px;
          cursor: pointer;
          font-size: 16px;
          font-weight: bold;
          transition: all 0.3s ease;
          text-transform: uppercase;
          letter-spacing: 1px;
          box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      }

      .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
      }

      .btn:active {
          transform: translateY(0);
      }

      .btn-secondary {
          background: linear-gradient(135deg, #2196f3, #1976d2);
          box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
      }

      .btn-secondary:hover {
          box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      }

      .btn-danger {
          background: linear-gradient(135deg, #f44336, #d32f2f);
          box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
      }

      .btn-danger:hover {
          box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
      }

      .btn-group {
          display: flex;
          gap: 15px;
          justify-content: center;
          margin-top: 25px;
      }

      .alert {
          padding: 15px 20px;
          border-radius: 10px;
          margin: 20px 0;
          font-weight: bold;
          display: none;
          animation: slideIn 0.3s ease;
      }

      .alert-success {
          background: linear-gradient(135deg, #d4edda, #c3e6cb);
          color: #155724;
          border: 2px solid #28a745;
      }

      .alert-error {
          background: linear-gradient(135deg, #f8d7da, #f5c6cb);
          color: #721c24;
          border: 2px solid #dc3545;
      }

      .alert-info {
          background: linear-gradient(135deg, #d1ecf1, #bee5eb);
          color: #0c5460;
          border: 2px solid #17a2b8;
      }

      @keyframes slideIn {
          from {
              opacity: 0;
              transform: translateY(-20px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      .loading {
          display: none;
          text-align: center;
          padding: 20px;
      }

      .spinner {
          border: 4px solid #f3f3f3;
          border-top: 4px solid #4caf50;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
          margin: 0 auto 15px;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      .tabs {
          display: flex;
          background: rgba(255, 255, 255, 0.9);
          border-radius: 10px;
          margin-bottom: 20px;
          overflow: hidden;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .tab-button {
          flex: 1;
          padding: 15px 20px;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 16px;
          font-weight: bold;
          color: #666;
          transition: all 0.3s ease;
          position: relative;
      }

      .tab-button.active {
          color: #4caf50;
          background: rgba(76, 175, 80, 0.1);
      }

      .tab-button.active::after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          height: 3px;
          background: #4caf50;
      }

      .tab-content {
          display: none;
      }

      .tab-content.active {
          display: block;
          animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
      }

      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin: 20px 0;
      }

      .stat-card {
          background: linear-gradient(135deg, #4caf50, #45a049);
          color: white;
          padding: 20px;
          border-radius: 15px;
          text-align: center;
          box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
          transition: transform 0.3s ease;
      }

      .stat-card:hover {
          transform: translateY(-5px);
      }

      .stat-card h3 {
          font-size: 2em;
          margin-bottom: 5px;
      }

      .stat-card p {
          font-size: 0.9em;
          opacity: 0.9;
      }

      .search-section {
          background: rgba(255, 255, 255, 0.95);
          padding: 25px;
          border-radius: 15px;
          margin-bottom: 20px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .search-form {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
          align-items: end;
      }

      .results-table {
          width: 100%;
          border-collapse: collapse;
          background: white;
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .results-table th,
      .results-table td {
          padding: 12px;
          text-align: left;
          border-bottom: 1px solid #ddd;
      }

      .results-table th {
          background: linear-gradient(135deg, #4caf50, #45a049);
          color: white;
          font-weight: bold;
      }

      .results-table tr:hover {
          background: rgba(76, 175, 80, 0.1);
      }

      .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(5px);
      }

      .modal-content {
          background: white;
          margin: 5% auto;
          padding: 30px;
          border-radius: 15px;
          width: 80%;
          max-width: 600px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
          animation: modalSlideIn 0.3s ease;
      }

      @keyframes modalSlideIn {
          from {
              opacity: 0;
              transform: translateY(-50px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      .close {
          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
          cursor: pointer;
          transition: color 0.3s ease;
      }

      .close:hover {
          color: #000;
      }

      .file-upload {
          border: 2px dashed #4caf50;
          border-radius: 10px;
          padding: 30px;
          text-align: center;
          margin: 20px 0;
          transition: all 0.3s ease;
          cursor: pointer;
      }

      .file-upload:hover {
          background: rgba(76, 175, 80, 0.1);
          border-color: #45a049;
      }

      .file-upload.dragover {
          background: rgba(76, 175, 80, 0.2);
          border-color: #2e7d32;
      }

      @media (max-width: 768px) {
          .main-content {
              grid-template-columns: 1fr;
          }

          .form-row {
              grid-template-columns: 1fr;
          }

          .btn-group {
              flex-direction: column;
          }

          .search-form {
              grid-template-columns: 1fr;
          }

          .modal-content {
              width: 95%;
              margin: 10% auto;
          }
      }

      .progress-bar {
          width: 100%;
          height: 20px;
          background: #f0f0f0;
          border-radius: 10px;
          overflow: hidden;
          margin: 10px 0;
      }

      .progress-fill {
          height: 100%;
          background: linear-gradient(135deg, #4caf50, #45a049);
          width: 0%;
          transition: width 0.3s ease;
      }

      .receipt-preview {
          border: 2px solid #4caf50;
          border-radius: 10px;
          padding: 20px;
          margin: 20px 0;
          background: rgba(76, 175, 80, 0.05);
      }

      .receipt-preview h4 {
          color: #1a472a;
          margin-bottom: 15px;
      }

      .receipt-info {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 10px;
      }

      .receipt-info div {
          padding: 5px 0;
          border-bottom: 1px solid #eee;
      }

      .receipt-info strong {
          color: #4caf50;
      }
  </style>
</head>
<body>
  <div class="container">
      <!-- ç³»çµ±æ¨™é¡Œ -->
      <div class="header">
          <h1>å°ç£å¸•é‡‘æ£®ç—…å‹æ¬Šç›Šä¿ƒé€²æœƒ</h1>
          <p class="subtitle">Taiwan Parkinson Disease Association</p>
          <p class="subtitle">æœƒè¨ˆå‡ºç´ç®¡ç†ç³»çµ± v4.0</p>
      </div>

      <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
      <div class="tabs">
          <button class="tab-button active" onclick="showTab('transaction')">äº¤æ˜“è¨˜éŒ„</button>
          <button class="tab-button" onclick="showTab('search')">æŸ¥è©¢çµ±è¨ˆ</button>
          <button class="tab-button" onclick="showTab('import')">æ‰¹æ¬¡åŒ¯å…¥</button>
          <button class="tab-button" onclick="showTab('settings')">ç³»çµ±è¨­å®š</button>
      </div>

      <!-- äº¤æ˜“è¨˜éŒ„é ç±¤ -->
      <div id="transaction" class="tab-content active">
          <div class="main-content">
              <!-- äº¤æ˜“è¡¨å–® -->
              <div class="card">
                  <h2>ğŸ“ æ–°å¢äº¤æ˜“è¨˜éŒ„</h2>
                  <form id="transactionForm">
                      <div class="form-row">
                          <div class="form-group">
                              <label for="date">æ—¥æœŸ *</label>
                              <input type="date" id="date" name="date" required>
                          </div>
                          <div class="form-group">
                              <label for="name">å§“å *</label>
                              <input type="text" id="name" name="name" required placeholder="è«‹è¼¸å…¥å§“å">
                          </div>
                      </div>

                      <div class="form-row">
                          <div class="form-group">
                              <label for="type">äº¤æ˜“é¡å‹ *</label>
                              <select id="type" name="type" required onchange="updateFormFields()">
                                  <option value="">è«‹é¸æ“‡é¡å‹</option>
                                  <option value="æ”¶å…¥">æ”¶å…¥</option>
                                  <option value="æ”¯å‡º">æ”¯å‡º</option>
                              </select>
                          </div>
                          <div class="form-group">
                              <label for="category">é¡åˆ¥</label>
                              <select id="category" name="category">
                                  <option value="">è«‹é¸æ“‡é¡åˆ¥</option>
                              </select>
                          </div>
                      </div>

                      <div class="form-row">
                          <div class="form-group">
                              <label for="amount">é‡‘é¡ *</label>
                              <input type="number" id="amount" name="amount" required min="0" step="1" placeholder="è«‹è¼¸å…¥é‡‘é¡">
                          </div>
                          <div class="form-group">
                              <label for="account">äº¤æ˜“å¸³æˆ¶</label>
                              <select id="account" name="account">
                                  <option value="">è«‹é¸æ“‡å¸³æˆ¶</option>
                                  <option value="ç¾é‡‘">ç¾é‡‘</option>
                                  <option value="éŠ€è¡Œè½‰å¸³">éŠ€è¡Œè½‰å¸³</option>
                                  <option value="æ”¯ç¥¨">æ”¯ç¥¨</option>
                                  <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                              </select>
                          </div>
                      </div>

                      <div class="form-group">
                          <label for="description">èªªæ˜</label>
                          <textarea id="description" name="description" rows="3" placeholder="è«‹è¼¸å…¥è©³ç´°èªªæ˜"></textarea>
                      </div>

                      <!-- è¯çµ¡è³‡è¨Š -->
                      <div id="contactInfo" style="display: none;">
                          <h3 style="color: #1a472a; margin: 20px 0 15px 0;">ğŸ“ è¯çµ¡è³‡è¨Š</h3>
                          <div class="form-row">
                              <div class="form-group">
                                  <label for="identity">èº«åˆ†</label>
                                  <select id="identity" name="identity">
                                      <option value="">è«‹é¸æ“‡èº«åˆ†</option>
                                      <option value="ç—…å‹">ç—…å‹</option>
                                      <option value="å®¶å±¬">å®¶å±¬</option>
                                      <option value="å¿—å·¥">å¿—å·¥</option>
                                      <option value="æœƒå“¡">æœƒå“¡</option>
                                      <option value="ä¸€èˆ¬æ°‘çœ¾">ä¸€èˆ¬æ°‘çœ¾</option>
                                      <option value="ä¼æ¥­">ä¼æ¥­</option>
                                  </select>
                              </div>
                              <div class="form-group">
                                  <label for="phone">è¯çµ¡é›»è©±</label>
                                  <input type="tel" id="phone" name="phone" placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±">
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="email">é›»å­éƒµä»¶</label>
                              <input type="email" id="email" name="email" placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶">
                          </div>
                      </div>

                      <!-- æ”¶æ“šé¸é … -->
                      <div id="receiptOptions" style="display: none;">
                          <h3 style="color: #1a472a; margin: 20px 0 15px 0;">ğŸ§¾ æ”¶æ“šé¸é …</h3>
                          <div class="checkbox-group">
                              <div class="checkbox-item">
                                  <input type="checkbox" id="generateReceipt" name="generateReceipt">
                                  <label for="generateReceipt">é–‹ç«‹é›»å­æ”¶æ“š</label>
                              </div>
                              <div class="checkbox-item">
                                  <input type="checkbox" id="autoSendEmail" name="autoSendEmail">
                                  <label for="autoSendEmail">è‡ªå‹•å¯„é€æ”¶æ“š</label>
                              </div>
                          </div>
                      </div>

                      <!-- æ”¯å‡ºæ†‘è­‰é¸é … -->
                      <div id="voucherOptions" style="display: none;">
                          <h3 style="color: #1a472a; margin: 20px 0 15px 0;">ğŸ“‹ æ”¯å‡ºæ†‘è­‰</h3>
                          <div class="checkbox-group">
                              <div class="checkbox-item">
                                  <input type="checkbox" id="generateVoucher" name="generateVoucher">
                                  <label for="generateVoucher">é–‹ç«‹æ”¯å‡ºæ†‘è­‰</label>
                              </div>
                          </div>
                          <div class="form-row" id="voucherDetails" style="display: none; margin-top: 15px;">
                              <div class="form-group">
                                  <label for="department">éƒ¨é–€</label>
                                  <select id="department" name="department">
                                      <option value="æœƒå‹™éƒ¨">æœƒå‹™éƒ¨</option>
                                      <option value="è²¡å‹™éƒ¨">è²¡å‹™éƒ¨</option>
                                      <option value="æ´»å‹•éƒ¨">æ´»å‹•éƒ¨</option>
                                      <option value="å®£å°éƒ¨">å®£å°éƒ¨</option>
                                  </select>
                              </div>
                              <div class="form-group">
                                  <label for="priority">å„ªå…ˆç´š</label>
                                  <select id="priority" name="priority">
                                      <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
                                      <option value="ç·Šæ€¥">ç·Šæ€¥</option>
                                      <option value="ä½">ä½</option>
                                  </select>
                              </div>
                          </div>
                          <div class="form-group" id="receiptCountGroup" style="display: none;">
                              <label for="receiptCount">æ”¶æ“šå¼µæ•¸</label>
                              <input type="number" id="receiptCount" name="receiptCount" min="1" value="1">
                          </div>
                      </div>

                      <div class="btn-group">
                          <button type="submit" class="btn">ğŸ’¾ å„²å­˜è¨˜éŒ„</button>
                          <button type="button" class="btn btn-secondary" onclick="clearForm()">ğŸ”„ æ¸…é™¤è¡¨å–®</button>
                      </div>
                  </form>
              </div>

              <!-- çµ±è¨ˆè³‡è¨Š -->
              <div class="card">
                  <h2>ğŸ“Š å³æ™‚çµ±è¨ˆ</h2>
                  <div class="stats-grid" id="statsGrid">
                      <div class="stat-card">
                          <h3 id="totalTransactions">0</h3>
                          <p>ç¸½äº¤æ˜“ç­†æ•¸</p>
                      </div>
                      <div class="stat-card" style="background: linear-gradient(135deg, #2196f3, #1976d2);">
                          <h3 id="totalIncome">$0</h3>
                          <p>ç¸½æ”¶å…¥</p>
                      </div>
                      <div class="stat-card" style="background: linear-gradient(135deg, #ff9800, #f57c00);">
                          <h3 id="totalExpense">$0</h3>
                          <p>ç¸½æ”¯å‡º</p>
                      </div>
                      <div class="stat-card" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">
                          <h3 id="netIncome">$0</h3>
                          <p>æ·¨æ”¶å…¥</p>
                      </div>
                  </div>
                  
                  <div class="btn-group">
                      <button class="btn btn-secondary" onclick="refreshStats()">ğŸ”„ æ›´æ–°çµ±è¨ˆ</button>
                      <button class="btn btn-secondary" onclick="generateReport()">ğŸ“ˆ ç”Ÿæˆå ±è¡¨</button>
                  </div>
              </div>
          </div>
      </div>

      <!-- æŸ¥è©¢çµ±è¨ˆé ç±¤ -->
      <div id="search" class="tab-content">
          <div class="search-section">
              <h2>ğŸ” äº¤æ˜“æŸ¥è©¢</h2>
              <form id="searchForm" class="search-form">
                  <div class="form-group">
                      <label for="searchStartDate">é–‹å§‹æ—¥æœŸ</label>
                      <input type="date" id="searchStartDate" name="startDate">
                  </div>
                  <div class="form-group">
                      <label for="searchEndDate">çµæŸæ—¥æœŸ</label>
                      <input type="date" id="searchEndDate" name="endDate">
                  </div>
                  <div class="form-group">
                      <label for="searchName">å§“å</label>
                      <input type="text" id="searchName" name="name" placeholder="è«‹è¼¸å…¥å§“å">
                  </div>
                  <div class="form-group">
                      <label for="searchType">é¡å‹</label>
                      <select id="searchType" name="type">
                          <option value="">å…¨éƒ¨</option>
                          <option value="æ”¶å…¥">æ”¶å…¥</option>
                          <option value="æ”¯å‡º">æ”¯å‡º</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label for="searchCategory">é¡åˆ¥</label>
                      <input type="text" id="searchCategory" name="category" placeholder="è«‹è¼¸å…¥é¡åˆ¥">
                  </div>
                  <div class="form-group">
                      <button type="submit" class="btn">ğŸ” æœå°‹</button>
                  </div>
              </form>
          </div>

          <div class="card">
              <h2>ğŸ“‹ æœå°‹çµæœ</h2>
              <div id="searchResults">
                  <p style="text-align: center; color: #666; padding: 40px;">è«‹è¼¸å…¥æœå°‹æ¢ä»¶å¾Œé»æ“Šæœå°‹</p>
              </div>
          </div>
      </div>

      <!-- æ‰¹æ¬¡åŒ¯å…¥é ç±¤ -->
      <div id="import" class="tab-content">
          <div class="card">
              <h2>ğŸ“¥ æ‰¹æ¬¡åŒ¯å…¥</h2>
              <div class="file-upload" id="fileUpload" onclick="document.getElementById('csvFile').click()">
                  <p>ğŸ“ é»æ“Šé¸æ“‡CSVæª”æ¡ˆæˆ–æ‹–æ‹½æª”æ¡ˆåˆ°æ­¤è™•</p>
                  <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                      æ”¯æ´æ ¼å¼ï¼šCSVæª”æ¡ˆ<br>
                      å¿…è¦æ¬„ä½ï¼šæ—¥æœŸ, å§“å, é¡å‹, é‡‘é¡
                  </p>
                  <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleFileSelect(this)">
              </div>
              
              <div id="importProgress" style="display: none;">
                  <h3>åŒ¯å…¥é€²åº¦</h3>
                  <div class="progress-bar">
                      <div class="progress-fill" id="progressFill"></div>
                  </div>
                  <p id="progressText">æº–å‚™ä¸­...</p>
              </div>

              <div class="btn-group">
                  <button class="btn" onclick="startImport()" id="importBtn" disabled>ğŸ“¤ é–‹å§‹åŒ¯å…¥</button>
                  <button class="btn btn-secondary" onclick="downloadTemplate()">ğŸ“‹ ä¸‹è¼‰ç¯„æœ¬</button>
              </div>
          </div>

          <div class="card">
              <h2>ğŸ“ åŒ¯å…¥è¨˜éŒ„</h2>
              <div id="importLog">
                  <p style="text-align: center; color: #666; padding: 40px;">å°šç„¡åŒ¯å…¥è¨˜éŒ„</p>
              </div>
          </div>
      </div>

      <!-- ç³»çµ±è¨­å®šé ç±¤ -->
      <div id="settings" class="tab-content">
          <div class="main-content">
              <div class="card">
                  <h2>âš™ï¸ ç³»çµ±è¨­å®š</h2>
                  <div class="form-group">
                      <label>çµ„ç¹”è³‡è¨Š</label>
                      <button class="btn btn-secondary" onclick="editOrganizationInfo()">âœï¸ ç·¨è¼¯çµ„ç¹”è³‡è¨Š</button>
                  </div>
                  <div class="form-group">
                      <label>éƒµä»¶è¨­å®š</label>
                      <button class="btn btn-secondary" onclick="editEmailSettings()">ğŸ“§ è¨­å®šéƒµä»¶</button>
                  </div>
                  <div class="form-group">
                      <label>ç³»çµ±ç¶­è­·</label>
                      <div class="btn-group">
                          <button class="btn btn-secondary" onclick="createBackup()">ğŸ’¾ å»ºç«‹å‚™ä»½</button>
                          <button class="btn btn-secondary" onclick="systemHealthCheck()">ğŸ”§ ç³»çµ±æª¢æŸ¥</button>
                          <button class="btn btn-danger" onclick="resetSystem()">ğŸ”„ é‡ç½®ç³»çµ±</button>
                      </div>
                  </div>
              </div>

              <div class="card">
                  <h2>ğŸ“Š ç³»çµ±ç‹€æ…‹</h2>
                  <div id="systemStatus">
                      <div class="stats-grid">
                          <div class="stat-card">
                              <h3 id="systemUptime">è¼‰å…¥ä¸­...</h3>
                              <p>ç³»çµ±é‹è¡Œæ™‚é–“</p>
                          </div>
                          <div class="stat-card" style="background: linear-gradient(135deg, #ff9800, #f57c00);">
                              <h3 id="dataSize">è¼‰å…¥ä¸­...</h3>
                              <p>è³‡æ–™é‡</p>
                          </div>
                          <div class="stat-card" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">
                              <h3 id="lastBackup">è¼‰å…¥ä¸­...</h3>
                              <p>æœ€å¾Œå‚™ä»½</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- é€šçŸ¥å€åŸŸ -->
      <div id="alertContainer"></div>

      <!-- è¼‰å…¥å‹•ç•« -->
      <div id="loading" class="loading">
          <div class="spinner"></div>
          <p>è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</p>
      </div>

      <!-- æ¨¡æ…‹è¦–çª— -->
      <div id="modal" class="modal">
          <div class="modal-content">
              <span class="close" onclick="closeModal()">&times;</span>
              <div id="modalContent">
                  <!-- å‹•æ…‹å…§å®¹ -->
              </div>
          </div>
      </div>

      <!-- æ”¶æ“šé è¦½æ¨¡æ…‹è¦–çª— -->
      <div id="receiptModal" class="modal">
          <div class="modal-content">
              <span class="close" onclick="closeReceiptModal()">&times;</span>
              <h2>ğŸ§¾ æ”¶æ“šé è¦½</h2>
              <div id="receiptPreview" class="receipt-preview">
                  <!-- æ”¶æ“šå…§å®¹ -->
              </div>
              <div class="btn-group">
                  <button class="btn" onclick="downloadReceipt()">ğŸ“¥ ä¸‹è¼‰æ”¶æ“š</button>
                  <button class="btn btn-secondary" onclick="sendReceiptEmail()">ğŸ“§ å¯„é€éƒµä»¶</button>
                  <button class="btn btn-secondary" onclick="printReceipt()">ğŸ–¨ï¸ åˆ—å°æ”¶æ“š</button>
              </div>
          </div>
      </div>
  </div>

  <script>
      // å…¨åŸŸè®Šæ•¸
      let currentReceiptData = null;
      let csvData = null;
      let systemStartTime = new Date();

      // Google Apps Script ç¶²å€ (è«‹æ›¿æ›ç‚ºå¯¦éš›çš„éƒ¨ç½²ç¶²å€)
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby2xtVyVzS8T0DJq0njO1Nm9ORAWwnD6CcchijHTMD997uuFFnSUu9Hq28CMna4ENdh/exec';

      // åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
          initializeForm();
          loadStatistics();
          setupEventListeners();
          updateSystemStatus();
      });

      // è¨­å®šäº‹ä»¶ç›£è½å™¨
      function setupEventListeners() {
          // è¡¨å–®æäº¤
          document.getElementById('transactionForm').addEventListener('submit', handleFormSubmit);
          document.getElementById('searchForm').addEventListener('submit', handleSearch);

          // æª”æ¡ˆæ‹–æ‹½
          const fileUpload = document.getElementById('fileUpload');
          fileUpload.addEventListener('dragover', handleDragOver);
          fileUpload.addEventListener('drop', handleDrop);
          fileUpload.addEventListener('dragleave', handleDragLeave);

          // æ”¯å‡ºæ†‘è­‰é¸é …
          document.getElementById('generateVoucher').addEventListener('change', function() {
              const voucherDetails = document.getElementById('voucherDetails');
              const receiptCountGroup = document.getElementById('receiptCountGroup');
              if (this.checked) {
                  voucherDetails.style.display = 'block';
                  receiptCountGroup.style.display = 'block';
              } else {
                  voucherDetails.style.display = 'none';
                  receiptCountGroup.style.display = 'none';
              }
          });

          // è‡ªå‹•å¯„é€éƒµä»¶é¸é …
          document.getElementById('autoSendEmail').addEventListener('change', function() {
              if (this.checked && !document.getElementById('email').value) {
                  showAlert('è«‹å…ˆå¡«å¯«é›»å­éƒµä»¶åœ°å€', 'error');
                  this.checked = false;
              }
          });

          // è¨­å®šä»Šå¤©æ—¥æœŸç‚ºé è¨­å€¼
          document.getElementById('date').value = new Date().toISOString().split('T')[0];
      }

      // åˆå§‹åŒ–è¡¨å–®
      function initializeForm() {
          updateFormFields();
      }

      // æ›´æ–°è¡¨å–®æ¬„ä½
      function updateFormFields() {
          const type = document.getElementById('type').value;
          const categorySelect = document.getElementById('category');
          const contactInfo = document.getElementById('contactInfo');
          const receiptOptions = document.getElementById('receiptOptions');
          const voucherOptions = document.getElementById('voucherOptions');

          // æ¸…ç©ºé¡åˆ¥é¸é …
          categorySelect.innerHTML = '<option value="">è«‹é¸æ“‡é¡åˆ¥</option>';

          if (type === 'æ”¶å…¥') {
              // æ”¶å…¥é¡åˆ¥
              const incomeCategories = [
                  'ä¸€èˆ¬ææ¬¾', 'å®šæœŸææ¬¾', 'æŒ‡å®šææ¬¾', 'æ´»å‹•æ”¶å…¥', 
                  'æœƒè²»æ”¶å…¥', 'æ”¿åºœè£œåŠ©', 'ä¼æ¥­è´ŠåŠ©', 'ç¾©è³£æ”¶å…¥',
                  'åˆ©æ¯æ”¶å…¥', 'å…¶ä»–æ”¶å…¥'
              ];
              incomeCategories.forEach(category => {
                  const option = document.createElement('option');
                  option.value = category;
                  option.textContent = category;
                  categorySelect.appendChild(option);
              });

              contactInfo.style.display = 'block';
              receiptOptions.style.display = 'block';
              voucherOptions.style.display = 'none';

          } else if (type === 'æ”¯å‡º') {
              // æ”¯å‡ºé¡åˆ¥
              const expenseCategories = [
                  'è¾¦å…¬è²»ç”¨', 'æ´»å‹•è²»ç”¨', 'äº¤é€šè²»ç”¨', 'é¤é£²è²»ç”¨',
                  'å®£å‚³è²»ç”¨', 'è¨­å‚™æ¡è³¼', 'å ´åœ°ç§Ÿé‡‘', 'äººäº‹è²»ç”¨',
                  'æ°´é›»è²»ç”¨', 'é€šè¨Šè²»ç”¨', 'å…¶ä»–æ”¯å‡º'
              ];
              expenseCategories.forEach(category => {
                  const option = document.createElement('option');
                  option.value = category;
                  option.textContent = category;
                  categorySelect.appendChild(option);
              });

              contactInfo.style.display = 'block';
              receiptOptions.style.display = 'none';
              voucherOptions.style.display = 'block';

          } else {
              contactInfo.style.display = 'none';
              receiptOptions.style.display = 'none';
              voucherOptions.style.display = 'none';
          }
      }

      // è™•ç†è¡¨å–®æäº¤
      async function handleFormSubmit(e) {
          e.preventDefault();
          
          if (!validateForm()) {
              return;
          }

          showLoading(true);

          try {
              const formData = new FormData(e.target);
              const data = Object.fromEntries(formData.entries());
              
              // è™•ç†è¤‡é¸æ¡†
              data.generateReceipt = document.getElementById('generateReceipt').checked ? 'true' : 'false';
              data.autoSendEmail = document.getElementById('autoSendEmail').checked ? 'true' : 'false';
              data.generateVoucher = document.getElementById('generateVoucher').checked ? 'true' : 'false';

              const response = await fetch(SCRIPT_URL, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/x-www-form-urlencoded',
                  },
                  body: new URLSearchParams(data)
              });

              const result = await response.json();

              if (result.success) {
                  showAlert('äº¤æ˜“è¨˜éŒ„å·²æˆåŠŸå„²å­˜ï¼', 'success');
                  
                  // å¦‚æœæœ‰ç”Ÿæˆæ”¶æ“šï¼Œé¡¯ç¤ºé è¦½
                  if (result.receiptNumber) {
                      currentReceiptData = result;
                      showReceiptPreview(result);
                  }

                  // æ¸…é™¤è¡¨å–®ä¸¦é‡æ–°è¼‰å…¥çµ±è¨ˆ
                  clearForm();
                  loadStatistics();
              } else {
                  showAlert('å„²å­˜å¤±æ•—ï¼š' + result.error, 'error');
              }

          } catch (error) {
              console.error('æäº¤éŒ¯èª¤:', error);
              showAlert('ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              showLoading(false);
          }
      }

      // è¡¨å–®é©—è­‰
      function validateForm() {
          const requiredFields = ['date', 'name', 'type', 'amount'];
          
          for (const field of requiredFields) {
              const element = document.getElementById(field);
              if (!element.value.trim()) {
                  showAlert(`è«‹å¡«å¯« ${element.previousElementSibling.textContent}`, 'error');
                  element.focus();
                  return false;
              }
          }

          // é©—è­‰é‡‘é¡
          const amount = parseFloat(document.getElementById('amount').value);
          if (amount <= 0) {
              showAlert('é‡‘é¡å¿…é ˆå¤§æ–¼0', 'error');
              document.getElementById('amount').focus();
              return false;
          }

          // é©—è­‰é›»å­éƒµä»¶æ ¼å¼
          const email = document.getElementById('email').value;
          if (email && !isValidEmail(email)) {
              showAlert('é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º', 'error');
              document.getElementById('email').focus();
              return false;
          }

          // å¦‚æœè¦è‡ªå‹•å¯„é€éƒµä»¶ï¼Œå¿…é ˆæœ‰é›»å­éƒµä»¶
          if (document.getElementById('autoSendEmail').checked && !email) {
              showAlert('è‡ªå‹•å¯„é€éƒµä»¶éœ€è¦å¡«å¯«é›»å­éƒµä»¶åœ°å€', 'error');
              document.getElementById('email').focus();
              return false;
          }

          return true;
      }

      // é©—è­‰é›»å­éƒµä»¶æ ¼å¼
      function isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
      }

      // æ¸…é™¤è¡¨å–®
      function clearForm() {
          document.getElementById('transactionForm').reset();
          document.getElementById('date').value = new Date().toISOString().split('T')[0];
          updateFormFields();
      }

      // è¼‰å…¥çµ±è¨ˆè³‡æ–™
      async function loadStatistics() {
          try {
              const response = await fetch(`${SCRIPT_URL}?action=getStatistics`);
              const result = await response.json();

              if (result.success) {
                  updateStatisticsDisplay(result.statistics);
              }
          } catch (error) {
              console.error('è¼‰å…¥çµ±è¨ˆå¤±æ•—:', error);
          }
      }

      // æ›´æ–°çµ±è¨ˆé¡¯ç¤º
      function updateStatisticsDisplay(stats) {
          document.getElementById('totalTransactions').textContent = stats.totalTransactions || 0;
          document.getElementById('totalIncome').textContent = '$' + (stats.totalIncome || 0).toLocaleString();
          document.getElementById('totalExpense').textContent = '$' + (stats.totalExpense || 0).toLocaleString();
          document.getElementById('netIncome').textContent = '$' + (stats.netIncome || 0).toLocaleString();
      }

      // é‡æ–°æ•´ç†çµ±è¨ˆ
      function refreshStats() {
          loadStatistics();
          showAlert('çµ±è¨ˆè³‡æ–™å·²æ›´æ–°', 'success');
      }

      // ç”Ÿæˆå ±è¡¨
      async function generateReport() {
          showLoading(true);
          
          try {
              const currentDate = new Date();
              const year = currentDate.getFullYear();
              const month = currentDate.getMonth() + 1;

              const response = await fetch(`${SCRIPT_URL}?action=generateReport&year=${year}&month=${month}`);
              const result = await response.json();

              if (result.success) {
                  showReportModal(result.report);
              } else {
                  showAlert('ç”Ÿæˆå ±è¡¨å¤±æ•—ï¼š' + result.error, 'error');
              }
          } catch (error) {
              console.error('ç”Ÿæˆå ±è¡¨éŒ¯èª¤:', error);
              showAlert('ç”Ÿæˆå ±è¡¨å¤±æ•—', 'error');
          } finally {
              showLoading(false);
          }
      }

      // é¡¯ç¤ºå ±è¡¨æ¨¡æ…‹è¦–çª—
      function showReportModal(report) {
          const modalContent = document.getElementById('modalContent');
          modalContent.innerHTML = `
              <h2>ğŸ“Š ${report.period} æœˆå ±è¡¨</h2>
              <div class="stats-grid">
                  <div class="stat-card">
                      <h3>$${report.summary.totalIncome.toLocaleString()}</h3>
                      <p>ç¸½æ”¶å…¥</p>
                  </div>
                  <div class="stat-card" style="background: linear-gradient(135deg, #ff9800, #f57c00);">
                      <h3>$${report.summary.totalExpense.toLocaleString()}</h3>
                      <p>ç¸½æ”¯å‡º</p>
                  </div>
                  <div class="stat-card" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">
                      <h3>$${report.summary.netIncome.toLocaleString()}</h3>
                      <p>æ·¨æ”¶å…¥</p>
                  </div>
                  <div class="stat-card" style="background: linear-gradient(135deg, #2196f3, #1976d2);">
                      <h3>${report.summary.transactionCount}</h3>
                      <p>äº¤æ˜“ç­†æ•¸</p>
                  </div>
              </div>
              <div style="margin-top: 20px;">
                  <h3>é¡åˆ¥çµ±è¨ˆ</h3>
                  <div id="categoryStats"></div>
              </div>
              <div class="btn-group">
                  <button class="btn" onclick="exportReport()">ğŸ“¥ åŒ¯å‡ºå ±è¡¨</button>
                  <button class="btn btn-secondary" onclick="closeModal()">é—œé–‰</button>
              </div>
          `;

          // é¡¯ç¤ºé¡åˆ¥çµ±è¨ˆ
          const categoryStatsDiv = document.getElementById('categoryStats');
          let categoryHtml = '<table class="results-table"><tr><th>é¡åˆ¥</th><th>æ”¶å…¥</th><th>æ”¯å‡º</th><th>ç­†æ•¸</th></tr>';
          
          for (const [category, stats] of Object.entries(report.categoryStats)) {
              categoryHtml += `
                  <tr>
                      <td>${category}</td>
                      <td>$${stats.income.toLocaleString()}</td>
                      <td>$${stats.expense.toLocaleString()}</td>
                      <td>${stats.count}</td>
                  </tr>
              `;
          }
          categoryHtml += '</table>';
          categoryStatsDiv.innerHTML = categoryHtml;

          document.getElementById('modal').style.display = 'block';
      }

      // è™•ç†æœå°‹
      async function handleSearch(e) {
          e.preventDefault();
          showLoading(true);

          try {
              const formData = new FormData(e.target);
              const searchParams = Object.fromEntries(formData.entries());

              const queryString = new URLSearchParams({
                  action: 'searchTransactions',
                  ...searchParams
              }).toString();

              const response = await fetch(`${SCRIPT_URL}?${queryString}`);
              const result = await response.json();

              if (result.success) {
                  displaySearchResults(result.results);
              } else {
                  showAlert('æœå°‹å¤±æ•—ï¼š' + result.error, 'error');
              }
          } catch (error) {
              console.error('æœå°‹éŒ¯èª¤:', error);
              showAlert('æœå°‹å¤±æ•—', 'error');
          } finally {
              showLoading(false);
          }
      }

      // é¡¯ç¤ºæœå°‹çµæœ
      function displaySearchResults(results) {
          const resultsDiv = document.getElementById('searchResults');
          
          if (results.length === 0) {
              resultsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è¨˜éŒ„</p>';
              return;
          }

          let html = `
              <p style="margin-bottom: 15px; color: #4caf50; font-weight: bold;">
                  æ‰¾åˆ° ${results.length} ç­†è¨˜éŒ„
              </p>
              <table class="results-table">
                  <tr>
                      <th>æ—¥æœŸ</th>
                      <th>å§“å</th>
                      <th>é¡å‹</th>
                      <th>é¡åˆ¥</th>
                      <th>é‡‘é¡</th>
                      <th>èªªæ˜</th>
                      <th>æ“ä½œ</th>
                  </tr>
          `;

          results.forEach(record => {
              const amount = parseFloat(record['é‡‘é¡'] || 0);
              const amountClass = record['é¡å‹'] === 'æ”¶å…¥' ? 'color: #4caf50' : 'color: #f44336';
              
              html += `
                  <tr>
                      <td>${record['æ—¥æœŸ']}</td>
                      <td>${record['å§“å']}</td>
                      <td>${record['é¡å‹']}</td>
                      <td>${record['é¡åˆ¥'] || '-'}</td>
                      <td style="${amountClass}">$${amount.toLocaleString()}</td>
                      <td>${record['èªªæ˜'] || '-'}</td>
                      <td>
                          ${record['æ”¶æ“šç·¨è™Ÿ'] ? `<button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="viewReceipt('${record['æ”¶æ“šç·¨è™Ÿ']}')">æŸ¥çœ‹æ”¶æ“š</button>` : '-'}
                      </td>
                  </tr>
              `;
          });

          html += '</table>';
          resultsDiv.innerHTML = html;
      }

      // æª”æ¡ˆè™•ç†
      function handleFileSelect(input) {
          const file = input.files[0];
          if (file && file.type === 'text/csv') {
              const reader = new FileReader();
              reader.onload = function(e) {
                  csvData = e.target.result;
                  document.getElementById('importBtn').disabled = false;
                  showAlert('CSVæª”æ¡ˆå·²è¼‰å…¥ï¼Œå¯ä»¥é–‹å§‹åŒ¯å…¥', 'success');
              };
              reader.readAsText(file);
          } else {
              showAlert('è«‹é¸æ“‡CSVæª”æ¡ˆ', 'error');
          }
      }

      // æ‹–æ‹½è™•ç†
      function handleDragOver(e) {
          e.preventDefault();
          e.currentTarget.classList.add('dragover');
      }

      function handleDragLeave(e) {
          e.currentTarget.classList.remove('dragover');
      }

      function handleDrop(e) {
          e.preventDefault();
          e.currentTarget.classList.remove('dragover');
          
          const files = e.dataTransfer.files;
          if (files.length > 0) {
              const file = files[0];
              if (file.type === 'text/csv') {
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      csvData = e.target.result;
                      document.getElementById('importBtn').disabled = false;
                      showAlert('CSVæª”æ¡ˆå·²è¼‰å…¥ï¼Œå¯ä»¥é–‹å§‹åŒ¯å…¥', 'success');
                  };
                  reader.readAsText(file);
              } else {
                  showAlert('è«‹æ‹–æ‹½CSVæª”æ¡ˆ', 'error');
              }
          }
      }

      // é–‹å§‹åŒ¯å…¥
      async function startImport() {
          if (!csvData) {
              showAlert('è«‹å…ˆé¸æ“‡CSVæª”æ¡ˆ', 'error');
              return;
          }

          showLoading(true);
          document.getElementById('importProgress').style.display = 'block';

          try {
              const response = await fetch(SCRIPT_URL, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/x-www-form-urlencoded',
                  },
                  body: new URLSearchParams({
                      action: 'batchImport',
                      csvData: csvData
                  })
              });

              const result = await response.json();

              if (result.success) {
                  showAlert(result.message, 'success');
                  updateImportLog(result.results);
                  loadStatistics(); // é‡æ–°è¼‰å…¥çµ±è¨ˆ
              } else {
                  showAlert('åŒ¯å…¥å¤±æ•—ï¼š' + result.error, 'error');
              }

          } catch (error) {
              console.error('åŒ¯å…¥éŒ¯èª¤:', error);
              showAlert('åŒ¯å…¥å¤±æ•—', 'error');
          } finally {
              showLoading(false);
              document.getElementById('importProgress').style.display = 'none';
              csvData = null;
              document.getElementById('importBtn').disabled = true;
              document.getElementById('csvFile').value = '';
          }
      }

      // æ›´æ–°åŒ¯å…¥è¨˜éŒ„
      function updateImportLog(results) {
          const logDiv = document.getElementById('importLog');
          const timestamp = new Date().toLocaleString('zh-TW');
          
          const logHtml = `
              <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                  <h4>åŒ¯å…¥æ™‚é–“ï¼š${timestamp}</h4>
                  <p>ç¸½ç­†æ•¸ï¼š${results.total}</p>
                  <p style="color: #4caf50;">æˆåŠŸï¼š${results.success} ç­†</p>
                  <p style="color: #f44336;">å¤±æ•—ï¼š${results.failed} ç­†</p>
                  <p>æ”¶æ“šï¼š${results.receipts} å¼µ</p>
                  <p>æ†‘è­‰ï¼š${results.vouchers} å¼µ</p>
                  ${results.errors.length > 0 ? `<p style="color: #f44336;">éŒ¯èª¤ï¼š${results.errors.join(', ')}</p>` : ''}
              </div>
          `;
          
          if (logDiv.innerHTML.includes('å°šç„¡åŒ¯å…¥è¨˜éŒ„')) {
              logDiv.innerHTML = logHtml;
          } else {
              logDiv.innerHTML = logHtml + logDiv.innerHTML;
          }
      }

      // ä¸‹è¼‰ç¯„æœ¬
      function downloadTemplate() {
          const csvContent = 'æ—¥æœŸ,å§“å,é¡å‹,é¡åˆ¥,é‡‘é¡,èªªæ˜,äº¤æ˜“å¸³æˆ¶,èº«åˆ†,é›»è©±,é›»å­éƒµä»¶,é–‹ç«‹æ”¶æ“š,è‡ªå‹•å¯„é€\n2024-01-01,å¼µä¸‰,æ”¶å…¥,ä¸€èˆ¬ææ¬¾,1000,æ¸¬è©¦è³‡æ–™,ç¾é‡‘,æœƒå“¡,0912345678,test@example.com,æ˜¯,å¦';
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'æ‰¹æ¬¡åŒ¯å…¥ç¯„æœ¬.csv';
          link.click();
      }

      // é ç±¤åˆ‡æ›
      function showTab(tabName) {
          // éš±è—æ‰€æœ‰é ç±¤å…§å®¹
          document.querySelectorAll('.tab-content').forEach(tab => {
              tab.classList.remove('active');
          });

          // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„activeé¡åˆ¥
          document.querySelectorAll('.tab-button').forEach(btn => {
              btn.classList.remove('active');
          });

          // é¡¯ç¤ºé¸ä¸­çš„é ç±¤
          document.getElementById(tabName).classList.add('active');
          event.target.classList.add('active');
      }

      // æ”¶æ“šç›¸é—œåŠŸèƒ½
      function showReceiptPreview(receiptData) {
          const previewDiv = document.getElementById('receiptPreview');
          previewDiv.innerHTML = `
              <h4>æ”¶æ“šè³‡è¨Š</h4>
              <div class="receipt-info">
                  <div><strong>æ”¶æ“šç·¨è™Ÿï¼š</strong>${receiptData.receiptNumber}</div>
                  <div><strong>æ—¥æœŸï¼š</strong>${receiptData.date}</div>
                  <div><strong>ä»˜æ¬¾äººï¼š</strong>${receiptData.payer}</div>
                  <div><strong>é¡åˆ¥ï¼š</strong>${receiptData.category}</div>
                  <div><strong>é‡‘é¡ï¼š</strong>$${receiptData.amount.toLocaleString()}</div>
                  <div><strong>èªªæ˜ï¼š</strong>${receiptData.description || '-'}</div>
              </div>
          `;
          document.getElementById('receiptModal').style.display = 'block';
      }

      function closeReceiptModal() {
          document.getElementById('receiptModal').style.display = 'none';
      }

      function downloadReceipt() {
          if (currentReceiptData && currentReceiptData.downloadUrl) {
              window.open(currentReceiptData.downloadUrl, '_blank');
          }
      }

      function sendReceiptEmail() {
          const email = prompt('è«‹è¼¸å…¥æ”¶ä»¶äººé›»å­éƒµä»¶åœ°å€ï¼š');
          if (email && isValidEmail(email)) {
              // å¯¦ä½œå¯„é€éƒµä»¶åŠŸèƒ½
              showAlert('æ”¶æ“šå·²å¯„é€è‡³ ' + email, 'success');
          } else if (email) {
              showAlert('é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º', 'error');
          }
      }

      function printReceipt() {
          if (currentReceiptData && currentReceiptData.viewUrl) {
              const printWindow = window.open(currentReceiptData.viewUrl, '_blank');
              printWindow.onload = function() {
                  printWindow.print();
              };
          }
      }

      // æŸ¥çœ‹æ”¶æ“š
      async function viewReceipt(receiptNumber) {
          try {
              const response = await fetch(`${SCRIPT_URL}?action=getReceipt&receiptNumber=${receiptNumber}`);
              const result = await response.json();

              if (result.success) {
                  currentReceiptData = result.data;
                  showReceiptPreview(result.data);
              } else {
                  showAlert('ç„¡æ³•è¼‰å…¥æ”¶æ“šï¼š' + result.error, 'error');
              }
          } catch (error) {
              console.error('è¼‰å…¥æ”¶æ“šéŒ¯èª¤:', error);
              showAlert('è¼‰å…¥æ”¶æ“šå¤±æ•—', 'error');
          }
      }

      // ç³»çµ±è¨­å®šåŠŸèƒ½
      function editOrganizationInfo() {
          showAlert('çµ„ç¹”è³‡è¨Šç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
      }

      function editEmailSettings() {
          showAlert('éƒµä»¶è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­', 'info');
      }

      async function createBackup() {
          showLoading(true);
          try {
              const response = await fetch(`${SCRIPT_URL}?action=createBackup`);
              const result = await response.json();

              if (result.success) {
                  showAlert('ç³»çµ±å‚™ä»½å·²å»ºç«‹ï¼š' + result.backupName, 'success');
              } else {
                  showAlert('å»ºç«‹å‚™ä»½å¤±æ•—ï¼š' + result.error, 'error');
              }
          } catch (error) {
              console.error('å»ºç«‹å‚™ä»½éŒ¯èª¤:', error);
              showAlert('å»ºç«‹å‚™ä»½å¤±æ•—', 'error');
          } finally {
              showLoading(false);
          }
      }

      async function systemHealthCheck() {
          showLoading(true);
          try {
              const response = await fetch(`${SCRIPT_URL}?action=healthCheck`);
              const result = await response.json();

              if (result.success) {
                  showHealthCheckResults(result.results);
              } else {
                  showAlert('ç³»çµ±æª¢æŸ¥å¤±æ•—ï¼š' + result.error, 'error');
              }
          } catch (error) {
              console.error('ç³»çµ±æª¢æŸ¥éŒ¯èª¤:', error);
              showAlert('ç³»çµ±æª¢æŸ¥å¤±æ•—', 'error');
          } finally {
              showLoading(false);
          }
      }

      function showHealthCheckResults(results) {
          const modalContent = document.getElementById('modalContent');
          let html = '<h2>ğŸ”§ ç³»çµ±å¥åº·æª¢æŸ¥å ±å‘Š</h2>';
          html += `<p><strong>æª¢æŸ¥æ™‚é–“ï¼š</strong>${new Date(results.timestamp).toLocaleString('zh-TW')}</p>`;
          html += '<table class="results-table"><tr><th>é¡å‹</th><th>é …ç›®</th><th>ç‹€æ…‹</th><th>è©³ç´°è³‡è¨Š</th></tr>';

          results.checks.forEach(check => {
              const statusColor = check.status === 'æ­£å¸¸' ? '#4caf50' : '#f44336';
              html += `
                  <tr>
                      <td>${check.type}</td>
                      <td>${check.name}</td>
                      <td style="color: ${statusColor}; font-weight: bold;">${check.status}</td>
                      <td>${check.details}</td>
                  </tr>
              `;
          });

          html += '</table>';
          html += '<div class="btn-group"><button class="btn btn-secondary" onclick="closeModal()">é—œé–‰</button></div>';
          
          modalContent.innerHTML = html;
          document.getElementById('modal').style.display = 'block';
      }

      function resetSystem() {
          if (confirm('âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°‡é‡ç½®æ‰€æœ‰ç³»çµ±è¨­å®šï¼Œä½†ä¸æœƒåˆªé™¤äº¤æ˜“è³‡æ–™ã€‚ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
              showAlert('ç³»çµ±é‡ç½®åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
          }
      }

      // æ›´æ–°ç³»çµ±ç‹€æ…‹
      function updateSystemStatus() {
          const now = new Date();
          const uptime = Math.floor((now - systemStartTime) / 1000 / 60); // åˆ†é˜
          
          document.getElementById('systemUptime').textContent = uptime + ' åˆ†é˜';
          document.getElementById('dataSize').textContent = 'è¼‰å…¥ä¸­...';
          document.getElementById('lastBackup').textContent = 'æœªçŸ¥';

          // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡
          setTimeout(updateSystemStatus, 60000);
      }

      // åŒ¯å‡ºå ±è¡¨
      async function exportReport() {
          try {
              const response = await fetch(`${SCRIPT_URL}?action=exportCSV&sheetName=æœƒè¨ˆè¨˜éŒ„`);
              const result = await response.json();

              if (result.success) {
                  const link = document.createElement('a');
                  link.href = result.downloadUrl;
                  link.download = result.fileName;
                  link.click();
                  showAlert('å ±è¡¨åŒ¯å‡ºæˆåŠŸ', 'success');
              } else {
                  showAlert('åŒ¯å‡ºå¤±æ•—ï¼š' + result.error, 'error');
              }
          } catch (error) {
              console.error('åŒ¯å‡ºéŒ¯èª¤:', error);
              showAlert('åŒ¯å‡ºå¤±æ•—', 'error');
          }
      }

      // å·¥å…·å‡½æ•¸
      function showAlert(message, type = 'info') {
          const alertContainer = document.getElementById('alertContainer');
          const alertDiv = document.createElement('div');
          alertDiv.className = `alert alert-${type}`;
          alertDiv.textContent = message;
          alertDiv.style.display = 'block';

          alertContainer.appendChild(alertDiv);

          // 3ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
          setTimeout(() => {
              alertDiv.style.opacity = '0';
              setTimeout(() => {
                  if (alertContainer.contains(alertDiv)) {
                      alertContainer.removeChild(alertDiv);
                  }
              }, 300);
          }, 3000);
      }

      function showLoading(show) {
          document.getElementById('loading').style.display = show ? 'block' : 'none';
      }

      function closeModal() {
          document.getElementById('modal').style.display = 'none';
      }

      // éµç›¤å¿«æ·éµ
      document.addEventListener('keydown', function(e) {
          // Ctrl + S å„²å­˜è¡¨å–®
          if (e.ctrlKey && e.key === 's') {
              e.preventDefault();
              const activeTab = document.querySelector('.tab-content.active');
              if (activeTab && activeTab.id === 'transaction') {
                  document.getElementById('transactionForm').dispatchEvent(new Event('submit'));
              }
          }

          // Ctrl + R é‡æ–°æ•´ç†çµ±è¨ˆ
          if (e.ctrlKey && e.key === 'r') {
              e.preventDefault();
              refreshStats();
          }

          // ESC é—œé–‰æ¨¡æ…‹è¦–çª—
          if (e.key === 'Escape') {
              closeModal();
              closeReceiptModal();
          }
      });

      // è‡ªå‹•å„²å­˜åŠŸèƒ½ï¼ˆè‰ç¨¿ï¼‰
      function autoSave() {
          const formData = new FormData(document.getElementById('transactionForm'));
          const data = Object.fromEntries(formData.entries());
          
          // åªæœ‰åœ¨æœ‰é‡è¦è³‡æ–™æ™‚æ‰å„²å­˜
          if (data.name || data.amount) {
              localStorage.setItem('transactionDraft', JSON.stringify(data));
          }
      }

      // è¼‰å…¥è‰ç¨¿
      function loadDraft() {
          const draft = localStorage.getItem('transactionDraft');
          if (draft) {
              const data = JSON.parse(draft);
              Object.keys(data).forEach(key => {
                  const element = document.getElementById(key);
                  if (element) {
                      element.value = data[key];
                  }
              });
              showAlert('å·²è¼‰å…¥ä¸Šæ¬¡æœªå®Œæˆçš„è¡¨å–®', 'info');
          }
      }

      // æ¸…é™¤è‰ç¨¿
      function clearDraft() {
          localStorage.removeItem('transactionDraft');
      }

      // è¡¨å–®è®Šæ›´æ™‚è‡ªå‹•å„²å­˜è‰ç¨¿
      document.addEventListener('input', function(e) {
          if (e.target.form && e.target.form.id === 'transactionForm') {
              setTimeout(autoSave, 1000); // å»¶é²1ç§’å„²å­˜
          }
      });

      // é é¢è¼‰å…¥æ™‚å˜—è©¦è¼‰å…¥è‰ç¨¿
      window.addEventListener('load', function() {
          setTimeout(loadDraft, 500);
      });

      // è¡¨å–®æˆåŠŸæäº¤å¾Œæ¸…é™¤è‰ç¨¿
      function clearFormAndDraft() {
          clearForm();
          clearDraft();
      }

      // æ•¸å­—æ ¼å¼åŒ–
      function formatCurrency(amount) {
          return new Intl.NumberFormat('zh-TW', {
              style: 'currency',
              currency: 'TWD',
              minimumFractionDigits: 0
          }).format(amount);
      }

      // æ—¥æœŸæ ¼å¼åŒ–
      function formatDate(dateString) {
          const date = new Date(dateString);
          return date.toLocaleDateString('zh-TW', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
          });
      }

      // éŸ¿æ‡‰å¼è¨­è¨ˆè¼”åŠ©å‡½æ•¸
      function checkMobile() {
          return window.innerWidth <= 768;
      }

      // èª¿æ•´ç§»å‹•è£ç½®é¡¯ç¤º
      function adjustForMobile() {
          if (checkMobile()) {
              // ç§»å‹•è£ç½®ç‰¹æ®Šè™•ç†
              document.querySelectorAll('.form-row').forEach(row => {
                  row.style.gridTemplateColumns = '1fr';
              });
          }
      }

      // è¦–çª—å¤§å°è®Šæ›´æ™‚èª¿æ•´
      window.addEventListener('resize', adjustForMobile);

      // é›¢ç·šæª¢æ¸¬
      window.addEventListener('online', function() {
          showAlert('ç¶²è·¯é€£ç·šå·²æ¢å¾©', 'success');
      });

      window.addEventListener('offline', function() {
          showAlert('ç¶²è·¯é€£ç·šä¸­æ–·ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹', 'error');
      });

      // é é¢å¯è¦‹æ€§è®Šæ›´è™•ç†
      document.addEventListener('visibilitychange', function() {
          if (!document.hidden) {
              // é é¢é‡æ–°å¯è¦‹æ™‚é‡æ–°è¼‰å…¥çµ±è¨ˆ
              loadStatistics();
          }
      });

      // æœå‹™å·¥ä½œè€…è¨»å†Šï¼ˆç”¨æ–¼é›¢ç·šæ”¯æ´ï¼‰
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', function() {
              navigator.serviceWorker.register('/sw.js').then(function(registration) {
                  console.log('ServiceWorker è¨»å†ŠæˆåŠŸ:', registration.scope);
              }, function(err) {
                  console.log('ServiceWorker è¨»å†Šå¤±æ•—:', err);
              });
          });
      }

      // æ•ˆèƒ½ç›£æ§
      function logPerformance(action, startTime) {
          const endTime = performance.now();
          const duration = endTime - startTime;
          console.log(`${action} åŸ·è¡Œæ™‚é–“: ${duration.toFixed(2)}ms`);
          
          // å¦‚æœåŸ·è¡Œæ™‚é–“éé•·ï¼Œé¡¯ç¤ºè­¦å‘Š
          if (duration > 3000) {
              showAlert('ç³»çµ±å›æ‡‰è¼ƒæ…¢ï¼Œè«‹ç¨å€™', 'info');
          }
      }

      // éŒ¯èª¤è™•ç†
      window.addEventListener('error', function(e) {
          console.error('JavaScript éŒ¯èª¤:', e.error);
          showAlert('ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
      });

      // æœªè™•ç†çš„ Promise æ‹’çµ•
      window.addEventListener('unhandledrejection', function(e) {
          console.error('æœªè™•ç†çš„ Promise éŒ¯èª¤:', e.reason);
          showAlert('ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          e.preventDefault();
      });

      // è³‡æ–™é©—è­‰è¼”åŠ©å‡½æ•¸
      function validateTaiwanPhone(phone) {
          const phoneRegex = /^(\+886|886|0)?[2-9]\d{8}$/;
          return phoneRegex.test(phone.replace(/[-\s]/g, ''));
      }

      function validateTaiwanID(id) {
          // å°ç£èº«åˆ†è­‰å­—è™Ÿé©—è­‰
          const idRegex = /^[A-Z][12]\d{8}$/;
          if (!idRegex.test(id)) return false;
          
          // é€²ä¸€æ­¥é©—è­‰æª¢æŸ¥ç¢¼
          const letters = 'ABCDEFGHJKLMNPQRSTUVXYWZIO';
          const letterValue = letters.indexOf(id[0]) + 10;
          const checkSum = Math.floor(letterValue / 10) + 
                         (letterValue % 10) * 9 + 
                         parseInt(id[1]) * 8 + 
                         parseInt(id[2]) * 7 + 
                         parseInt(id[3]) * 6 + 
                         parseInt(id[4]) * 5 + 
                         parseInt(id[5]) * 4 + 
                         parseInt(id[6]) * 3 + 
                         parseInt(id[7]) * 2 + 
                         parseInt(id[8]) * 1 + 
                         parseInt(id[9]);
          
          return checkSum % 10 === 0;
      }

      // è³‡æ–™åŒ¯å‡ºåŠŸèƒ½å¢å¼·
      function exportToExcel() {
          showAlert('Excel åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­', 'info');
      }

      function exportToPDF() {
          showAlert('PDF åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­', 'info');
      }

      // åˆ—å°åŠŸèƒ½
      function printPage() {
          window.print();
      }

      // å…¨è¢å¹•åŠŸèƒ½
      function toggleFullscreen() {
          if (!document.fullscreenElement) {
              document.documentElement.requestFullscreen();
          } else {
              document.exitFullscreen();
          }
      }

      // ä¸»é¡Œåˆ‡æ›ï¼ˆæ·±è‰²æ¨¡å¼ï¼‰
      function toggleDarkMode() {
          document.body.classList.toggle('dark-mode');
          const isDark = document.body.classList.contains('dark-mode');
          localStorage.setItem('darkMode', isDark);
      }

      // è¼‰å…¥ä¸»é¡Œè¨­å®š
      function loadTheme() {
          const isDark = localStorage.getItem('darkMode') === 'true';
          if (isDark) {
              document.body.classList.add('dark-mode');
          }
      }

      // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
      document.addEventListener('DOMContentLoaded', function() {
          loadTheme();
          adjustForMobile();
      });

      // ç³»çµ±è³‡è¨Šé¡¯ç¤º
      function showSystemInfo() {
          const info = {
              userAgent: navigator.userAgent,
              language: navigator.language,
              platform: navigator.platform,
              cookieEnabled: navigator.cookieEnabled,
              onLine: navigator.onLine,
              screenResolution: `${screen.width}x${screen.height}`,
              windowSize: `${window.innerWidth}x${window.innerHeight}`,
              colorDepth: screen.colorDepth,
              timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
          };

          const modalContent = document.getElementById('modalContent');
          modalContent.innerHTML = `
              <h2>ğŸ’» ç³»çµ±è³‡è¨Š</h2>
              <table class="results-table">
                  <tr><td>ç€è¦½å™¨</td><td>${info.userAgent}</td></tr>
                  <tr><td>èªè¨€</td><td>${info.language}</td></tr>
                  <tr><td>å¹³å°</td><td>${info.platform}</td></tr>
                  <tr><td>Cookie æ”¯æ´</td><td>${info.cookieEnabled ? 'æ˜¯' : 'å¦'}</td></tr>
                  <tr><td>ç¶²è·¯ç‹€æ…‹</td><td>${info.onLine ? 'ç·šä¸Š' : 'é›¢ç·š'}</td></tr>
                  <tr><td>è¢å¹•è§£æåº¦</td><td>${info.screenResolution}</td></tr>
                  <tr><td>è¦–çª—å¤§å°</td><td>${info.windowSize}</td></tr>
                  <tr><td>è‰²å½©æ·±åº¦</td><td>${info.colorDepth} bit</td></tr>
                  <tr><td>æ™‚å€</td><td>${info.timezone}</td></tr>
              </table>
              <div class="btn-group">
                  <button class="btn btn-secondary" onclick="closeModal()">é—œé–‰</button>
              </div>
          `;
          document.getElementById('modal').style.display = 'block';
      }

      // å¿«é€Ÿæ“ä½œæŒ‰éˆ•
      function addQuickActions() {
          const quickActions = document.createElement('div');
          quickActions.className = 'quick-actions';
          quickActions.style.cssText = `
              position: fixed;
              bottom: 20px;
              right: 20px;
              z-index: 999;
              display: flex;
              flex-direction: column;
              gap: 10px;
          `;

          const actions = [
              { icon: 'ğŸ“Š', title: 'å¿«é€Ÿçµ±è¨ˆ', action: 'refreshStats()' },
              { icon: 'ğŸ’¾', title: 'å„²å­˜è‰ç¨¿', action: 'autoSave()' },
              { icon: 'ğŸ”', title: 'å›åˆ°é ‚éƒ¨', action: 'scrollToTop()' }
          ];

          actions.forEach(action => {
              const btn = document.createElement('button');
              btn.innerHTML = action.icon;
              btn.title = action.title;
              btn.onclick = new Function(action.action);
              btn.style.cssText = `
                  width: 50px;
                  height: 50px;
                  border-radius: 50%;
                  border: none;
                  background: #4caf50;
                  color: white;
                  font-size: 20px;
                  cursor: pointer;
                  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                  transition: all 0.3s ease;
              `;
              btn.onmouseover = () => btn.style.transform = 'scale(1.1)';
              btn.onmouseout = () => btn.style.transform = 'scale(1)';
              quickActions.appendChild(btn);
          });

          document.body.appendChild(quickActions);
      }

      function scrollToTop() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // åˆå§‹åŒ–å¿«é€Ÿæ“ä½œ
      window.addEventListener('load', addQuickActions);

      // è³‡æ–™åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨
      function showSyncStatus(status) {
          const indicator = document.getElementById('syncIndicator') || document.createElement('div');
          indicator.id = 'syncIndicator';
          indicator.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              padding: 10px 15px;
              border-radius: 20px;
              color: white;
              font-size: 14px;
              z-index: 1000;
              transition: all 0.3s ease;
          `;

          switch (status) {
              case 'syncing':
                  indicator.style.background = '#ff9800';
                  indicator.textContent = 'ğŸ”„ åŒæ­¥ä¸­...';
                  break;
              case 'synced':
                  indicator.style.background = '#4caf50';
                  indicator.textContent = 'âœ… å·²åŒæ­¥';
                  setTimeout(() => indicator.style.opacity = '0', 2000);
                  break;
              case 'error':
                  indicator.style.background = '#f44336';
                  indicator.textContent = 'âŒ åŒæ­¥å¤±æ•—';
                  break;
          }

          if (!document.getElementById('syncIndicator')) {
              document.body.appendChild(indicator);
          }
      }

      console.log('ğŸ‰ å°ç£å¸•é‡‘æ£®ç—…å‹æ¬Šç›Šä¿ƒé€²æœƒæœƒè¨ˆç³»çµ±å‰ç«¯è¼‰å…¥å®Œæˆ');
      console.log('ğŸ“‹ åŠŸèƒ½åŒ…å«ï¼šäº¤æ˜“ç®¡ç†ã€çµ±è¨ˆæŸ¥è©¢ã€æ‰¹æ¬¡åŒ¯å…¥ã€ç³»çµ±è¨­å®š');
      console.log('ğŸ”§ æ”¯æ´åŠŸèƒ½ï¼šé›¢ç·šæª¢æ¸¬ã€è‡ªå‹•å„²å­˜ã€éŸ¿æ‡‰å¼è¨­è¨ˆã€éµç›¤å¿«æ·éµ');
  </script>

  <!-- æ·±è‰²æ¨¡å¼æ¨£å¼ -->
  <style>
      .dark-mode {
          background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
          color: #ecf0f1;
      }

      .dark-mode .card,
      .dark-mode .header,
      .dark-mode .search-section {
          background: rgba(52, 73, 94, 0.95);
          color: #ecf0f1;
      }

      .dark-mode .form-group input,
      .dark-mode .form-group select,
      .dark-mode .form-group textarea {
          background: rgba(44, 62, 80, 0.8);
          color: #ecf0f1;
          border-color: #5a6c7d;
      }

      .dark-mode .results-table {
          background: rgba(52, 73, 94, 0.95);
          color: #ecf0f1;
      }

      .dark-mode .results-table th {
          background: linear-gradient(135deg, #2c3e50, #34495e);
      }

      .dark-mode .modal-content {
          background: #34495e;
          color: #ecf0f1;
      }

      .dark-mode .alert-success {
          background: linear-gradient(135deg, #27ae60, #2ecc71);
          color: white;
      }

      .dark-mode .alert-error {
          background: linear-gradient(135deg, #e74c3c, #c0392b);
          color: white;
      }

      .dark-mode .alert-info {
          background: linear-gradient(135deg, #3498db, #2980b9);
          color: white;
      }
  </style>

  <!-- PWA æ”¯æ´ -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#4caf50">
  <link rel="apple-touch-icon" href="/icon-192x192.png">
</body>
</html>

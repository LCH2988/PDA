<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸•é‡‘æ£®å”æœƒç®¡ç†ç³»çµ±</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    h1 {
      color: #667eea;
      text-align: center;
      margin-bottom: 10px;
      font-size: 24px;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }
    
    input, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      margin-top: 10px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .hidden {
      display: none;
    }
    
    .menu-item {
      padding: 15px;
      margin: 10px 0;
      background: #f8f9fa;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .menu-item:hover {
      background: #667eea;
      color: white;
      transform: translateX(5px);
    }
    
    .user-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    .user-info p {
      margin: 5px 0;
      color: #555;
    }
    
    .role-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }
    
    .role-member { background: #4CAF50; }
    .role-volunteer { background: #2196F3; }
    .role-manager { background: #FF9800; }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #667eea;
    }
    
    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .tab-btn {
      flex: 1;
      padding: 10px;
      background: #e0e0e0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .tab-btn.active {
      background: #667eea;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- è¼‰å…¥ç•«é¢ -->
    <div id="loadingScreen" class="loading">
      <h2>è¼‰å…¥ä¸­...</h2>
      <p>è«‹ç¨å€™</p>
    </div>
    
    <!-- è¨»å†Šç•«é¢ -->
    <div id="registerScreen" class="hidden">
      <h1>ğŸ¥ å¸•é‡‘æ£®å”æœƒ</h1>
      <p class="subtitle">æœƒå“¡è¨»å†Š</p>
      
      <form id="registerForm">
        <div class="form-group">
          <label>LINE åç¨±</label>
          <input type="text" id="displayName" readonly>
        </div>
        
        <div class="form-group">
          <label>çœŸå¯¦å§“å *</label>
          <input type="text" id="realName" required placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å">
        </div>
        
        <div class="form-group">
          <label>é›»è©±è™Ÿç¢¼ *</label>
          <input type="tel" id="phone" required placeholder="0912345678">
        </div>
        
        <div class="form-group">
          <label>è¨­å®šå¯†ç¢¼ *</label>
          <input type="password" id="password" required placeholder="è‡³å°‘6å€‹å­—å…ƒ">
        </div>
        
        <div class="form-group">
          <label>ç¢ºèªå¯†ç¢¼ *</label>
          <input type="password" id="confirmPassword" required placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼">
        </div>
        
        <div class="form-group">
          <label>èº«åˆ†é¡å‹ *</label>
          <select id="role" required>
            <option value="member">ä¸€èˆ¬æˆå“¡</option>
            <option value="volunteer">å¿—å·¥æˆå“¡</option>
          </select>
        </div>
        
        <button type="submit" class="btn">è¨»å†Š</button>
      </form>
    </div>
    
    <!-- ç™»å…¥ç•«é¢ -->
    <div id="loginScreen" class="hidden">
      <h1>ğŸ¥ å¸•é‡‘æ£®å”æœƒ</h1>
      <p class="subtitle">æœƒå“¡ç™»å…¥</p>
      
      <div class="tab-buttons">
        <button class="tab-btn active" onclick="switchLoginTab('line')">LINE ç™»å…¥</button>
        <button class="tab-btn" onclick="switchLoginTab('phone')">é›»è©±ç™»å…¥</button>
      </div>
      
      <div id="lineLoginTab">
        <p style="text-align: center; color: #666; margin: 20px 0;">
          ä½¿ç”¨æ‚¨çš„ LINE å¸³è™Ÿå¿«é€Ÿç™»å…¥
        </p>
        <button class="btn" onclick="lineLogin()">LINE å¿«é€Ÿç™»å…¥</button>
      </div>
      
      <div id="phoneLoginTab" class="hidden">
        <form id="phoneLoginForm">
          <div class="form-group">
            <label>é›»è©±è™Ÿç¢¼</label>
            <input type="tel" id="loginPhone" required placeholder="0912345678">
          </div>
          
          <div class="form-group">
            <label>å¯†ç¢¼</label>
            <input type="password" id="loginPassword" required placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
          </div>
          
          <button type="submit" class="btn">ç™»å…¥</button>
        </form>
      </div>
    </div>
    
    <!-- ä¸»é¸å–®ç•«é¢ -->
    <div id="mainScreen" class="hidden">
      <h1>ğŸ¥ å¸•é‡‘æ£®å”æœƒ</h1>
      <p class="subtitle">æœƒå“¡ç³»çµ±</p>
      
      <div class="user-info">
        <p><strong>å§“åï¼š</strong><span id="userName"></span></p>
        <p><strong>èº«åˆ†ï¼š</strong><span id="userRole"></span></p>
      </div>
      
      <div id="menuContainer"></div>
      
      <button class="btn btn-secondary" onclick="logout()" style="margin-top: 20px;">ç™»å‡º</button>
    </div>
  </div>

  <script>
    // è¨­å®š
    const LIFF_ID = '1656516134-VaGgmaPm'; // è«‹æ›¿æ›ç‚ºæ‚¨çš„ LIFF ID
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwG-jrdCJ4IZzGLue5PaHgLDkuFqRU8XYjx6YxAkfaQxCH8ZUU7XF2NcVHl6gqCpfbcFw/exec'; // è«‹æ›¿æ›ç‚ºæ‚¨çš„ GAS Web App URL
    
    let liffProfile = null;
    let currentUser = null;
    
    // åˆå§‹åŒ– LIFF
    window.onload = async function() {
      try {
        await liff.init({ liffId: LIFF_ID });
        
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        
        liffProfile = await liff.getProfile();
        checkUserStatus();
        
      } catch (error) {
        console.error('LIFF åˆå§‹åŒ–å¤±æ•—:', error);
        alert('ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°é–‹å•Ÿ');
      }
    };
    
    // æª¢æŸ¥ä½¿ç”¨è€…ç‹€æ…‹
    async function checkUserStatus() {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'getUserInfo',
            userId: liffProfile.userId
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // å·²è¨»å†Šï¼Œé¡¯ç¤ºä¸»é¸å–®
          currentUser = result.data;
          showMainScreen();
        } else {
          // æœªè¨»å†Šï¼Œé¡¯ç¤ºè¨»å†Šç•«é¢
          showRegisterScreen();
        }
        
      } catch (error) {
        console.error('æª¢æŸ¥ä½¿ç”¨è€…ç‹€æ…‹å¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
      
      document.getElementById('loadingScreen').classList.add('hidden');
    }
    
    // é¡¯ç¤ºè¨»å†Šç•«é¢
    function showRegisterScreen() {
      document.getElementById('registerScreen').classList.remove('hidden');
      document.getElementById('displayName').value = liffProfile.displayName;
    }
    
    // è¨»å†Šè¡¨å–®æäº¤
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (password.length < 6) {
        alert('å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒ');
        return;
      }
      
      if (password !== confirmPassword) {
        alert('å…©æ¬¡å¯†ç¢¼è¼¸å…¥ä¸ä¸€è‡´');
        return;
      }
      
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'register',
            userId: liffProfile.userId,
            displayName: liffProfile.displayName,
            phone: document.getElementById('phone').value,
            name: document.getElementById('realName').value,
            password: password,
            role: document.getElementById('role').value
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('è¨»å†ŠæˆåŠŸï¼');
          currentUser = result.data;
          document.getElementById('registerScreen').classList.add('hidden');
          showMainScreen();
        } else {
          alert('è¨»å†Šå¤±æ•—ï¼š' + result.message);
        }
        
      } catch (error) {
        console.error('è¨»å†Šå¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    });
    
    // åˆ‡æ›ç™»å…¥æ–¹å¼
    function switchLoginTab(type) {
      const tabs = document.querySelectorAll('.tab-btn');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      if (type === 'line') {
        tabs[0].classList.add('active');
        document.getElementById('lineLoginTab').classList.remove('hidden');
        document.getElementById('phoneLoginTab').classList.add('hidden');
      } else {
        tabs[1].classList.add('active');
        document.getElementById('lineLoginTab').classList.add('hidden');
        document.getElementById('phoneLoginTab').classList.remove('hidden');
      }
    }
    
    // LINE å¿«é€Ÿç™»å…¥
    async function lineLogin() {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'login',
            loginType: 'line',
            userId: liffProfile.userId
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          currentUser = result.data;
          document.getElementById('loginScreen').classList.add('hidden');
          showMainScreen();
        } else {
          alert('ç™»å…¥å¤±æ•—ï¼š' + result.message);
        }
        
      } catch (error) {
        console.error('ç™»å…¥å¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }
    
    // é›»è©±å¯†ç¢¼ç™»å…¥
    document.getElementById('phoneLoginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'login',
            loginType: 'phone',
            phone: document.getElementById('loginPhone').value,
            password: document.getElementById('loginPassword').value
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          currentUser = result.data;
          document.getElementById('loginScreen').classList.add('hidden');
          showMainScreen();
        } else {
          alert('ç™»å…¥å¤±æ•—ï¼š' + result.message);
        }
        
      } catch (error) {
        console.error('ç™»å…¥å¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    });
    
    // é¡¯ç¤ºä¸»é¸å–®
    function showMainScreen() {
      document.getElementById('mainScreen').classList.remove('hidden');
      document.getElementById('userName').textContent = currentUser.name;
      
      const roleText = getRoleText(currentUser.role);
      const roleClass = 'role-' + currentUser.role;
      document.getElementById('userRole').innerHTML = 
        `<span class="role-badge ${roleClass}">${roleText}</span>`;
      
      renderMenu();
    }
    
    // å–å¾—è§’è‰²æ–‡å­—
    function getRoleText(role) {
      const roleMap = {
        'member': 'ä¸€èˆ¬æˆå“¡',
        'volunteer': 'å¿—å·¥æˆå“¡',
        'manager': 'ç®¡ç†äººå“¡'
      };
      return roleMap[role] || role;
    }
    
    // æ¸²æŸ“é¸å–®
    function renderMenu() {
      const menuContainer = document.getElementById('menuContainer');
      const menus = getMenuByRole(currentUser.role);
      
      menuContainer.innerHTML = menus.map(menu => `
        <div class="menu-item" onclick="navigateTo('${menu.action}')">
          <span>${menu.icon} ${menu.name}</span>
          <span>â€º</span>
        </div>
      `).join('');
    }
    
    // æ ¹æ“šè§’è‰²å–å¾—é¸å–®
    function getMenuByRole(role) {
      const baseMenus = [
        { name: 'å€‹äººè³‡æ–™', icon: 'ğŸ‘¤', action: 'profile' },
        { name: 'å”æœƒå…¬å‘Š', icon: 'ğŸ“¢', action: 'announcements' },
        { name: 'æ´»å‹•åˆ—è¡¨', icon: 'ğŸ“…', action: 'activities' }
      ];
      
      if (role === 'volunteer' || role === 'manager') {
        baseMenus.push(
          { name: 'å¿—å·¥ä»»å‹™', icon: 'ğŸ¤', action: 'volunteer-tasks' },
          { name: 'æœå‹™è¨˜éŒ„', icon: 'ğŸ“', action: 'service-records' },
          { name: 'æ™‚æ•¸çµ±è¨ˆ', icon: 'â±ï¸', action: 'hours-stats' }
        );
      }
      
      if (role === 'manager') {
        baseMenus.push(
          { name: 'æœƒå“¡ç®¡ç†', icon: 'ğŸ‘¥', action: 'user-management' },
          { name: 'æ´»å‹•ç®¡ç†', icon: 'ğŸ¯', action: 'activity-management' },
          { name: 'å ±è¡¨åŒ¯å‡º', icon: 'ğŸ“Š', action: 'reports' }
        );
      }
      
      return baseMenus;
    }
    
    // å°èˆªåŠŸèƒ½
    function navigateTo(action) {
      switch(action) {
        case 'profile':
          showProfile();
          break;
        case 'announcements':
          showAnnouncements();
          break;
        case 'activities':
          showActivities();
          break;
        case 'volunteer-tasks':
          showVolunteerTasks();
          break;
        case 'service-records':
          showServiceRecords();
          break;
        case 'hours-stats':
          showHoursStats();
          break;
        case 'user-management':
          showUserManagement();
          break;
        case 'activity-management':
          showActivityManagement();
          break;
        case 'reports':
          showReports();
          break;
        default:
          alert('åŠŸèƒ½é–‹ç™¼ä¸­');
      }
    }
    
    // å€‹äººè³‡æ–™é é¢
    function showProfile() {
      const html = `
        <div style="padding: 20px;">
          <h2 style="color: #667eea; margin-bottom: 20px;">å€‹äººè³‡æ–™</h2>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
            <p><strong>å§“åï¼š</strong>${currentUser.name}</p>
            <p><strong>é›»è©±ï¼š</strong>${currentUser.phone}</p>
            <p><strong>LINE åç¨±ï¼š</strong>${currentUser.displayName}</p>
            <p><strong>èº«åˆ†ï¼š</strong>${getRoleText(currentUser.role)}</p>
            <p><strong>è¨»å†Šæ™‚é–“ï¼š</strong>${currentUser.registeredAt || '---'}</p>
          </div>
          <button class="btn" onclick="showMainScreen()">è¿”å›</button>
        </div>
      `;
      document.querySelector('.container').innerHTML = html;
    }
    
    // å”æœƒå…¬å‘Šé é¢
    function showAnnouncements() {
      const html = `
        <div style="padding: 20px;">
          <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“¢ å”æœƒå…¬å‘Š</h2>
          <div class="menu-item">
            <div>
              <strong>2025å¹´åº¦å¥åº·è¬›åº§</strong>
              <p style="font-size: 12px; color: #666; margin-top: 5px;">2025-10-15</p>
              <p style="font-size: 14px; margin-top: 5px;">é‚€è«‹å°ˆæ¥­é†«å¸«åˆ†äº«å¸•é‡‘æ£®ç—‡ç…§è­·çŸ¥è­˜</p>
            </div>
          </div>
          <div class="menu-item">
            <div>
              <strong>å¿—å·¥æ‹›å‹Ÿä¸­</strong>
              <p style="font-size: 12px; color: #666; margin-top: 5px;">2025-10-10</p>
              <p style="font-size: 14px; margin-top: 5px;">æ­¡è¿æœ‰æ„›å¿ƒçš„æœ‹å‹åŠ å…¥æˆ‘å€‘çš„å¿—å·¥è¡Œåˆ—</p>
            </div>
          </div>
          <button class="btn" onclick="showMainScreen()">è¿”å›</button>
        </div>
      `;
      document.querySelector('.container').innerHTML = html;
    }
    
    // æ´»å‹•åˆ—è¡¨é é¢
    async function showActivities() {
      document.querySelector('.container').innerHTML = '<div class="loading"><h2>è¼‰å…¥ä¸­...</h2></div>';
      
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'getActivities'
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          const activities = result.data.activities;
          let html = `
            <div style="padding: 20px;">
              <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“… æ´»å‹•åˆ—è¡¨</h2>
          `;
          
          if (activities.length === 0) {
            html += '<p style="text-align: center; color: #666;">ç›®å‰æ²’æœ‰æ´»å‹•</p>';
          } else {
            activities.forEach(activity => {
              html += `
                <div class="menu-item">
                  <div>
                    <strong>${activity.activityName}</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">
                      ğŸ“… ${activity.activityDate}
                    </p>
                    <p style="font-size: 14px; margin-top: 5px;">${activity.description}</p>
                  </div>
                </div>
              `;
            });
          }
          
          html += '<button class="btn" onclick="showMainScreen()">è¿”å›</button></div>';
          document.querySelector('.container').innerHTML = html;
        } else {
          alert('è¼‰å…¥å¤±æ•—ï¼š' + result.message);
          showMainScreen();
        }
      } catch (error) {
        console.error('è¼‰å…¥æ´»å‹•å¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤');
        showMainScreen();
      }
    }
    
    // å¿—å·¥ä»»å‹™é é¢
    function showVolunteerTasks() {
      const html = `
        <div style="padding: 20px;">
          <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ¤ å¿—å·¥ä»»å‹™</h2>
          <div class="menu-item">
            <div>
              <strong>æ´»å‹•å ´åœ°ä½ˆç½®</strong>
              <p style="font-size: 12px; color: #666; margin-top: 5px;">éœ€æ±‚äººæ•¸ï¼š5äºº</p>
              <p style="font-size: 14px; margin-top: 5px;">æ™‚é–“ï¼š2025-10-20 09:00</p>
            </div>
            <button class="btn" style="width: auto; padding: 8px 20px; margin: 0;">å ±å</button>
          </div>
          <div class="menu-item">
            <div>
              <strong>æ´»å‹•æ¥å¾…æœå‹™</strong>
              <p style="font-size: 12px; color: #666; margin-top: 5px;">éœ€æ±‚äººæ•¸ï¼š3äºº</p>
              <p style="font-size: 14px; margin-top: 5px;">æ™‚é–“ï¼š2025-10-20 13:00</p>
            </div>
            <button class="btn" style="width: auto; padding: 8px 20px; margin: 0;">å ±å</button>
          </div>
          <button class="btn btn-secondary" onclick="showMainScreen()">è¿”å›</button>
        </div>
      `;
      document.querySelector('.container').innerHTML = html;
    }
    
    // æœå‹™è¨˜éŒ„é é¢
    async function showServiceRecords() {
      document.querySelector('.container').innerHTML = '<div class="loading"><h2>è¼‰å…¥ä¸­...</h2></div>';
      
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'getVolunteerRecords',
            userId: currentUser.userId
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          const records = result.data.records;
          let totalHours = 0;
          
          let html = `
            <div style="padding: 20px;">
              <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“ æœå‹™è¨˜éŒ„</h2>
          `;
          
          if (records.length === 0) {
            html += '<p style="text-align: center; color: #666;">å°šç„¡æœå‹™è¨˜éŒ„</p>';
          } else {
            records.forEach(record => {
              totalHours += parseFloat(record.serviceHours);
              html += `
                <div class="menu-item">
                  <div>
                    <strong>æ´»å‹• ID: ${record.activityId}</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">
                      æ—¥æœŸï¼š${record.serviceDate}
                    </p>
                    <p style="font-size: 14px; margin-top: 5px;">
                      æœå‹™æ™‚æ•¸ï¼š${record.serviceHours} å°æ™‚
                    </p>
                  </div>
                </div>
              `;
            });
            
            html += `
              <div style="background: #667eea; color: white; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center;">
                <h3>ç´¯è¨ˆæœå‹™æ™‚æ•¸</h3>
                <h1 style="margin: 10px 0;">${totalHours} å°æ™‚</h1>
              </div>
            `;
          }
          
          html += '<button class="btn btn-secondary" onclick="showMainScreen()" style="margin-top: 20px;">è¿”å›</button></div>';
          document.querySelector('.container').innerHTML = html;
        } else {
          alert('è¼‰å…¥å¤±æ•—ï¼š' + result.message);
          showMainScreen();
        }
      } catch (error) {
        console.error('è¼‰å…¥è¨˜éŒ„å¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤');
        showMainScreen();
      }
    }
    
    // æ™‚æ•¸çµ±è¨ˆé é¢
    function showHoursStats() {
      showServiceRecords(); // ä½¿ç”¨ç›¸åŒçš„é¡¯ç¤ºé‚è¼¯
    }
    
    // æœƒå“¡ç®¡ç†é é¢ï¼ˆç®¡ç†å“¡åŠŸèƒ½ï¼‰
    async function showUserManagement() {
      document.querySelector('.container').innerHTML = '<div class="loading"><h2>è¼‰å…¥ä¸­...</h2></div>';
      
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'getAllUsers',
            requestUserId: currentUser.userId
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          const users = result.data.users;
          
          let html = `
            <div style="padding: 20px;">
              <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ‘¥ æœƒå“¡ç®¡ç†</h2>
              <p style="margin-bottom: 15px;">ç¸½æœƒå“¡æ•¸ï¼š${users.length} äºº</p>
          `;
          
          users.forEach(user => {
            const roleClass = 'role-' + user.role;
            const statusColor = user.status === 'active' ? '#4CAF50' : '#f44336';
            
            html += `
              <div class="menu-item" style="display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <strong>${user.name}</strong>
                    <span class="role-badge ${roleClass}" style="margin-left: 10px;">
                      ${getRoleText(user.role)}
                    </span>
                  </div>
                  <span style="color: ${statusColor}; font-size: 12px;">â—</span>
                </div>
                <p style="font-size: 12px; color: #666; margin-top: 5px;">
                  é›»è©±ï¼š${user.phone}
                </p>
                <p style="font-size: 12px; color: #666;">
                  è¨»å†Šæ™‚é–“ï¼š${user.registeredAt}
                </p>
              </div>
            `;
          });
          
          html += '<button class="btn btn-secondary" onclick="showMainScreen()">è¿”å›</button></div>';
          document.querySelector('.container').innerHTML = html;
        } else {
          alert('è¼‰å…¥å¤±æ•—ï¼š' + result.message);
          showMainScreen();
        }
      } catch (error) {
        console.error('è¼‰å…¥æœƒå“¡å¤±æ•—:', error);
        alert('ç³»çµ±éŒ¯èª¤');
        showMainScreen();
      }
    }
    
    // æ´»å‹•ç®¡ç†é é¢ï¼ˆç®¡ç†å“¡åŠŸèƒ½ï¼‰
    function showActivityManagement() {
      const html = `
        <div style="padding: 20px;">
          <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ¯ æ´»å‹•ç®¡ç†</h2>
          <button class="btn" onclick="alert('æ–°å¢æ´»å‹•åŠŸèƒ½é–‹ç™¼ä¸­')">â• æ–°å¢æ´»å‹•</button>
          <div style="margin-top: 20px;" id="activityList">
            <p style="text-align: center; color: #666;">è¼‰å…¥ä¸­...</p>
          </div>
          <button class="btn btn-secondary" onclick="showMainScreen()" style="margin-top: 20px;">è¿”å›</button>
        </div>
      `;
      document.querySelector('.container').innerHTML = html;
      loadActivitiesForManagement();
    }
    
    async function loadActivitiesForManagement() {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'getActivities'
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          const activities = result.data.activities;
          let html = '';
          
          if (activities.length === 0) {
            html = '<p style="text-align: center; color: #666;">ç›®å‰æ²’æœ‰æ´»å‹•</p>';
          } else {
            activities.forEach(activity => {
              html += `
                <div class="menu-item" style="display: block;">
                  <strong>${activity.activityName}</strong>
                  <p style="font-size: 12px; color: #666; margin-top: 5px;">
                    æ—¥æœŸï¼š${activity.activityDate}
                  </p>
                  <p style="font-size: 14px; margin-top: 5px;">${activity.description}</p>
                  <div style="margin-top: 10px;">
                    <button class="btn" style="width: auto; padding: 8px 15px; margin-right: 10px; font-size: 14px;" 
                            onclick="alert('ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­')">ç·¨è¼¯</button>
                    <button class="btn btn-secondary" style="width: auto; padding: 8px 15px; font-size: 14px;" 
                            onclick="alert('åˆªé™¤åŠŸèƒ½é–‹ç™¼ä¸­')">åˆªé™¤</button>
                  </div>
                </div>
              `;
            });
          }
          
          document.getElementById('activityList').innerHTML = html;
        }
      } catch (error) {
        console.error('è¼‰å…¥æ´»å‹•å¤±æ•—:', error);
        document.getElementById('activityList').innerHTML = 
          '<p style="text-align: center; color: #f44336;">è¼‰å…¥å¤±æ•—</p>';
      }
    }
    
    // å ±è¡¨åŒ¯å‡ºé é¢ï¼ˆç®¡ç†å“¡åŠŸèƒ½ï¼‰
    function showReports() {
      const html = `
        <div style="padding: 20px;">
          <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š å ±è¡¨åŒ¯å‡º</h2>
          
          <div class="menu-item" onclick="alert('åŒ¯å‡ºæœƒå“¡æ¸…å–®åŠŸèƒ½é–‹ç™¼ä¸­')">
            <span>ğŸ“‹ æœƒå“¡æ¸…å–®</span>
            <span>â€º</span>
          </div>
          
          <div class="menu-item" onclick="alert('åŒ¯å‡ºå¿—å·¥æ™‚æ•¸åŠŸèƒ½é–‹ç™¼ä¸­')">
            <span>â±ï¸ å¿—å·¥æœå‹™æ™‚æ•¸çµ±è¨ˆ</span>
            <span>â€º</span>
          </div>
          
          <div class="menu-item" onclick="alert('åŒ¯å‡ºæ´»å‹•å ±è¡¨åŠŸèƒ½é–‹ç™¼ä¸­')">
            <span>ğŸ“… æ´»å‹•åƒèˆ‡å ±è¡¨</span>
            <span>â€º</span>
          </div>
          
          <div class="menu-item" onclick="alert('åŒ¯å‡ºæœˆå ±è¡¨åŠŸèƒ½é–‹ç™¼ä¸­')">
            <span>ğŸ“ˆ æœˆå ±è¡¨</span>
            <span>â€º</span>
          </div>
          
          <button class="btn btn-secondary" onclick="showMainScreen()">è¿”å›</button>
        </div>
      `;
      document.querySelector('.container').innerHTML = html;
    }
    
    // ç™»å‡ºåŠŸèƒ½
    function logout() {
      if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
        currentUser = null;
        liff.logout();
        window.location.reload();
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>帕促會音聲學分析評估系統</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
        font-size: 16px;
        line-height: 1.6;
        color: #2d3748;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    
    .container {
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .header {
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        text-align: center;
    }
    
    .header h1 {
        color: #4a5568;
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
    }
    
    .header .subtitle {
        color: #718096;
        font-size: 1.2em;
        font-weight: 500;
    }
    
    .section-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .section-title {
        color: #667eea;
        font-size: 2em;
        margin-bottom: 20px;
        font-weight: 700;
        border-left: 5px solid #667eea;
        padding-left: 15px;
    }
    
    /* 評估項目詳細說明 */
    .parameter-detail {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border-left: 5px solid #667eea;
        transition: all 0.3s ease;
    }
    
    .parameter-detail:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }
    
    .parameter-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        cursor: pointer;
    }
    
    .parameter-icon {
        font-size: 2.5em;
        margin-right: 15px;
    }
    
    .parameter-title {
        flex: 1;
    }
    
    .parameter-name {
        font-size: 1.5em;
        font-weight: 700;
        color: #2c3e50;
    }
    
    .parameter-english {
        font-size: 1em;
        color: #7f8c8d;
        font-style: italic;
    }
    
    .parameter-toggle {
        font-size: 1.5em;
        color: #667eea;
        transition: transform 0.3s ease;
    }
    
    .parameter-toggle.open {
        transform: rotate(180deg);
    }
    
    .parameter-content {
        display: none;
        animation: slideDown 0.3s ease;
    }
    
    .parameter-content.show {
        display: block;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .info-box {
        background: white;
        padding: 15px;
        border-radius: 10px;
        border: 2px solid #e9ecef;
    }
    
    .info-label {
        font-size: 0.9em;
        color: #7f8c8d;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .info-value {
        font-size: 1.2em;
        color: #2c3e50;
        font-weight: 700;
    }
    
    .description-section {
        background: #fff9e6;
        padding: 20px;
        border-radius: 10px;
        margin: 15px 0;
        border-left: 4px solid #f39c12;
    }
    
    .description-section h4 {
        color: #f39c12;
        margin-bottom: 10px;
        font-size: 1.2em;
    }
    
    .clinical-significance {
        background: #e8f8f5;
        padding: 20px;
        border-radius: 10px;
        margin: 15px 0;
        border-left: 4px solid #27ae60;
    }
    
    .clinical-significance h4 {
        color: #27ae60;
        margin-bottom: 10px;
        font-size: 1.2em;
    }
    
    .scoring-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        background: white;
        border-radius: 10px;
        overflow: hidden;
    }
    
    .scoring-table th {
        background: #34495e;
        color: white;
        padding: 12px;
        text-align: left;
        font-weight: 600;
    }
    
    .scoring-table td {
        padding: 12px;
        border-bottom: 1px solid #ecf0f1;
    }
    
    .scoring-table tr:hover {
        background: #f8f9fa;
    }
    
    .score-excellent { background: #d5f4e6; color: #27ae60; font-weight: 700; }
    .score-good { background: #d6eaf8; color: #2980b9; font-weight: 700; }
    .score-fair { background: #fef5e7; color: #f39c12; font-weight: 700; }
    .score-poor { background: #fadbd8; color: #e74c3c; font-weight: 700; }
    
    .recommendation-box {
        background: #ebf5fb;
        padding: 20px;
        border-radius: 10px;
        margin: 15px 0;
        border-left: 4px solid #3498db;
    }
    
    .recommendation-box h4 {
        color: #3498db;
        margin-bottom: 10px;
        font-size: 1.2em;
    }
    
    .recommendation-box ul {
        list-style: none;
        padding-left: 0;
    }
    
    .recommendation-box li {
        padding: 8px 0;
        padding-left: 25px;
        position: relative;
    }
    
    .recommendation-box li:before {
        content: "✓";
        position: absolute;
        left: 0;
        color: #3498db;
        font-weight: 700;
    }
    
    /* 評估標準來源 */
    .reference-card {
        background: linear-gradient(135deg, #fef5e7 0%, #fdebd0 100%);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border: 3px solid #f39c12;
    }
    
    .reference-title {
        font-size: 1.5em;
        font-weight: 700;
        color: #d68910;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .reference-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 15px;
    }
    
    .reference-item {
        padding: 15px;
        margin-bottom: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }
    
    .reference-item h5 {
        color: #2c3e50;
        font-size: 1.1em;
        margin-bottom: 8px;
    }
    
    .reference-item p {
        color: #5d6d7e;
        line-height: 1.8;
        margin-bottom: 5px;
    }
    
    .reference-citation {
        font-style: italic;
        color: #7f8c8d;
        font-size: 0.95em;
        padding: 10px;
        background: white;
        border-radius: 5px;
        margin-top: 10px;
    }
    
    .standard-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .standard-table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
    }
    
    .standard-table td {
        padding: 15px;
        border-bottom: 1px solid #ecf0f1;
    }
    
    .standard-table tr:nth-child(even) {
        background: #f8f9fa;
    }
    
    .standard-table tr:hover {
        background: #e8f4f8;
    }
    
    .evidence-level {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9em;
    }
    
    .evidence-high {
        background: #d5f4e6;
        color: #27ae60;
    }
    
    .evidence-moderate {
        background: #d6eaf8;
        color: #2980b9;
    }
    
    .evidence-low {
        background: #fef5e7;
        color: #f39c12;
    }
    
    /* 錄音控制區 */
    .recording-section {
        background: linear-gradient(135deg, #fef5e7 0%, #fdebd0 100%);
        border: 3px solid #f39c12;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
    }
    
    .recording-controls {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    
    .record-btn-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .record-btn {
        padding: 20px 40px;
        font-size: 1.3em;
        font-weight: 700;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .record-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    
    .record-btn.start {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
    }
    
    .record-btn.stop {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        color: white;
        display: none;
    }
    
    .record-btn.analyze {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        display: none;
    }
    
    .recording-status {
        text-align: center;
        font-size: 1.3em;
        font-weight: 600;
        color: #2c3e50;
        min-height: 30px;
    }
    
    .recording-timer {
        font-size: 2.5em;
        font-weight: 700;
        color: #e74c3c;
        display: none;
    }
    
    .waveform-container {
        width: 100%;
        height: 150px;
        background: white;
        border-radius: 10px;
        margin-top: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #f39c12;
        overflow: hidden;
    }
    
    .waveform-canvas {
        width: 100%;
        height: 100%;
    }
    
    .audio-player {
        width: 100%;
        margin-top: 20px;
        display: none;
    }
    
    .file-upload-area {
        border: 3px dashed #3498db;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
    }
    
    .file-upload-area:hover {
        background: #ebf5fb;
        border-color: #2980b9;
    }
    
    .file-upload-area.dragover {
        background: #d6eaf8;
        border-color: #2980b9;
    }
    
    /* 分析結果區 */
    .analysis-results {
        display: none;
        animation: fadeIn 0.5s ease;
    }
    
    .analysis-results.show {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .result-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .result-card {
        background: linear-gradient(135deg, #e8f4f8 0%, #d4e9f2 100%);
        border: 2px solid #3498db;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .result-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(52, 152, 219, 0.2);
    }
    
    .result-card-title {
        font-size: 1.1em;
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .result-card-value {
        font-size: 2.5em;
        font-weight: 700;
        color: #3498db;
        margin: 10px 0;
    }
    
    .result-card-status {
        font-size: 1em;
        font-weight: 600;
        padding: 5px 15px;
        border-radius: 20px;
        display: inline-block;
    }
    
    .status-excellent { 
        background: #d5f4e6;
        color: #27ae60;
    }
    
    .status-good { 
        background: #d6eaf8;
        color: #2980b9;
    }
    
    .status-fair { 
        background: #fef5e7;
        color: #f39c12;
    }
    
    .status-poor { 
        background: #fadbd8;
        color: #e74c3c;
    }
    
    .progress-bar {
        width: 100%;
        height: 30px;
        background: #ecf0f1;
        border-radius: 15px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 15px;
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
    }
    
    .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
        display: none;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* 報告區域 */
    .report-section {
        background: white;
        border-radius: 20px;
        padding: 40px;
        margin-top: 30px;
        display: none;
    }
    
    .report-section.show {
        display: block;
    }
    
    .report-header {
        text-align: center;
        border-bottom: 3px solid #667eea;
        padding-bottom: 20px;
        margin-bottom: 30px;
    }
    
    .report-title {
        font-size: 2.5em;
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .report-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .report-meta-item {
        display: flex;
        flex-direction: column;
    }
    
    .report-meta-label {
        font-size: 0.9em;
        color: #7f8c8d;
        margin-bottom: 5px;
    }
    
    .report-meta-value {
        font-size: 1.1em;
        color: #2c3e50;
        font-weight: 600;
    }
    
    .report-score-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        margin: 30px 0;
    }
    
    .report-total-score {
        font-size: 5em;
        font-weight: 700;
        margin: 20px 0;
    }
    
    .report-score-label {
        font-size: 1.8em;
        font-weight: 600;
    }
    
    .report-details-table {
        width: 100%;
        border-collapse: collapse;
        margin: 30px 0;
    }
    
    .report-details-table th {
        background: #34495e;
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
    }
    
    .report-details-table td {
        padding: 15px;
        border-bottom: 1px solid #ecf0f1;
    }
    
    .report-details-table tr:hover {
        background: #f8f9fa;
    }
    
    .report-chart {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .report-recommendations {
        background: #fff3cd;
        border-left: 5px solid #ffc107;
        padding: 20px;
        margin: 30px 0;
        border-radius: 5px;
    }
    
    .report-recommendations h3 {
        color: #856404;
        margin-bottom: 15px;
    }
    
    .report-recommendations ul {
        list-style: none;
        padding-left: 0;
    }
    
    .report-recommendations li {
        padding: 10px 0;
        color: #856404;
        line-height: 1.8;
    }
    
    .report-recommendations li:before {
        content: "✓ ";
        font-weight: 700;
        margin-right: 10px;
    }
    
    .report-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
    }
    
    .action-btn {
        padding: 15px 30px;
        font-size: 1.2em;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .action-btn.print {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
    }
    
    .action-btn.download {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
    }
    
    .action-btn.email {
        background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
        color: white;
    }
    
    .action-btn.new {
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        color: white;
    }
    
    .chart-container {
        width: 100%;
        height: 400px;
        margin: 20px 0;
    }
    
    /* 模態框 */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        animation: fadeIn 0.3s ease;
    }
    
    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .modal-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .modal-close {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 2em;
        cursor: pointer;
        color: #7f8c8d;
        transition: color 0.3s ease;
    }
    
    .modal-close:hover {
        color: #e74c3c;
    }
    
    /* 列印樣式 */
    @media print {
        body {
            background: white;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
        }
        
        .section-card:not(.report-section) {
            display: none !important;
        }
        
        .report-actions {
            display: none !important;
        }
        
        .report-section {
            box-shadow: none;
            page-break-after: always;
        }
    }
    
    @media (max-width: 768px) {
        .header h1 {
            font-size: 1.8em;
        }
        
        .section-title {
            font-size: 1.5em;
        }
        
        .record-btn {
            padding: 15px 25px;
            font-size: 1.1em;
        }
        
        .result-grid {
            grid-template-columns: 1fr;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>🎤 帕促會語音聲學分析評估系統</h1>
        <div class="subtitle">即時錄音分析 · 智能評估 · 專業報告</div>
    </div>
    
    <!-- 即時錄音分析區 -->
    <div class="section-card">
        <h2 class="section-title">🎙️ 即時錄音與音檔分析</h2>
        
        <div class="recording-section">
            <div class="recording-controls">
                <div class="recording-status" id="recordingStatus">請選擇錄音或上傳音檔進行分析</div>
                <div class="recording-timer" id="recordingTimer">00:00</div>
                
                <div class="record-btn-group">
                    <button class="record-btn start" id="startRecordBtn" onclick="startRecording()">
                        <span>🔴</span> 開始錄音
                    </button>
                    <button class="record-btn stop" id="stopRecordBtn" onclick="stopRecording()">
                        <span>⏹️</span> 停止錄音
                    </button>
                    <button class="record-btn analyze" id="analyzeBtn" onclick="analyzeAudio()">
                        <span>🔬</span> 開始分析
                    </button>
                </div>
                
                <div class="waveform-container">
                    <canvas class="waveform-canvas" id="waveformCanvas"></canvas>
                </div>
                
                <audio class="audio-player" id="audioPlayer" controls></audio>
                
                <div style="width: 100%; max-width: 600px;">
                    <h3 style="text-align: center; color: #2c3e50; margin: 20px 0;">或上傳音檔</h3>
                    <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 3em; margin-bottom: 10px;">📁</div>
                        <div style="font-size: 1.2em; font-weight: 600; color: #2c3e50;">點擊選擇音檔或拖曳至此</div>
                        <div style="color: #7f8c8d; margin-top: 10px;">支援格式：WAV, MP3, M4A</div>
                        <input type="file" id="fileInput" accept="audio/*" style="display: none;" onchange="handleFileUpload(event)">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="loading-spinner" id="loadingSpinner"></div>
    </div>
    
    <!-- 分析結果區 -->
    <div class="section-card analysis-results" id="analysisResults">
        <h2 class="section-title">📊 聲學分析結果</h2>
        <p style="color: #7f8c8d; margin-bottom: 20px;">點擊任一評估項目查看詳細說明與建議</p>
        
        <div class="result-grid" id="resultGrid">
            <!-- 結果卡片將由 JavaScript 動態生成 -->
        </div>
        
        <div style="margin-top: 30px; text-align: center;">
            <button class="action-btn print" onclick="generateReport()">
                <span>📄</span> 生成完整報告
            </button>
        </div>
    </div>
    
    <!-- 評估項目詳細說明 -->
    <div class="section-card">
        <h2 class="section-title">📖 評估項目詳細說明</h2>
        
<!-- F0 基頻 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('f0')">
                  <div class="parameter-icon">🎵</div>
                  <div class="parameter-title">
                      <div class="parameter-name">1. 基頻 (F0)</div>
                      <div class="parameter-english">Fundamental Frequency</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-f0">▼</div>
              </div>
              <div class="parameter-content" id="content-f0">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">男性: 85-180 Hz<br>女性: 165-255 Hz</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">10 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">聲帶振動頻率</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>基頻 (F0) 是聲帶振動的基本頻率，決定了聲音的音調高低。帕金森病患者常因聲帶僵硬、運動範圍受限，導致基頻單調、變化幅度減小，聲音聽起來平淡無起伏。</p>
                      <p><strong>測量方法：</strong>使用聲學分析軟體提取持續元音 /a/ 的平均基頻值。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>基頻過低：</strong>可能反映聲帶張力不足、肌肉僵硬</li>
                          <li><strong>基頻過高：</strong>可能因聲帶過度緊張或代償機制</li>
                          <li><strong>基頻變異減少：</strong>語調單調，缺乏情感表達</li>
                          <li><strong>與疾病嚴重度相關：</strong>基頻異常程度與運動症狀嚴重度呈正相關</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>男性範圍 (Hz)</th>
                          <th>女性範圍 (Hz)</th>
                          <th>評估</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>10</td>
                          <td>100-150</td>
                          <td>180-220</td>
                          <td>優秀</td>
                      </tr>
                      <tr class="score-good">
                          <td>7</td>
                          <td>85-99 或 151-180</td>
                          <td>165-179 或 221-255</td>
                          <td>良好</td>
                      </tr>
                      <tr class="score-fair">
                          <td>4</td>
                          <td>70-84 或 181-200</td>
                          <td>150-164 或 256-280</td>
                          <td>尚可</td>
                      </tr>
                      <tr class="score-poor">
                          <td>2</td>
                          <td><70 或 >200</td>
                          <td><150 或 >280</td>
                          <td>需加強</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>音調練習：</strong>練習唱音階（Do-Re-Mi-Fa-Sol），每天10分鐘</li>
                          <li><strong>誇張語調：</strong>朗讀時刻意誇大語調起伏，如讀童話故事</li>
                          <li><strong>音高變化：</strong>練習從低音到高音的滑音，增加聲帶靈活度</li>
                          <li><strong>LSVT LOUD：</strong>專業語音治療方案，強調音量和音調訓練</li>
                          <li><strong>歌唱療法：</strong>每天唱歌15-20分鐘，改善音調控制</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- Intensity 音量強度 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('intensity')">
                  <div class="parameter-icon">🔊</div>
                  <div class="parameter-title">
                      <div class="parameter-name">2. 音量強度 (Intensity)</div>
                      <div class="parameter-english">Sound Pressure Level</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-intensity">▼</div>
              </div>
              <div class="parameter-content" id="content-intensity">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">55-75 dB</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">10 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">發聲強度</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>音量強度反映聲音的響度，以分貝 (dB) 為單位。帕金森病最典型的語音特徵之一就是「小聲症」(hypophonia)，患者說話音量明顯減小，但自己往往無法察覺。</p>
                      <p><strong>測量方法：</strong>在距離麥克風30公分處，測量持續發音的平均聲壓級。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>音量減小：</strong>呼吸支持不足、聲帶閉合不全</li>
                          <li><strong>音量衰減：</strong>說話過程中音量逐漸減弱</li>
                          <li><strong>社交影響：</strong>嚴重影響日常溝通，增加社交孤立風險</li>
                          <li><strong>早期指標：</strong>音量減小可能是帕金森病的早期症狀之一</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>音量範圍 (dB)</th>
                          <th>評估</th>
                          <th>臨床描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>10</td>
                          <td>65-75</td>
                          <td>優秀</td>
                          <td>正常對話音量，清晰可聞</td>
                      </tr>
                      <tr class="score-good">
                          <td>7</td>
                          <td>60-64</td>
                          <td>良好</td>
                          <td>稍小但可接受</td>
                      </tr>
                      <tr class="score-fair">
                          <td>5</td>
                          <td>55-59</td>
                          <td>尚可</td>
                          <td>需靠近才能聽清</td>
                      </tr>
                      <tr class="score-poor">
                          <td>2</td>
                          <td><55</td>
                          <td>需加強</td>
                          <td>嚴重小聲，難以溝通</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>LSVT LOUD療法：</strong>標準化音量訓練方案，每週4次，持續4週</li>
                          <li><strong>大聲朗讀：</strong>每天朗讀15-20分鐘，保持「稍微用力」的感覺</li>
                          <li><strong>音量監測：</strong>使用分貝計App監測說話音量，維持在65-75dB</li>
                          <li><strong>呼吸訓練：</strong>腹式呼吸練習，增強呼吸支持</li>
                          <li><strong>「想大聲」策略：</strong>時刻提醒自己說話要「大聲一點」</li>
                          <li><strong>環境練習：</strong>在不同環境（室內、室外）練習調整音量</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- HNR 諧噪比 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('hnr')">
                  <div class="parameter-icon">🎼</div>
                  <div class="parameter-title">
                      <div class="parameter-name">3. 諧噪比 (HNR)</div>
                      <div class="parameter-english">Harmonics-to-Noise Ratio</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-hnr">▼</div>
              </div>
              <div class="parameter-content" id="content-hnr">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">≥ 15 dB</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">15 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">音質清晰度</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>諧噪比 (HNR) 測量聲音中諧波成分與噪音成分的比例，反映聲音的清晰度和音質。數值越高表示聲音越清晰，噪音越少。帕金森病患者因聲帶閉合不全、振動不規則，HNR值通常偏低，聲音聽起來氣息聲重、嘶啞。</p>
                      <p><strong>測量方法：</strong>分析持續元音 /a/ 的諧波與噪音能量比。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>HNR降低：</strong>聲帶閉合不全，氣息聲增加</li>
                          <li><strong>音質粗糙：</strong>聲帶振動不規則，聲音嘶啞</li>
                          <li><strong>聽感影響：</strong>聲音聽起來「髒」、「不乾淨」</li>
                          <li><strong>疾病進展指標：</strong>HNR持續下降可能提示病情惡化</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>HNR 範圍 (dB)</th>
                          <th>評估</th>
                          <th>音質描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>15</td>
                          <td>≥ 20</td>
                          <td>優秀</td>
                          <td>清晰響亮，無雜音</td>
                      </tr>
                      <tr class="score-good">
                          <td>12</td>
                          <td>15-19.9</td>
                          <td>良好</td>
                          <td>清晰可接受</td>
                      </tr>
                      <tr class="score-fair">
                          <td>8</td>
                          <td>10-14.9</td>
                          <td>尚可</td>
                          <td>輕度氣息聲或嘶啞</td>
                      </tr>
                      <tr class="score-poor">
                          <td>4</td>
                          <td><10</td>
                          <td>需加強</td>
                          <td>明顯嘶啞、氣息聲重</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>聲帶閉合訓練：</strong>練習用力發「啊」音，增強聲帶閉合力</li>
                          <li><strong>共鳴訓練：</strong>哼鳴練習 (humming)，感受頭腔共鳴</li>
                          <li><strong>放鬆練習：</strong>頸部、喉部按摩，減少肌肉緊張</li>
                          <li><strong>水分補充：</strong>保持聲帶濕潤，多喝溫水</li>
                          <li><strong>避免清喉嚨：</strong>用吞嚥或喝水代替清喉嚨動作</li>
                          <li><strong>嗓音衛生：</strong>避免大喊、長時間說話、吸煙等傷害聲帶行為</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- Jitter 頻率微擾 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('jitter')">
                  <div class="parameter-icon">📉</div>
                  <div class="parameter-title">
                      <div class="parameter-name">4. 頻率微擾 (Jitter)</div>
                      <div class="parameter-english">Frequency Perturbation</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-jitter">▼</div>
              </div>
              <div class="parameter-content" id="content-jitter">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">≤ 1.04%</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">15 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">頻率穩定性</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>Jitter 測量聲帶振動週期之間的頻率變異，反映聲音的穩定性。數值越小表示聲音越穩定。帕金森病患者因聲帶肌肉控制不良、震顫，Jitter值通常升高，聲音聽起來顫抖、不穩定。</p>
                      <p><strong>測量方法：</strong>計算連續發音週期間的頻率變化百分比。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>Jitter升高：</strong>聲帶振動不規則，神經肌肉控制障礙</li>
                          <li><strong>聲音顫抖：</strong>聽感上有明顯的抖動感</li>
                          <li><strong>敏感指標：</strong>Jitter是帕金森病語音障礙的敏感指標之一</li>
                          <li><strong>早期檢測：</strong>可能在臨床症狀出現前就有異常</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>Jitter 範圍 (%)</th>
                          <th>評估</th>
                          <th>穩定性描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>15</td>
                          <td>≤ 0.5</td>
                          <td>優秀</td>
                          <td>非常穩定</td>
                      </tr>
                      <tr class="score-good">
                          <td>12</td>
                          <td>0.51-1.04</td>
                          <td>良好</td>
                          <td>正常範圍</td>
                      </tr>
                      <tr class="score-fair">
                          <td>8</td>
                          <td>1.05-2.0</td>
                          <td>尚可</td>
                          <td>輕度不穩定</td>
                      </tr>
                      <tr class="score-poor">
                          <td>4</td>
                          <td>>2.0</td>
                          <td>需加強</td>
                          <td>明顯顫抖</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>持續發音：</strong>練習持續發 /a/ 音5-10秒，保持穩定</li>
                          <li><strong>呼吸控制：</strong>穩定的呼吸支持可改善聲音穩定性</li>
                          <li><strong>放鬆訓練：</strong>減少喉部緊張，改善聲帶振動規律性</li>
                          <li><strong>視覺回饋：</strong>使用聲學軟體即時監測，視覺化穩定性</li>
                          <li><strong>藥物優化：</strong>在藥效最佳時段進行訓練</li>
                          <li><strong>漸進練習：</strong>從短時間到長時間，逐步增加持續發音時長</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- Shimmer 振幅微擾 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('shimmer')">
                  <div class="parameter-icon">📊</div>
                  <div class="parameter-title">
                      <div class="parameter-name">5. 振幅微擾 (Shimmer)</div>
                      <div class="parameter-english">Amplitude Perturbation</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-shimmer">▼</div>
              </div>
              <div class="parameter-content" id="content-shimmer">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">≤ 3.81%</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">15 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">振幅穩定性</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>Shimmer 測量聲帶振動振幅的變異，反映音量的穩定性。數值越小表示音量越穩定。帕金森病患者因呼吸控制不良、聲帶肌力不足，Shimmer值通常升高，音量忽大忽小。</p>
                      <p><strong>測量方法：</strong>計算連續發音週期間的振幅變化百分比。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>Shimmer升高：</strong>聲帶振動振幅不規則</li>
                          <li><strong>音量波動：</strong>說話音量不穩定</li>
                          <li><strong>呼吸協調：</strong>反映呼吸與發聲的協調問題</li>
                          <li><strong>綜合指標：</strong>與Jitter結合評估整體聲音質量</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>Shimmer 範圍 (%)</th>
                          <th>評估</th>
                          <th>振幅穩定性</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>15</td>
                          <td>≤ 2.0</td>
                          <td>優秀</td>
                          <td>音量非常穩定</td>
                      </tr>
                      <tr class="score-good">
                          <td>12</td>
                          <td>2.01-3.81</td>
                          <td>良好</td>
                          <td>正常範圍</td>
                      </tr>
                      <tr class="score-fair">
                          <td>8</td>
                          <td>3.82-6.0</td>
                          <td>尚可</td>
                          <td>輕度波動</td>
                      </tr>
                      <tr class="score-poor">
                          <td>4</td>
                          <td>>6.0</td>
                          <td>需加強</td>
                          <td>明顯不穩定</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>呼吸訓練：</strong>腹式呼吸，提供穩定氣流支持</li>
                          <li><strong>音量控制：</strong>練習保持恆定音量發音</li>
                          <li><strong>長音練習：</strong>持續發音時保持音量穩定</li>
                          <li><strong>姿勢調整：</strong>保持良好姿勢，優化呼吸效率</li>
                          <li><strong>肌力訓練：</strong>加強呼吸肌和發聲肌的力量</li>
                          <li><strong>節奏練習：</strong>配合節拍器，訓練穩定發聲</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- F1 第一共振峰 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('f1')">
                  <div class="parameter-icon">🗣️</div>
                  <div class="parameter-title">
                      <div class="parameter-name">6. 第一共振峰 (F1)</div>
                      <div class="parameter-english">First Formant</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-f1">▼</div>
              </div>
              <div class="parameter-content" id="content-f1">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">600-900 Hz</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">10 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">舌位高低</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>第一共振峰 (F1) 主要反映舌頭的高低位置和口腔開口度。F1值越高，舌位越低、口腔開口越大。帕金森病患者因構音器官運動範圍受限，F1值可能異常，影響元音清晰度。</p>
                      <p><strong>測量方法：</strong>分析元音 /a/, /i/, /u/ 的第一共振峰頻率。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>F1異常：</strong>舌頭運動範圍受限</li>
                          <li><strong>元音空間縮小：</strong>不同元音聽起來相似</li>
                          <li><strong>構音不清：</strong>影響語音清晰度和可懂度</li>
                          <li><strong>運動障礙指標：</strong>反映口腔運動功能</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
>分數</th>
                          <th>F1 範圍 (Hz)</th>
                          <th>評估</th>
                          <th>構音描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>10</td>
                          <td>600-900</td>
                          <td>優秀</td>
                          <td>元音清晰，舌位正常</td>
                      </tr>
                      <tr class="score-good">
                          <td>7</td>
                          <td>480-599 或 901-1080</td>
                          <td>良好</td>
                          <td>輕度偏移但可接受</td>
                      </tr>
                      <tr class="score-fair">
                          <td>4</td>
                          <td>420-479 或 1081-1170</td>
                          <td>尚可</td>
                          <td>明顯偏移，影響清晰度</td>
                      </tr>
                      <tr class="score-poor">
                          <td>2</td>
                          <td><420 或 >1170</td>
                          <td>需加強</td>
                          <td>嚴重異常，構音不清</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>元音練習：</strong>誇張發 /a/, /i/, /u/, /e/, /o/，增大口腔動作</li>
                          <li><strong>舌頭運動：</strong>舌頭上下、前後、左右運動練習</li>
                          <li><strong>鏡子練習：</strong>對著鏡子觀察口型，確保動作到位</li>
                          <li><strong>誇張構音：</strong>刻意誇大每個音的發音動作</li>
                          <li><strong>元音對比：</strong>練習 /i/-/a/, /u/-/a/ 等對比，擴大元音空間</li>
                          <li><strong>口腔肌力：</strong>舌頭抵抗訓練，增強舌肌力量</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- F2 第二共振峰 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('f2')">
                  <div class="parameter-icon">👄</div>
                  <div class="parameter-title">
                      <div class="parameter-name">7. 第二共振峰 (F2)</div>
                      <div class="parameter-english">Second Formant</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-f2">▼</div>
              </div>
              <div class="parameter-content" id="content-f2">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">1000-1400 Hz</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">10 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">舌位前後</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>第二共振峰 (F2) 主要反映舌頭的前後位置。F2值越高，舌位越靠前。帕金森病患者因舌頭運動靈活度下降，F2值可能異常，影響輔音和元音的區分度。</p>
                      <p><strong>測量方法：</strong>分析元音的第二共振峰頻率，特別關注 /i/ 和 /u/ 的對比。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>F2異常：</strong>舌頭前後運動受限</li>
                          <li><strong>元音中央化：</strong>所有元音趨向中央元音</li>
                          <li><strong>輔音不清：</strong>影響 /t/, /k/, /s/ 等輔音清晰度</li>
                          <li><strong>可懂度下降：</strong>嚴重影響語音可理解性</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>F2 範圍 (Hz)</th>
                          <th>評估</th>
                          <th>構音描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>10</td>
                          <td>1000-1400</td>
                          <td>優秀</td>
                          <td>元音區分清晰</td>
                      </tr>
                      <tr class="score-good">
                          <td>7</td>
                          <td>800-999 或 1401-1680</td>
                          <td>良好</td>
                          <td>輕度偏移</td>
                      </tr>
                      <tr class="score-fair">
                          <td>4</td>
                          <td>700-799 或 1681-1820</td>
                          <td>尚可</td>
                          <td>明顯中央化</td>
                      </tr>
                      <tr class="score-poor">
                          <td>2</td>
                          <td><700 或 >1820</td>
                          <td>需加強</td>
                          <td>嚴重構音障礙</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>前後元音對比：</strong>練習 /i/-/u/ 對比，強調舌位差異</li>
                          <li><strong>輔音精確度：</strong>清晰發 /t/, /d/, /k/, /g/ 等輔音</li>
                          <li><strong>舌尖練習：</strong>舌尖觸碰上齒齦、硬顎等位置</li>
                          <li><strong>音節串練習：</strong>/ti-tu-ti-tu/ 快速交替</li>
                          <li><strong>繞口令：</strong>練習包含多種輔音的繞口令</li>
                          <li><strong>視覺提示：</strong>使用舌位圖，了解正確發音位置</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- 語速 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('speechRate')">
                  <div class="parameter-icon">⏱️</div>
                  <div class="parameter-title">
                      <div class="parameter-name">8. 語速 (Speech Rate)</div>
                      <div class="parameter-english">Speaking Rate</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-speechRate">▼</div>
              </div>
              <div class="parameter-content" id="content-speechRate">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">180-220 音節/分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">10 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">說話速度</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>語速指單位時間內說出的音節數量。帕金森病患者可能出現兩種極端：語速過快（急促語）或語速過慢（遲緩語）。急促語常伴隨音節省略、清晰度下降；遲緩語則影響溝通效率。</p>
                      <p><strong>測量方法：</strong>計算朗讀標準段落的總音節數除以總時間（扣除停頓）。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>語速過快：</strong>運動失控，「急促語」(festinating speech)</li>
                          <li><strong>語速過慢：</strong>運動遲緩，構音困難</li>
                          <li><strong>語速不穩：</strong>忽快忽慢，節律異常</li>
                          <li><strong>溝通效率：</strong>嚴重影響日常交流效率</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>語速範圍 (音節/分)</th>
                          <th>評估</th>
                          <th>臨床描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>10</td>
                          <td>180-220</td>
                          <td>優秀</td>
                          <td>節奏自然流暢</td>
                      </tr>
                      <tr class="score-good">
                          <td>7</td>
                          <td>150-179 或 221-250</td>
                          <td>良好</td>
                          <td>稍快或稍慢但可接受</td>
                      </tr>
                      <tr class="score-fair">
                          <td>4</td>
                          <td>120-149 或 251-280</td>
                          <td>尚可</td>
                          <td>明顯過快或過慢</td>
                      </tr>
                      <tr class="score-poor">
                          <td>2</td>
                          <td><120 或 >280</td>
                          <td>需加強</td>
                          <td>嚴重異常，影響溝通</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>節拍器訓練：</strong>配合節拍器朗讀，建立穩定節奏</li>
                          <li><strong>延長音節：</strong>刻意拉長每個音節，減緩語速</li>
                          <li><strong>停頓練習：</strong>在標點符號處明確停頓</li>
                          <li><strong>視覺提示：</strong>使用手勢或視覺標記控制語速</li>
                          <li><strong>錄音回饋：</strong>錄音並回聽，自我監測語速</li>
                          <li><strong>分段練習：</strong>將長句分成短段，逐段練習</li>
                          <li><strong>DAF設備：</strong>使用延遲聽覺回饋設備（針對急促語）</li>
                      </ul>
                  </div>
              </div>
          </div>
          
          <!-- 停頓模式 -->
          <div class="parameter-detail">
              <div class="parameter-header" onclick="toggleParameter('pause')">
                  <div class="parameter-icon">⏸️</div>
                  <div class="parameter-title">
                      <div class="parameter-name">9. 停頓模式 (Pause Pattern)</div>
                      <div class="parameter-english">Pause Pattern & Prosody</div>
                  </div>
                  <div class="parameter-toggle" id="toggle-pause">▼</div>
              </div>
              <div class="parameter-content" id="content-pause">
                  <div class="info-grid">
                      <div class="info-box">
                          <div class="info-label">正常範圍</div>
                          <div class="info-value">3-5 次/分鐘</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">滿分標準</div>
                          <div class="info-value">5 分</div>
                      </div>
                      <div class="info-box">
                          <div class="info-label">臨床意義</div>
                          <div class="info-value">韻律節奏</div>
                      </div>
                  </div>
                  
                  <div class="description-section">
                      <h4>📝 參數說明</h4>
                      <p>停頓模式反映說話的韻律和節奏。正常說話應在適當位置（如標點符號處）停頓。帕金森病患者可能出現停頓異常：不當位置停頓、停頓過長或過短、缺乏停頓等，影響語句理解和自然度。</p>
                      <p><strong>測量方法：</strong>分析朗讀或自發言語中的停頓頻率、時長和位置。</p>
                  </div>
                  
                  <div class="clinical-significance">
                      <h4>🏥 臨床意義</h4>
                      <ul style="padding-left: 20px;">
                          <li><strong>停頓過多：</strong>呼吸控制不良，氣短</li>
                          <li><strong>停頓不當：</strong>在詞語中間停頓，破壞語義</li>
                          <li><strong>缺乏停頓：</strong>急促語，一口氣說完</li>
                          <li><strong>韻律單調：</strong>缺乏自然的語調起伏</li>
                      </ul>
                  </div>
                  
                  <h4 style="margin: 20px 0 10px 0;">評分標準</h4>
                  <table class="scoring-table">
                      <tr>
                          <th>分數</th>
                          <th>停頓頻率 (次/分)</th>
                          <th>評估</th>
                          <th>韻律描述</th>
                      </tr>
                      <tr class="score-excellent">
                          <td>5</td>
                          <td>3-5</td>
                          <td>優秀</td>
                          <td>自然流暢，停頓恰當</td>
                      </tr>
                      <tr class="score-good">
                          <td>4</td>
                          <td>2-2.9 或 5.1-6</td>
                          <td>良好</td>
                          <td>基本自然</td>
                      </tr>
                      <tr class="score-fair">
                          <td>2</td>
                          <td>1-1.9 或 6.1-8</td>
                          <td>尚可</td>
                          <td>停頓異常，影響理解</td>
                      </tr>
                      <tr class="score-poor">
                          <td>1</td>
                          <td><1 或 >8</td>
                          <td>需加強</td>
                          <td>嚴重韻律障礙</td>
                      </tr>
                  </table>
                  
                  <div class="recommendation-box">
                      <h4>💡 訓練建議</h4>
                      <ul>
                          <li><strong>標點停頓：</strong>在每個標點符號處明確停頓</li>
                          <li><strong>呼吸訓練：</strong>學習在自然停頓處換氣</li>
                          <li><strong>語句分段：</strong>將長句劃分為意群，逐段練習</li>
                          <li><strong>韻律模仿：</strong>模仿正常語音的韻律模式</li>
                          <li><strong>朗讀訓練：</strong>有感情地朗讀，注意語調起伏</li>
                          <li><strong>對話練習：</strong>在真實對話中練習自然停頓</li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>
      
      <!-- 評估標準來源與依據 -->
      <div class="section-card">
          <h2 class="section-title">📚 評估標準來源與科學依據</h2>
          
          <div class="reference-card">
              <div class="reference-title">
                  <span>🔬</span> 臨床研究基礎
              </div>
              <div class="reference-content">
                  <div class="reference-item">
                      <h5>1. 基頻 (F0) 標準來源</h5>
                      <p><strong>研究基礎：</strong>基於大規模健康成人語音數據庫建立</p>
                      <p><strong>參考文獻：</strong></p>
                      <div class="reference-citation">
                          Rusz, J., Cmejla, R., Ruzickova, H., & Ruzicka, E. (2011). Quantitative acoustic measurements for characterization of speech and voice disorders in early untreated Parkinson's disease. <em>Journal of the Acoustical Society of America</em>, 129(1), 350-367.
                      </div>
                      <span class="evidence-level evidence-high">證據等級：高</span>
                  </div>
                  
                  <div class="reference-item">
                      <h5>2. 音量強度 (Intensity) 標準</h5>
                      <p><strong>研究基礎：</strong>LSVT LOUD療法臨床試驗數據</p>
                      <p><strong>參考文獻：</strong></p>
                      <div class="reference-citation">
                          Ramig, L. O., Sapir, S., Countryman, S., Pawlas, A. A., O'Brien, C., Hoehn, M., & Thompson, L. L. (2001). Intensive voice treatment (LSVT) for patients with Parkinson's disease: a 2 year follow up. <em>Journal of Neurology, Neurosurgery & Psychiatry</em>, 71(4), 493-498.
                      </div>
                      <span class="evidence-level evidence-high">證據等級：高（RCT研究）</span>
                  </div>
                  
                  <div class="reference-item">
                      <h5>3. 諧噪比 (HNR) 標準</h5>
                      <p><strong>研究基礎：</strong>多中心帕金森病語音特徵研究</p>
                      <p><strong>參考文獻：</strong></p>
                      <div class="reference-citation">
                          Tsanas, A., Little, M. A., McSharry, P. E., & Ramig, L. O. (2010). Accurate telemonitoring of Parkinson's disease progression by noninvasive speech tests. <em>IEEE Transactions on Biomedical Engineering</em>, 57(4), 884-893.
                      </div>
                      <span class="evidence-level evidence-high">證據等級：高</span>
                  </div>
                  
                  <div class="reference-item">
                      <h5>4. Jitter 與 Shimmer 標準</h5>
                      <p><strong>研究基礎：</strong>Praat軟體聲學分析規範與臨床驗證</p>
                      <p><strong>參考文獻：</strong></p>
                      <div class="reference-citation">
                          Boersma, P., & Weenink, D. (2021). Praat: doing phonetics by computer [Computer program]. Version 6.1.38. <br>
                          Little, M. A., McSharry, P. E., Roberts, S. J., Costello, D. A., & Moroz, I. M. (2007). Exploiting nonlinear recurrence and fractal scaling properties for voice disorder detection. <em>BioMedical Engineering OnLine</em>, 6(1), 23.
                      </div>
                      <span class="evidence-level evidence-high">證據等級：高</span>
                  </div>
                  
                  <div class="reference-item">
                      <h5>5. 共振峰 (F1, F2) 標準</h5>
                      <p><strong>研究基礎：</strong>元音空間分析與構音清晰度研究</p>
                      <p><strong>參考文獻：</strong></p>
                      <div class="reference-citation">
                          Skodda, S., Visser, W., & Schlegel, U. (2011). Vowel articulation in Parkinson's disease. <em>Journal of Voice</em>, 25(4), 467-472.<br>
                          Sapir, S., Ramig, L. O., Spielman, J. L., & Fox, C. (2010). Formant centralization ratio: a proposal for a new acoustic measure of dysarthric speech. <em>Journal of Speech, Language, and Hearing Research</em>, 53(1), 114-125.
                      </div>
                      <span class="evidence-level evidence-moderate">證據等級：中高</span>
                  </div>
                  
                  <div class="reference-item">
                      <h5>6. 語速與停頓模式標準</h5>
                      <p><strong>研究基礎：</strong>帕金森病韻律障礙研究</p>
                      <p><strong>參考文獻：</strong></p>
                      <div class="reference-citation">
                          Skodda, S., Grönheit, W., & Schlegel, U. (2012). Impairment of vowel articulation as a possible marker of disease progression in Parkinson's disease. <em>PLoS ONE</em>, 7(2), e32132.<br>
                          Duez, D. (1982). Silent and non-silent pauses in three speech styles. <em>Language and Speech</em>, 25(1), 11-28.
                      </div>
                      <span class="evidence-level evidence-moderate">證據等級：中</span>
                  </div>
              </div>
          </div>
          
          <div class="reference-card">
              <div class="reference-title">
                  <span>📊</span> 評分系統設計依據
              </div>
              <div class="reference-content">
                  <h4 style="color: #2c3e50; margin-bottom: 15px;">總分100分制設計理念</h4>
                  <table class="standard-table">
                      <tr>
                          <th>評估維度</th>
                          <th>分值</th>
                          <th>權重比例</th>
                          <th>設計依據</th>
                      </tr>
                      <tr>
                          <td>音質參數 (HNR, Jitter, Shimmer)</td>
                          <td>45分</td>
                          <td>45%</td>
                          <td>聲音質量核心指標，最能反映聲帶功能</td>
                      </tr>
                      <tr>
                          <td>音量與音調 (F0, Intensity)</td>
                          <td>20分</td>
                          <td>20%</td>
                          <td>日常溝通最直接影響因素</td>
                      </tr>
                      <tr>
                          <td>構音清晰度 (F1, F2)</td>
                          <td>20分</td>
                          <td>20%</td>
                          <td>語音可懂度關鍵指標</td>
                      </tr>
                      <tr>
                          <td>韻律節奏 (語速, 停頓)</td>
                          <td>15分</td>
                          <td>15%</td>
                          <td>自然度與溝通效率指標</td>
                      </tr>
                  </table>
                  
                  <h4 style="color: #2c3e50; margin: 25px 0 15px 0;">評分等級劃分標準</h4>
                  <table class="standard-table">
                      <tr>
                          <th>總分範圍</th>
                          <th>評估等級</th>
                          <th>臨床意義</th>
                          <th>建議措施</th>
                      </tr>
                      <tr>
                          <td>90-100分</td>
                          <td><span class="evidence-level evidence-high">優秀</span></td>
                          <td>語音功能正常或接近正常</td>
                          <td>維持性訓練，每天15-20分鐘</td>
                      </tr>
                      <tr>
                          <td>75-89分</td>
                          <td><span class="evidence-level evidence-moderate">良好</span></td>
                          <td>輕度語音障礙，日常溝通無礙</td>
                          <td>持續訓練，每2週評估一次</td>
                      </tr>
                      <tr>
                          <td>60-74分</td>
                          <td><span class="evidence-level evidence-low">尚可</span></td>
                          <td>中度語音障礙，部分影響溝通</td>
                          <td>加強訓練，每週評估一次</td>
                      </tr>
                      <tr>
                          <td><60分</td>
                          <td><span class="evidence-level evidence-low">需加強</span></td>
                          <td>重度語音障礙，嚴重影響溝通</td>
                          <td>尋求專業語言治療師協助</td>
                      </tr>
                  </table>
              </div>
          </div>
          
          <div class="reference-card">
              <div class="reference-title">
                  <span>🏥</span> 臨床應用指南
              </div>
              <div class="reference-content">
                  <h4 style="color: #2c3e50; margin-bottom: 15px;">評估頻率建議</h4>
                  <ul style="padding-left: 20px; line-height: 2;">
                      <li><strong>早期患者（H&Y 1-2期）：</strong>每2-4週評估一次</li>
                      <li><strong>中期患者（H&Y 3期）：</strong>每1-2週評估一次</li>
                      <li><strong>晚期患者（H&Y 4-5期）：</strong>每週評估一次</li>
                      <li><strong>治療期間：</strong>治療前、治療中（每週）、治療後追蹤</li>
                  </ul>
                  
                  <h4 style="color: #2c3e50; margin: 25px 0 15px 0;">評估環境要求</h4>
                  <ul style="padding-left: 20px; line-height: 2;">
                      <li><strong>環境噪音：</strong>背景噪音 < 40 dB</li>
                      <li><strong>麥克風距離：</strong>距離口部 30 公分</li>
                      <li><strong>錄音設備：</strong>採樣率 ≥ 44.1 kHz，16-bit以上</li>
                      <li><strong>測試時間：</strong>建議在藥效最佳時段（ON狀態）進行</li>
                      <li><strong>測試內容：</strong>持續元音 /a/ 3-5秒，朗讀標準段落</li>
                  </ul>
                  
                  <h4 style="color: #2c3e50; margin: 25px 0 15px 0;">國際標準參考</h4>
                  <ul style="padding-left: 20px; line-height: 2;">
                      <li><strong>ASHA (美國語言聽力協會)：</strong>語音評估臨床指南</li>
                      <li><strong>ELS (歐洲喉科學會)：</strong>嗓音障礙評估標準</li>
                      <li><strong>MDS (國際運動障礙學會)：</strong>帕金森病非運動症狀評估</li>
                      <li><strong>WHO ICF：</strong>國際功能、失能與健康分類</li>
                  </ul>
              </div>
          </div>
      </div>
      
      <!-- 完整報告區 -->
      <div class="section-card report-section" id="reportSection">
          <div class="report-header">
              <h1 class="report-title">帕金森病語音聲學分析報告</h1>
              <div class="report-meta">
                  <div class="report-meta-item">
                      <div class="report-meta-label">報告編號</div>
                      <div class="report-meta-value" id="reportId">-</div>
                  </div>
                  <div class="report-meta-item">
                      <div class="report-meta-label">評估日期</div>
                      <div class="report-meta-value" id="reportDate">-</div>
                  </div>
                  <div class="report-meta-item">
                      <div class="report-meta-label">評估時間</div>
                      <div class="report-meta-value" id="reportTime">-</div>
                  </div>
                  <div class="report-meta-item">
                      <div class="report-meta-label">音檔時長</div>
                      <div class="report-meta-value" id="reportDuration">-</div>
                  </div>
              </div>
          </div>
          
          <div class="report-score-summary">
              <div class="report-score-label">綜合評分</div>
              <div class="report-total-score" id="reportTotalScore">--</div>
              <div class="report-score-label" id="reportGrade">--</div>
          </div>
          
          <h3 style="color: #2c3e50; margin: 30px 0 15px 0;">📊 詳細評估結果</h3>
          <table class="report-details-table" id="reportDetailsTable">
              <thead>
                  <tr>
                      <th>評估項目</th>
                      <th>測量值</th>
                      <th>正常範圍</th>
                      <th>得分</th>
                      <th>評估</th>
                  </tr>
              </thead>
              <tbody>
                  <!-- 由 JavaScript 動態生成 -->
              </tbody>
          </table>
          
          <div class="report-chart">
              <h3 style="color: #2c3e50; margin-bottom: 15px;">📈 各項指標雷達圖</h3>
              <canvas id="radarChart" style="max-width: 600px; margin: 0 auto;"></canvas>
          </div>
          
          <div class="report-recommendations">
              <h3>💡 個性化訓練建議</h3>
              <ul id="reportRecommendations">
                  <!-- 由 JavaScript 動態生成 -->
              </ul>
          </div>
          
          <div style="margin-top: 30px; padding: 20px; background: #e8f4f8; border-radius: 10px; border-left: 5px solid #3498db;">
              <h4 style="color: #2c3e50; margin-bottom: 10px;">⚠️ 重要提示</h4>
              <p style="line-height: 1.8; color: #5d6d7e;">
                  本報告基於聲學分析提供參考，不能替代專業醫療診斷。建議定期追蹤評估，並在語言治療師指導下進行訓練。如有疑問或症狀惡化，請及時就醫。
              </p>
          </div>
          
          <div class="report-actions">
              <button class="action-btn print" onclick="window.print()">
                  <span>🖨️</span> 列印報告
              </button>
              <button class="action-btn new" onclick="newAssessment()">
                  <span>🔄</span> 新評估
              </button>
          </div>
      </div>
  </div>
  
  <!-- 模態框 -->
  <div class="modal" id="detailModal">
      <div class="modal-content">
          <span class="modal-close" onclick="closeModal()">&times;</span>
          <div id="modalContent"></div>
      </div>
  </div>
  
  <script>
      // 全局變數
      let mediaRecorder;
      let audioChunks = [];
      let recordingStartTime;
      let timerInterval;
      let audioContext;
      let analyser;
      let dataArray;
      let animationId;
      let currentAudioBlob;
      
      // 評估參數配置
      const parameters = {
          f0: {
              name: '基頻 (F0)',
              unit: 'Hz',
              normalRange: { male: [85, 180], female: [165, 255] },
              maxScore: 10,
              icon: '🎵'
          },
          intensity: {
              name: '音量強度',
              unit: 'dB',
              normalRange: [55, 75],
              maxScore: 10,
              icon: '🔊'
          },
          hnr: {
              name: '諧噪比 (HNR)',
              unit: 'dB',
              normalRange: [15, null],
              maxScore: 15,
              icon: '🎼'
          },
          jitter: {
              name: 'Jitter',
              unit: '%',
              normalRange: [0, 1.04],
              maxScore: 15,
              icon: '📉'
          },
          shimmer: {
              name: 'Shimmer',
              unit: '%',
              normalRange: [0, 3.81],
              maxScore: 15,
              icon: '📊'
          },
          f1: {
              name: '第一共振峰 (F1)',
              unit: 'Hz',
              normalRange: [600, 900],
              maxScore: 10,
              icon: '🗣️'
          },
          f2: {
              name: '第二共振峰 (F2)',
              unit: 'Hz',
              normalRange: [1000, 1400],
              maxScore: 10,
              icon: '👄'
          },
          speechRate: {
              name: '語速',
              unit: '音節/分',
              normalRange: [180, 220],
              maxScore: 10,
              icon: '⏱️'
          },
          pause: {
              name: '停頓模式',
              unit: '次/分',
              normalRange: [3, 5],
              maxScore: 5,
              icon: '⏸️'
          }
      };
      
      // 切換參數詳情
      function toggleParameter(paramId) {
          const content = document.getElementById(`content-${paramId}`);
          const toggle = document.getElementById(`toggle-${paramId}`);
          
          if (content.classList.contains('show')) {
              content.classList.remove('show');
              toggle.classList.remove('open');
          } else {
              content.classList.add('show');
              toggle.classList.add('open');
          }
      }
      
      // 開始錄音
      async function startRecording() {
          try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              
              mediaRecorder = new MediaRecorder(stream);
              audioChunks = [];
              
              mediaRecorder.ondataavailable = (event) => {
                  audioChunks.push(event.data);
              };
              
              mediaRecorder.onstop = () => {
                  const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                  currentAudioBlob = audioBlob;
                  const audioUrl = URL.createObjectURL(audioBlob);
                  const audioPlayer = document.getElementById('audioPlayer');
                  audioPlayer.src = audioUrl;
                  audioPlayer.style.display = 'block';
                  
                  document.getElementById('analyzeBtn').style.display = 'inline-flex';
              };
              
              mediaRecorder.start();
              recordingStartTime = Date.now();
              
              // UI更新
              document.getElementById('startRecordBtn').style.display = 'none';
              document.getElementById('stopRecordBtn').style.display = 'inline-flex';
              document.getElementById('recordingStatus').textContent = '🔴 錄音中...';
              document.getElementById('recordingTimer').style.display = 'block';
              
              // 啟動計時器
              startTimer();
              
              // 啟動波形視覺化
              setupAudioVisualization(stream);
              
          } catch (error) {
              alert('無法訪問麥克風，請確認權限設置');
              console.error('錄音錯誤:', error);
          }
      }
      
      // 停止錄音
      function stopRecording() {
          if (mediaRecorder && mediaRecorder.state !== 'inactive') {
              mediaRecorder.stop();
              mediaRecorder.stream.getTracks().forEach(track => track.stop());
              
              clearInterval(timerInterval);
              cancelAnimationFrame(animationId);
              
              document.getElementById('startRecordBtn').style.display = 'inline-flex';
              document.getElementById('stopRecordBtn').style.display = 'none';
              document.getElementById('recordingStatus').textContent = '✅ 錄音完成，可以開始分析';
              document.getElementById('recordingTimer').style.display = 'none';
          }
      }
      
      // 計時器
      function startTimer() {
          timerInterval = setInterval(() => {
              const elapsed = Date.now() - recordingStartTime;
              const seconds = Math.floor(elapsed / 1000);
              const minutes = Math.floor(seconds / 60);
              const displaySeconds = seconds % 60;
              
              document.getElementById('recordingTimer').textContent = 
                  `${String(minutes).padStart(2, '0')}:${String(displaySeconds).padStart(2, '0')}`;
          }, 100);
      }
      
      // 音頻視覺化
      function setupAudioVisualization(stream) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          analyser = audioContext.createAnalyser();
          const source = audioContext.createMediaStreamSource(stream);
          source.connect(analyser);
          
          analyser.fftSize = 2048;
          const bufferLength = analyser.frequencyBinCount;
          dataArray = new Uint8Array(bufferLength);
          
          const canvas = document.getElementById('waveformCanvas');
          const canvasCtx = canvas.getContext('2d');
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;
          
          function draw() {
              animationId = requestAnimationFrame(draw);
              
              analyser.getByteTimeDomainData(dataArray);
              
              canvasCtx.fillStyle = 'rgb(255, 255, 255)';
              canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
              
              canvasCtx.lineWidth = 2;
              canvasCtx.strokeStyle = 'rgb(102, 126, 234)';
              canvasCtx.beginPath();
              
              const sliceWidth = canvas.width / bufferLength;
              let x = 0;
              
              for (let i = 0; i < bufferLength; i++) {
                  const v = dataArray[i] / 128.0;
                  const y = v * canvas.height / 2;
                  
                  if (i === 0) {
                      canvasCtx.moveTo(x, y);
                  } else {
                      canvasCtx.lineTo(x, y);
                  }
                  
                  x += sliceWidth;
              }
              
              canvasCtx.lineTo(canvas.width, canvas.height / 2);
              canvasCtx.stroke();
          }
          
          draw();
      }
      
      // 檔案上傳處理
      function handleFileUpload(event) {
          const file = event.target.files[0];
          if (file) {
              currentAudioBlob = file;
              const audioUrl = URL.createObjectURL(file);
              const audioPlayer = document.getElementById('audioPlayer');
              audioPlayer.src = audioUrl;
              audioPlayer.style.display = 'block';
              
              document.getElementById('recordingStatus').textContent = `✅ 已上傳：${file.name}`;
              document.getElementById('analyzeBtn').style.display = 'inline-flex';
          }
      }
      
      // 拖放上傳
      const fileUploadArea = document.getElementById('fileUploadArea');
      
      fileUploadArea.addEventListener('dragover', (e) => {
          e.preventDefault();
          fileUploadArea.classList.add('dragover');
      });
      
      fileUploadArea.addEventListener('dragleave', () => {
          fileUploadArea.classList.remove('dragover');
      });
      
      fileUploadArea.addEventListener('drop', (e) => {
          e.preventDefault();
          fileUploadArea.classList.remove('dragover');
          
          const file = e.dataTransfer.files[0];
          if (file && file.type.startsWith('audio/')) {
              document.getElementById('fileInput').files = e.dataTransfer.files;
              handleFileUpload({ target: { files: [file] } });
          }
      });
      
      // 分析音頻（模擬）
      function analyzeAudio() {
          if (!currentAudioBlob) {
              alert('請先錄音或上傳音檔');
              return;
          }
          
          // 顯示載入動畫
          document.getElementById('loadingSpinner').style.display = 'block';
          document.getElementById('recordingStatus').textContent = '🔬 分析中，請稍候...';
          
          // 模擬分析過程
          setTimeout(() => {
              const results = generateMockResults();
              displayResults(results);
              
              document.getElementById('loadingSpinner').style.display = 'none';
              document.getElementById('recordingStatus').textContent = '✅ 分析完成';
              document.getElementById('analysisResults').classList.add('show');
              
              // 滾動到結果區
              document.getElementById('analysisResults').scrollIntoView({ behavior: 'smooth' });
          }, 3000);
      }
      
      // 生成模擬結果
      function generateMockResults() {
          return {
              f0: { value: 125, score: 10 },
              intensity: { value: 68, score: 10 },
              hnr: { value: 18.5, score: 15 },
              jitter: { value: 0.85, score: 12 },
              shimmer: { value: 3.2, score: 12 },
              f1: { value: 750, score: 10 },
              f2: { value: 1200, score: 10 },
              speechRate: { value: 195, score: 10 },
              pause: { value: 4, score: 5 }
          };
      }
      
      // 顯示結果
      function displayResults(results) {
          const resultGrid = document.getElementById('resultGrid');
          resultGrid.innerHTML = '';
          
          for (const [key, data] of Object.entries(results)) {
              const param = parameters[key];
              const percentage = (data.score / param.maxScore) * 100;
              let statusClass, statusText;
              
              if (percentage >= 90) {
                  statusClass = 'status-excellent';
                  statusText = '優秀';
              } else if (percentage >= 75) {
                  statusClass = 'status-good';
                  statusText = '良好';
              } else if (percentage >= 60) {
                  statusClass = 'status-fair';
                  statusText = '尚可';
              } else {
                  statusClass = 'status-poor';
                  statusText = '需加強';
              }
              
              const card = document.createElement('div');
              card.className = 'result-card';
              card.onclick = () => showParameterDetail(key);
              card.innerHTML = `
                  <div style="font-size: 2.5em; margin-bottom: 10px;">${param.icon}</div>
                  <div class="result-card-title">${param.name}</div>
                  <div class="result-card-value">${data.value} ${param.unit}</div>
                  <div class="progress-bar">
                      <div class="progress-fill" style="width: ${percentage}%">${data.score}/${param.maxScore}</div>
                  </div>
                  <div class="result-card-status ${statusClass}">${statusText}</div>
              `;
              
              resultGrid.appendChild(card);
          }
          
          // 儲存結果供報告使用
          window.currentResults = results;
      }
      
      // 顯示參數詳情
      function showParameterDetail(paramKey) {
          const paramElement = document.getElementById(`content-${paramKey}`);
          if (paramElement) {
              paramElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
              
              // 如果未展開則展開
              if (!paramElement.classList.contains('show')) {
                  toggleParameter(paramKey);
              }
              
              // 高亮效果
              const detailElement = paramElement.parentElement;
              detailElement.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.5)';
              setTimeout(() => {
                  detailElement.style.boxShadow = '';
              }, 2000);
          }
      }
      
      // 生成完整報告
      function generateReport() {
          if (!window.currentResults) {
              alert('請先進行音頻分析');
              return;
          }
          
          const results = window.currentResults;
          const now = new Date();
          
          // 填充報告基本信息
          document.getElementById('reportId').textContent = `PD-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}`;
          document.getElementById('reportDate').textContent = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日`;
          document.getElementById('reportTime').textContent = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
          document.getElementById('reportDuration').textContent = '5秒';
          
          // 計算總分
          let totalScore = 0;
          for (const data of Object.values(results)) {
              totalScore += data.score;
          }
          
          document.getElementById('reportTotalScore').textContent = totalScore;
          
          let grade, gradeColor;
          if (totalScore >= 90) {
              grade = '優秀 - 語音功能正常';
              gradeColor = '#27ae60';
          } else if (totalScore >= 75) {
              grade = '良好 - 輕度語音障礙';
              gradeColor = '#2980b9';
          } else if (totalScore >= 60) {
              grade = '尚可 - 中度語音障礙';
              gradeColor = '#f39c12';
          } else {
              grade = '需加強 - 重度語音障礙';
              gradeColor = '#e74c3c';
          }
          
          const gradeElement = document.getElementById('reportGrade');
          gradeElement.textContent = grade;
          gradeElement.style.color = gradeColor;
          
          // 填充詳細結果表格
          const tbody = document.querySelector('#reportDetailsTable tbody');
          tbody.innerHTML = '';
          
          for (const [key, data] of Object.entries(results)) {
              const param = parameters[key];
              const percentage = (data.score / param.maxScore) * 100;
              let assessment;
              
              if (percentage >= 90) assessment = '優秀';
              else if (percentage >= 75) assessment = '良好';
              else if (percentage >= 60) assessment = '尚可';
              else assessment = '需加強';
              
              let normalRangeText;
              if (Array.isArray(param.normalRange)) {
                  normalRangeText = `${param.normalRange[0]}-${param.normalRange[1]} ${param.unit}`;
              } else if (param.normalRange[1] === null) {
                  normalRangeText = `≥ ${param.normalRange[0]} ${param.unit}`;
              }
              
              const row = tbody.insertRow();
              row.innerHTML = `
                  <td>${param.icon} ${param.name}</td>
                  <td><strong>${data.value} ${param.unit}</strong></td>
                  <td>${normalRangeText}</td>
                  <td><strong>${data.score}/${param.maxScore}</strong></td>
                  <td>${assessment}</td>
              `;
          }
          
          // 生成個性化建議
          generateRecommendations(results);
          
          // 顯示報告區
          document.getElementById('reportSection').classList.add('show');
          document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
          
          // 繪製雷達圖
          setTimeout(() => drawRadarChart(results), 500);
      }
      
      // 生成個性化建議
      function generateRecommendations(results) {
          const recommendations = [];
          
          if (results.intensity.score < 7) {
              recommendations.push('音量偏小：建議進行LSVT LOUD療法訓練，每天大聲朗讀15-20分鐘');
          }
          
          if (results.hnr.score < 12) {
              recommendations.push('音質欠佳：建議進行聲帶閉合訓練和共鳴練習，保持聲帶濕潤');
          }
          
          if (results.jitter.score < 12 || results.shimmer.score < 12) {
              recommendations.push('聲音穩定性不足：建議進行持續發音練習和呼吸控制訓練');
          }
          
          if (results.f1.score < 7 || results.f2.score < 7) {
              recommendations.push('構音清晰度待改善：建議進行元音誇張練習和舌頭運動訓練');
          }
          
          if (results.speechRate.score < 7) {
              recommendations.push('語速異常：建議使用節拍器訓練，練習穩定的說話節奏');
          }
          
          if (recommendations.length === 0) {
              recommendations.push('整體表現優秀！建議繼續保持，每天進行15-20分鐘維持性訓練');
          }
          
          recommendations.push('定期追蹤評估，記錄訓練進展');
          recommendations.push('如有疑問，請諮詢語言治療師');
          
          const ul = document.getElementById('reportRecommendations');
          ul.innerHTML = '';
          recommendations.forEach(rec => {
              const li = document.createElement('li');
              li.textContent = rec;
              ul.appendChild(li);
          });
      }
      
      // 繪製雷達圖（簡化版）
      function drawRadarChart(results) {
          const canvas = document.getElementById('radarChart');
          const ctx = canvas.getContext('2d');
          
          canvas.width = 500;
          canvas.height = 500;
          
          const centerX = canvas.width / 2;
          const centerY = canvas.height / 2;
          const radius = 180;
          
          // 清空畫布
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          
          // 繪製背景網格
          ctx.strokeStyle = '#e0e0e0';
          ctx.lineWidth = 1;
          for (let i = 1; i <= 5; i++) {
              ctx.beginPath();
              ctx.arc(centerX, centerY, radius * i / 5, 0, 2 * Math.PI);
              ctx.stroke();
          }
          
          // 繪製軸線和標籤
          const labels = Object.keys(results);
          const angleStep = (2 * Math.PI) / labels.length;
          
          ctx.fillStyle = '#2c3e50';
          ctx.font = '14px Arial';
          ctx.textAlign = 'center';
          
          labels.forEach((key, index) => {
              const angle = angleStep * index - Math.PI / 2;
              const x = centerX + radius * Math.cos(angle);
              const y = centerY + radius * Math.sin(angle);
              
              // 繪製軸線
              ctx.beginPath();
              ctx.moveTo(centerX, centerY);
              ctx.lineTo(x, y);
              ctx.strokeStyle = '#e0e0e0';
              ctx.stroke();
              
              // 繪製標籤
              const labelX = centerX + (radius + 30) * Math.cos(angle);
              const labelY = centerY + (radius + 30) * Math.sin(angle);
              ctx.fillText(parameters[key].name, labelX, labelY);
          });
          
          // 繪製數據
          ctx.beginPath();
          ctx.strokeStyle = '#667eea';
          ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
          ctx.lineWidth = 2;
          
          labels.forEach((key, index) => {
              const param = parameters[key];
              const percentage = results[key].score / param.maxScore;
              const angle = angleStep * index - Math.PI / 2;
              const x = centerX + radius * percentage * Math.cos(angle);
              const y = centerY + radius * percentage * Math.sin(angle);
              
              if (index === 0) {
                  ctx.moveTo(x, y);
              } else {
                  ctx.lineTo(x, y);
              }
          });
          
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
          
          // 繪製數據點
          labels.forEach((key, index) => {
              const param = parameters[key];
              const percentage = results[key].score / param.maxScore;
              const angle = angleStep * index - Math.PI / 2;
              const x = centerX + radius * percentage * Math.cos(angle);
              const y = centerY + radius * percentage * Math.sin(angle);
              
              ctx.beginPath();
              ctx.arc(x, y, 5, 0, 2 * Math.PI);
              ctx.fillStyle = '#667eea';
              ctx.fill();
          });
      }
      
      // 下載報告
      function downloadReport() {
          alert('PDF下載功能開發中...\n\n目前可使用「列印報告」功能，選擇「另存為PDF」');
      }
      
      // 郵件發送
      function emailReport() {
          const email = prompt('請輸入接收報告的郵箱地址：');
          if (email) {
              alert(`報告將發送至：${email}\n\n（此為演示功能）`);
          }
      }
      
      // 新評估
      function newAssessment() {
          if (confirm('確定要開始新的評估嗎？當前結果將被清除。')) {
              location.reload();
          }
      }
      
      // 關閉模態框
      function closeModal() {
          document.getElementById('detailModal').classList.remove('show');
      }
      
      // 點擊模態框外部關閉
      window.onclick = function(event) {
          const modal = document.getElementById('detailModal');
          if (event.target === modal) {
              closeModal();
          }
      }
      
      // 頁面載入完成
      window.addEventListener('load', () => {
          console.log('帕金森病語音聲學分析評估系統已載入');
      });
  </script>
  </body>
</html>


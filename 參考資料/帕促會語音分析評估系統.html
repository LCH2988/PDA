<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>帕金森病語音分析評估系統 - 國家標準版</title>
<style>
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }
  
  body {
      font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      color: #2d3748;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
  }
  
  .container {
      max-width: 1400px;
      margin: 0 auto;
  }
  
  .header {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-align: center;
      position: relative;
  }
  
  .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
      border-radius: 20px 20px 0 0;
  }
  
  .header h1 {
      color: #4a5568;
      font-size: 2.2em;
      margin-bottom: 10px;
      font-weight: 700;
  }
  
  .header .subtitle {
      color: #718096;
      font-size: 1.1em;
      font-weight: 500;
  }
  
  .certification-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      display: inline-block;
      font-size: 0.9em;
      font-weight: 600;
      margin-top: 15px;
  }
  
  .nav-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 30px;
      justify-content: center;
  }
  
  .nav-tab {
      background: white;
      border: none;
      padding: 15px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
  }
  
  .nav-tab:hover, .nav-tab.active {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.2);
  }
  
  .content-section {
      display: none;
  }
  
  .content-section.active {
      display: block;
  }
  
  .assessment-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 25px;
  }
  
  .card-title {
      color: #667eea;
      font-size: 1.8em;
      font-weight: 700;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 3px solid #667eea;
  }
  
  .form-group {
      margin-bottom: 25px;
  }
  
  .form-label {
      display: block;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 1.1em;
  }
  
  .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s ease;
  }
  
  .form-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
  }
  
  .assessment-section {
      background: #f7fafc;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border-left: 5px solid #667eea;
  }
  
  .section-title {
      color: #667eea;
      font-size: 1.4em;
      font-weight: 700;
      margin-bottom: 20px;
  }
  
  .measurement-item {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }
  
  .measurement-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
  }
  
  .measurement-name {
      font-weight: 600;
      color: #2d3748;
      font-size: 1.1em;
  }
  
  .standard-badge {
      background: #e6fffa;
      color: #2c7a7b;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.85em;
      font-weight: 600;
  }
  
  .measurement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
  }
  
  .measurement-field {
      display: flex;
      flex-direction: column;
  }
  
  .field-label {
      font-size: 0.9em;
      color: #718096;
      margin-bottom: 5px;
      font-weight: 500;
  }
  
  .field-input {
      padding: 10px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1em;
  }
  
  .field-input:focus {
      outline: none;
      border-color: #667eea;
  }
  
  .comparison-box {
      background: linear-gradient(135deg, #e6f3ff 0%, #cce7ff 100%);
      border: 2px solid #3182ce;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
  }
  
  .comparison-title {
      color: #2b6cb0;
      font-weight: 700;
      margin-bottom: 10px;
  }
  
  .comparison-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: white;
      border-radius: 8px;
      margin-top: 10px;
  }
  
  .result-label {
      font-weight: 600;
      color: #2d3748;
  }
  
  .result-value {
      font-size: 1.2em;
      font-weight: 700;
  }
  
  .result-normal { color: #22543d; }
  .result-mild { color: #c05621; }
  .result-moderate { color: #c53030; }
  .result-severe { color: #742a2a; }
  
  .rating-scale {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 10px;
  }
  
  .rating-option {
      display: flex;
      align-items: center;
      gap: 8px;
  }
  
  .rating-option input[type="radio"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
  }
  
  .rating-option label {
      cursor: pointer;
      font-weight: 500;
  }
  
  .standard-reference {
      background: #fffaf0;
      border: 2px dashed #ed8936;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
  }
  
  .reference-title {
      color: #c05621;
      font-weight: 700;
      font-size: 1.2em;
      margin-bottom: 15px;
  }
  
  .reference-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
  }
  
  .reference-table th,
  .reference-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
  }
  
  .reference-table th {
      background: #f7fafc;
      font-weight: 700;
      color: #2d3748;
  }
  
  .reference-table tr:hover {
      background: #f7fafc;
  }
  
  .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }
  
  .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.25);
  }
  
  .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      padding: 12px 25px;
      border-radius: 25px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 10px;
  }
  
  .btn-secondary:hover {
      background: #667eea;
      color: white;
  }
  
  .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      justify-content: center;
      flex-wrap: wrap;
  }
  
  .report-preview {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 15px;
      padding: 30px;
      margin-top: 30px;
  }
  
  .report-header {
      text-align: center;
      border-bottom: 3px solid #667eea;
      padding-bottom: 20px;
      margin-bottom: 30px;
  }
  
  .report-title {
      font-size: 2em;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 10px;
  }
  
  .report-subtitle {
      color: #718096;
      font-size: 1.1em;
  }
  
  .report-section {
      margin-bottom: 30px;
  }
  
  .report-section-title {
      background: #667eea;
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 1.3em;
      font-weight: 700;
      margin-bottom: 20px;
  }
  
  .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
  }
  
  .data-card {
      background: #f7fafc;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
  }
  
  .data-label {
      color: #718096;
      font-size: 0.9em;
      margin-bottom: 5px;
  }
  
  .data-value {
      color: #2d3748;
      font-size: 1.3em;
      font-weight: 700;
  }
  
  .chart-container {
      background: white;
      padding: 25px;
      border-radius: 15px;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }
  
  .chart-title {
      font-size: 1.2em;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 20px;
      text-align: center;
  }
  
  .progress-bar-container {
      margin: 15px 0;
  }
  
  .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-weight: 600;
  }
  
  .progress-bar {
      width: 100%;
      height: 30px;
      background: #e2e8f0;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
  }
  
  .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 15px;
      transition: width 1s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      color: white;
      font-weight: 700;
  }
  
  .recommendation-box {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      border: 2px solid #ed8936;
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
  }
  
  .recommendation-title {
      color: #c05621;
      font-size: 1.4em;
      font-weight: 700;
      margin-bottom: 15px;
  }
  
  .recommendation-list {
      list-style: none;
      padding: 0;
  }
  
  .recommendation-list li {
      padding: 12px 0;
      border-bottom: 1px solid rgba(237, 137, 54, 0.2);
      font-weight: 500;
      color: #744210;
  }
  
  .recommendation-list li:before {
      content: '✓';
      color: #c05621;
      font-weight: 700;
      margin-right: 10px;
  }
  
  .signature-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid #e2e8f0;
  }
  
  .signature-box {
      text-align: center;
  }
  
  .signature-line {
      border-top: 2px solid #2d3748;
      margin: 40px 20px 10px;
  }
  
  .signature-label {
      color: #718096;
      font-size: 0.9em;
  }
  
  @media print {
      body {
          background: white;
          padding: 0;
      }
      
      .nav-tabs,
      .button-group,
      .btn-primary,
      .btn-secondary {
          display: none;
      }
      
      .assessment-card {
          box-shadow: none;
          page-break-inside: avoid;
      }
  }
  
  @media (max-width: 768px) {
      .form-row {
          grid-template-columns: 1fr;
      }
      
      .measurement-grid {
          grid-template-columns: 1fr;
      }
      
      .data-grid {
          grid-template-columns: 1fr;
      }
      
      .signature-section {
          grid-template-columns: 1fr;
      }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
      <h1>🏥 帕金森病語音分析評估系統</h1>
      <div class="subtitle">依據衛生福利部語言治療標準作業規範</div>
      <div class="certification-badge">符合國家醫療品質標準 | ISO 9001認證</div>
  </div>
  
  <div class="nav-tabs">
      <button class="nav-tab active" onclick="showSection('basic-info')">基本資料</button>
      <button class="nav-tab" onclick="showSection('acoustic')">聲學參數評估</button>
      <button class="nav-tab" onclick="showSection('perceptual')">知覺評估</button>
      <button class="nav-tab" onclick="showSection('functional')">功能性評估</button>
      <button class="nav-tab" onclick="showSection('report')">評估報告</button>
  </div>
  
  <!-- 基本資料 -->
  <div id="basic-info" class="content-section active">
      <div class="assessment-card">
          <h2 class="card-title">📋 受評者基本資料</h2>
          
          <div class="form-row">
              <div class="form-group">
                  <label class="form-label">姓名</label>
                  <input type="text" class="form-input" id="patientName" placeholder="請輸入姓名">
              </div>
              
              <div class="form-group">
                  <label class="form-label">病歷號</label>
                  <input type="text" class="form-input" id="patientID" placeholder="請輸入病歷號">
              </div>
              
              <div class="form-group">
                  <label class="form-label">性別</label>
                  <select class="form-input" id="gender">
                      <option value="">請選擇</option>
                      <option value="male">男性</option>
                      <option value="female">女性</option>
                  </select>
              </div>
              
              <div class="form-group">
                  <label class="form-label">出生日期</label>
                  <input type="date" class="form-input" id="birthDate">
              </div>
          </div>
          
          <div class="form-row">
              <div class="form-group">
                  <label class="form-label">診斷日期</label>
                  <input type="date" class="form-input" id="diagnosisDate">
              </div>
              
              <div class="form-group">
                  <label class="form-label">評估日期</label>
                  <input type="date" class="form-input" id="assessmentDate">
              </div>
              
              <div class="form-group">
                  <label class="form-label">評估次數</label>
                  <select class="form-input" id="assessmentNumber">
                      <option value="baseline">基線評估</option>
                      <option value="week1">第1週</option>
                      <option value="week2">第2週</option>
                      <option value="week3">第3週</option>
                      <option value="week4">第4週</option>
                      <option value="followup">追蹤評估</option>
                  </select>
              </div>
              
              <div class="form-group">
                  <label class="form-label">Hoehn-Yahr分期</label>
                  <select class="form-input" id="hohenYahr">
                      <option value="">請選擇</option>
                      <option value="1">第1期</option>
                      <option value="1.5">第1.5期</option>
                      <option value="2">第2期</option>
                      <option value="2.5">第2.5期</option>
                      <option value="3">第3期</option>
                      <option value="4">第4期</option>
                      <option value="5">第5期</option>
                  </select>
              </div>
          </div>
          
          <div class="form-group">
              <label class="form-label">主要主訴</label>
              <textarea class="form-input" id="chiefComplaint" rows="3" placeholder="請描述主要語言溝通困難..."></textarea>
          </div>
          
          <div class="form-group">
              <label class="form-label">目前用藥</label>
              <textarea class="form-input" id="medications" rows="2" placeholder="請列出目前使用的帕金森病相關藥物..."></textarea>
          </div>
      </div>
  </div>
  
  <!-- 聲學參數評估 -->
  <div id="acoustic" class="content-section">
      <div class="assessment-card">
          <h2 class="card-title">🔊 聲學參數評估（依據國家標準）</h2>
          
          <div class="standard-reference">
              <div class="reference-title">📊 國家標準參考值</div>
              <p style="color: #744210; margin-bottom: 15px;">依據衛生福利部「語言治療服務標準作業規範」及台灣語言治療學會制定之標準</p>
              
              <table class="reference-table">
                  <thead>
                      <tr>
                          <th>評估項目</th>
                          <th>正常範圍（男性）</th>
                          <th>正常範圍（女性）</th>
                          <th>測量單位</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td>基本頻率 (F0)</td>
                          <td>100-150 Hz</td>
                          <td>180-250 Hz</td>
                          <td>赫茲 (Hz)</td>
                      </tr>
                      <tr>
                          <td>音量 (SPL)</td>
                          <td>65-75 dB</td>
                          <td>60-70 dB</td>
                          <td>分貝 (dB)</td>
                      </tr>
                      <tr>
                          <td>最大發聲時間 (MPT)</td>
                          <td>≥ 20秒</td>
                          <td>≥ 15秒</td>
                          <td>秒 (s)</td>
                      </tr>
                      <tr>
                          <td>嗓音擾動 (Jitter)</td>
                          <td colspan="2">< 1.04%</td>
                          <td>百分比 (%)</td>
                      </tr>
                      <tr>
                          <td>振幅擾動 (Shimmer)</td>
                          <td colspan="2">< 3.81%</td>
                          <td>百分比 (%)</td>
                      </tr>
                      <tr>
                          <td>諧噪比 (HNR)</td>
                          <td colspan="2">≥ 20 dB</td>
                          <td>分貝 (dB)</td>
                      </tr>
                  </tbody>
              </table>
          </div>
          
          <!-- 基本頻率評估 -->
          <div class="assessment-section">
              <h3 class="section-title">1. 基本頻率 (Fundamental Frequency, F0)</h3>
              
              <div class="measurement-item">
                  <div class="measurement-header">
                      <span class="measurement-name">持續母音 /a/ 發聲</span>
                      <span class="standard-badge">國家標準項目</span>
                  </div>
                  
                  <div class="measurement-grid">
                      <div class="measurement-field">
                          <label class="field-label">平均基本頻率 (Hz)</label>
                          <input type="number" class="field-input" id="f0_mean" step="0.1" oninput="calculateF0Status()">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">標準差 (Hz)</label>
                          <input type="number" class="field-input" id="f0_sd" step="0.1">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">最低頻率 (Hz)</label>
                          <input type="number" class="field-input" id="f0_min" step="0.1">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">最高頻率 (Hz)</label>
                          <input type="number" class="field-input" id="f0_max" step="0.1">
                      </div>
                  </div>
                  
                  <div class="comparison-box" id="f0_comparison" style="display:none;">
                      <div class="comparison-title">與標準值比較</div>
                      <div class="comparison-result">
                          <span class="result-label">評估結果：</span>
                          <span class="result-value" id="f0_status"></span>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- 音量評估 -->
          <div class="assessment-section">
              <h3 class="section-title">2. 聲音響度 (Sound Pressure Level, SPL)</h3>
              
              <div class="measurement-item">
                  <div class="measurement-header">
                      <span class="measurement-name">標準化音量測量</span>
                      <span class="standard-badge">距離30公分測量</span>
                  </div>
                  
                  <div class="measurement-grid">
                      <div class="measurement-field">
                          <label class="field-label">舒適音量 (dB)</label>
                          <input type="number" class="field-input" id="spl_comfortable" step="0.1" oninput="calculateSPLStatus()">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">最大音量 (dB)</label>
                          <input type="number" class="field-input" id="spl_max" step="0.1">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">最小音量 (dB)</label>
                          <input type="number" class="field-input" id="spl_min" step="0.1">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">動態範圍 (dB)</label>
                          <input type="number" class="field-input" id="spl_range" step="0.1">
                      </div>
                  </div>
                  
                  <div class="comparison-box" id="spl_comparison" style="display:none;">
                      <div class="comparison-title">與標準值比較</div>
                      <div class="comparison-result">
                          <span class="result-label">評估結果：</span>
                          <span class="result-value" id="spl_status"></span>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- 最大發聲時間 -->
          <div class="assessment-section">
              <h3 class="section-title">3. 最大發聲時間 (Maximum Phonation Time, MPT)</h3>
              
              <div class="measurement-item">
                  <div class="measurement-header">
                      <span class="measurement-name">持續母音發聲測試</span>
                      <span class="standard-badge">測量3次取平均</span>
                  </div>
                  
                  <div class="measurement-grid">
                      <div class="measurement-field">
                          <label class="field-label">第1次 (秒)</label>
                          <input type="number" class="field-input" id="mpt_1" step="0.1" oninput="calculateMPT()">
                      </div>
                      
                      <div class="measurement-field">
                          <label class="field-label">第2次 (秒)</label>
                            <input type="number" class="field-input" id="mpt_2" step="0.1" oninput="calculateMPT()">
                        </div>
                        
                        <div class="measurement-field">
                            <label class="field-label">第3次 (秒)</label>
                            <input type="number" class="field-input" id="mpt_3" step="0.1" oninput="calculateMPT()">
                        </div>
                        
                        <div class="measurement-field">
                            <label class="field-label">平均值 (秒)</label>
                            <input type="number" class="field-input" id="mpt_avg" step="0.1" readonly style="background:#f7fafc;">
                        </div>
                    </div>
                    
                    <div class="comparison-box" id="mpt_comparison" style="display:none;">
                        <div class="comparison-title">與標準值比較</div>
                        <div class="comparison-result">
                            <span class="result-label">評估結果：</span>
                            <span class="result-value" id="mpt_status"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 嗓音品質參數 -->
            <div class="assessment-section">
                <h3 class="section-title">4. 嗓音品質參數 (Voice Quality Parameters)</h3>
                
                <div class="measurement-item">
                    <div class="measurement-header">
                        <span class="measurement-name">Jitter (嗓音擾動)</span>
                        <span class="standard-badge">正常值 < 1.04%</span>
                    </div>
                    
                    <div class="measurement-grid">
                        <div class="measurement-field">
                            <label class="field-label">Jitter (%)</label>
                            <input type="number" class="field-input" id="jitter" step="0.01" oninput="calculateJitterStatus()">
                        </div>
                        
                        <div class="measurement-field">
                            <label class="field-label">Jitter (absolute)</label>
                            <input type="number" class="field-input" id="jitter_abs" step="0.001">
                        </div>
                    </div>
                    
                    <div class="comparison-box" id="jitter_comparison" style="display:none;">
                        <div class="comparison-title">與標準值比較</div>
                        <div class="comparison-result">
                            <span class="result-label">評估結果：</span>
                            <span class="result-value" id="jitter_status"></span>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-header">
                        <span class="measurement-name">Shimmer (振幅擾動)</span>
                        <span class="standard-badge">正常值 < 3.81%</span>
                    </div>
                    
                    <div class="measurement-grid">
                        <div class="measurement-field">
                            <label class="field-label">Shimmer (%)</label>
                            <input type="number" class="field-input" id="shimmer" step="0.01" oninput="calculateShimmerStatus()">
                        </div>
                        
                        <div class="measurement-field">
                            <label class="field-label">Shimmer (dB)</label>
                            <input type="number" class="field-input" id="shimmer_db" step="0.01">
                        </div>
                    </div>
                    
                    <div class="comparison-box" id="shimmer_comparison" style="display:none;">
                        <div class="comparison-title">與標準值比較</div>
                        <div class="comparison-result">
                            <span class="result-label">評估結果：</span>
                            <span class="result-value" id="shimmer_status"></span>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-header">
                        <span class="measurement-name">HNR (諧噪比)</span>
                        <span class="standard-badge">正常值 ≥ 20 dB</span>
                    </div>
                    
                    <div class="measurement-grid">
                        <div class="measurement-field">
                            <label class="field-label">HNR (dB)</label>
                            <input type="number" class="field-input" id="hnr" step="0.1" oninput="calculateHNRStatus()">
                        </div>
                        
                        <div class="measurement-field">
                            <label class="field-label">NHR (噪諧比)</label>
                            <input type="number" class="field-input" id="nhr" step="0.001">
                        </div>
                    </div>
                    
                    <div class="comparison-box" id="hnr_comparison" style="display:none;">
                        <div class="comparison-title">與標準值比較</div>
                        <div class="comparison-result">
                            <span class="result-label">評估結果：</span>
                            <span class="result-value" id="hnr_status"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 知覺評估 -->
    <div id="perceptual" class="content-section">
        <div class="assessment-card">
            <h2 class="card-title">👂 知覺評估（GRBAS量表 + 國家標準）</h2>
            
            <div class="standard-reference">
                <div class="reference-title">📋 GRBAS評估標準</div>
                <p style="color: #744210; margin-bottom: 10px;">依據日本耳鼻喉科學會制定，國際通用之嗓音知覺評估量表</p>
                <p style="color: #744210;"><strong>評分標準：</strong> 0=正常、1=輕度、2=中度、3=重度</p>
            </div>
            
            <div class="assessment-section">
                <h3 class="section-title">GRBAS量表評估</h3>
                
                <div class="measurement-item">
                    <div class="measurement-name">G (Grade) - 整體嚴重度</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="grbas_g" value="0" id="g0">
                            <label for="g0">0 - 正常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_g" value="1" id="g1">
                            <label for="g1">1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_g" value="2" id="g2">
                            <label for="g2">2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_g" value="3" id="g3">
                            <label for="g3">3 - 重度</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">R (Roughness) - 粗糙度</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="grbas_r" value="0" id="r0">
                            <label for="r0">0 - 正常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_r" value="1" id="r1">
                            <label for="r1">1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_r" value="2" id="r2">
                            <label for="r2">2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_r" value="3" id="r3">
                            <label for="r3">3 - 重度</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">B (Breathiness) - 氣息聲</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="grbas_b" value="0" id="b0">
                            <label for="b0">0 - 正常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_b" value="1" id="b1">
                            <label for="b1">1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_b" value="2" id="b2">
                            <label for="b2">2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_b" value="3" id="b3">
                            <label for="b3">3 - 重度</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">A (Asthenia) - 無力度</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="grbas_a" value="0" id="a0">
                            <label for="a0">0 - 正常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_a" value="1" id="a1">
                            <label for="a1">1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_a" value="2" id="a2">
                            <label for="a2">2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_a" value="3" id="a3">
                            <label for="a3">3 - 重度</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">S (Strain) - 緊張度</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="grbas_s" value="0" id="s0">
                            <label for="s0">0 - 正常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_s" value="1" id="s1">
                            <label for="s1">1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_s" value="2" id="s2">
                            <label for="s2">2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="grbas_s" value="3" id="s3">
                            <label for="s3">3 - 重度</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="assessment-section">
                <h3 class="section-title">帕金森病特定語音特徵評估</h3>
                
                <div class="measurement-item">
                    <div class="measurement-name">音量減弱 (Hypophonia)</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="hypophonia" value="0">
                            <label>0 - 無</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="hypophonia" value="1">
                            <label>1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="hypophonia" value="2">
                            <label>2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="hypophonia" value="3">
                            <label>3 - 重度</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">單調語調 (Monopitch)</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="monopitch" value="0">
                            <label>0 - 無</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="monopitch" value="1">
                            <label>1 - 輕度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="monopitch" value="2">
                            <label>2 - 中度</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="monopitch" value="3">
                            <label>3 - 重度</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">語速異常 (Rate Abnormality)</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="rate" value="0">
                            <label>0 - 正常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="rate" value="1">
                            <label>1 - 略快/略慢</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="rate" value="2">
                            <label>2 - 明顯異常</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="rate" value="3">
                            <label>3 - 嚴重異常</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">構音不清 (Imprecise Articulation)</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="articulation" value="0">
                            <label>0 - 清晰</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="articulation" value="1">
                            <label>1 - 輕度不清</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="articulation" value="2">
                            <label>2 - 中度不清</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="articulation" value="3">
                            <label>3 - 重度不清</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 功能性評估 -->
    <div id="functional" class="content-section">
        <div class="assessment-card">
            <h2 class="card-title">💬 功能性溝通評估</h2>
            
            <div class="standard-reference">
                <div class="reference-title">📋 評估標準說明</div>
                <p style="color: #744210;">依據「國際功能、失能與健康分類系統」(ICF) 及台灣語言治療學會制定之功能性評估標準</p>
            </div>
            
            <div class="assessment-section">
                <h3 class="section-title">語音清晰度評估</h3>
                
                <div class="measurement-item">
                    <div class="measurement-name">詞彙層次清晰度</div>
                    <div class="measurement-grid">
                        <div class="measurement-field">
                            <label class="field-label">測試詞彙數</label>
                            <input type="number" class="field-input" id="word_total" value="50">
                        </div>
                        <div class="measurement-field">
                            <label class="field-label">正確辨識數</label>
                            <input type="number" class="field-input" id="word_correct" oninput="calculateWordClarity()">
                        </div>
                        <div class="measurement-field">
                            <label class="field-label">清晰度百分比</label>
                            <input type="number" class="field-input" id="word_clarity" readonly style="background:#f7fafc;">
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">句子層次清晰度</div>
                    <div class="measurement-grid">
                        <div class="measurement-field">
                            <label class="field-label">測試句子數</label>
                            <input type="number" class="field-input" id="sentence_total" value="20">
                        </div>
                        <div class="measurement-field">
                            <label class="field-label">完全理解數</label>
                            <input type="number" class="field-input" id="sentence_correct" oninput="calculateSentenceClarity()">
                        </div>
                        <div class="measurement-field">
                            <label class="field-label">可懂度百分比</label>
                            <input type="number" class="field-input" id="sentence_clarity" readonly style="background:#f7fafc;">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="assessment-section">
                <h3 class="section-title">溝通效能評估 (CETI改編版)</h3>
                
                <div class="measurement-item">
                    <div class="measurement-name">日常對話能力</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="daily_conv" value="1">
                            <label>1 - 完全無法</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="daily_conv" value="2">
                            <label>2 - 非常困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="daily_conv" value="3">
                            <label>3 - 有些困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="daily_conv" value="4">
                            <label>4 - 略有困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="daily_conv" value="5">
                            <label>5 - 完全正常</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">電話溝通能力</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="phone_comm" value="1">
                            <label>1 - 完全無法</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="phone_comm" value="2">
                            <label>2 - 非常困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="phone_comm" value="3">
                            <label>3 - 有些困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="phone_comm" value="4">
                            <label>4 - 略有困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="phone_comm" value="5">
                            <label>5 - 完全正常</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">公共場所溝通</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="public_comm" value="1">
                            <label>1 - 完全無法</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="public_comm" value="2">
                            <label>2 - 非常困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="public_comm" value="3">
                            <label>3 - 有些困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="public_comm" value="4">
                            <label>4 - 略有困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="public_comm" value="5">
                            <label>5 - 完全正常</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">表達需求能力</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="express_needs" value="1">
                            <label>1 - 完全無法</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="express_needs" value="2">
                            <label>2 - 非常困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="express_needs" value="3">
                            <label>3 - 有些困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="express_needs" value="4">
                            <label>4 - 略有困難</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="express_needs" value="5">
                            <label>5 - 完全正常</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="assessment-section">
                <h3 class="section-title">生活品質影響評估 (V-RQOL改編)</h3>
                
                <div class="measurement-item">
                    <div class="measurement-name">語音問題對社交的影響</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="social_impact" value="1">
                            <label>1 - 嚴重影響</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="social_impact" value="2">
                            <label>2 - 中度影響</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="social_impact" value="3">
                            <label>3 - 輕度影響</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="social_impact" value="4">
                            <label>4 - 極輕微影響</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="social_impact" value="5">
                            <label>5 - 無影響</label>
                        </div>
                    </div>
                </div>
                
                <div class="measurement-item">
                    <div class="measurement-name">語音問題造成的心理壓力</div>
                    <div class="rating-scale">
                        <div class="rating-option">
                            <input type="radio" name="psychological" value="1">
                            <label>1 - 極大壓力</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="psychological" value="2">
                            <label>2 - 中度壓力</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="psychological" value="3">
                            <label>3 - 輕度壓力</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="psychological" value="4">
                            <label>4 - 極輕微壓力</label>
                        </div>
                        <div class="rating-option">
                            <input type="radio" name="psychological" value="5">
                            <label>5 - 無壓力</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">臨床觀察與備註</label>
                <textarea class="form-input" id="clinical_notes" rows="5" placeholder="請記錄評估過程中的重要觀察、患者表現、特殊狀況等..."></textarea>
            </div>
        </div>
    </div>
    
    <!-- 評估報告 -->
    <div id="report" class="content-section">
        <div class="assessment-card">
            <h2 class="card-title">📄 語音分析評估報告</h2>
            
            <div class="button-group">
                <button class="btn-primary" onclick="generateReport()">🔄 生成完整報告</button>
                <button class="btn-secondary" onclick="window.print()">🖨️ 列印報告</button>
                <button class="btn-secondary" onclick="saveReport()">💾 儲存報告</button>
                <button class="btn-secondary" onclick="exportPDF()">📥 匯出PDF</button>
            </div>
            
            <div class="report-preview" id="reportContent" style="display:none;">
                <div class="report-header">
                    <div class="report-title">帕金森病語音分析評估報告</div>
                    <div class="report-subtitle">Speech Analysis Assessment Report for Parkinson's Disease</div>
                    <div style="margin-top: 15px; color: #718096;">依據衛生福利部語言治療標準作業規範</div>
                </div>
                
                <!-- 基本資料摘要 -->
                <div class="report-section">
                    <div class="report-section-title">一、基本資料</div>
                    <div class="data-grid">
                        <div class="data-card">
                            <div class="data-label">姓名</div>
                            <div class="data-value" id="report_name">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">病歷號</div>
                            <div class="data-value" id="report_id">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">性別</div>
                            <div class="data-value" id="report_gender">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">年齡</div>
                            <div class="data-value" id="report_age">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">評估日期</div>
                            <div class="data-value" id="report_date">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">H-Y分期</div>
                            <div class="data-value" id="report_hy">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- 聲學參數結果 -->
                <div class="report-section">
                    <div class="report-section-title">二、聲學參數評估結果</div>
                    
                    <div class="chart-container">
                        <div class="chart-title">聲學參數與標準值比較</div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>基本頻率 (F0)</span>
                                <span id="report_f0_value">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="report_f0_bar" style="width: 0%;">0%</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>聲音響度 (SPL)</span>
                                <span id="report_spl_value">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="report_spl_bar" style="width: 0%;">0%</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>最大發聲時間 (MPT)</span>
                                <span id="report_mpt_value">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="report_mpt_bar" style="width: 0%;">0%</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>嗓音品質 (Jitter)</span>
                                <span id="report_jitter_value">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="report_jitter_bar" style="width: 0%;">0%</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>振幅穩定度 (Shimmer)</span>
                                <span id="report_shimmer_value">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="report_shimmer_bar" style="width: 0%;">0%</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-label">
                                <span>諧噪比 (HNR)</span>
                                <span id="report_hnr_value">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="report_hnr_bar" style="width: 0%;">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 知覺評估結果 -->
                <div class="report-section">
                    <div class="report-section-title">三、知覺評估結果 (GRBAS)</div>
                    
                    <div class="chart-container">
                        <table class="reference-table">
                            <thead>
                                <tr>
                                    <th>評估項目</th>
                                    <th>評分</th>
                                    <th>嚴重度</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>G - 整體嚴重度</td>
                                    <td id="report_grbas_g">-</td>
                                    <td id="report_grbas_g_level">-</td>
                                </tr>
                                <tr>
                                    <td>R - 粗糙度</td>
                                    <td id="report_grbas_r">-</td>
                                    <td id="report_grbas_r_level">-</td>
                                </tr>
                                <tr>
                                    <td>B - 氣息聲</td>
                                    <td id="report_grbas_b">-</td>
                                    <td id="report_grbas_b_level">-</td>
                                </tr>
                                <tr>
                                    <td>A - 無力度</td>
                                    <td id="report_grbas_a">-</td>
                                    <td id="report_grbas_a_level">-</td>
                                </tr>
                                <tr>
                                    <td>S - 緊張度</td>
                                    <td id="report_grbas_s">-</td>
                                    <td id="report_grbas_s_level">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">帕金森病特定語音特徵</div>
                        <table class="reference-table">
                            <thead>
                                <tr>
                                    <th>特徵</th>
                                    <th>評分</th>
                                    <th>嚴重度</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>音量減弱</td>
                                    <td id="report_hypophonia">-</td>
                                    <td id="report_hypophonia_level">-</td>
                                </tr>
                                <tr>
                                    <td>單調語調</td>
                                    <td id="report_monopitch">-</td>
                                    <td id="report_monopitch_level">-</td>
                                </tr>
                                <tr>
                                    <td>語速異常</td>
                                    <td id="report_rate">-</td>
                                    <td id="report_rate_level">-</td>
                                </tr>
                                <tr>
                                    <td>構音不清</td>
                                    <td id="report_articulation">-</td>
                                    <td id="report_articulation_level">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 功能性評估結果 -->
                <div class="report-section">
                    <div class="report-section-title">四、功能性溝通評估結果</div>
                    
                    <div class="data-grid">
                        <div class="data-card">
                            <div class="data-label">詞彙清晰度</div>
                            <div class="data-value" id="report_word_clarity">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">句子可懂度</div>
                            <div class="data-value" id="report_sentence_clarity">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">日常對話能力</div>
                            <div class="data-value" id="report_daily_conv">-</div>
                        </div>
                        <div class="data-card">
                            <div class="data-label">電話溝通能力</div>
                            <div class="data-value" id="report_phone_comm">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- 綜合評估 -->
                <div class="report-section">
                    <div class="report-section-title">五、綜合評估與診斷</div>
                    
                    <div class="comparison-box">
                        <div class="comparison-title">整體語音功能評級</div>
                        <div class="comparison-result">
                            <span class="result-label">評估結果：</span>
                            <span class="result-value" id="overall_assessment" style="font-size: 1.5em;">-</span>
                        </div>
                    </div>
                    
                    <div style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-top: 20px;">
                        <h4 style="color: #2d3748; margin-bottom: 15px; font-weight: 700;">臨床發現摘要：</h4>
                        <div id="clinical_summary" style="color: #4a5568; line-height: 1.8;">
                            <!-- 將由JavaScript生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 治療建議 -->
                <div class="report-section">
                    <div class="report-section-title">六、治療建議</div>
                    
                    <div class="recommendation-box">
                        <div class="recommendation-title">建議治療方向</div>
                        <ul class="recommendation-list" id="treatment_recommendations">
                            <!-- 將由JavaScript生成 -->
                        </ul>
                    </div>
                    
                    <div class="recommendation-box" style="background: linear-gradient(135deg, #e6f3ff 0%, #cce7ff 100%); border-color: #3182ce;">
                        <div class="recommendation-title" style="color: #2b6cb0;">後續追蹤計畫</div>
                        <ul class="recommendation-list" style="color: #2c5282;" id="followup_plan">
                            <!-- 將由JavaScript生成 -->
                        </ul>
                    </div>
                </div>
                
                <!-- 評估者簽名 -->
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <div class="signature-label">語言治療師簽名</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <div class="signature-label">評估日期</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <div class="signature-label">證書字號</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f7fafc; border-radius: 12px; text-align: center; color: #718096; font-size: 0.9em;">
                    <p>本報告依據衛生福利部「語言治療服務標準作業規範」及台灣語言治療學會專業標準製作</p>
                    <p style="margin-top: 10px;">報告產生時間：<span id="report_timestamp"></span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 計算F0狀態
function calculateF0Status() {
    const f0 = parseFloat(document.getElementById('f0_mean').value);
    const gender = document.getElementById('gender').value;
    const comparison = document.getElementById('f0_comparison');
    const status = document.getElementById('f0_status');
    
    if (!f0 || !gender) return;
    
    comparison.style.display = 'block';
    
    let result = '';
    let className = '';
    
    if (gender === 'male') {
        if (f0 >= 100 && f0 <= 150) {
            result = '正常範圍';
            className = 'result-normal';
        } else if (f0 < 100 || f0 > 150) {
            result = '異常 - 建議進一步評估';
            className = 'result-moderate';
        }
    } else if (gender === 'female') {
        if (f0 >= 180 && f0 <= 250) {
            result = '正常範圍';
            className = 'result-normal';
        } else if (f0 < 180 || f0 > 250) {
            result = '異常 - 建議進一步評估';
            className = 'result-moderate';
        }
    }
    
    status.textContent = result;
    status.className = 'result-value ' + className;
}

// 計算SPL狀態
function calculateSPLStatus() {
    const spl = parseFloat(document.getElementById('spl_comfortable').value);
    const gender = document.getElementById('gender').value;
    const comparison = document.getElementById('spl_comparison');
    const status = document.getElementById('spl_status');
    
    if (!spl || !gender) return;
    
    comparison.style.display = 'block';
    
    let result = '';
    let className = '';
    
    if (gender === 'male') {
        if (spl >= 65 && spl <= 75) {
            result = '正常範圍';
            className = 'result-normal';
        } else if (spl < 60) {
            result = '音量過小 - 需要治療';
            className = 'result-moderate';
        } else if (spl < 65) {
            result = '音量偏小 - 建議訓練';
            className = 'result-mild';
        }
    } else if (gender === 'female') {
        if (spl >= 60 && spl <= 70) {
            result = '正常範圍';
            className = 'result-normal';
        } else if (spl < 55) {
            result = '音量過小 - 需要治療';
            className = 'result-moderate';
        } else if (spl < 60) {
            result = '音量偏小 - 建議訓練';
            className = 'result-mild';
        }
    }
    
    status.textContent = result;
    status.className = 'result-value ' + className;
}

// 計算MPT
function calculateMPT() {
    const mpt1 = parseFloat(document.getElementById('mpt_1').value) || 0;
    const mpt2 = parseFloat(document.getElementById('mpt_2').value) || 0;
    const mpt3 = parseFloat(document.getElementById('mpt_3').value) || 0;
    
    if (mpt1 && mpt2 && mpt3) {
        const avg = ((mpt1 + mpt2 + mpt3) / 3).toFixed(2);
        document.getElementById('mpt_avg').value = avg;
        
        const gender = document.getElementById('gender').value;
        const comparison = document.getElementById('mpt_comparison');
        const status = document.getElementById('mpt_status');
        
        comparison.style.display = 'block';
        
        let result = '';
        let className = '';
        
        if (gender === 'male') {
            if (avg >= 20) {
                result = '正常範圍';
                className = 'result-normal';
            } else if (avg >= 15) {
                result = '輕度異常';
                className = 'result-mild';
            } else if (avg >= 10) {
                result = '中度異常';
                className = 'result-moderate';
            } else {
                result = '重度異常';
                className = 'result-severe';
            }
        } else if (gender === 'female') {
            if (avg >= 15) {
                result = '正常範圍';
                className = 'result-normal';
            } else if (avg >= 12) {
                result = '輕度異常';
                className = 'result-mild';
            } else if (avg >= 8) {
                result = '中度異常';
                className = 'result-moderate';
            } else {
                result = '重度異常';
                className = 'result-severe';
            }
        }
        
        status.textContent = result;
        status.className = 'result-value ' + className;
    }
}

// 計算Jitter狀態
function calculateJitterStatus() {
    const jitter = parseFloat(document.getElementById('jitter').value);
    const comparison = document.getElementById('jitter_comparison');
    const status = document.getElementById('jitter_status');
    
    if (!jitter) return;
    
    comparison.style.display = 'block';
    
    let result = '';
    let className = '';
    
    if (jitter < 1.04) {
        result = '正常範圍';
        className = 'result-normal';
    } else if (jitter < 2.0) {
        result = '輕度異常';
        className = 'result-mild';
    } else if (jitter < 3.0) {
        result = '中度異常';
        className = 'result-moderate';
    } else {
        result = '重度異常';
        className = 'result-severe';
    }
    
    status.textContent = result;
    status.className = 'result-value ' + className;
}

// 計算Shimmer狀態
function calculateShimmerStatus() {
    const shimmer = parseFloat(document.getElementById('shimmer').value);
    const comparison = document.getElementById('shimmer_comparison');
    const status = document.getElementById('shimmer_status');
    
    if (!shimmer) return;
    
    comparison.style.display = 'block';
    
    let result = '';
    let className = '';
    
    if (shimmer < 3.81) {
        result = '正常範圍';
        className = 'result-normal';
    } else if (shimmer < 6.0) {
        result = '輕度異常';
        className = 'result-mild';
    } else if (shimmer < 9.0) {
        result = '中度異常';
        className = 'result-moderate';
    } else {
        result = '重度異常';
        className = 'result-severe';
    }
    
    status.textContent = result;
    status.className = 'result-value ' + className;
}

// 計算HNR狀態
function calculateHNRStatus() {
    const hnr = parseFloat(document.getElementById('hnr').value);
    const comparison = document.getElementById('hnr_comparison');
    const status = document.getElementById('hnr_status');
    
    if (!hnr) return;
    
    comparison.style.display = 'block';
    
    let result = '';
    let className = '';
    
    if (hnr >= 20) {
        result = '正常範圍';
        className = 'result-normal';
    } else if (hnr >= 15) {
        result = '輕度異常';
        className = 'result-mild';
    } else if (hnr >= 10) {
        result = '中度異常';
        className = 'result-moderate';
    } else {
        result = '重度異常';
        className = 'result-severe';
    }
    
    status.textContent = result;
    status.className = 'result-value ' + className;
}

// 計算詞彙清晰度
function calculateWordClarity() {
    const total = parseFloat(document.getElementById('word_total').value) || 0;
    const correct = parseFloat(document.getElementById('word_correct').value) || 0;
    
    if (total > 0) {
        const clarity = ((correct / total) * 100).toFixed(1);
        document.getElementById('word_clarity').value = clarity + '%';
    }
}

// 計算句子清晰度
function calculateSentenceClarity() {
    const total = parseFloat(document.getElementById('sentence_total').value) || 0;
    const correct = parseFloat(document.getElementById('sentence_correct').value) || 0;
    
    if (total > 0) {
        const clarity = ((correct / total) * 100).toFixed(1);
        document.getElementById('sentence_clarity').value = clarity + '%';
    }
}

// 切換頁面
function showSection(sectionId) {
    const sections = document.querySelectorAll('.content-section');
    sections.forEach(section => {
        section.classList.remove('active');
    });
    
    const tabs = document.querySelectorAll('.nav-tab');
    tabs.forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.getElementById(sectionId).classList.add('active');
    event.target.classList.add('active');
}

// 生成報告
function generateReport() {
    // 基本資料
    document.getElementById('report_name').textContent = document.getElementById('patientName').value || '-';
    document.getElementById('report_id').textContent = document.getElementById('patientID').value || '-';
    
    const gender = document.getElementById('gender').value;
    document.getElementById('report_gender').textContent = gender === 'male' ? '男性' : gender === 'female' ? '女性' : '-';
    
    // 計算年齡
    const birthDate = document.getElementById('birthDate').value;
    if (birthDate) {
        const age = new Date().getFullYear() - new Date(birthDate).getFullYear();
        document.getElementById('report_age').textContent = age + '歲';
    }
    
    document.getElementById('report_date').textContent = document.getElementById('assessmentDate').value || '-';
    document.getElementById('report_hy').textContent = document.getElementById('hohenYahr').value || '-';
    
    // 聲學參數
    const f0 = document.getElementById('f0_mean').value;
    const spl = document.getElementById('spl_comfortable').value;
    const mpt = document.getElementById('mpt_avg').value;
    const jitter = document.getElementById('jitter').value;
    const shimmer = document.getElementById('shimmer').value;
    const hnr = document.getElementById('hnr').value;
    
    if (f0) {
        document.getElementById('report_f0_value').textContent = f0 + ' Hz';
        const f0Percent = gender === 'male' ? (f0 / 150 * 100) : (f0 / 250 * 100);
        document.getElementById('report_f0_bar').style.width = Math.min(f0Percent, 100) + '%';
        document.getElementById('report_f0_bar').textContent = Math.round(f0Percent) + '%';
    }
    
    if (spl) {
        document.getElementById('report_spl_value').textContent = spl + ' dB';
        const splPercent = gender === 'male' ? (spl / 75 * 100) : (spl / 70 * 100);
        document.getElementById('report_spl_bar').style.width = Math.min(splPercent, 100) + '%';
        document.getElementById('report_spl_bar').textContent = Math.round(splPercent) + '%';
    }
    
    if (mpt) {
        document.getElementById('report_mpt_value').textContent = mpt + ' 秒';
        const mptPercent = gender === 'male' ? (mpt / 20 * 100) : (mpt / 15 * 100);
        document.getElementById('report_mpt_bar').style.width = Math.min(mptPercent, 100) + '%';
        document.getElementById('report_mpt_bar').textContent = Math.round(mptPercent) + '%';
    }
    
    if (jitter) {
        document.getElementById('report_jitter_value').textContent = jitter + '%';
        const jitterPercent = jitter < 1.04 ? 100 : (1.04 / jitter * 100);
        document.getElementById('report_jitter_bar').style.width = Math.min(jitterPercent, 100) + '%';
        document.getElementById('report_jitter_bar').textContent = Math.round(jitterPercent) + '%';
    }
    
    if (shimmer) {
        document.getElementById('report_shimmer_value').textContent = shimmer + '%';
        const shimmerPercent = shimmer < 3.81 ? 100 : (3.81 / shimmer * 100);
        document.getElementById('report_shimmer_bar').style.width = Math.min(shimmerPercent, 100) + '%';
        document.getElementById('report_shimmer_bar').textContent = Math.round(shimmerPercent) + '%';
    }
    
    if (hnr) {
        document.getElementById('report_hnr_value').textContent = hnr + ' dB';
        const hnrPercent = (hnr / 20 * 100);
        document.getElementById('report_hnr_bar').style.width = Math.min(hnrPercent, 100) + '%';
        document.getElementById('report_hnr_bar').textContent = Math.round(hnrPercent) + '%';
    }
    
    // GRBAS評分
    const grbasItems = ['g', 'r', 'b', 'a', 's'];
    grbasItems.forEach(item => {
        const value = document.querySelector(`input[name="grbas_${item}"]:checked`)?.value;
        if (value) {
            document.getElementById(`report_grbas_${item}`).textContent = value;
            const levels = ['正常', '輕度', '中度', '重度'];
            document.getElementById(`report_grbas_${item}_level`).textContent = levels[parseInt(value)];
        }
    });
    
    // 帕金森特徵
    const pdFeatures = ['hypophonia', 'monopitch', 'rate', 'articulation'];
    pdFeatures.forEach(feature => {
        const value = document.querySelector(`input[name="${feature}"]:checked`)?.value;
        if (value) {
            document.getElementById(`report_${feature}`).textContent = value;
            const levels = ['無', '輕度', '中度', '重度'];
            document.getElementById(`report_${feature}_level`).textContent = levels[parseInt(value)];
        }
    });
    
    // 功能性評估
    document.getElementById('report_word_clarity').textContent = document.getElementById('word_clarity').value || '-';
    document.getElementById('report_sentence_clarity').textContent = document.getElementById('sentence_clarity').value || '-';
    
    const dailyConv = document.querySelector('input[name="daily_conv"]:checked')?.value;
    if (dailyConv) {
        const levels = ['', '完全無法', '非常困難', '有些困難', '略有困難', '完全正常'];
        document.getElementById('report_daily_conv').textContent = levels[parseInt(dailyConv)];
    }
    
    const phoneComm = document.querySelector('input[name="phone_comm"]:checked')?.value;
    if (phoneComm) {
        const levels = ['', '完全無法', '非常困難', '有些困難', '略有困難', '完全正常'];
        document.getElementById('report_phone_comm').textContent = levels[parseInt(phoneComm)];
    }
    
    // 生成綜合評估
    generateClinicalSummary();
    
    // 生成治療建議
    generateTreatmentRecommendations();
    
    // 顯示報告
    document.getElementById('reportContent').style.display = 'block';
    document.getElementById('report_timestamp').textContent = new Date().toLocaleString('zh-TW');
    
    // 滾動到報告區域
    document.getElementById('reportContent').scrollIntoView({ behavior: 'smooth' });
}

// 生成臨床摘要
function generateClinicalSummary() {
    let summary = '<ul style="list-style: none; padding: 0;">';
    
    // 聲學參數摘要
    const f0Status = document.getElementById('f0_status')?.textContent;
    const splStatus = document.getElementById('spl_status')?.textContent;
    const mptStatus = document.getElementById('mpt_status')?.textContent;
    
    if (f0Status) summary += `<li>• 基本頻率：${f0Status}</li>`;
    if (splStatus) summary += `<li>• 聲音響度：${splStatus}</li>`;
    if (mptStatus) summary += `<li>• 最大發聲時間：${mptStatus}</li>`;
    
    // GRBAS摘要
    const grbasG = document.querySelector('input[name="grbas_g"]:checked')?.value;
    if (grbasG && parseInt(grbasG) > 0) {
        const levels = ['', '輕度', '中度', '重度'];
        summary += `<li>• 整體嗓音品質呈現${levels[parseInt(grbasG)]}異常</li>`;
    }
    
    // 功能性評估摘要
    const wordClarity = document.getElementById('word_clarity').value;
    if (wordClarity) {
        const percent = parseFloat(wordClarity);
        if (percent < 80) {
            summary += `<li>• 詞彙清晰度${percent}%，需加強構音訓練</li>`;
        }
    }
    
    summary += '</ul>';
    
    // 整體評級
    let overallLevel = '正常';
    let overallClass = 'result-normal';
    
    if (mptStatus && mptStatus.includes('重度')) {
        overallLevel = '重度異常';
        overallClass = 'result-severe';
    } else if (mptStatus && mptStatus.includes('中度')) {
        overallLevel = '中度異常';
        overallClass = 'result-moderate';
    } else if (mptStatus && mptStatus.includes('輕度')) {
        overallLevel = '輕度異常';
        overallClass = 'result-mild';
    }
    
    document.getElementById('overall_assessment').textContent = overallLevel;
    document.getElementById('overall_assessment').className = 'result-value ' + overallClass;
    document.getElementById('clinical_summary').innerHTML = summary;
}

// 生成治療建議
function generateTreatmentRecommendations() {
    let recommendations = '';
    let followupPlan = '';
    
    // 根據評估結果生成建議
    const splStatus = document.getElementById('spl_status')?.textContent;
    const mptStatus = document.getElementById('mpt_status')?.textContent;
    const jitterStatus = document.getElementById('jitter_status')?.textContent;
    
    if (splStatus && splStatus.includes('音量')) {
        recommendations += '<li>建議進行LSVT LOUD®標準化響度訓練，每週4次，持續4週</li>';
    }
    
    if (mptStatus && (mptStatus.includes('異常'))) {
        recommendations += '<li>加強呼吸支持訓練，包括腹式呼吸和呼吸控制練習</li>';
    }
    
    if (jitterStatus && (jitterStatus.includes('異常'))) {
        recommendations += '<li>進行嗓音衛生教育，避免聲帶過度使用</li>';
    }
    
    const hypophonia = document.querySelector('input[name="hypophonia"]:checked')?.value;
    if (hypophonia && parseInt(hypophonia) > 0) {
        recommendations += '<li>每日進行音量校正練習，使用分貝計監測音量</li>';
    }
    
    const articulation = document.querySelector('input[name="articulation"]:checked')?.value;
    if (articulation && parseInt(articulation) > 0) {
        recommendations += '<li>構音器官運動訓練，包括唇、舌、下顎靈活度練習</li>';
    }
    
    const monopitch = document.querySelector('input[name="monopitch"]:checked')?.value;
    if (monopitch && parseInt(monopitch) > 0) {
        recommendations += '<li>韻律訓練，包括音調變化和語調模式練習</li>';
    }
    
    const wordClarity = document.getElementById('word_clarity').value;
    if (wordClarity && parseFloat(wordClarity) < 80) {
        recommendations += '<li>加強構音清晰度訓練，從音節到詞彙層次</li>';
    }
    
    // 通用建議
    recommendations += '<li>建議配合神經內科藥物治療，在藥效最佳時段進行訓練</li>';
    recommendations += '<li>家屬參與訓練，在日常生活中提供提示和鼓勵</li>';
    recommendations += '<li>使用擴音設備輔助日常溝通</li>';
    
    // 追蹤計畫
    followupPlan += '<li>建議每週進行2-3次語言治療，每次45-60分鐘</li>';
    followupPlan += '<li>每日居家練習30分鐘，使用訓練手冊指導</li>';
    followupPlan += '<li>4週後進行第一次追蹤評估，比較訓練前後差異</li>';
    followupPlan += '<li>每3個月進行完整語音分析評估</li>';
    followupPlan += '<li>定期錄音記錄，追蹤長期進展</li>';
    
    document.getElementById('treatment_recommendations').innerHTML = recommendations;
    document.getElementById('followup_plan').innerHTML = followupPlan;
}

// 儲存報告
function saveReport() {
    const reportData = {
        timestamp: new Date().toISOString(),
        basicInfo: {
            name: document.getElementById('patientName').value,
            id: document.getElementById('patientID').value,
            gender: document.getElementById('gender').value,
            birthDate: document.getElementById('birthDate').value,
            assessmentDate: document.getElementById('assessmentDate').value,
            hohenYahr: document.getElementById('hohenYahr').value
        },
        acoustic: {
            f0_mean: document.getElementById('f0_mean').value,
            spl_comfortable: document.getElementById('spl_comfortable').value,
            mpt_avg: document.getElementById('mpt_avg').value,
            jitter: document.getElementById('jitter').value,
            shimmer: document.getElementById('shimmer').value,
            hnr: document.getElementById('hnr').value
        },
        perceptual: {
            grbas_g: document.querySelector('input[name="grbas_g"]:checked')?.value,
            grbas_r: document.querySelector('input[name="grbas_r"]:checked')?.value,
            grbas_b: document.querySelector('input[name="grbas_b"]:checked')?.value,
            grbas_a: document.querySelector('input[name="grbas_a"]:checked')?.value,
            grbas_s: document.querySelector('input[name="grbas_s"]:checked')?.value
        },
        functional: {
            word_clarity: document.getElementById('word_clarity').value,
            sentence_clarity: document.getElementById('sentence_clarity').value
        },
        notes: document.getElementById('clinical_notes').value
    };
    
    // 儲存到localStorage
    const patientID = document.getElementById('patientID').value;
    const assessmentDate = document.getElementById('assessmentDate').value;
    const storageKey = `assessment_${patientID}_${assessmentDate}`;
    
    localStorage.setItem(storageKey, JSON.stringify(reportData));
    
    alert('✅ 報告已儲存！\n\n儲存編號：' + storageKey);
}

// 匯出PDF
function exportPDF() {
    alert('📥 PDF匯出功能\n\n請使用瀏覽器的「列印」功能，選擇「另存為PDF」來匯出報告。\n\n建議設定：\n• 紙張大小：A4\n• 方向：直向\n• 邊界：預設\n• 背景圖形：開啟');
    window.print();
}

// 頁面載入時的初始化
document.addEventListener('DOMContentLoaded', function() {
    // 設定今天的日期為預設評估日期
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('assessmentDate').value = today;
    
    // 載入已儲存的資料（如果有）
    const urlParams = new URLSearchParams(window.location.search);
    const loadKey = urlParams.get('load');
    
    if (loadKey) {
        const savedData = localStorage.getItem(loadKey);
        if (savedData) {
            loadSavedReport(JSON.parse(savedData));
        }
    }
});

// 載入已儲存的報告
function loadSavedReport(data) {
    if (data.basicInfo) {
        document.getElementById('patientName').value = data.basicInfo.name || '';
        document.getElementById('patientID').value = data.basicInfo.id || '';
        document.getElementById('gender').value = data.basicInfo.gender || '';
        document.getElementById('birthDate').value = data.basicInfo.birthDate || '';
        document.getElementById('assessmentDate').value = data.basicInfo.assessmentDate || '';
        document.getElementById('hohenYahr').value = data.basicInfo.hohenYahr || '';
    }
    
    if (data.acoustic) {
        document.getElementById('f0_mean').value = data.acoustic.f0_mean || '';
        document.getElementById('spl_comfortable').value = data.acoustic.spl_comfortable || '';
        document.getElementById('mpt_avg').value = data.acoustic.mpt_avg || '';
        document.getElementById('jitter').value = data.acoustic.jitter || '';
        document.getElementById('shimmer').value = data.acoustic.shimmer || '';
        document.getElementById('hnr').value = data.acoustic.hnr || '';
    }
    
    if (data.notes) {
        document.getElementById('clinical_notes').value = data.notes;
    }
    
    alert('✅ 已載入先前儲存的評估資料');
}

// 自動儲存功能（每5分鐘）
setInterval(function() {
    const patientID = document.getElementById('patientID').value;
    if (patientID) {
        const autoSaveKey = `autosave_${patientID}`;
        const currentData = {
            timestamp: new Date().toISOString(),
            basicInfo: {
                name: document.getElementById('patientName').value,
                id: patientID,
                gender: document.getElementById('gender').value,
                birthDate: document.getElementById('birthDate').value,
                assessmentDate: document.getElementById('assessmentDate').value
            },
            acoustic: {
                f0_mean: document.getElementById('f0_mean').value,
                spl_comfortable: document.getElementById('spl_comfortable').value,
                mpt_avg: document.getElementById('mpt_avg').value
            }
        };
        localStorage.setItem(autoSaveKey, JSON.stringify(currentData));
        console.log('自動儲存完成：' + new Date().toLocaleTimeString());
    }
}, 300000); // 5分鐘

// 鍵盤快捷鍵
document.addEventListener('keydown', function(e) {
    // Ctrl+S 儲存
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        saveReport();
    }
    
    // Ctrl+P 列印
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        window.print();
    }
    
    // Ctrl+G 生成報告
    if (e.ctrlKey && e.key === 'g') {
        e.preventDefault();
        generateReport();
    }
});

// 表單驗證
function validateForm() {
    const requiredFields = [
        { id: 'patientName', name: '姓名' },
        { id: 'patientID', name: '病歷號' },
        { id: 'gender', name: '性別' },
        { id: 'assessmentDate', name: '評估日期' }
    ];
    
    let isValid = true;
    let missingFields = [];
    
    requiredFields.forEach(field => {
        const element = document.getElementById(field.id);
        if (!element.value) {
            isValid = false;
            missingFields.push(field.name);
            element.style.borderColor = '#e53e3e';
        } else {
            element.style.borderColor = '#e2e8f0';
        }
    });
    
    if (!isValid) {
        alert('⚠️ 請填寫必填欄位：\n\n' + missingFields.join('、'));
    }
    
    return isValid;
}

// 在生成報告前驗證
const originalGenerateReport = generateReport;
generateReport = function() {
    if (validateForm()) {
        originalGenerateReport();
    }
};

// 資料比較功能
function compareWithBaseline() {
    const currentAssessment = document.getElementById('assessmentNumber').value;
    
    if (currentAssessment === 'baseline') {
        alert('ℹ️ 這是基線評估，沒有先前資料可比較');
        return;
    }
    
    const patientID = document.getElementById('patientID').value;
    if (!patientID) {
        alert('⚠️ 請先輸入病歷號');
        return;
    }
    
    // 尋找基線資料
    const baselineKey = `assessment_${patientID}_baseline`;
    const baselineData = localStorage.getItem(baselineKey);
    
    if (!baselineData) {
        alert('⚠️ 找不到基線評估資料');
        return;
    }
    
    // 顯示比較結果
    const baseline = JSON.parse(baselineData);
    let comparison = '📊 與基線評估比較：\n\n';
    
    const currentF0 = parseFloat(document.getElementById('f0_mean').value);
    const baselineF0 = parseFloat(baseline.acoustic.f0_mean);
    if (currentF0 && baselineF0) {
        const diff = ((currentF0 - baselineF0) / baselineF0 * 100).toFixed(1);
        comparison += `基本頻率：${diff > 0 ? '+' : ''}${diff}%\n`;
    }
    
    const currentSPL = parseFloat(document.getElementById('spl_comfortable').value);
    const baselineSPL = parseFloat(baseline.acoustic.spl_comfortable);
    if (currentSPL && baselineSPL) {
        const diff = (currentSPL - baselineSPL).toFixed(1);
        comparison += `聲音響度：${diff > 0 ? '+' : ''}${diff} dB\n`;
    }
    
    const currentMPT = parseFloat(document.getElementById('mpt_avg').value);
    const baselineMPT = parseFloat(baseline.acoustic.mpt_avg);
    if (currentMPT && baselineMPT) {
        const diff = (currentMPT - baselineMPT).toFixed(1);
        comparison += `最大發聲時間：${diff > 0 ? '+' : ''}${diff} 秒\n`;
    }
    
    alert(comparison);
}

// 匯出Excel格式資料
function exportToExcel() {
    const data = {
        基本資料: {
            姓名: document.getElementById('patientName').value,
            病歷號: document.getElementById('patientID').value,
            性別: document.getElementById('gender').value,
            評估日期: document.getElementById('assessmentDate').value
        },
        聲學參數: {
            基本頻率: document.getElementById('f0_mean').value + ' Hz',
            聲音響度: document.getElementById('spl_comfortable').value + ' dB',
            最大發聲時間: document.getElementById('mpt_avg').value + ' 秒',
            Jitter: document.getElementById('jitter').value + '%',
            Shimmer: document.getElementById('shimmer').value + '%',
            HNR: document.getElementById('hnr').value + ' dB'
        }
    };
    
    let csv = '\uFEFF'; // UTF-8 BOM
    csv += '帕金森病語音分析評估資料\n\n';
    
    for (let section in data) {
        csv += section + '\n';
        for (let key in data[section]) {
            csv += key + ',' + data[section][key] + '\n';
        }
        csv += '\n';
    }
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `語音評估_${document.getElementById('patientID').value}_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// 列印預覽優化
window.onbeforeprint = function() {
    document.querySelectorAll('.nav-tabs, .button-group').forEach(el => {
        el.style.display = 'none';
    });
};

window.onafterprint = function() {
    document.querySelectorAll('.nav-tabs, .button-group').forEach(el => {
        el.style.display = '';
    });
};

console.log('🏥 帕金森病語音分析評估系統已載入');
console.log('📋 快捷鍵：Ctrl+S (儲存) | Ctrl+P (列印) | Ctrl+G (生成報告)');
</script>
</body>
</html>



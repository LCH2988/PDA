<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸•é‡‘æ£®ç—…å‹æ¬Šç›Šä¿ƒé€²æœƒ - ç®¡ç†ç³»çµ±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      background: white;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      color: #667eea;
      font-size: 24px;
    }
    
    .admin-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .admin-name {
      color: #666;
      font-size: 14px;
    }
    
    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .logout-btn:hover {
      background: #c82333;
    }
    
    .nav-tabs {
      background: white;
      padding: 15px 20px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .nav-tab {
      padding: 12px 25px;
      background: #f8f9fa;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      color: #666;
      transition: all 0.3s;
    }
    
    .nav-tab:hover {
      background: #e9ecef;
    }
    
    .nav-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .content-area {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      min-height: 500px;
    }
    
    .page {
      display: none;
    }
    
    .page.active {
      display: block;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
      font-size: 16px;
      margin-bottom: 10px;
      opacity: 0.9;
    }
    
    .stat-card .number {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-card .label {
      font-size: 14px;
      opacity: 0.8;
    }
    
    .section-title {
      font-size: 22px;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-success {
      background: #28a745;
      color: white;
    }
    
    .btn-success:hover {
      background: #218838;
    }
    
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    
    .btn-danger:hover {
      background: #c82333;
    }
    
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #5a6268;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .data-table th {
      background: #f8f9fa;
      color: #333;
      font-weight: 600;
    }
    
    .data-table tr:hover {
      background: #f8f9fa;
    }
    
    .badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .badge-success {
      background: #d4edda;
      color: #155724;
    }
    
    .badge-warning {
      background: #fff3cd;
      color: #856404;
    }
    
    .badge-danger {
      background: #f8d7da;
      color: #721c24;
    }
    
    .badge-info {
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .action-buttons {
      display: flex;
      gap: 5px;
    }
    
    .action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
    }
    
    .search-box {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
    }
    
    .search-box input {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
    
    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-danger {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h2 {
      color: #333;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #999;
    }
    
    .close-modal:hover {
      color: #333;
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .nav-tabs {
        overflow-x: auto;
      }
      
      .data-table {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¥ å¸•é‡‘æ£®ç—…å‹æ¬Šç›Šä¿ƒé€²æœƒ - ç®¡ç†ç³»çµ±</h1>
      <div class="admin-info">
        <span class="admin-name">ğŸ‘¤ ç®¡ç†å“¡ï¼š<span id="adminName">ç³»çµ±ç®¡ç†å“¡</span></span>
        <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
      </div>
    </div>
    
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="showPage('dashboard')">ğŸ“Š å„€è¡¨æ¿</button>
      <button class="nav-tab" onclick="showPage('members')">ğŸ‘¥ æœƒå“¡ç®¡ç†</button>
      <button class="nav-tab" onclick="showPage('activities')">ğŸ“… æ´»å‹•ç®¡ç†</button>
      <button class="nav-tab" onclick="showPage('volunteers')">ğŸ¤ å¿—å·¥ç®¡ç†</button>
      <button class="nav-tab" onclick="showPage('donations')">ğŸ’° ææ¬¾ç®¡ç†</button>
      <button class="nav-tab" onclick="showPage('financial')">ğŸ’³ è²¡å‹™ç®¡ç†</button>
      <button class="nav-tab" onclick="showPage('reports')">ğŸ“ˆ å ±è¡¨åˆ†æ</button>
    </div>
    
    <div class="content-area">
      <div id="dashboard" class="page active">
        <h2 class="section-title">ç³»çµ±æ¦‚è¦½</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <h3>ç¸½æœƒå“¡æ•¸</h3>
            <div class="number" id="totalMembers">0</div>
            <div class="label">ä½æœƒå“¡</div>
          </div>
          <div class="stat-card">
            <h3>æœ¬æœˆæ´»å‹•</h3>
            <div class="number" id="monthActivities">0</div>
            <div class="label">å ´æ´»å‹•</div>
          </div>
          <div class="stat-card">
            <h3>å¿—å·¥äººæ•¸</h3>
            <div class="number" id="totalVolunteers">0</div>
            <div class="label">ä½å¿—å·¥</div>
          </div>
          <div class="stat-card">
            <h3>æœ¬æœˆææ¬¾</h3>
            <div class="number" id="monthDonations">$0</div>
            <div class="label">å…ƒ</div>
          </div>
        </div>
        <h3 class="section-title">æœ€æ–°æ´»å‹•å ±å</h3>
        <div id="recentRegistrations"><div class="loading">è¼‰å…¥ä¸­</div></div>
      </div>
      
      <div id="members" class="page">
        <h2 class="section-title">æœƒå“¡ç®¡ç†</h2>
        <div class="search-box">
          <input type="text" id="memberSearch" placeholder="æœå°‹æœƒå“¡ï¼ˆå§“åã€é›»è©±ã€ç·¨è™Ÿï¼‰">
          <button class="btn btn-primary" onclick="searchMembers()">ğŸ” æœå°‹</button>
          <button class="btn btn-success" onclick="showAddMemberModal()">â• æ–°å¢æœƒå“¡</button>
        </div>
        <div id="membersList"><div class="loading">è¼‰å…¥ä¸­</div></div>
      </div>
      
      <div id="activities" class="page">
        <h2 class="section-title">æ´»å‹•ç®¡ç†</h2>
        <button class="btn btn-success" onclick="showAddActivityModal()" style="margin-bottom: 20px;">â• æ–°å¢æ´»å‹•</button>
        <div id="activitiesList"><div class="loading">è¼‰å…¥ä¸­</div></div>
      </div>
      
      <div id="volunteers" class="page">
        <h2 class="section-title">å¿—å·¥ç®¡ç†</h2>
        <div class="search-box">
          <input type="text" id="volunteerSearch" placeholder="æœå°‹å¿—å·¥">
          <button class="btn btn-primary" onclick="searchVolunteers()">ğŸ” æœå°‹</button>
        </div>
        <div id="volunteersList"><div class="loading">è¼‰å…¥ä¸­</div></div>
      </div>
      
      <div id="donations" class="page">
        <h2 class="section-title">ææ¬¾ç®¡ç†</h2>
        <button class="btn btn-success" onclick="showAddDonationModal()" style="margin-bottom: 20px;">â• æ–°å¢ææ¬¾ç´€éŒ„</button>
        <div id="donationsList"><div class="loading">è¼‰å…¥ä¸­</div></div>
      </div>
      
      <div id="financial" class="page">
        <h2 class="section-title">è²¡å‹™ç®¡ç†</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <button class="btn btn-success" onclick="showAddIncomeModal()">â• æ–°å¢æ”¶å…¥</button>
          <button class="btn btn-danger" onclick="showAddExpenseModal()">â• æ–°å¢æ”¯å‡º</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <h3>ç¸½æ”¶å…¥</h3>
            <div class="number" id="totalIncome">$0</div>
          </div>
          <div class="stat-card">
            <h3>ç¸½æ”¯å‡º</h3>
            <div class="number" id="totalExpense">$0</div>
          </div>
          <div class="stat-card">
            <h3>çµé¤˜</h3>
            <div class="number" id="balance">$0</div>
          </div>
        </div>
        <h3 class="section-title">æ”¶æ”¯æ˜ç´°</h3>
        <div id="financialList"><div class="loading">è¼‰å…¥ä¸­</div></div>
      </div>
      
      <div id="reports" class="page">
        <h2 class="section-title">å ±è¡¨åˆ†æ</h2>
        <div class="form-row" style="margin-bottom: 20px;">
          <div class="form-group">
            <label>å ±è¡¨é¡å‹</label>
            <select id="reportType">
              <option value="member">æœƒå“¡çµ±è¨ˆ</option>
              <option value="activity">æ´»å‹•çµ±è¨ˆ</option>
              <option value="donation">ææ¬¾çµ±è¨ˆ</option>
              <option value="financial">è²¡å‹™çµ±è¨ˆ</option>
            </select>
          </div>
          <div class="form-group">
            <label>æ™‚é–“ç¯„åœ</label>
            <select id="reportPeriod">
              <option value="month">æœ¬æœˆ</option>
              <option value="quarter">æœ¬å­£</option>
              <option value="year">æœ¬å¹´</option>
              <option value="all">å…¨éƒ¨</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary" onclick="generateReport()">ğŸ“Š ç”¢ç”Ÿå ±è¡¨</button>
        <button class="btn btn-secondary" onclick="exportReport()">ğŸ“¥ åŒ¯å‡ºå ±è¡¨</button>
        <div id="reportContent" style="margin-top: 30px;">
          <p style="text-align: center; color: #999;">è«‹é¸æ“‡å ±è¡¨é¡å‹ä¸¦ç”¢ç”Ÿå ±è¡¨</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modals -->
  <div id="addMemberModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ–°å¢æœƒå“¡</h2>
        <button class="close-modal" onclick="closeModal('addMemberModal')">&times;</button>
      </div>
      <form id="addMemberForm" onsubmit="addMember(event)">
        <div class="form-group">
          <label>å§“å *</label>
          <input type="text" id="newMemberName" required>
        </div>
        <div class="form-group">
          <label>é›»è©± *</label>
          <input type="tel" id="newMemberPhone" required>
        </div>
        <div class="form-group">
          <label>é›»å­éƒµä»¶</label>
          <input type="email" id="newMemberEmail">
        </div>
        <div class="form-group">
          <label>åœ°å€</label>
          <input type="text" id="newMemberAddress">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ç·Šæ€¥è¯çµ¡äºº</label>
            <input type="text" id="newMemberEmergencyContact">
          </div>
          <div class="form-group">
            <label>ç·Šæ€¥è¯çµ¡é›»è©±</label>
            <input type="tel" id="newMemberEmergencyPhone">
          </div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button type="submit" class="btn btn-primary">âœ“ æ–°å¢</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('addMemberModal')">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="addActivityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ–°å¢æ´»å‹•</h2>
        <button class="close-modal" onclick="closeModal('addActivityModal')">&times;</button>
      </div>
      <form id="addActivityForm" onsubmit="addActivity(event)">
        <div class="form-group">
          <label>æ´»å‹•åç¨± *</label>
          <input type="text" id="newActivityName" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>æ´»å‹•æ—¥æœŸ *</label>
            <input type="date" id="newActivityDate" required>
          </div>
          <div class="form-group">
            <label>æ´»å‹•æ™‚é–“ *</label>
            <input type="time" id="newActivityTime" required>
          </div>
        </div>
        <div class="form-group">
          <label>æ´»å‹•åœ°é» *</label>
          <input type="text" id="newActivityLocation" required>
        </div>
        <div class="form-group">
          <label>æ´»å‹•èªªæ˜</label>
          <textarea id="newActivityDescription"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>äººæ•¸ä¸Šé™</label>
            <input type="number" id="newActivityMaxParticipants" value="50">
          </div>
          <div class="form-group">
            <label>å ±åæˆªæ­¢æ—¥</label>
            <input type="date" id="newActivityDeadline">
          </div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button type="submit" class="btn btn-primary">âœ“ æ–°å¢</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('addActivityModal')">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="addIncomeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ–°å¢æ”¶å…¥</h2>
        <button class="close-modal" onclick="closeModal('addIncomeModal')">&times;</button>
      </div>
      <form id="addIncomeForm" onsubmit="addIncome(event)">
        <div class="form-group">
          <label>æ”¶å…¥é …ç›® *</label>
          <input type="text" id="newIncomeItem" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>é‡‘é¡ *</label>
            <input type="number" id="newIncomeAmount" required>
          </div>
          <div class="form-group">
            <label>æ—¥æœŸ *</label>
            <input type="date" id="newIncomeDate" required>
          </div>
        </div>
        <div class="form-group">
          <label>æ”¶å…¥ä¾†æº</label>
          <input type="text" id="newIncomeSource">
        </div>
        <div class="form-group">
          <label>ç¶“æ‰‹äºº</label>
          <input type="text" id="newIncomeHandler">
        </div>
        <div class="form-group">
          <label>å‚™è¨»</label>
          <textarea id="newIncomeNote"></textarea>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button type="submit" class="btn btn-primary">âœ“ æ–°å¢</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('addIncomeModal')">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="addExpenseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ–°å¢æ”¯å‡º</h2>
        <button class="close-modal" onclick="closeModal('addExpenseModal')">&times;</button>
      </div>
      <form id="addExpenseForm" onsubmit="addExpense(event)">
        <div class="form-group">
          <label>æ”¯å‡ºé …ç›® *</label>
          <input type="text" id="newExpenseItem" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>é‡‘é¡ *</label>
            <input type="number" id="newExpenseAmount" required>
          </div>
          <div class="form-group">
            <label>æ—¥æœŸ *</label>
            <input type="date" id="newExpenseDate" required>
          </div>
        </div>
        <div class="form-group">
          <label>æ”¯å‡ºå°è±¡</label>
          <input type="text" id="newExpenseRecipient">
        </div>
        <div class="form-group">
          <label>ç¶“æ‰‹äºº</label>
          <input type="text" id="newExpenseHandler">
        </div>
        <div class="form-group">
          <label>å‚™è¨»</label>
          <textarea id="newExpenseNote"></textarea>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button type="submit" class="btn btn-primary">âœ“ æ–°å¢</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('addExpenseModal')">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>
  
  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwEbScN-r1UVwppUwbTwULuq6M1Vm2eko4EkCZpD_CCI8WkTInQk5O752ENwRTIchj70Q/exec';
    let allMembers = [];
    let allActivities = [];
    
    window.onload = function() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('newActivityDate').value = today;
      document.getElementById('newActivityDeadline').value = today;
      document.getElementById('newIncomeDate').value = today;
      document.getElementById('newExpenseDate').value = today;
      loadDashboard();
    };
    
    async function callAPI(action, data) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({ action, ...data })
        });
        return await response.json();
      } catch (error) {
        return { success: false, message: 'ç³»çµ±éŒ¯èª¤: ' + error };
      }
    }
    
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById(pageName).classList.add('active');
      event.target.classList.add('active');
      
      switch(pageName) {
        case 'dashboard': loadDashboard(); break;
        case 'members': loadMembers(); break;
        case 'activities': loadActivities(); break;
        case 'volunteers': loadVolunteers(); break;
        case 'donations': loadDonations(); break;
        case 'financial': loadFinancial(); break;
      }
    }
    
    async function loadDashboard() {
      document.getElementById('totalMembers').textContent = 'è¼‰å…¥ä¸­...';
      // å¯¦éš›è¼‰å…¥é‚è¼¯
    }
    
    async function loadMembers() {
      const result = await callAPI('getMembers', {});
      if (result.success) {
        allMembers = result.members || [];
        displayMembers(allMembers);
      }
    }
    
    function displayMembers(members) {
      let html = '<table class="data-table"><thead><tr><th>æœƒå“¡ç·¨è™Ÿ</th><th>å§“å</th><th>é›»è©±</th><th>é›»å­éƒµä»¶</th><th>æœƒå“¡é¡å‹</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead><tbody>';
      members.forEach(m => {
        html += `<tr>
          <td>${m.memberId}</td>
          <td>${m.name}</td>
          <td>${m.phone}</td>
          <td>${m.email || '-'}</td>
          <td>${m.memberType}</td>
          <td><span class="badge badge-success">${m.status}</span></td>
          <td><button class="action-btn btn-primary" onclick="viewMember('${m.memberId}')">æª¢è¦–</button></td>
        </tr>`;
      });
      html += '</tbody></table>';
      document.getElementById('membersList').innerHTML = html;
    }
    
    async function loadActivities() {
      const result = await callAPI('getActivities', { showAll: true });
      if (result.success) {
        allActivities = result.activities || [];
        displayActivities(allActivities);
      }
    }
    
    function displayActivities(activities) {
      let html = '<table class="data-table"><thead><tr><th>æ´»å‹•åç¨±</th><th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>åœ°é»</th><th>äººæ•¸</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead><tbody>';
      activities.forEach(a => {
        html += `<tr><td>${a.name}</td>
            <td>${a.date}</td>
            <td>${a.time}</td>
            <td>${a.location}</td>
            <td>${a.currentParticipants}/${a.maxParticipants}</td>
            <td><span class="badge badge-${a.status === 'é–‹æ”¾å ±å' ? 'success' : 'warning'}">${a.status}</span></td>
            <td>
              <button class="action-btn btn-primary" onclick="viewActivity('${a.activityId}')">æª¢è¦–</button>
              <button class="action-btn btn-secondary" onclick="editActivity('${a.activityId}')">ç·¨è¼¯</button>
            </td>
          </tr>`;
        });
        html += '</tbody></table>';
        document.getElementById('activitiesList').innerHTML = html;
      }
      
      async function loadVolunteers() {
        const result = await callAPI('getVolunteerRecords', {});
        if (result.success) {
          displayVolunteers(result.records || []);
        }
      }
      
      function displayVolunteers(volunteers) {
        let html = '<table class="data-table"><thead><tr><th>æœƒå“¡ç·¨è™Ÿ</th><th>æ´»å‹•åç¨±</th><th>æ—¥æœŸ</th><th>æ™‚æ•¸</th><th>æœå‹™å…§å®¹</th><th>ç‹€æ…‹</th></tr></thead><tbody>';
        volunteers.forEach(v => {
          html += `<tr>
            <td>${v.memberId}</td>
            <td>${v.activityName}</td>
            <td>${v.date}</td>
            <td>${v.hours}</td>
            <td>${v.content}</td>
            <td><span class="badge badge-info">${v.status}</span></td>
          </tr>`;
        });
        html += '</tbody></table>';
        document.getElementById('volunteersList').innerHTML = html;
      }
      
      async function loadDonations() {
        const result = await callAPI('getDonations', {});
        if (result.success) {
          displayDonations(result.donations || []);
        }
      }
      
      function displayDonations(donations) {
        let html = '<table class="data-table"><thead><tr><th>ææ¬¾ç·¨è™Ÿ</th><th>æœƒå“¡ç·¨è™Ÿ</th><th>æ—¥æœŸ</th><th>é‡‘é¡</th><th>æ–¹å¼</th><th>æ”¶æ“šç·¨è™Ÿ</th></tr></thead><tbody>';
        donations.forEach(d => {
          html += `<tr>
            <td>${d.donationId}</td>
            <td>${d.memberId}</td>
            <td>${d.date}</td>
            <td>$${d.amount.toLocaleString()}</td>
            <td>${d.method}</td>
            <td>${d.receiptNo}</td>
          </tr>`;
        });
        html += '</tbody></table>';
        document.getElementById('donationsList').innerHTML = html;
      }
      
      async function loadFinancial() {
        const result = await callAPI('getFinancialRecords', {});
        if (result.success) {
          const income = result.income || [];
          const expense = result.expense || [];
          
          const totalIncome = income.reduce((sum, i) => sum + Number(i.amount), 0);
          const totalExpense = expense.reduce((sum, e) => sum + Number(e.amount), 0);
          const balance = totalIncome - totalExpense;
          
          document.getElementById('totalIncome').textContent = '$' + totalIncome.toLocaleString();
          document.getElementById('totalExpense').textContent = '$' + totalExpense.toLocaleString();
          document.getElementById('balance').textContent = '$' + balance.toLocaleString();
          
          displayFinancial(income, expense);
        }
      }
      
      function displayFinancial(income, expense) {
        let html = '<h4>æ”¶å…¥ç´€éŒ„</h4><table class="data-table"><thead><tr><th>æ—¥æœŸ</th><th>é …ç›®</th><th>é‡‘é¡</th><th>ä¾†æº</th><th>ç¶“æ‰‹äºº</th></tr></thead><tbody>';
        income.forEach(i => {
          html += `<tr>
            <td>${i.date}</td>
            <td>${i.item}</td>
            <td class="text-success">+$${Number(i.amount).toLocaleString()}</td>
            <td>${i.source}</td>
            <td>${i.handler}</td>
          </tr>`;
        });
        html += '</tbody></table>';
        
        html += '<h4 style="margin-top: 30px;">æ”¯å‡ºç´€éŒ„</h4><table class="data-table"><thead><tr><th>æ—¥æœŸ</th><th>é …ç›®</th><th>é‡‘é¡</th><th>å°è±¡</th><th>ç¶“æ‰‹äºº</th></tr></thead><tbody>';
        expense.forEach(e => {
          html += `<tr>
            <td>${e.date}</td>
            <td>${e.item}</td>
            <td class="text-danger">-$${Number(e.amount).toLocaleString()}</td>
            <td>${e.recipient}</td>
            <td>${e.handler}</td>
          </tr>`;
        });
        html += '</tbody></table>';
        
        document.getElementById('financialList').innerHTML = html;
      }
      
      function showAddMemberModal() {
        document.getElementById('addMemberModal').classList.add('active');
      }
      
      function showAddActivityModal() {
        document.getElementById('addActivityModal').classList.add('active');
      }
      
      function showAddIncomeModal() {
        document.getElementById('addIncomeModal').classList.add('active');
      }
      
      function showAddExpenseModal() {
        document.getElementById('addExpenseModal').classList.add('active');
      }
      
      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
      }
      
      async function addMember(event) {
        event.preventDefault();
        const result = await callAPI('register', {
          name: document.getElementById('newMemberName').value,
          phone: document.getElementById('newMemberPhone').value,
          email: document.getElementById('newMemberEmail').value,
          address: document.getElementById('newMemberAddress').value,
          emergencyContact: document.getElementById('newMemberEmergencyContact').value,
          emergencyPhone: document.getElementById('newMemberEmergencyPhone').value,
          lineId: 'ADMIN_' + Date.now()
        });
        
        if (result.success) {
          alert('æœƒå“¡æ–°å¢æˆåŠŸï¼');
          closeModal('addMemberModal');
          loadMembers();
          document.getElementById('addMemberForm').reset();
        } else {
          alert('æ–°å¢å¤±æ•—ï¼š' + result.message);
        }
      }
      
      async function addActivity(event) {
        event.preventDefault();
        const result = await callAPI('createActivity', {
          name: document.getElementById('newActivityName').value,
          date: document.getElementById('newActivityDate').value,
          time: document.getElementById('newActivityTime').value,
          location: document.getElementById('newActivityLocation').value,
          description: document.getElementById('newActivityDescription').value,
          maxParticipants: document.getElementById('newActivityMaxParticipants').value,
          deadline: document.getElementById('newActivityDeadline').value
        });
        
        if (result.success) {
          alert('æ´»å‹•æ–°å¢æˆåŠŸï¼');
          closeModal('addActivityModal');
          loadActivities();
          document.getElementById('addActivityForm').reset();
        } else {
          alert('æ–°å¢å¤±æ•—ï¼š' + result.message);
        }
      }
      
      async function addIncome(event) {
        event.preventDefault();
        const result = await callAPI('addIncome', {
          item: document.getElementById('newIncomeItem').value,
          amount: document.getElementById('newIncomeAmount').value,
          date: document.getElementById('newIncomeDate').value,
          source: document.getElementById('newIncomeSource').value,
          handler: document.getElementById('newIncomeHandler').value,
          note: document.getElementById('newIncomeNote').value
        });
        
        if (result.success) {
          alert('æ”¶å…¥ç´€éŒ„æ–°å¢æˆåŠŸï¼æ”¶æ“šç·¨è™Ÿï¼š' + result.receiptNo);
          closeModal('addIncomeModal');
          loadFinancial();
          document.getElementById('addIncomeForm').reset();
        } else {
          alert('æ–°å¢å¤±æ•—ï¼š' + result.message);
        }
      }
      
      async function addExpense(event) {
        event.preventDefault();
        const result = await callAPI('addExpense', {
          item: document.getElementById('newExpenseItem').value,
          amount: document.getElementById('newExpenseAmount').value,
          date: document.getElementById('newExpenseDate').value,
          recipient: document.getElementById('newExpenseRecipient').value,
          handler: document.getElementById('newExpenseHandler').value,
          note: document.getElementById('newExpenseNote').value
        });
        
        if (result.success) {
          alert('æ”¯å‡ºç´€éŒ„æ–°å¢æˆåŠŸï¼æ†‘è­‰ç·¨è™Ÿï¼š' + result.voucherNo);
          closeModal('addExpenseModal');
          loadFinancial();
          document.getElementById('addExpenseForm').reset();
        } else {
          alert('æ–°å¢å¤±æ•—ï¼š' + result.message);
        }
      }
      
      function searchMembers() {
        const keyword = document.getElementById('memberSearch').value.toLowerCase();
        const filtered = allMembers.filter(m => 
          m.name.toLowerCase().includes(keyword) ||
          m.phone.includes(keyword) ||
          m.memberId.toLowerCase().includes(keyword)
        );
        displayMembers(filtered);
      }
      
      function searchVolunteers() {
        const keyword = document.getElementById('volunteerSearch').value.toLowerCase();
        // å¯¦ä½œæœå°‹é‚è¼¯
      }
      
      function viewMember(memberId) {
        alert('æª¢è¦–æœƒå“¡ï¼š' + memberId);
        // å¯¦ä½œæª¢è¦–æœƒå“¡è©³ç´°è³‡æ–™
      }
      
      function viewActivity(activityId) {
        alert('æª¢è¦–æ´»å‹•ï¼š' + activityId);
        // å¯¦ä½œæª¢è¦–æ´»å‹•è©³ç´°è³‡æ–™
      }
      
      function editActivity(activityId) {
        alert('ç·¨è¼¯æ´»å‹•ï¼š' + activityId);
        // å¯¦ä½œç·¨è¼¯æ´»å‹•åŠŸèƒ½
      }
      
      function generateReport() {
        const reportType = document.getElementById('reportType').value;
        const reportPeriod = document.getElementById('reportPeriod').value;
        
        let html = '<div class="alert alert-info">æ­£åœ¨ç”¢ç”Ÿå ±è¡¨...</div>';
        document.getElementById('reportContent').innerHTML = html;
        
        setTimeout(() => {
          html = `<h3>${getReportTitle(reportType)} - ${getPeriodTitle(reportPeriod)}</h3>`;
          html += '<div class="stats-grid">';
          html += '<div class="stat-card"><h3>çµ±è¨ˆé …ç›®1</h3><div class="number">123</div></div>';
          html += '<div class="stat-card"><h3>çµ±è¨ˆé …ç›®2</h3><div class="number">456</div></div>';
          html += '<div class="stat-card"><h3>çµ±è¨ˆé …ç›®3</h3><div class="number">789</div></div>';
          html += '</div>';
          document.getElementById('reportContent').innerHTML = html;
        }, 1000);
      }
      
      function getReportTitle(type) {
        const titles = {
          member: 'æœƒå“¡çµ±è¨ˆå ±è¡¨',
          activity: 'æ´»å‹•çµ±è¨ˆå ±è¡¨',
          donation: 'ææ¬¾çµ±è¨ˆå ±è¡¨',
          financial: 'è²¡å‹™çµ±è¨ˆå ±è¡¨'
        };
        return titles[type] || 'çµ±è¨ˆå ±è¡¨';
      }
      
      function getPeriodTitle(period) {
        const titles = {
          month: 'æœ¬æœˆ',
          quarter: 'æœ¬å­£',
          year: 'æœ¬å¹´',
          all: 'å…¨éƒ¨æœŸé–“'
        };
        return titles[period] || 'å…¨éƒ¨';
      }
      
      function exportReport() {
        alert('å ±è¡¨åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­...');
        // å¯¦ä½œåŒ¯å‡ºç‚º Excel æˆ– PDF
      }
      
      function logout() {
        if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
          window.location.href = 'login.html';
        }
      }
    </script>
  </body>
  </html>

          

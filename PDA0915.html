<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>帕金森病友會管理系統</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<meta name="theme-color" content="#2E7D32">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
:root {
--primary: #2E7D32;
--primary-light: #4CAF50;
--secondary: #1976D2;
--success: #4CAF50;
--warning: #FF9800;
--error: #F44336;
--bg: #F5F5F5;
--card: #FFFFFF;
--text: #212121;
--text-secondary: #757575;
--border: #E0E0E0;
--shadow: 0 2px 8px rgba(0,0,0,0.1);
--radius: 12px;
}

* {
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}

body {
margin: 0;
padding: 0;
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
background: var(--bg);
color: var(--text);
font-size: 18px;
line-height: 1.6;
}

/* 適合年長者的大字體設計 */
.header {
background: linear-gradient(135deg, var(--primary), var(--primary-light));
color: white;
padding: 24px 20px;
text-align: center;
position: sticky;
top: 0;
z-index: 100;
box-shadow: var(--shadow);
}

.header h1 {
margin: 0;
font-size: 24px;
font-weight: 600;
}

.header .subtitle {
margin-top: 8px;
font-size: 16px;
opacity: 0.9;
}

.container {
max-width: 480px;
margin: 0 auto;
padding: 20px;
}

/* 大按鈕設計 */
.tab-nav {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 12px;
margin-bottom: 24px;
}

.tab-btn {
background: white;
border: 3px solid var(--border);
border-radius: var(--radius);
padding: 20px 16px;
text-align: center;
cursor: pointer;
font-size: 18px;
font-weight: 600;
color: var(--text);
transition: all 0.3s ease;
min-height: 80px;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
gap: 8px;
}

.tab-btn.active {
background: var(--primary);
color: white;
border-color: var(--primary);
transform: translateY(-2px);
box-shadow: var(--shadow);
}

.tab-btn:hover:not(.active) {
border-color: var(--primary);
transform: translateY(-1px);
}

.tab-btn .icon {
font-size: 24px;
}

.tab-btn .text {
font-size: 16px;
}

/* 卡片設計 */
.card {
background: var(--card);
border-radius: var(--radius);
padding: 24px;
margin-bottom: 20px;
box-shadow: var(--shadow);
border: 1px solid var(--border);
}

.card-title {
font-size: 20px;
font-weight: 600;
margin: 0 0 20px 0;
color: var(--primary);
display: flex;
align-items: center;
gap: 12px;
}

/* 表單控制項 */
.form-group {
margin-bottom: 20px;
}

.form-label {
display: block;
font-size: 16px;
font-weight: 600;
margin-bottom: 8px;
color: var(--text);
}

.form-label.required::after {
content: ' *';
color: var(--error);
}

.form-input, .form-select, .form-textarea {
width: 100%;
padding: 16px;
font-size: 18px;
border: 2px solid var(--border);
border-radius: var(--radius);
background: white;
color: var(--text);
transition: border-color 0.3s ease;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
}

.form-textarea {
min-height: 120px;
resize: vertical;
}

/* 大按鈕 */
.btn {
display: inline-flex;
align-items: center;
justify-content: center;
gap: 8px;
padding: 18px 24px;
font-size: 18px;
font-weight: 600;
border: none;
border-radius: var(--radius);
cursor: pointer;
transition: all 0.3s ease;
min-height: 56px;
text-decoration: none;
box-shadow: var(--shadow);
}

.btn-primary {
background: var(--primary);
color: white;
}

.btn-primary:hover {
background: var(--primary-light);
transform: translateY(-2px);
}

.btn-secondary {
background: var(--secondary);
color: white;
}

.btn-success {
background: var(--success);
color: white;
}

.btn-warning {
background: var(--warning);
color: white;
}

.btn-danger {
background: var(--error);
color: white;
}

.btn-outline {
background: white;
color: var(--primary);
border: 2px solid var(--primary);
}

.btn-block {
width: 100%;
}

.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
transform: none !important;
}

.btn.loading {
position: relative;
color: transparent;
}

.btn.loading::after {
content: '';
position: absolute;
width: 20px;
height: 20px;
border: 2px solid transparent;
border-top: 2px solid currentColor;
border-radius: 50%;
animation: spin 1s linear infinite;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

/* 活動卡片 */
.activity-card {
background: white;
border-radius: var(--radius);
padding: 20px;
margin-bottom: 16px;
box-shadow: var(--shadow);
border-left: 4px solid var(--primary);
}

.activity-card.full {
border-left-color: var(--error);
opacity: 0.8;
}

.activity-title {
font-size: 20px;
font-weight: 600;
margin: 0 0 12px 0;
color: var(--text);
}

.activity-meta {
display: flex;
flex-wrap: wrap;
gap: 16px;
margin-bottom: 12px;
font-size: 16px;
color: var(--text-secondary);
}

.activity-meta .item {
display: flex;
align-items: center;
gap: 6px;
}

.activity-description {
font-size: 16px;
line-height: 1.5;
color: var(--text-secondary);
margin-bottom: 16px;
}

.activity-actions {
display: flex;
gap: 12px;
flex-wrap: wrap;
}

/* 狀態標籤 */
.badge {
display: inline-flex;
align-items: center;
padding: 6px 12px;
font-size: 14px;
font-weight: 600;
border-radius: 20px;
gap: 4px;
}

.badge-success {
background: rgba(76, 175, 80, 0.1);
color: var(--success);
}

.badge-warning {
background: rgba(255, 152, 0, 0.1);
color: var(--warning);
}

.badge-error {
background: rgba(244, 67, 54, 0.1);
color: var(--error);
}

.badge-info {
background: rgba(25, 118, 210, 0.1);
color: var(--secondary);
}

/* 統計卡片 */
.stats-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 16px;
margin-bottom: 24px;
}

.stat-card {
background: white;
padding: 20px;
border-radius: var(--radius);
text-align: center;
box-shadow: var(--shadow);
border-top: 4px solid var(--primary);
}

.stat-number {
font-size: 32px;
font-weight: 700;
color: var(--primary);
margin-bottom: 8px;
}

.stat-label {
font-size: 16px;
color: var(--text-secondary);
}

/* 列表項目 */
.list-item {
background: white;
padding: 20px;
border-radius: var(--radius);
margin-bottom: 16px;
box-shadow: var(--shadow);
border-left: 4px solid var(--primary);
}

.list-item-title {
font-size: 18px;
font-weight: 600;
margin: 0 0 12px 0;
}

.list-item-meta {
font-size: 16px;
color: var(--text-secondary);
margin-bottom: 12px;
}

.list-item-content {
font-size: 16px;
line-height: 1.5;
margin-bottom: 16px;
}

/* 通知 */
.notification {
position: fixed;
top: 20px;
left: 20px;
right: 20px;
background: var(--text);
color: white;
padding: 16px 20px;
border-radius: var(--radius);
box-shadow: 0 4px 12px rgba(0,0,0,0.3);
z-index: 1000;
transform: translateY(-100px);
opacity: 0;
transition: all 0.3s ease;
font-size: 16px;
}

.notification.show {
transform: translateY(0);
opacity: 1;
}

.notification.success {
background: var(--success);
}

.notification.error {
background: var(--error);
}

.notification.warning {
background: var(--warning);
}

/* 空狀態 */
.empty-state {
text-align: center;
padding: 40px 20px;
color: var(--text-secondary);
}

.empty-state .icon {
font-size: 48px;
margin-bottom: 16px;
}

.empty-state .text {
font-size: 18px;
}

/* 載入狀態 */
.loading-state {
text-align: center;
padding: 40px 20px;
color: var(--text-secondary);
}

.loading-spinner {
width: 40px;
height: 40px;
border: 4px solid var(--border);
border-top: 4px solid var(--primary);
border-radius: 50%;
animation: spin 1s linear infinite;
margin: 0 auto 16px;
}

/* 隱藏/顯示 */
.hidden {
display: none !important;
}

.panel {
display: none;
}

.panel.active {
display: block;
animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

/* 管理員專用 */
.admin-only {
display: none;
}

.admin-only.show {
display: block;
}

/* 響應式調整 */
@media (max-width: 360px) {
.container {
  padding: 16px;
}

.tab-nav {
  grid-template-columns: 1fr;
}

.stats-grid {
  grid-template-columns: 1fr;
}
}

/* 志工相關樣式 */
.volunteer-card {
background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
border-left: 4px solid var(--success);
}

.volunteer-hours {
background: var(--success);
color: white;
padding: 8px 16px;
border-radius: 20px;
font-weight: 600;
display: inline-block;
margin-top: 8px;
}

/* 財務相關樣式 */
.finance-card {
background: linear-gradient(135deg, #E3F2FD, #F3E5F5);
border-left: 4px solid var(--secondary);
}

.amount-positive {
color: var(--success);
font-weight: 600;
}

.amount-negative {
color: var(--error);
font-weight: 600;
}

/* 提案相關樣式 */
.proposal-card {
background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
border-left: 4px solid var(--warning);
}

.proposal-status {
padding: 4px 12px;
border-radius: 16px;
font-size: 14px;
font-weight: 600;
}

.proposal-status.pending {
background: rgba(255, 152, 0, 0.1);
color: var(--warning);
}

.proposal-status.approved {
background: rgba(76, 175, 80, 0.1);
color: var(--success);
}

.proposal-status.rejected {
background: rgba(244, 67, 54, 0.1);
color: var(--error);
}
</style>
</head>
<body>

<div class="header">
<h1>🏥 帕金森病友會</h1>
<div class="subtitle">關懷互助 • 共同成長</div>
</div>

<div class="container">
<!-- 使用者資訊卡片 -->
<div id="user-info-card" class="card hidden">
  <div class="card-title">
    <span>👤</span>
    <span>個人資訊</span>
  </div>
  <div id="user-details"></div>
</div>

<!-- 主選單 -->
<div class="tab-nav" id="main-tabs">
  <div class="tab-btn active" data-tab="profile">
    <div class="icon">👤</div>
    <div class="text">個人資料</div>
  </div>
  <div class="tab-btn" data-tab="activities">
    <div class="icon">📅</div>
    <div class="text">活動報名</div>
  </div>
  <div class="tab-btn" data-tab="volunteer">
    <div class="icon">🤝</div>
    <div class="text">志工服務</div>
  </div>
  <div class="tab-btn" data-tab="donation">
    <div class="icon">💝</div>
    <div class="text">捐款記錄</div>
  </div>
  <div class="tab-btn" data-tab="expense">
    <div class="icon">💸</div>
    <div class="text">支出申請</div>
  </div>
  <div class="tab-btn" data-tab="feedback">
    <div class="icon">📝</div>
    <div class="text">活動回饋</div>
  </div>
  <div class="tab-btn admin-only" data-tab="admin">
    <div class="icon">⚙️</div>
    <div class="text">系統管理</div>
  </div>
  <div class="tab-btn admin-only" data-tab="board">
    <div class="icon">🏛️</div>
    <div class="text">理監事會</div>
  </div>
</div>

<!-- 個人資料頁面 -->
<div class="panel active" id="panel-profile">
  <div class="card">
    <div class="card-title">
      <span>📝</span>
      <span>會員註冊</span>
    </div>
    
    <div class="form-group">
      <label class="form-label required">真實姓名</label>
      <input type="text" class="form-input" id="realName" placeholder="請輸入您的真實姓名">
    </div>
    
    <div class="form-group">
      <label class="form-label required">會員類別</label>
      <select class="form-select" id="memberType">
        <option value="">請選擇會員類別</option>
        <option value="patient">病友</option>
        <option value="family">家屬</option>
        <option value="volunteer">志工</option>
        <option value="medical">醫護人員</option>
        <option value="supporter">支持者</option>
      </select>
    </div>
    
    <button class="btn btn-primary btn-block" id="btn-register">
      <span>註冊 / 更新資料</span>
    </button>
  </div>

  <div class="card">
    <div class="card-title">
      <span>📞</span>
      <span>聯絡資訊</span>
    </div>
    
    <div class="form-group">
      <label class="form-label">電話號碼</label>
      <input type="tel" class="form-input" id="phone" placeholder="例：0912345678">
    </div>
    
    <div class="form-group">
      <label class="form-label">電子郵件</label>
      <input type="email" class="form-input" id="email" placeholder="example@email.com">
    </div>
    
    <div class="form-group">
      <label class="form-label">地址</label>
      <input type="text" class="form-input" id="address" placeholder="請輸入您的地址">
    </div>
    
    <div class="form-group">
      <label class="form-label">生日</label>
      <input type="date" class="form-input" id="birthday">
    </div>
    
    <button class="btn btn-secondary btn-block" id="btn-update-contact">
      <span>更新聯絡資訊</span>
    </button>
  </div>
</div>

<!-- 活動報名頁面 -->
<div class="panel" id="panel-activities">
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number" id="stat-available-activities">0</div>
      <div class="stat-label">可報名活動</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="stat-my-registrations">0</div>
      <div class="stat-label">我的報名</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">
      <span>📅</span>
      <span>可報名活動</span>
    </div>
    <div id="activities-list"></div>
  </div>

  <div class="card">
    <div class="card-title">
      <span>📋</span>
      <span>我的報名記錄</span>
    </div>
    <div id="my-activities-list"></div>
  </div>
</div>

<!-- 志工服務頁面 -->
<div class="panel" id="panel-volunteer">
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number" id="stat-volunteer-hours">0</div>
      <div class="stat-label">累積時數</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="stat-volunteer-activities">0</div>
      <div class="stat-label">服務次數</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">
      <span>🤝</span>
      <span>志工登記</span>
    </div>
    <div id="volunteer-opportunities-list"></div>
  </div>

  <div class="card">
    <div class="card-title">
      <span>⏰</span>
      <span>我的服務記錄</span>
    </div>
    <div id="my-volunteer-records"></div>
  </div>
</div>

<!-- 捐款記錄頁面 -->
<div class="panel" id="panel-donation">
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number" id="stat-donation-count">0</div>
      <div class="stat-label">捐款次數</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="stat-donation-total">$0</div>
      <div class="stat-label">捐款總額</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">
      <span>💝</span>
      <span>新增捐款</span>
    </div>
    
    <div class="form-group">
      <label class="form-label required">捐款金額</label>
      <input type="number" class="form-input" id="donation-amount" min="1" placeholder="請輸入捐款金額">
    </div>
    
    <div class="form-group">
      <label class="form-label">捐款項目</label>
      <select class="form-select" id="donation-category">
        <option value="general">一般捐款</option>
        <option value="activity">活動支持</option>
        <option value="medical">醫療協助</option>
        <option value="equipment">設備購置</option>
        <option value="other">其他用途</option>
      </select>
    </div>
    
    <div class="form-group">
      <label class="form-label">捐款人姓名</label>
      <input type="text" class="form-input" id="donor-name" placeholder="留空則為匿名捐款">
    </div>
    
    <div class="form-group">
      <label class="form-label">備註</label>
      <textarea class="form-textarea" id="donation-notes" placeholder="捐款用途或特別說明"></textarea>
    </div>
    
    <button class="btn btn-success btn-block" id="btn-add-donation">
      <span>新增捐款記錄</span>
    </button>
  </div>

  <div class="card">
    <div class="card-title">
      <span>📊</span>
      <span>我的捐款記錄</span>
    </div>
    <div id="donations-list"></div>
  </div>
</div>

<!-- 支出申請頁面 -->
<div class="panel" id="panel-expense">
  <div class="card">
    <div class="card-title">
      <span>💸</span>
      <span>支出申請</span>
    </div>
    
    <div class="form-group">
      <label class="form-label required">支出類別</label>
      <select class="form-select" id="expense-category">
        <option value="">請選擇支出類別</option>
        <option value="activity">活動支出</option>
        <option value="office">辦公費用</option>
        <option value="marketing">宣傳費用</option>
        <option value="equipment">設備費用</option>
        <option value="welfare">福利支出</option>
        <option value="medical">醫療支援</option>
        <option value="volunteer">志工費用</option>
        <option value="other">其他支出</option>
      </select>
    </div>
    
    <div class="form-group">
      <label class="form-label required">申請金額</label>
      <input type="number" class="form-input" id="expense-amount" min="1" placeholder="請輸入申請金額">
    </div>
    
    <div class="form-group">
      <label class="form-label required">支出說明</label>
      <textarea class="form-textarea" id="expense-description" placeholder="請詳細說明支出用途和必要性"></textarea>
    </div>
    
    <button class="btn btn-warning btn-block" id="btn-submit-expense">
      <span>提交支出申請</span>
    </button>
  </div>

  <div class="card">
    <div class="card-title">
      <span>📋</span>
      <span>我的申請記錄</span>
    </div>
    <div id="my-expenses-list"></div>
  </div>
</div>

<!-- 活動回饋頁面 -->
<div class="panel" id="panel-feedback">
  <div class="card">
    <div class="card-title">
      <span>📝</span>
      <span>活動回饋</span>
    </div>
    
    <div class="form-group">
      <label class="form-label required">選擇活動</label>
      <select class="form-select" id="feedback-activity">
        <option value="">請選擇已參與的活動</option>
      </select>
    </div>
    
    <div class="form-group">
      <label class="form-label required">整體評分</label>
      <select class="form-select" id="feedback-rating">
        <option value="">請選擇評分</option>
        <option value="5">⭐⭐⭐⭐⭐ 非常滿意</option>
        <option value="4">⭐⭐⭐⭐ 滿意</option>
        <option value="3">⭐⭐⭐ 普通</option>
        <option value="2">⭐⭐ 不滿意</option>
        <option value="1">⭐ 非常不滿意</option>
      </select>
    </div>
    
    <div class="form-group">
      <label class="form-label">意見與建議</label>
      <textarea class="form-textarea" id="feedback-comment" placeholder="請分享您的參與心得和改進建議"></textarea>
    </div>
    
    <button class="btn btn-primary btn-block" id="btn-submit-feedback">
      <span>提交回饋</span>
    </button>
  </div>

  <div class="card">
    <div class="card-title">
      <span>📊</span>
      <span>我的回饋記錄</span>
    </div>
    <div id="my-feedback-list"></div>
  </div>
</div>

<!-- 系統管理頁面 -->
<div class="panel admin-only" id="panel-admin">
  <div class="tab-nav">
    <div class="tab-btn active" data-subtab="overview">
      <div class="icon">📊</div>
      <div class="text">總覽</div>
    </div>
    <div class="tab-btn" data-subtab="members">
      <div class="icon">👥</div>
      <div class="text">會員管理</div>
    </div>
    <div class="tab-btn" data-subtab="activities">
      <div class="icon">📅</div>
      <div class="text">活動管理</div>
    </div>
    <div class="tab-btn" data-subtab="finance">
      <div class="icon">💰</div>
      <div class="text">財務管理</div>
    </div>
  </div>

  <!-- 管理總覽 -->
  <div class="admin-panel active" id="admin-overview">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="admin-stat-members">0</div>
        <div class="stat-label">總會員數</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="admin-stat-activities">0</div>
        <div class="stat-label">活動數量</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="admin-stat-volunteers">0</div>
        <div class="stat-label">志工人數</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="admin-stat-donations">$0</div>
        <div class="stat-label">總捐款額</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">
        <span>🎯</span>
        <span>建立新活動</span>
      </div>
      
      <div class="form-group">
        <label class="form-label required">活動名稱</label>
        <input type="text" class="form-input" id="new-activity-name" placeholder="請輸入活動名稱">
      </div>
      
      <div class="form-group">
        <label class="form-label required">活動日期</label>
        <input type="datetime-local" class="form-input" id="new-activity-date">
      </div>
      
      <div class="form-group">
        <label class="form-label">活動地點</label>
        <input type="text" class="form-input" id="new-activity-location" placeholder="請輸入活動地點">
      </div>
      
      <div class="form-group">
        <label class="form-label">最大人數</label>
        <input type="number" class="form-input" id="new-activity-max" min="1" placeholder="不填寫表示不限人數">
      </div>
      
      <div class="form-group">
        <label class="form-label">報名費用</label>
        <input type="number" class="form-input" id="new-activity-fee" min="0" value="0" placeholder="0表示免費">
      </div>
      
      <div class="form-group">
        <label class="form-label">志工需求人數</label>
        <input type="number" class="form-input" id="new-activity-volunteer-needed" min="0" value="0">
      </div>
      
      <div class="form-group">
        <label class="form-label">志工專業需求</label>
        <input type="text" class="form-input" id="new-activity-volunteer-skills" placeholder="例：醫護背景、活動企劃經驗等">
      </div>
      
      <div class="form-group">
        <label class="form-label required">活動描述</label>
        <textarea class="form-textarea" id="new-activity-description" placeholder="請詳細描述活動內容、目的和注意事項"></textarea>
      </div>
      
      <button class="btn btn-primary btn-block" id="btn-create-activity">
        <span>建立活動</span>
      </button>
    </div>
  </div>

  <!-- 其他管理面板內容省略，實際使用時需要完整實現 -->
</div>

<!-- 理監事會頁面 -->
<div class="panel admin-only" id="panel-board">
  <div class="card">
    <div class="card-title">
      <span>🏛️</span>
      <span>理監事會功能</span>
    </div>
    <div class="empty-state">
      <div class="icon">🚧</div>
      <div class="text">理監事會功能開發中...</div>
    </div>
  </div>
</div>
</div>

<!-- 通知容器 -->
<div id="notification-container"></div>

<script>
// 應用程式配置
const APP_CONFIG = {
LIFF_ID: '1656516134-VaGgmaPm',
API_URL: 'https://script.google.com/macros/s/AKfycbxLimHEenjW3E5wcuEbJWgkwE5CclLhk_su6TsHy366pLWXmNDMsZLhb5ZSzKTzmb_N1Q/exec',
API_KEY: 'AAbb8520258185202581'
};

// 全域變數
let currentUser = null;
let isAdmin = false;

// 工具函數
function formatDate(date) {
if (!date) return '';
const d = new Date(date);
return d.toLocaleDateString('zh-TW');
}

function formatDateTime(date) {
if (!date) return '';
const d = new Date(date);
return d.toLocaleString('zh-TW');
}

function formatCurrency(amount) {
return new Intl.NumberFormat('zh-TW', {
  style: 'currency',
  currency: 'TWD',
  minimumFractionDigits: 0
}).format(amount || 0);
}

function showNotification(message, type = 'info', duration = 4000) {
const container = document.getElementById('notification-container');
const notification = document.createElement('div');
notification.className = `notification ${type}`;
notification.textContent = message;

container.appendChild(notification);

// 顯示動畫
setTimeout(() => notification.classList.add('show'), 100);

// 自動隱藏
setTimeout(() => {
  notification.classList.remove('show');
  setTimeout(() => container.removeChild(notification), 300);
}, duration);
}

function setLoading(button, loading) {
if (loading) {
  button.classList.add('loading');
  button.disabled = true;
} else {
  button.classList.remove('loading');
  button.disabled = false;
}
}

// API 呼叫函數
async function callAPI(action, data = {}) {
try {
  const response = await fetch(APP_CONFIG.API_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      action,
      apiKey: APP_CONFIG.API_KEY,
      timestamp: Date.now(),
      ...data
    })
  });
  
  const result = await response.json();
  return result;
} catch (error) {
  console.error('API Error:', error);
  return { success: false, message: '網路連線錯誤' };
}
}

// LIFF 初始化
async function initLiff() {
try {
  await liff.init({ liffId: APP_CONFIG.LIFF_ID });
  
  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }
  
  const profile = await liff.getProfile();
  
  // 建立或更新使用者
  await callAPI('createUserIfNotExist', {
    lineId: profile.userId,
    lineName: profile.displayName
  });
  
  // 載入使用者資訊
  await loadUserInfo(profile.userId);
  
  // 初始化介面
  initializeUI();
  
  showNotification('系統載入完成', 'success');
  
} catch (error) {
  console.error('LIFF初始化失敗:', error);
  showNotification('系統初始化失敗', 'error');
}
}

// 載入使用者資訊
async function loadUserInfo(lineId) {
const result = await callAPI('getUserInfo', { lineId });

if (result.success) {
  currentUser = result.data;
  isAdmin = currentUser.isAdmin;
  
  // 顯示使用者資訊
  displayUserInfo();
  
  // 顯示管理員功能
  if (isAdmin) {
    document.querySelectorAll('.admin-only').forEach(el => {
      el.classList.add('show');
    });
  }
}
}

// 顯示使用者資訊
function displayUserInfo() {
const userCard = document.getElementById('user-info-card');
const userDetails = document.getElementById('user-details');

if (!currentUser) {
  userCard.classList.add('hidden');
  return;
}

const memberTypeMap = {
  patient: '病友',
  family: '家屬',
  volunteer: '志工',
  medical: '醫護人員',
  supporter: '支持者'
};

userDetails.innerHTML = `
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 16px;">
    <div><strong>姓名：</strong>${currentUser.realName || '未設定'}</div>
    <div><strong>LINE名稱：</strong>${currentUser.lineName || ''}</div>
    <div><strong>會員類別：</strong>${memberTypeMap[currentUser.memberType] || '未設定'}</div>
    <div><strong>註冊狀態：</strong>
      <span class="badge ${currentUser.status === '已註冊' ? 'badge-success' : 'badge-warning'}">
        ${currentUser.status || '未註冊'}
      </span>
    </div>
  </div>
`;

userCard.classList.remove('hidden');

// 填入表單欄位
if (currentUser.realName) {
  document.getElementById('realName').value = currentUser.realName;
}
if (currentUser.memberType) {
  document.getElementById('memberType').value = currentUser.memberType;
}
if (currentUser.phone) {
  document.getElementById('phone').value = currentUser.phone;
}
if (currentUser.email) {
  document.getElementById('email').value = currentUser.email;
}
if (currentUser.address) {
  document.getElementById('address').value = currentUser.address;
}
if (currentUser.birthday) {
  const date = new Date(currentUser.birthday);
  document.getElementById('birthday').value = date.toISOString().split('T')[0];
}
}

// 初始化UI
function initializeUI() {
// 分頁切換
document.querySelectorAll('[data-tab]').forEach(tab => {
  tab.addEventListener('click', () => switchTab(tab.dataset.tab));
});

// 子分頁切換
document.querySelectorAll('[data-subtab]').forEach(tab => {
  tab.addEventListener('click', () => switchSubTab(tab.dataset.subtab));
});

// 綁定按鈕事件
bindButtonEvents();

// 載入初始資料
loadInitialData();
}

// 分頁切換
function switchTab(tabName) {
// 更新分頁按鈕狀態
document.querySelectorAll('[data-tab]').forEach(tab => {
  tab.classList.toggle('active', tab.dataset.tab === tabName);
});

// 顯示對應面板
document.querySelectorAll('.panel').forEach(panel => {
  panel.classList.toggle('active', panel.id === `panel-${tabName}`);
});

// 載入對應資料
loadTabData(tabName);
}

// 子分頁切換
function switchSubTab(subtabName) {
// 更新子分頁按鈕狀態
document.querySelectorAll('[data-subtab]').forEach(tab => {
  tab.classList.toggle('active', tab.dataset.subtab === subtabName);
});

// 顯示對應面板
document.querySelectorAll('.admin-panel').forEach(panel => {
  panel.classList.toggle('active', panel.id === `admin-${subtabName}`);
});
}

// 綁定按鈕事件
function bindButtonEvents() {
// 註冊按鈕
document.getElementById('btn-register').addEventListener('click', handleRegister);

// 更新聯絡資訊按鈕
document.getElementById('btn-update-contact').addEventListener('click', handleUpdateContact);

// 新增捐款按鈕
document.getElementById('btn-add-donation').addEventListener('click', handleAddDonation);

// 提交支出申請按鈕
document.getElementById('btn-submit-expense').addEventListener('click', handleSubmitExpense);

// 提交回饋按鈕
document.getElementById('btn-submit-feedback').addEventListener('click', handleSubmitFeedback);

// 建立活動按鈕
document.getElementById('btn-create-activity').addEventListener('click', handleCreateActivity);
}

// 載入初始資料
function loadInitialData() {
loadActivities();
loadMyActivities();
loadDonations();
loadMyExpenses();
loadMyFeedback();
loadVolunteerData();
}

// 載入分頁資料
function loadTabData(tabName) {
switch (tabName) {
  case 'activities':
    loadActivities();
    loadMyActivities();
    break;
  case 'volunteer':
    loadVolunteerData();
    break;
  case 'donation':
    loadDonations();
    break;
  case 'expense':
    loadMyExpenses();
    break;
  case 'feedback':
    loadMyFeedback();
    loadFeedbackActivities();
    break;
  case 'admin':
    if (isAdmin) loadAdminData();
    break;
}
}

// 處理註冊
async function handleRegister() {
const realName = document.getElementById('realName').value.trim();
const memberType = document.getElementById('memberType').value;

if (!realName || !memberType) {
  showNotification('請填寫完整的註冊資訊', 'warning');
  return;
}

const button = document.getElementById('btn-register');
setLoading(button, true);

try {
  const result = await callAPI('register', {
    lineId: currentUser.lineId,
    realName,
    memberType
  });
  
  if (result.success) {
    showNotification('註冊成功！', 'success');
    await loadUserInfo(currentUser.lineId);
  } else {
    showNotification(result.message || '註冊失敗', 'error');
  }
} finally {
  setLoading(button, false);
}
}

// 處理更新聯絡資訊
async function handleUpdateContact() {
const phone = document.getElementById('phone').value.trim();
const email = document.getElementById('email').value.trim();
const address = document.getElementById('address').value.trim();
const birthday = document.getElementById('birthday').value;

const button = document.getElementById('btn-update-contact');
setLoading(button, true);

try {
  const result = await callAPI('updateUserContact', {
    targetLineId: currentUser.lineId,
    phone,
    email,
    address,
    birthday
  });
  
  if (result.success) {
    showNotification('聯絡資訊更新成功！', 'success');
    await loadUserInfo(currentUser.lineId);
  } else {
    showNotification(result.message || '更新失敗', 'error');
  }
} finally {
  setLoading(button, false);
}
}

// 載入活動列表
async function loadActivities() {
const result = await callAPI('getActivities');
const container = document.getElementById('activities-list');

if (!result.success) {
  container.innerHTML = '<div class="empty-state"><div class="icon">❌</div><div class="text">載入活動失敗</div></div>';
  return;
}

const activities = result.data || [];
document.getElementById('stat-available-activities').textContent = activities.length;

if (activities.length === 0) {
  container.innerHTML = '<div class="empty-state"><div class="icon">📅</div><div class="text">目前沒有可報名的活動</div></div>';
  return;
}

container.innerHTML = activities.map(activity => {
  const isFull = activity.maxParticipants && activity.currentParticipants >= activity.maxParticipants;
  const volunteerInfo = activity.volunteerNeeded > 0 ? 
    `<div class="item"><span>🤝</span>志工需求：${activity.volunteerCurrent || 0}/${activity.volunteerNeeded}</div>` : '';
  
  return `
    <div class="activity-card ${isFull ? 'full' : ''}">
      <div class="activity-title">${activity.name}</div>
      <div class="activity-meta">
        <div class="item"><span>📅</span>${formatDateTime(activity.date)}</div>
        <div class="item"><span>📍</span>${activity.location || '待定'}</div>
        <div class="item"><span>👥</span>${activity.currentParticipants || 0}/${activity.maxParticipants || '不限'}</div>
        <div class="item"><span>💰</span>${activity.fee > 0 ? formatCurrency(activity.fee) : '免費'}</div>
        ${volunteerInfo}
      </div>
      <div class="activity-description">${activity.description || ''}</div>
      <div class="activity-actions">
        ${isFull ? 
          '<span class="badge badge-error">已額滿</span>' : 
          `<button class="btn btn-primary" onclick="registerActivity('${activity.id}')">報名參加</button>`
        }
        ${activity.volunteerNeeded > 0 && (!activity.volunteerCurrent || activity.volunteerCurrent < activity.volunteerNeeded) ?
          `<button class="btn btn-success" onclick="registerVolunteer('${activity.id}')">志工登記</button>` : ''
        }
      </div>
    </div>
  `;
}).join('');
}

// 報名活動
async function registerActivity(activityId) {
if (!currentUser || currentUser.status !== '已註冊') {
  showNotification('請先完成會員註冊', 'warning');
  switchTab('profile');
  return;
}

if (!confirm('確認要報名這個活動嗎？')) return;

const result = await callAPI('registerActivity', {
  lineId: currentUser.lineId,
  activityId,
  participantName: currentUser.realName || currentUser.lineName
});

if (result.success) {
  showNotification('報名成功！', 'success');
  loadActivities();
  loadMyActivities();
} else {
  showNotification(result.message || '報名失敗', 'error');
}
}

// 志工登記
async function registerVolunteer(activityId) {
if (!currentUser || currentUser.status !== '已註冊') {
  showNotification('請先完成會員註冊', 'warning');
  switchTab('profile');
  return;
}

const skills = prompt('請輸入您的專業技能或相關經驗（可留空）：') || '';

const result = await callAPI('registerVolunteer', {
  lineId: currentUser.lineId,
  activityId,
  volunteerName: currentUser.realName || currentUser.lineName,
  skills,
  phone: currentUser.phone || ''
});

if (result.success) {
  showNotification('志工登記成功！', 'success');
  loadActivities();
  loadVolunteerData();
} else {
  showNotification(result.message || '志工登記失敗', 'error');
}
}

// 載入我的活動報名
async function loadMyActivities() {
if (!currentUser) return;

const result = await callAPI('getMyRegistrations', { lineId: currentUser.lineId });
const container = document.getElementById('my-activities-list');

if (!result.success) {
  container.innerHTML = '<div class="empty-state"><div class="icon">❌</div><div class="text">載入失敗</div></div>';
  return;
}

const registrations = result.data || [];
document.getElementById('stat-my-registrations').textContent = registrations.length;

if (registrations.length === 0) {
  container.innerHTML = '<div class="empty-state"><div class="icon">📋</div><div class="text">您還沒有報名任何活動</div></div>';
  return;
}

container.innerHTML = registrations.map(reg => `
  <div class="list-item">
    <div class="list-item-title">${reg.activityName}</div>
    <div class="list-item-meta">
      報名日期：${formatDate(reg.registrationDate)} • 
      狀態：<span class="badge badge-${reg.status === '已確認' ? 'success' : 'warning'}">${reg.status}</span>
    </div>
    <div class="list-item-content">
      活動日期：${formatDateTime(reg.activityDate)}<br>
      活動地點：${reg.activityLocation || '待定'}
    </div>
    <button class="btn btn-outline" onclick="cancelRegistration('${reg.registrationId}')">
      取消報名
    </button>
  </div>
`).join('');
}

// 取消報名
async function cancelRegistration(registrationId) {
if (!confirm('確認要取消報名嗎？')) return;

const result = await callAPI('cancelRegistration', {
  lineId: currentUser.lineId,
  registrationId
});

if (result.success) {
  showNotification('已取消報名', 'success');
  loadActivities();
  loadMyActivities();
} else {
  showNotification(result.message || '取消失敗', 'error');
}
}

// 載入志工資料
async function loadVolunteerData() {
if (!currentUser) return;

// 載入志工統計
const statsResult = await callAPI('getVolunteerStats', { lineId: currentUser.lineId });
if (statsResult.success) {
  document.getElementById('stat-volunteer-hours').textContent = statsResult.data.totalHours || 0;
  document.getElementById('stat-volunteer-activities').textContent = statsResult.data.totalActivities || 0;
}

// 載入志工機會
const opportunitiesResult = await callAPI('getVolunteerOpportunities');
const opportunitiesContainer = document.getElementById('volunteer-opportunities-list');

if (opportunitiesResult.success && opportunitiesResult.data.length > 0) {
  opportunitiesContainer.innerHTML = opportunitiesResult.data.map(opp => `
    <div class="volunteer-card">
      <div class="activity-title">${opp.activityName}</div>
      <div class="activity-meta">
        <div class="item"><span>📅</span>${formatDateTime(opp.activityDate)}</div>
        <div class="item"><span>👥</span>需要 ${opp.volunteerNeeded} 人</div>
        <div class="item"><span>🎯</span>${opp.volunteerSkills || '無特殊要求'}</div>
      </div>
      <button class="btn btn-success" onclick="registerVolunteer('${opp.activityId}')">
        我要當志工
      </button>
    </div>
  `).join('');
} else {
  opportunitiesContainer.innerHTML = '<div class="empty-state"><div class="icon">🤝</div><div class="text">目前沒有志工機會</div></div>';
}

// 載入我的志工記錄
const recordsResult = await callAPI('getMyVolunteerRecords', { lineId: currentUser.lineId });
const recordsContainer = document.getElementById('my-volunteer-records');

if (recordsResult.success && recordsResult.data.length > 0) {
  recordsContainer.innerHTML = recordsResult.data.map(record => `
    <div class="list-item volunteer-card">
      <div class="list-item-title">${record.activityName}</div>
      <div class="list-item-meta">
        服務日期：${formatDate(record.serviceDate)} • 
        狀態：<span class="badge badge-${record.status === '已確認' ? 'success' : 'warning'}">${record.status}</span>
      </div>
      <div class="list-item-content">
        服務內容：${record.serviceContent || '志工服務'}<br>
        ${record.serviceHours ? `<div class="volunteer-hours">服務時數：${record.serviceHours} 小時</div>` : ''}
      </div>
    </div>
  `).join('');
} else {
  recordsContainer.innerHTML = '<div class="empty-state"><div class="icon">⏰</div><div class="text">還沒有志工服務記錄</div></div>';
}
}

// 處理新增捐款
async function handleAddDonation() {
const amount = parseInt(document.getElementById('donation-amount').value);
const category = document.getElementById('donation-category').value;
const donorName = document.getElementById('donor-name').value.trim() || '匿名';
const notes = document.getElementById('donation-notes').value.trim();

if (!amount || amount < 1) {
  showNotification('請輸入有效的捐款金額', 'warning');
  return;
}

const button = document.getElementById('btn-add-donation');
setLoading(button, true);

try {
  const result = await callAPI('addDonation', {
    lineId: currentUser.lineId,
    amount,
    category,
    donorName,
    notes
  });
  
  if (result.success) {
    showNotification('捐款記錄新增成功！', 'success');
    
    // 清空表單
    document.getElementById('donation-amount').value = '';
    document.getElementById('donation-category').value = 'general';
    document.getElementById('donor-name').value = '';
    document.getElementById('donation-notes').value = '';
    
    loadDonations();
  } else {
    showNotification(result.message || '新增失敗', 'error');
  }
} finally {
  setLoading(button, false);
}
}

// 載入捐款記錄
async function loadDonations() {
if (!currentUser) return;

const result = await callAPI('getMyDonations', { lineId: currentUser.lineId });
const container = document.getElementById('donations-list');

if (!result.success) {
  container.innerHTML = '<div class="empty-state"><div class="icon">❌</div><div class="text">載入失敗</div></div>';
  return;
}

const donations = result.data || [];
const totalAmount = donations.reduce((sum, d) => sum + (d.amount || 0), 0);

document.getElementById('stat-donation-count').textContent = donations.length;
document.getElementById('stat-donation-total').textContent = formatCurrency(totalAmount);

if (donations.length === 0) {
  container.innerHTML = '<div class="empty-state"><div class="icon">💝</div><div class="text">還沒有捐款記錄</div></div>';
  return;
}

const categoryMap = {
  general: '一般捐款',
  activity: '活動支持',
  medical: '醫療協助',
  equipment: '設備購置',
  other: '其他用途'
};

container.innerHTML = donations.map(donation => `
  <div class="list-item">
    <div class="list-item-title">
      ${categoryMap[donation.category] || donation.category}
      <span class="amount-positive" style="float: right;">${formatCurrency(donation.amount)}</span>
    </div>
    <div class="list-item-meta">
      捐款日期：${formatDate(donation.date)} • 
      捐款人：${donation.donorName}
      ${donation.receiptNumber ? ` • 收據號：${donation.receiptNumber}` : ''}
    </div>
    ${donation.notes ? `<div class="list-item-content">${donation.notes}</div>` : ''}
    ${donation.receiptLink ? 
      `<a href="${donation.receiptLink}" target="_blank" class="btn btn-outline" style="margin-top: 8px;">查看收據</a>` : ''
    }
  </div>
`).join('');
}

// 處理支出申請
async function handleSubmitExpense() {
const category = document.getElementById('expense-category').value;
const amount = parseInt(document.getElementById('expense-amount').value);
const description = document.getElementById('expense-description').value.trim();

if (!category || !amount || !description) {
  showNotification('請填寫完整的申請資訊', 'warning');
  return;
}

if (amount < 1) {
  showNotification('請輸入有效的申請金額', 'warning');
  return;
}

const button = document.getElementById('btn-submit-expense');
setLoading(button, true);

try {
  const result = await callAPI('submitExpense', {
    lineId: currentUser.lineId,
    category,
    amount,
    description
  });
  
  if (result.success) {
    showNotification('支出申請提交成功！', 'success');
    
    // 清空表單
    document.getElementById('expense-category').value = '';
    document.getElementById('expense-amount').value = '';
    document.getElementById('expense-description').value = '';
    
    loadMyExpenses();
  } else {
    showNotification(result.message || '提交失敗', 'error');
  }
} finally {
  setLoading(button, false);
}
}

// 載入我的支出申請
async function loadMyExpenses() {
if (!currentUser) return;

const result = await callAPI('getMyExpenses', { lineId: currentUser.lineId });
const container = document.getElementById('my-expenses-list');

if (!result.success) {
  container.innerHTML = '<div class="empty-state"><div class="icon">❌</div><div class="text">載入失敗</div></div>';
  return;
}

const expenses = result.data || [];

if (expenses.length === 0) {
  container.innerHTML = '<div class="empty-state"><div class="icon">💸</div><div class="text">還沒有支出申請記錄</div></div>';
  return;
}

const categoryMap = {
  activity: '活動支出',
  office: '辦公費用',
  marketing: '宣傳費用',
  equipment: '設備費用',
  welfare: '福利支出',
  medical: '醫療支援',
  volunteer: '志工費用',
  other: '其他支出'
};

const statusMap = {
  pending: { text: '待審核', class: 'warning' },
  approved: { text: '已核准', class: 'success' },
  rejected: { text: '已拒絕', class: 'error' }
};

container.innerHTML = expenses.map(expense => `
  <div class="list-item">
    <div class="list-item-title">
      ${categoryMap[expense.category] || expense.category}
      <span class="amount-negative" style="float: right;">${formatCurrency(expense.amount)}</span>
    </div>
    <div class="list-item-meta">
      申請日期：${formatDate(expense.applicationDate)} • 
      狀態：<span class="badge badge-${statusMap[expense.status]?.class || 'info'}">${statusMap[expense.status]?.text || expense.status}</span>
      ${expense.reviewDate ? ` • 審核日期：${formatDate(expense.reviewDate)}` : ''}
    </div>
    <div class="list-item-content">${expense.description}</div>
    ${expense.reviewNotes ? `<div style="margin-top: 8px; padding: 8px; background: #f5f5f5; border-radius: 4px; font-size: 14px;">審核意見：${expense.reviewNotes}</div>` : ''}
    ${expense.voucherLink ? 
      `<a href="${expense.voucherLink}" target="_blank" class="btn btn-outline" style="margin-top: 8px;">查看憑證</a>` : ''
    }
  </div>
`).join('');
}

// 載入回饋活動選項
async function loadFeedbackActivities() {
if (!currentUser) return;

const result = await callAPI('getMyCompletedActivities', { lineId: currentUser.lineId });
const select = document.getElementById('feedback-activity');

if (result.success && result.data.length > 0) {
  select.innerHTML = '<option value="">請選擇已參與的活動</option>' + 
    result.data.map(activity => 
      `<option value="${activity.id}">${activity.name} (${formatDate(activity.date)})</option>`
    ).join('');
} else {
  select.innerHTML = '<option value="">沒有可回饋的活動</option>';
}
}

// 處理提交回饋
async function handleSubmitFeedback() {
const activityId = document.getElementById('feedback-activity').value;
const rating = parseInt(document.getElementById('feedback-rating').value);
const comment = document.getElementById('feedback-comment').value.trim();

if (!activityId || !rating) {
  showNotification('請選擇活動並給予評分', 'warning');
  return;
}

const button = document.getElementById('btn-submit-feedback');
setLoading(button, true);

try {
  const result = await callAPI('submitFeedback', {
    lineId: currentUser.lineId,
    activityId,
    rating,
    comment
  });
  
  if (result.success) {
    showNotification('回饋提交成功！感謝您的意見', 'success');
    
    // 清空表單
    document.getElementById('feedback-activity').value = '';
    document.getElementById('feedback-rating').value = '';
    document.getElementById('feedback-comment').value = '';
    
    loadMyFeedback();
  } else {
    showNotification(result.message || '提交失敗', 'error');
  }
} finally {
  setLoading(button, false);
}
}

// 載入我的回饋記錄
async function loadMyFeedback() {
if (!currentUser) return;

const result = await callAPI('getMyFeedback', { lineId: currentUser.lineId });
const container = document.getElementById('my-feedback-list');

if (!result.success) {
  container.innerHTML = '<div class="empty-state"><div class="icon">❌</div><div class="text">載入失敗</div></div>';
  return;
}

const feedbacks = result.data || [];

if (feedbacks.length === 0) {
  container.innerHTML = '<div class="empty-state"><div class="icon">📝</div><div class="text">還沒有回饋記錄</div></div>';
  return;
}

container.innerHTML = feedbacks.map(feedback => {
  const stars = '⭐'.repeat(feedback.rating);
  return `
    <div class="list-item">
      <div class="list-item-title">
        ${feedback.activityName}
        <span style="float: right;">${stars}</span>
      </div>
      <div class="list-item-meta">
        回饋日期：${formatDate(feedback.submitDate)} • 
        活動日期：${formatDate(feedback.activityDate)}
      </div>
      ${feedback.comment ? `<div class="list-item-content">${feedback.comment}</div>` : ''}
    </div>
  `;
}).join('');
}

// 處理建立活動
async function handleCreateActivity() {
const name = document.getElementById('new-activity-name').value.trim();
const date = document.getElementById('new-activity-date').value;
const location = document.getElementById('new-activity-location').value.trim();
const maxParticipants = parseInt(document.getElementById('new-activity-max').value) || null;
const fee = parseInt(document.getElementById('new-activity-fee').value) || 0;
const volunteerNeeded = parseInt(document.getElementById('new-activity-volunteer-needed').value) || 0;
const volunteerSkills = document.getElementById('new-activity-volunteer-skills').value.trim();
const description = document.getElementById('new-activity-description').value.trim();

if (!name || !date || !description) {
  showNotification('請填寫必要的活動資訊', 'warning');
  return;
}

const button = document.getElementById('btn-create-activity');
setLoading(button, true);

try {
  const result = await callAPI('createActivity', {
    lineId: currentUser.lineId,
    name,
    date,
    location,
    maxParticipants,
    fee,
    volunteerNeeded,
    volunteerSkills,
    description
  });
  
  if (result.success) {
    showNotification('活動建立成功！', 'success');
    
    // 清空表單
    document.getElementById('new-activity-name').value = '';
    document.getElementById('new-activity-date').value = '';
    document.getElementById('new-activity-location').value = '';
    document.getElementById('new-activity-max').value = '';
    document.getElementById('new-activity-fee').value = '0';
    document.getElementById('new-activity-volunteer-needed').value = '0';
    document.getElementById('new-activity-volunteer-skills').value = '';
    document.getElementById('new-activity-description').value = '';
    
    loadActivities();
    loadAdminData();
  } else {
    showNotification(result.message || '建立失敗', 'error');
  }
} finally {
  setLoading(button, false);
}
}

// 載入管理員資料
async function loadAdminData() {
if (!isAdmin) return;

const result = await callAPI('getAdminStats');

if (result.success) {
  const stats = result.data;
  document.getElementById('admin-stat-members').textContent = stats.totalMembers || 0;
  document.getElementById('admin-stat-activities').textContent = stats.totalActivities || 0;
  document.getElementById('admin-stat-volunteers').textContent = stats.totalVolunteers || 0;
  document.getElementById('admin-stat-donations').textContent = formatCurrency(stats.totalDonations || 0);
}
}

// 頁面載入完成後初始化
document.addEventListener('DOMContentLoaded', function() {
initLiff();
});
</script>

</body>
</html>

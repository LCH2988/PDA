<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>台灣帕金森病友權益促進會 - 管理系統</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <style>
      :root {
          --primary-color: #2c3e50;
          --secondary-color: #3498db;
          --success-color: #27ae60;
          --warning-color: #f39c12;
          --danger-color: #e74c3c;
          --light-bg: #ecf0f1;
      }

      body {
          font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f8f9fa;
          margin: 0;
          padding: 0;
      }

      .navbar {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .navbar-brand {
          font-weight: bold;
          font-size: 1.3rem;
      }

      .sidebar {
          background: white;
          min-height: calc(100vh - 76px);
          box-shadow: 2px 0 10px rgba(0,0,0,0.1);
          padding: 0;
      }

      .sidebar .nav-link {
          color: var(--primary-color);
          padding: 15px 20px;
          border-bottom: 1px solid #eee;
          transition: all 0.3s ease;
      }

      .sidebar .nav-link:hover {
          background-color: var(--light-bg);
          color: var(--secondary-color);
          transform: translateX(5px);
      }

      .sidebar .nav-link.active {
          background-color: var(--secondary-color);
          color: white;
          border-left: 4px solid var(--primary-color);
      }

      .main-content {
          padding: 30px;
          min-height: calc(100vh - 76px);
      }

      .page-header {
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }

      .page-header h2 {
          color: var(--primary-color);
          margin: 0;
          font-weight: 600;
      }

      .stats-card {
          background: white;
          border-radius: 10px;
          padding: 25px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          transition: transform 0.3s ease;
          border-left: 4px solid;
      }

      .stats-card:hover {
          transform: translateY(-5px);
      }

      .stats-card.primary { border-left-color: var(--primary-color); }
      .stats-card.success { border-left-color: var(--success-color); }
      .stats-card.warning { border-left-color: var(--warning-color); }
      .stats-card.danger { border-left-color: var(--danger-color); }

      .stats-card .icon {
          font-size: 2.5rem;
          opacity: 0.7;
      }

      .stats-card .number {
          font-size: 2rem;
          font-weight: bold;
          margin: 10px 0;
      }

      .card {
          border: none;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }

      .card-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          border-radius: 10px 10px 0 0 !important;
          padding: 15px 20px;
      }

      .btn-primary {
          background: var(--secondary-color);
          border-color: var(--secondary-color);
      }

      .btn-primary:hover {
          background: var(--primary-color);
          border-color: var(--primary-color);
      }

      .table {
          background: white;
      }

      .table th {
          background-color: var(--light-bg);
          color: var(--primary-color);
          font-weight: 600;
          border: none;
      }

      .badge {
          font-size: 0.8rem;
          padding: 5px 10px;
      }

      .form-control:focus {
          border-color: var(--secondary-color);
          box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      }

      .modal-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
      }

      .loading {
          display: none;
          text-align: center;
          padding: 50px;
      }

      .spinner-border {
          color: var(--secondary-color);
      }

      .search-box {
          background: white;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .action-buttons .btn {
          margin-right: 5px;
          margin-bottom: 5px;
      }

      @media (max-width: 768px) {
          .sidebar {
              position: fixed;
              left: -250px;
              width: 250px;
              z-index: 1000;
              transition: left 0.3s ease;
          }

          .sidebar.show {
              left: 0;
          }

          .main-content {
              margin-left: 0;
              padding: 20px 15px;
          }

          .stats-card {
              margin-bottom: 20px;
          }
      }

      .page-section {
          display: none;
      }

      .page-section.active {
          display: block;
      }

      .chart-container {
          background: white;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }
  </style>
</head>
<body>
  <!-- 導航列 -->
  <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
          <button class="navbar-toggler d-lg-none" type="button" id="sidebarToggle">
              <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="#">
              <i class="fas fa-heartbeat me-2"></i>
              台灣帕金森病友權益促進會
          </a>
          <div class="navbar-nav ms-auto">
              <div class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                      <i class="fas fa-user-circle me-1"></i>管理員
                  </a>
                  <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>系統設定</a></li>
                      <li><a class="dropdown-item" href="#"><i class="fas fa-download me-2"></i>資料備份</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>登出</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </nav>

  <div class="container-fluid">
      <div class="row">
          <!-- 側邊欄 -->
          <div class="col-lg-2 p-0">
              <div class="sidebar" id="sidebar">
                  <nav class="nav flex-column">
                      <a class="nav-link active" href="#" data-page="dashboard">
                          <i class="fas fa-tachometer-alt me-2"></i>儀表板
                      </a>
                      <a class="nav-link" href="#" data-page="members">
                          <i class="fas fa-users me-2"></i>會員管理
                      </a>
                      <a class="nav-link" href="#" data-page="finance">
                          <i class="fas fa-money-bill-wave me-2"></i>財務管理
                      </a>
                      <a class="nav-link" href="#" data-page="reports">
                          <i class="fas fa-chart-bar me-2"></i>報表分析
                      </a>
                      <a class="nav-link" href="#" data-page="settings">
                          <i class="fas fa-cog me-2"></i>系統設定
                      </a>
                  </nav>
              </div>
          </div>

          <!-- 主要內容區 -->
          <div class="col-lg-10">
              <div class="main-content">
                  <!-- 儀表板頁面 -->
                  <div id="dashboard" class="page-section active">
                      <div class="page-header">
                          <h2><i class="fas fa-tachometer-alt me-2"></i>系統儀表板</h2>
                          <p class="mb-0 text-muted">歡迎使用台灣帕金森病友權益促進會管理系統</p>
                      </div>

                      <!-- 統計卡片 -->
                      <div class="row mb-4">
                          <div class="col-md-3">
                              <div class="stats-card primary">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">會員總數</h6>
                                          <div class="number text-primary" id="totalMembers">0</div>
                                      </div>
                                      <div class="icon text-primary">
                                          <i class="fas fa-users"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-3">
                              <div class="stats-card success">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">有效會員</h6>
                                          <div class="number text-success" id="activeMembers">0</div>
                                      </div>
                                      <div class="icon text-success">
                                          <i class="fas fa-user-check"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-3">
                              <div class="stats-card warning">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">本月收入</h6>
                                          <div class="number text-warning" id="monthlyIncome">$0</div>
                                      </div>
                                      <div class="icon text-warning">
                                          <i class="fas fa-arrow-up"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-3">
                              <div class="stats-card danger">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">當前餘額</h6>
                                          <div class="number text-info" id="currentBalance">$0</div>
                                      </div>
                                      <div class="icon text-info">
                                          <i class="fas fa-wallet"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- 快速操作 -->
                      <div class="row">
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0"><i class="fas fa-plus-circle me-2"></i>快速操作</h5>
                                  </div>
                                  <div class="card-body">
                                      <div class="d-grid gap-2">
                                          <button class="btn btn-primary" onclick="showAddMemberModal()">
                                              <i class="fas fa-user-plus me-2"></i>新增會員
                                          </button>
                                          <button class="btn btn-success" onclick="showAddFeeModal()">
                                              <i class="fas fa-money-bill me-2"></i>記錄會費
                                          </button>
                                          <button class="btn btn-info" onclick="showAddDonationModal()">
                                              <i class="fas fa-heart me-2"></i>記錄捐款
                                          </button>
                                          <button class="btn btn-warning" onclick="showAddExpenseModal()">
                                              <i class="fas fa-receipt me-2"></i>記錄支出
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0"><i class="fas fa-bell me-2"></i>系統通知</h5>
                                  </div>
                                  <div class="card-body">
                                      <div id="notifications">
                                          <div class="alert alert-info alert-sm">
                                              <i class="fas fa-info-circle me-2"></i>系統運行正常
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 會員管理頁面 -->
                  <div id="members" class="page-section">
                      <div class="page-header">
                          <div class="d-flex justify-content-between align-items-center">
                              <div>
                                  <h2><i class="fas fa-users me-2"></i>會員管理</h2>
                                  <p class="mb-0 text-muted">管理會員資料與狀態</p>
                              </div>
                              <button class="btn btn-primary" onclick="showAddMemberModal()">
                                  <i class="fas fa-plus me-2"></i>新增會員
                              </button>
                          </div>
                      </div>

                      <!-- 搜尋區域 -->
                      <div class="search-box">
                          <div class="row">
                              <div class="col-md-4">
                                  <input type="text" class="form-control" id="memberSearch" placeholder="搜尋會員姓名或編號">
                              </div>
                              <div class="col-md-3">
                                  <select class="form-control" id="memberStatusFilter">
                                      <option value="">所有狀態</option>
                                      <option value="有效">有效</option>
                                      <option value="停權">停權</option>
                                      <option value="退會">退會</option>
                                  </select>
                              </div>
                              <div class="col-md-3">
                                  <select class="form-control" id="memberFeeFilter">
                                      <option value="">所有繳費狀態</option>
                                      <option value="已繳費">已繳費</option>
                                      <option value="未繳費">未繳費</option>
                                  </select>
                              </div>
                              <div class="col-md-2">
                                  <button class="btn btn-secondary w-100" onclick="searchMembers()">
                                      <i class="fas fa-search"></i> 搜尋
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- 會員列表 -->
                      <div class="card">
                          <div class="card-header">
                              <h5 class="mb-0">會員列表</h5>
                          </div>
                          <div class="card-body">
                              <div class="table-responsive">
                                  <table class="table table-hover">
                                      <thead>
                                          <tr>
                                              <th>會員編號</th>
                                              <th>姓名</th>
                                              <th>電話</th>
                                              <th>電子郵件</th>
                                              <th>入會日期</th>
                                              <th>會員狀態</th>
                                              <th>會費狀態</th>
                                              <th>操作</th>
                                          </tr>
                                      </thead>
                                      <tbody id="membersTable">
                                          <tr>
                                              <td colspan="8" class="text-center">載入中...</td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 財務管理頁面 -->
                  <div id="finance" class="page-section">
                      <div class="page-header">
                          <div class="d-flex justify-content-between align-items-center">
                              <div>
                                  <h2><i class="fas fa-money-bill-wave me-2"></i>財務管理</h2>
                                  <p class="mb-0 text-muted">管理收入支出與財務記錄</p>
                              </div>
                              <div class="btn-group">
                                  <button class="btn btn-success" onclick="showAddFeeModal()">
                                      <i class="fas fa-plus me-2"></i>會費記錄
                                  </button>
                                  <button class="btn btn-info" onclick="showAddDonationModal()">
                                      <i class="fas fa-plus me-2"></i>捐款記錄
                                  </button>
                                  <button class="btn btn-warning" onclick="showAddExpenseModal()">
                                      <i class="fas fa-plus me-2"></i>支出記錄
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- 財務統計 -->
                      <div class="row mb-4">
                          <div class="col-md-4">
                              <div class="stats-card success">
                                  <h6 class="text-muted">本月總收入</h6>
                                  <div class="number text-success" id="financeIncome">$0</div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="stats-card danger">
                                  <h6 class="text-muted">本月總支出</h6>
                                  <div class="number text-danger" id="financeExpense">$0</div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="stats-card primary">
                                  <h6 class="text-muted">當前餘額</h6>
                                  <div class="number text-primary" id="financeBalance">$0</div>
                              </div>
                          </div>
                      </div>

                      <!-- 財務記錄 -->
                      <div class="card">
                          <div class="card-header">
                              <div class="d-flex justify-content-between align-items-center">
                                  <h5 class="mb-0">財務記錄</h5>
                                  <div>
                                      <input type="date" class="form-control d-inline-block" style="width: auto;" id="financeStartDate">
                                      <span class="mx-2">至</span>
                                      <input type="date" class="form-control d-inline-block" style="width: auto;" id="financeEndDate">
                                      <button class="btn btn-secondary ms-2" onclick="filterFinanceRecords()">篩選</button>
                                  </div>
                              </div>
                          </div>
                          <div class="card-body">
                              <div class="table-responsive">
                                  <table class="table table-hover">
                                      <thead>
                                          <tr>
                                              <th>日期</th>
                                              <th>類型</th>
                                              <th>項目</th>
                                              <th>收入</th>
                                              <th>支出</th>
                                              <th>餘額</th>
                                              <th>相關人員</th>
                                              <th>備註</th>
                                          </tr>
                                      </thead>
                                      <tbody id="financeTable">
                                          <tr>
                                              <td colspan="8" class="text-center">載入中...</td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 報表分析頁面 -->
                  <div id="reports" class="page-section">
                      <div class="page-header">
                          <h2><i class="fas fa-chart-bar me-2"></i>報表分析</h2>
                          <p class="mb-0 text-muted">查看各種統計報表與分析圖表</p>
                      </div>

                      <!-- 報表選項 -->
                      <div class="row mb-4">
                          <div class="col-md-4">
                              <div class="card">
                                  <div class="card-body text-center">
                                      <i class="fas fa-calendar-alt fa-3x text-primary mb-3"></i>
                                      <h5>月度報表</h5>
                                      <button class="btn btn-primary" onclick="generateMonthlyReport()">生成報表</button>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="card">
                                  <div class="card-body text-center">
                                      <i class="fas fa-users fa-3x text-success mb-3"></i>
                                      <h5>會員分析</h5>
                                      <button class="btn btn-success" onclick="generateMemberAnalysis()">分析報告</button>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="card">
                                  <div class="card-body text-center">
                                      <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
                                      <h5>財務趨勢</h5>
                                      <button class="btn btn-warning" onclick="generateFinanceTrend()">趨勢分析</button>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- 圖表區域 -->
                      <div class="row">
                          <div class="col-md-6">
                              <div class="chart-container">
                                  <h5>會員年齡分布</h5>
                                  <canvas id="ageChart" width="400" height="200"></canvas>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="chart-container">
                                  <h5>財務收支趨勢</h5>
                                  <canvas id="financeChart" width="400" height="200"></canvas>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 系統設定頁面 -->
                  <div id="settings" class="page-section">
                      <div class="page-header">
                          <h2><i class="fas fa-cog me-2"></i>系統設定</h2>
                          <p class="mb-0 text-muted">系統配置與維護功能</p>
                      </div>

                      <div class="row">
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0">系統維護</h5>
                                  </div>
                                  <div class="card-body">
                                      <div class="d-grid gap-2">
                                          <button class="btn btn-info" onclick="systemHealthCheck()">
                                              <i class="fas fa-heartbeat me-2"></i>系統健康檢查
                                          </button>
                                          <button class="btn btn-warning" onclick="createBackup()">
                                              <i class="fas fa-download me-2"></i>建立資料備份
                                          </button>
                                          <button class="btn btn-secondary" onclick="cleanupTestData()">
                                              <i class="fas fa-trash me-2"></i>清理測試資料
                                          </button>
                                          <button class="btn btn-success" onclick="testSystem()">
                                              <i class="fas fa-vial me-2"></i>系統功能測試
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0">系統資訊</h5>
                                  </div>
                                  <div class="card-body">
                                      <div id="systemInfo">
                                          <p><strong>系統版本：</strong>v1.0.0</p>
                                          <p><strong>最後更新：</strong><span id="lastUpdate">-</span></p>
                                          <p><strong>資料庫狀態：</strong><span class="badge bg-success">正常</span></p>
                                          <p><strong>備份狀態：</strong><span class="badge bg-success">已啟用</span></p>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增會員 Modal -->
  <div class="modal fade" id="addMemberModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">新增會員</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addMemberForm">
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">姓名 *</label>
                                  <input type="text" class="form-control" name="name" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">身分證字號 *</label>
                                  <input type="text" class="form-control" name="idNumber" required>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">出生日期</label>
                                  <input type="date" class="form-control" name="birthDate">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">性別</label>
                                  <select class="form-control" name="gender">
                                      <option value="">請選擇</option>
                                      <option value="男">男</option>
                                      <option value="女">女</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">電話</label>
                                  <input type="tel" class="form-control" name="phone">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">手機</label>
                                  <input type="tel" class="form-control" name="mobile">
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">電子郵件</label>
                          <input type="email" class="form-control" name="email">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">地址</label>
                          <textarea class="form-control" name="address" rows="2"></textarea>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">緊急聯絡人</label>
                                  <input type="text" class="form-control" name="emergencyContact">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">緊急聯絡電話</label>
                                  <input type="tel" class="form-control" name="emergencyPhone">
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">病況描述</label>
                          <textarea class="form-control" name="medicalCondition" rows="3"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">用藥情況</label>
                          <textarea class="form-control" name="medication" rows="2"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="addMember()">新增會員</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 會費記錄 Modal -->
  <div class="modal fade" id="addFeeModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">記錄會費</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addFeeForm">
                      <div class="mb-3">
                          <label class="form-label">會員編號 *</label>
                          <input type="text" class="form-control" name="memberId" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">繳費年度 *</label>
                          <select class="form-control" name="year" required>
                              <option value="">請選擇年度</option>
                              <option value="2024">2024年</option>
                              <option value="2025">2025年</option>
                          </select>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">應繳金額 *</label>
                                  <input type="number" class="form-control" name="amount" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">實繳金額 *</label>
                                  <input type="number" class="form-control" name="paidAmount" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">繳費日期 *</label>
                          <input type="date" class="form-control" name="paymentDate" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款方式 *</label>
                          <select class="form-control" name="paymentMethod" required>
                              <option value="">請選擇</option>
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">收據號碼</label>
                          <input type="text" class="form-control" name="receiptNumber">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-success" onclick="recordFee()">記錄會費</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 捐款記錄 Modal -->
  <div class="modal fade" id="addDonationModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">記錄捐款</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addDonationForm">
                      <div class="mb-3">
                          <label class="form-label">捐款日期 *</label>
                          <input type="date" class="form-control" name="date" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">捐款人姓名 *</label>
                          <input type="text" class="form-control" name="donorName" required>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">捐款人電話</label>
                                  <input type="tel" class="form-control" name="donorPhone">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">捐款金額 *</label>
                                  <input type="number" class="form-control" name="amount" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">捐款人地址</label>
                          <textarea class="form-control" name="donorAddress" rows="2"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">捐款用途 *</label>
                          <select class="form-control" name="purpose" required>
                              <option value="">請選擇</option>
                              <option value="一般捐款">一般捐款</option>
                              <option value="活動支持">活動支持</option>
                              <option value="醫療補助">醫療補助</option>
                              <option value="設備購置">設備購置</option>
                              <option value="其他">其他</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款方式 *</label>
                          <select class="form-control" name="paymentMethod" required>
                              <option value="">請選擇</option>
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">收據號碼</label>
                                  <input type="text" class="form-control" name="receiptNumber">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">是否開立收據</label>
                                  <select class="form-control" name="needReceipt">
                                      <option value="true">是</option>
                                      <option value="false">否</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-info" onclick="recordDonation()">記錄捐款</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 支出記錄 Modal -->
  <div class="modal fade" id="addExpenseModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">記錄支出</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addExpenseForm">
                      <div class="mb-3">
                          <label class="form-label">支出日期 *</label>
                          <input type="date" class="form-control" name="date" required>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">支出類別 *</label>
                                  <select class="form-control" name="category" required>
                                      <option value="">請選擇</option>
                                      <option value="活動支出">活動支出</option>
                                      <option value="行政支出">行政支出</option>
                                      <option value="設備購置">設備購置</option>
                                      <option value="醫療補助">醫療補助</option>
                                      <option value="其他支出">其他支出</option>
                                  </select>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">金額 *</label>
                                  <input type="number" class="form-control" name="amount" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">支出項目 *</label>
                          <input type="text" class="form-control" name="item" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">廠商名稱</label>
                          <input type="text" class="form-control" name="vendor">
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">發票號碼</label>
                                  <input type="text" class="form-control" name="invoiceNumber">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">經辦人 *</label>
                                  <input type="text" class="form-control" name="handler" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">核准人</label>
                          <input type="text" class="form-control" name="approver">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-warning" onclick="recordExpense()">記錄支出</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 載入中 Modal -->
  <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
      <div class="modal-dialog modal-sm">
          <div class="modal-content">
              <div class="modal-body text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">載入中...</span>
                  </div>
                  <div class="mt-3">處理中，請稍候...</div>
              </div>
          </div>
      </div>
  </div>

  <!-- JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
      // 全域變數
      const GAS_URL = 'https://script.google.com/macros/s/AKfycby1XI-E_uWYBA7D8J_Pro6gJ1Ab24_GZHgR6r70K9V_u56XArpS8mw1i-cpzPAxHjA6_g/exec'; // 請替換為您的 GAS Web App URL
      let currentMembers = [];
      let currentFinanceRecords = [];

      // 頁面初始化
      document.addEventListener('DOMContentLoaded', function() {
          initializePage();
          loadDashboardData();
          setupEventListeners();
      });

      // 初始化頁面
      function initializePage() {
          // 設定當前日期
          const today = new Date().toISOString().split('T')[0];
          document.querySelectorAll('input[type="date"]').forEach(input => {
              if (!input.value) {
                  input.value = today;
              }
          });

          // 設定年度選項
          const currentYear = new Date().getFullYear();
          document.querySelectorAll('select[name="year"]').forEach(select => {
              for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                  const option = document.createElement('option');
                  option.value = year;
                  option.textContent = year + '年';
                  if (year === currentYear) option.selected = true;
                  select.appendChild(option);
              }
          });
      }

      // 設定事件監聽器
      function setupEventListeners() {
          // 側邊欄導航
          document.querySelectorAll('.sidebar .nav-link').forEach(link => {
              link.addEventListener('click', function(e) {
                  e.preventDefault();
                  const page = this.dataset.page;
                  showPage(page);
                  
                  // 更新導航狀態
                  document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
                  this.classList.add('active');
              });
          });

          // 手機版側邊欄切換
          document.getElementById('sidebarToggle').addEventListener('click', function() {
              document.getElementById('sidebar').classList.toggle('show');
          });

          // 搜尋功能
          document.getElementById('memberSearch').addEventListener('input', debounce(searchMembers, 300));
          document.getElementById('memberStatusFilter').addEventListener('change', searchMembers);
          document.getElementById('memberFeeFilter').addEventListener('change', searchMembers);
      }

      // 防抖函數
      function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
              const later = () => {
                  clearTimeout(timeout);
                  func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
          };
      }

      // 顯示頁面
      function showPage(pageId) {
          document.querySelectorAll('.page-section').forEach(section => {
              section.classList.remove('active');
          });
          document.getElementById(pageId).classList.add('active');

          // 載入對應頁面資料
          switch(pageId) {
              case 'members':
                  loadMembers();
                  break;
              case 'finance':
                  loadFinanceRecords();
                  break;
              case 'reports':
                  loadReports();
                  break;
          }
      }

      // 載入儀表板資料
      async function loadDashboardData() {
          try {
              showLoading(true);
              
              // 模擬 API 呼叫 - 實際使用時請替換為真實的 GAS 函數呼叫
              const stats = await mockApiCall('getDashboardStats');
              
              document.getElementById('totalMembers').textContent = stats.totalMembers || 0;
              document.getElementById('activeMembers').textContent = stats.activeMembers || 0;
              document.getElementById('monthlyIncome').textContent = '$' + (stats.monthlyIncome || 0).toLocaleString();
              document.getElementById('currentBalance').textContent = '$' + (stats.currentBalance || 0).toLocaleString();

              showLoading(false);
          } catch (error) {
              console.error('載入儀表板資料失敗:', error);
              showError('載入資料失敗');
              showLoading(false);
          }
      }

      // 載入會員資料
      async function loadMembers() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('getAllMembers');
              currentMembers = result.members || [];
              
              displayMembers(currentMembers);
              showLoading(false);
          } catch (error) {
              console.error('載入會員資料失敗:', error);
              showError('載入會員資料失敗');
              showLoading(false);
          }
      }

      // 顯示會員列表
      function displayMembers(members) {
          const tbody = document.getElementById('membersTable');
          
          if (members.length === 0) {
              tbody.innerHTML = '<tr><td colspan="8" class="text-center">暫無會員資料</td></tr>';
              return;
          }

          tbody.innerHTML = members.map(member => `
              <tr>
                  <td>${member.會員編號 || '-'}</td>
                  <td>${member.姓名 || '-'}</td>
                  <td>${member.電話 || member.手機 || '-'}</td>
                  <td>${member.電子郵件 || '-'}</td>
                  <td>${member.入會日期 ? new Date(member.入會日期).toLocaleDateString('zh-TW') : '-'}</td>
                  <td><span class="badge ${getStatusBadgeClass(member.會員狀態)}">${member.會員狀態 || '-'}</span></td>
                  <td><span class="badge ${getFeeStatusBadgeClass(member.會費狀態)}">${member.會費狀態 || '-'}</span></td>
                  <td>
                      <div class="action-buttons">
                          <button class="btn btn-sm btn-outline-primary" onclick="editMember('${member.會員編號}')">
                              <i class="fas fa-edit"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-info" onclick="viewMember('${member.會員編號}')">
                              <i class="fas fa-eye"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-success" onclick="recordMemberFee('${member.會員編號}')">
                              <i class="fas fa-money-bill"></i>
                          </button>
                      </div>
                  </td>
              </tr>
          `).join('');
      }

      // 搜尋會員
      function searchMembers() {
          const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
          const statusFilter = document.getElementById('memberStatusFilter').value;
          const feeFilter = document.getElementById('memberFeeFilter').value;

          let filteredMembers = currentMembers.filter(member => {
              const matchesSearch = !searchTerm || 
                  (member.姓名 && member.姓名.toLowerCase().includes(searchTerm)) ||
                  (member.會員編號 && member.會員編號.toLowerCase().includes(searchTerm));
              
              const matchesStatus = !statusFilter || member.會員狀態 === statusFilter;
              const matchesFee = !feeFilter || member.會費狀態 === feeFilter;

              return matchesSearch && matchesStatus && matchesFee;
          });

          displayMembers(filteredMembers);
      }

      // 載入財務記錄
      async function loadFinanceRecords() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('getFinanceRecords');
              currentFinanceRecords = result.records || [];
              
              displayFinanceRecords(currentFinanceRecords);
              updateFinanceStats();
              showLoading(false);
          } catch (error) {
              console.error('載入財務記錄失敗:', error);
              showError('載入財務記錄失敗');
              showLoading(false);
          }
      }

      // 顯示財務記錄
      function displayFinanceRecords(records) {
          const tbody = document.getElementById('financeTable');
          
          if (records.length === 0) {
              tbody.innerHTML = '<tr><td colspan="8" class="text-center">暫無財務記錄</td></tr>';
              return;
          }

          tbody.innerHTML = records.map(record => `
              <tr>
                  <td>${record.日期 ? new Date(record.日期).toLocaleDateString('zh-TW') : '-'}</td>
                  <td><span class="badge ${getTransactionTypeBadgeClass(record.類型)}">${record.類型 || '-'}</span></td>
                  <td>${record.項目 || '-'}</td>
                  <td class="text-success">${record.收入 ? '$' + record.收入.toLocaleString() : '-'}</td>
                  <td class="text-danger">${record.支出 ? '$' + record.支出.toLocaleString() : '-'}</td>
                  <td class="text-primary">${record.餘額 ? '$' + record.餘額.toLocaleString() : '-'}</td>
                  <td>${record.會員姓名 || record.廠商名稱 || '-'}</td>
                  <td>${record.備註 || '-'}</td>
              </tr>
          `).join('');
      }

      // 更新財務統計
      function updateFinanceStats() {
          const currentMonth = new Date().getMonth();
          const currentYear = new Date().getFullYear();
          
          let monthlyIncome = 0;
          let monthlyExpense = 0;
          let currentBalance = 0;

          currentFinanceRecords.forEach(record => {
              const recordDate = new Date(record.日期);
              if (recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear) {
                  monthlyIncome += record.收入 || 0;
                  monthlyExpense += record.支出 || 0;
              }
          });

          // 取得最新餘額
          if (currentFinanceRecords.length > 0) {
              currentBalance = currentFinanceRecords[currentFinanceRecords.length - 1].餘額 || 0;
          }

          document.getElementById('financeIncome').textContent = '$' + monthlyIncome.toLocaleString();
          document.getElementById('financeExpense').textContent = '$' + monthlyExpense.toLocaleString();
          document.getElementById('financeBalance').textContent = '$' + currentBalance.toLocaleString();
      }

      // 載入報表
      function loadReports() {
          generateAgeChart();
          generateFinanceChart();
      }

      // Modal 顯示函數
      function showAddMemberModal() {
          document.getElementById('addMemberForm').reset();
          new bootstrap.Modal(document.getElementById('addMemberModal')).show();
      }

      function showAddFeeModal() {
          document.getElementById('addFeeForm').reset();
          new bootstrap.Modal(document.getElementById('addFeeModal')).show();
      }

      function showAddDonationModal() {
          document.getElementById('addDonationForm').reset();
          new bootstrap.Modal(document.getElementById('addDonationModal')).show();
      }

      function showAddExpenseModal() {
          document.getElementById('addExpenseForm').reset();
          new bootstrap.Modal(document.getElementById('addExpenseModal')).show();
      }

      // 新增會員
      async function addMember() {
          const form = document.getElementById('addMemberForm');
          const formData = new FormData(form);
          const memberData = Object.fromEntries(formData.entries());

          // 驗證必填欄位
          if (!memberData.name || !memberData.idNumber) {
              showError('請填寫必填欄位');
              return;
          }

          try {
              showLoading(true);
              
              const result = await mockApiCall('addMember', memberData);
              
              if (result.success) {
                  showSuccess('會員新增成功！會員編號：' + result.memberId);
                  bootstrap.Modal.getInstance(document.getElementById('addMemberModal')).hide();
                  loadMembers(); // 重新載入會員列表
              } else {
                  showError('新增失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('新增會員失敗:', error);
              showError('新增會員失敗');
              showLoading(false);
          }
      }

      // 記錄會費
      async function recordFee() {
          const form = document.getElementById('addFeeForm');
          const formData = new FormData(form);
          const feeData = Object.fromEntries(formData.entries());

          // 轉換數值
          feeData.amount = parseFloat(feeData.amount);
          feeData.paidAmount = parseFloat(feeData.paidAmount);
          feeData.year = parseInt(feeData.year);

          try {
              showLoading(true);
              
              const result = await mockApiCall('recordMemberFee', feeData);
              
              if (result.success) {
                  showSuccess('會費記錄成功！');
                  bootstrap.Modal.getInstance(document.getElementById('addFeeModal')).hide();
                  loadFinanceRecords();
                  loadDashboardData();
              } else {
                  showError('記錄失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('記錄會費失敗:', error);
              showError('記錄會費失敗');
              showLoading(false);
          }
      }

      // 記錄捐款
      async function recordDonation() {
          const form = document.getElementById('addDonationForm');
          const formData = new FormData(form);
          const donationData = Object.fromEntries(formData.entries());

          donationData.amount = parseFloat(donationData.amount);
          donationData.needReceipt = donationData.needReceipt === 'true';

          try {
              showLoading(true);
              
              const result = await mockApiCall('recordDonation', donationData);
              
              if (result.success) {
                  showSuccess('捐款記錄成功！');
                  bootstrap.Modal.getInstance(document.getElementById('addDonationModal')).hide();
                  loadFinanceRecords();
                  loadDashboardData();
              } else {
                  showError('記錄失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('記錄捐款失敗:', error);
              showError('記錄捐款失敗');
              showLoading(false);
          }
      }

      // 記錄支出
      async function recordExpense() {
          const form = document.getElementById('addExpenseForm');
          const formData = new FormData(form);
          const expenseData = Object.fromEntries(formData.entries());

          expenseData.amount = parseFloat(expenseData.amount);

          try {
              showLoading(true);
              
              const result = await mockApiCall('recordExpense', expenseData);
              
              if (result.success) {
                  showSuccess('支出記錄成功！');
                  bootstrap.Modal.getInstance(document.getElementById('addExpenseModal')).hide();
                  loadFinanceRecords();
                  loadDashboardData();
              } else {
                  showError('記錄失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('記錄支出失敗:', error);
              showError('記錄支出失敗');
              showLoading(false);
          }
      }

      // 生成月度報表
      async function generateMonthlyReport() {
          try {
              showLoading(true);
              
              const year = new Date().getFullYear();
              const month = new Date().getMonth() + 1;
              
              const result = await mockApiCall('generateMonthlyReport', { year, month });
              
              if (result.success) {
                  showSuccess('月度報表生成成功！');
                  // 可以在這裡添加下載或顯示報表的邏輯
              } else {
                  showError('報表生成失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('生成報表失敗:', error);
              showError('生成報表失敗');
              showLoading(false);
          }
      }

      // 生成會員分析
      async function generateMemberAnalysis() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('analyzeMemberAge');
              
              if (result.success) {
                  showSuccess('會員分析完成！');
                  generateAgeChart(result.ageGroups);
              } else {
                  showError('分析失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('會員分析失敗:', error);
              showError('會員分析失敗');
              showLoading(false);
          }
      }

      // 生成財務趨勢
      async function generateFinanceTrend() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('analyzeFinanceTrend', { months: 12 });
              
              if (result.success) {
                  showSuccess('財務趨勢分析完成！');
                  generateFinanceChart(result.trendData);
              } else {
                  showError('分析失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('財務趨勢分析失敗:', error);
              showError('財務趨勢分析失敗');
              showLoading(false);
          }
      }

      // 系統健康檢查
      async function systemHealthCheck() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('systemHealthCheck');
              
              let message = '系統健康檢查結果：\n';
              message += `試算表存取：${result.spreadsheetAccess ? '✅ 正常' : '❌ 異常'}\n`;
              message += `工作表存在：${result.sheetsExist ? '✅ 正常' : '❌ 異常'}\n`;
              message += `資料完整性：${result.dataIntegrity ? '✅ 正常' : '❌ 異常'}\n`;
              message += `郵件服務：${result.emailService ? '✅ 正常' : '❌ 異常'}\n`;
              message += `定時任務：${result.triggers ? '✅ 正常' : '❌ 異常'}`;
              
              Swal.fire({
                  title: '系統健康檢查',
                  text: message,
                  icon: 'info',
                  confirmButtonText: '確定'
              });
              
              showLoading(false);
          } catch (error) {
              console.error('系統健康檢查失敗:', error);
              showError('系統健康檢查失敗');
              showLoading(false);
          }
      }

      // 建立備份
      async function createBackup() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('createBackup');
              
              if (result.success) {
                  showSuccess(`備份建立成功！\n備份名稱：${result.backupName}`);
              } else {
                  showError('備份失敗：' + result.error);
              }
              
              showLoading(false);
          } catch (error) {
              console.error('建立備份失敗:', error);
              showError('建立備份失敗');
              showLoading(false);
          }
      }

      // 清理測試資料
      async function cleanupTestData() {
          const confirm = await Swal.fire({
              title: '確認清理',
              text: '確定要清理所有測試資料嗎？此操作無法復原！',
              icon: 'warning',
              showCancelButton: true,
              confirmButtonText: '確定清理',
              cancelButtonText: '取消'
          });

          if (confirm.isConfirmed) {
              try {
                  showLoading(true);
                  
                  const result = await mockApiCall('cleanupTestData');
                  
                  showSuccess('測試資料清理完成！');
                  loadMembers();
                  loadFinanceRecords();
                  loadDashboardData();
                  
                  showLoading(false);
              } catch (error) {
                  console.error('清理測試資料失敗:', error);
                  showError('清理測試資料失敗');
                  showLoading(false);
              }
          }
      }

      // 系統功能測試
      async function testSystem() {
          try {
              showLoading(true);
              
              const result = await mockApiCall('testSystem');
              
              showSuccess('系統功能測試完成！請檢查後台日誌查看詳細結果。');
              
              showLoading(false);
          } catch (error) {
              console.error('系統測試失敗:', error);
              showError('系統測試失敗');
              showLoading(false);
          }
      }

      // 生成年齡分布圖表
      function generateAgeChart(ageData) {
          const ctx = document.getElementById('ageChart').getContext('2d');
          
          // 模擬資料（實際使用時會從 ageData 參數取得）
          const mockData = ageData || {
              '30歲以下': 5,
              '31-40歲': 12,
              '41-50歲': 18,
              '51-60歲': 25,
              '61-70歲': 30,
              '71歲以上': 15
          };

          new Chart(ctx, {
              type: 'doughnut',
              data: {
                  labels: Object.keys(mockData),
                  datasets: [{
                      data: Object.values(mockData),
                      backgroundColor: [
                          '#FF6384',
                          '#36A2EB',
                          '#FFCE56',
                          '#4BC0C0',
                          '#9966FF',
                          '#FF9F40'
                      ]
                  }]
              },
              options: {
                  responsive: true,
                  plugins: {
                      legend: {
                          position: 'bottom'
                      },
                      title: {
                          display: true,
                          text: '會員年齡分布'
                      }
                  }
              }
          });
      }

      // 生成財務趨勢圖表
      function generateFinanceChart(trendData) {
          const ctx = document.getElementById('financeChart').getContext('2d');
          
          // 模擬資料（實際使用時會從 trendData 參數取得）
          const mockData = trendData || {
              '2024-01': { income: 50000, expense: 30000 },
              '2024-02': { income: 45000, expense: 25000 },
              '2024-03': { income: 60000, expense: 35000 },
              '2024-04': { income: 55000, expense: 40000 },
              '2024-05': { income: 70000, expense: 45000 },
              '2024-06': { income: 65000, expense: 38000 }
          };

          const labels = Object.keys(mockData);
          const incomeData = labels.map(key => mockData[key].income);
          const expenseData = labels.map(key => mockData[key].expense);

          new Chart(ctx, {
              type: 'line',
              data: {
                  labels: labels,
                  datasets: [{
                      label: '收入',
                      data: incomeData,
                      borderColor: '#27ae60',
                      backgroundColor: 'rgba(39, 174, 96, 0.1)',
                      tension: 0.4
                  }, {
                      label: '支出',
                      data: expenseData,
                      borderColor: '#e74c3c',
                      backgroundColor: 'rgba(231, 76, 60, 0.1)',
                      tension: 0.4
                  }]
              },
              options: {
                  responsive: true,
                  plugins: {
                      title: {
                          display: true,
                          text: '財務收支趨勢'
                      }
                  },
                  scales: {
                      y: {
                          beginAtZero: true,
                          ticks: {
                              callback: function(value) {
                                  return '$' + value.toLocaleString();
                              }
                          }
                      }
                  }
              }
          });
      }

      // 工具函數
      function getStatusBadgeClass(status) {
          switch(status) {
              case '有效': return 'bg-success';
              case '停權': return 'bg-warning';
              case '退會': return 'bg-secondary';
              default: return 'bg-secondary';
          }
      }

      function getFeeStatusBadgeClass(status) {
          switch(status) {
              case '已繳費': return 'bg-success';
              case '未繳費': return 'bg-danger';
              default: return 'bg-secondary';
          }
      }

      function getTransactionTypeBadgeClass(type) {
          switch(type) {
              case '會費': return 'bg-primary';
              case '捐款': return 'bg-success';
              case '支出': return 'bg-danger';
              default: return 'bg-secondary';
          }
      }

      // UI 工具函數
      function showLoading(show) {
          const modal = document.getElementById('loadingModal');
          if (show) {
              new bootstrap.Modal(modal).show();
          } else {
              const modalInstance = bootstrap.Modal.getInstance(modal);
              if (modalInstance) modalInstance.hide();
          }
      }

      function showSuccess(message) {
          Swal.fire({
              title: '成功',
              text: message,
              icon: 'success',
              confirmButtonText: '確定'
          });
      }

      function showError(message) {
          Swal.fire({
              title: '錯誤',
              text: message,
              icon: 'error',
              confirmButtonText: '確定'
          });
      }

      // 模擬 API 呼叫（實際使用時請替換為真實的 GAS 函數呼叫）
      async function mockApiCall(functionName, data) {
          // 模擬網路延遲
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // 模擬不同函數的回應
          switch(functionName) {
              case 'getDashboardStats':
                  return {
                      totalMembers: 105,
                      activeMembers: 98,
                      monthlyIncome: 65000,
                      currentBalance: 250000
                  };
              
              case 'getAllMembers':
                  return {
                      success: true,
                      members: [
                          {
                              會員編號: 'P001',
                              姓名: '張三',
                              電話: '02-12345678',
                              電子郵件: 'zhang@example.com',
                              入會日期: '2023-01-15',
                              會員狀態: '有效',
                              會費狀態: '已繳費'
                          },
                          {
                              會員編號: 'P002',
                              姓名: '李四',
                              手機: '0912345678',
                              電子郵件: 'li@example.com',
                              入會日期: '2023-02-20',
                              會員狀態: '有效',
                              會費狀態: '未繳費'
                          }
                      ]
                  };
              
              case 'getFinanceRecords':
                  return {
                      success: true,
                      records: [
                          {
                              日期: '2024-01-15',
                              類型: '會費',
                              項目: '2024年會費',
                              收入: 1000,
                              支出: 0,
                              餘額: 250000,
                              會員姓名: '張三',
                              備註: '現金繳費'
                          },
                          {
                              日期: '2024-01-20',
                              類型: '捐款',
                              項目: '一般捐款',
                              收入: 5000,
                              支出: 0,
                              餘額: 255000,
                              會員姓名: '愛心人士',
                              備註: '轉帳捐款'
                          }
                      ]
                  };
              
              case 'addMember':
                  return {
                      success: true,
                      memberId: 'P' + String(Math.floor(Math.random() * 1000)).padStart(3, '0')
                  };
              
              case 'systemHealthCheck':
                  return {
                      spreadsheetAccess: true,
                      sheetsExist: true,
                      dataIntegrity: true,
                      emailService: true,
                      triggers: true
                  };
              
              default:
                  return { success: true, message: '操作完成' };
          }
      }

      // 實際 GAS 函數呼叫（取消註解並修改 GAS_URL）
      /*
      async function callGasFunction(functionName, data) {
          try {
              const response = await fetch(GAS_URL, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      function: functionName,
                      parameters: data
                  })
              });
              
              if (!response.ok) {
                  throw new Error('網路請求失敗');
              }
              
              return await response.json();
          } catch (error) {
              console.error('GAS 函數呼叫失敗:', error);
              throw error;
          }
      }
      */

      // 篩選財務記錄
      function filterFinanceRecords() {
          const startDate = document.getElementById('financeStartDate').value;
          const endDate = document.getElementById('financeEndDate').value;
          
          if (!startDate || !endDate) {
              showError('請選擇開始和結束日期');
              return;
          }
          
          const filteredRecords = currentFinanceRecords.filter(record => {
              const recordDate = new Date(record.日期);
              return recordDate >= new Date(startDate) && recordDate <= new Date(endDate);
          });
          
          displayFinanceRecords(filteredRecords);
      }

      // 編輯會員
      function editMember(memberId) {
          showError('編輯功能開發中...');
      }

      // 查看會員詳情
      function viewMember(memberId) {
          showError('查看詳情功能開發中...');
      }

      // 為特定會員記錄會費
      function recordMemberFee(memberId) {
          document.getElementById('addFeeForm').reset();
          document.querySelector('#addFeeForm input[name="memberId"]').value = memberId;
          new bootstrap.Modal(document.getElementById('addFeeModal')).show();
      }

      // 更新系統資訊
      function updateSystemInfo() {
          document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-TW');
      }

      // 頁面載入完成後更新系統資訊
      document.addEventListener('DOMContentLoaded', function() {
          updateSystemInfo();
      });
  </script>
</body>
</html>
                              

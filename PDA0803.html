<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>台灣帕金森病友權益促進會 - 財務會計系統</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
      :root {
          --primary-color: #2c5aa0;
          --secondary-color: #17a2b8;
          --success-color: #28a745;
          --danger-color: #dc3545;
          --warning-color: #ffc107;
          --info-color: #17a2b8;
          --light-color: #f8f9fa;
          --dark-color: #343a40;
      }

      body {
          font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f5f6fa;
          margin: 0;
          padding: 0;
      }

      /* 側邊欄樣式 */
      .sidebar {
          position: fixed;
          top: 0;
          left: 0;
          height: 100vh;
          width: 250px;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          transform: translateX(-250px);
          transition: transform 0.3s ease;
          z-index: 1000;
          overflow-y: auto;
      }

      .sidebar.active {
          transform: translateX(0);
      }

      .sidebar-header {
          padding: 20px;
          text-align: center;
          border-bottom: 1px solid rgba(255,255,255,0.1);
      }

      .sidebar-header h4 {
          margin: 0;
          font-size: 16px;
          font-weight: bold;
      }

      .sidebar-menu {
          list-style: none;
          padding: 0;
          margin: 20px 0;
      }

      .sidebar-menu li {
          margin: 0;
      }

      .sidebar-menu a {
          display: block;
          padding: 15px 20px;
          color: white;
          text-decoration: none;
          transition: all 0.3s ease;
          border-left: 3px solid transparent;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
          background-color: rgba(255,255,255,0.1);
          border-left-color: white;
          padding-left: 25px;
      }

      .sidebar-menu i {
          margin-right: 10px;
          width: 20px;
          text-align: center;
      }

      /* 主要內容區域 */
      .main-content {
          margin-left: 0;
          padding: 20px;
          transition: margin-left 0.3s ease;
          min-height: 100vh;
      }

      .main-content.sidebar-open {
          margin-left: 250px;
      }

      /* 頂部導航 */
      .top-navbar {
          background: white;
          padding: 15px 20px;
          margin: -20px -20px 20px -20px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .menu-toggle {
          background: none;
          border: none;
          font-size: 20px;
          color: var(--primary-color);
          cursor: pointer;
      }

      .user-info {
          display: flex;
          align-items: center;
          gap: 10px;
      }

      /* 卡片樣式 */
      .card {
          border: none;
          border-radius: 10px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          margin-bottom: 20px;
          transition: transform 0.2s ease;
      }

      .card:hover {
          transform: translateY(-2px);
      }

      .card-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          border-radius: 10px 10px 0 0 !important;
          padding: 15px 20px;
      }

      .card-header h5 {
          margin: 0;
          font-weight: 600;
      }

      /* 統計卡片 */
      .stat-card {
          background: white;
          border-radius: 10px;
          padding: 20px;
          text-align: center;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          transition: transform 0.2s ease;
      }

      .stat-card:hover {
          transform: translateY(-5px);
      }

      .stat-card .icon {
          font-size: 2.5rem;
          margin-bottom: 10px;
      }

      .stat-card .number {
          font-size: 2rem;
          font-weight: bold;
          margin-bottom: 5px;
      }

      .stat-card .label {
          color: #666;
          font-size: 0.9rem;
      }

      .stat-card.income {
          border-left: 4px solid var(--success-color);
      }

      .stat-card.expense {
          border-left: 4px solid var(--danger-color);
      }

      .stat-card.member {
          border-left: 4px solid var(--info-color);
      }

      .stat-card.balance {
          border-left: 4px solid var(--warning-color);
      }

      /* 表格樣式 */
      .table-responsive {
          border-radius: 10px;
          overflow: hidden;
      }

      .table {
          margin: 0;
      }

      .table th {
          background-color: var(--light-color);
          border: none;
          font-weight: 600;
          color: var(--dark-color);
      }

      .table td {
          border: none;
          vertical-align: middle;
      }

      .table tbody tr:hover {
          background-color: rgba(44, 90, 160, 0.05);
      }

      /* 按鈕樣式 */
      .btn {
          border-radius: 6px;
          font-weight: 500;
          padding: 8px 16px;
          transition: all 0.2s ease;
      }

      .btn-primary {
          background-color: var(--primary-color);
          border-color: var(--primary-color);
      }

      .btn-primary:hover {
          background-color: #1e3d6f;
          border-color: #1e3d6f;
      }

      .btn-sm {
          padding: 4px 8px;
          font-size: 0.875rem;
      }

      /* 表單樣式 */
      .form-control {
          border-radius: 6px;
          border: 1px solid #ddd;
          padding: 10px 12px;
          transition: border-color 0.2s ease;
      }

      .form-control:focus {
          border-color: var(--primary-color);
          box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
      }

      .form-label {
          font-weight: 500;
          color: var(--dark-color);
          margin-bottom: 8px;
      }

      /* 模態框樣式 */
      .modal-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          border-radius: 10px 10px 0 0;
      }

      .modal-content {
          border-radius: 10px;
          border: none;
      }

      /* 載入動畫 */
      .loading {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
          z-index: 9999;
          justify-content: center;
          align-items: center;
      }

      .loading.show {
          display: flex;
      }

      .spinner {
          width: 50px;
          height: 50px;
          border: 5px solid #f3f3f3;
          border-top: 5px solid var(--primary-color);
          border-radius: 50%;
          animation: spin 1s linear infinite;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      /* 提示訊息 */
      .alert {
          border-radius: 8px;
          border: none;
          padding: 12px 16px;
          margin-bottom: 20px;
      }

      .alert-success {
          background-color: #d4edda;
          color: #155724;
      }

      .alert-danger {
          background-color: #f8d7da;
          color: #721c24;
      }

      .alert-warning {
          background-color: #fff3cd;
          color: #856404;
      }

      .alert-info {
          background-color: #d1ecf1;
          color: #0c5460;
      }

      /* 響應式設計 */
      @media (max-width: 768px) {
          .sidebar {
              width: 100%;
              transform: translateX(-100%);
          }

          .main-content.sidebar-open {
              margin-left: 0;
          }

          .top-navbar {
              margin: -20px -20px 20px -20px;
          }

          .stat-card {
              margin-bottom: 15px;
          }
      }

      /* 頁面特定樣式 */
      .page-content {
          display: none;
      }

      .page-content.active {
          display: block;
      }

      .search-bar {
          background: white;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .action-buttons {
          display: flex;
          gap: 10px;
          margin-bottom: 20px;
      }

      /* 圖表容器 */
      .chart-container {
          background: white;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }

      .chart-container canvas {
          max-height: 400px;
      }

      /* 狀態標籤 */
      .status-badge {
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
      }

      .status-active {
          background-color: #d4edda;
          color: #155724;
      }

      .status-inactive {
          background-color: #f8d7da;
          color: #721c24;
      }

      .status-pending {
          background-color: #fff3cd;
          color: #856404;
      }

      .status-approved {
          background-color: #d4edda;
          color: #155724;
      }

      /* 金額顯示 */
      .amount-positive {
          color: var(--success-color);
          font-weight: bold;
      }

      .amount-negative {
          color: var(--danger-color);
          font-weight: bold;
      }

      .amount-neutral {
          color: var(--dark-color);
          font-weight: bold;
      }

      /* 分頁樣式 */
      .pagination {
          justify-content: center;
          margin-top: 20px;
      }

      .page-link {
          color: var(--primary-color);
          border-color: #dee2e6;
      }

      .page-link:hover {
          color: #1e3d6f;
          background-color: #e9ecef;
          border-color: #dee2e6;
      }

      .page-item.active .page-link {
          background-color: var(--primary-color);
          border-color: var(--primary-color);
      }
  </style>
</head>
<body>
  <!-- 載入動畫 -->
  <div class="loading" id="loadingOverlay">
      <div class="spinner"></div>
  </div>

  <!-- 側邊欄 -->
  <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
          <h4>財務會計系統</h4>
          <small>台灣帕金森病友權益促進會</small>
      </div>
      <ul class="sidebar-menu">
          <li><a href="#" data-page="dashboard" class="active"><i class="fas fa-tachometer-alt"></i> 儀表板</a></li>
          <li><a href="#" data-page="members"><i class="fas fa-users"></i> 會員管理</a></li>
          <li><a href="#" data-page="income"><i class="fas fa-arrow-up"></i> 收入管理</a></li>
          <li><a href="#" data-page="expenses"><i class="fas fa-arrow-down"></i> 支出管理</a></li>
          <li><a href="#" data-page="receipts"><i class="fas fa-receipt"></i> 電子收據</a></li>
          <li><a href="#" data-page="accounts"><i class="fas fa-list"></i> 會計科目</a></li>
          <li><a href="#" data-page="bank-accounts"><i class="fas fa-university"></i> 銀行帳戶</a></li>
          <li><a href="#" data-page="reports"><i class="fas fa-chart-bar"></i> 報表分析</a></li>
          <li><a href="#" data-page="settings"><i class="fas fa-cog"></i> 系統設定</a></li>
      </ul>
  </nav>

  <!-- 主要內容區域 -->
  <div class="main-content" id="mainContent">
      <!-- 頂部導航 -->
      <div class="top-navbar">
          <button class="menu-toggle" id="menuToggle">
              <i class="fas fa-bars"></i>
          </button>
          <div class="user-info">
              <span>管理員</span>
              <i class="fas fa-user-circle fa-lg"></i>
          </div>
      </div>

      <!-- 儀表板頁面 -->
      <div class="page-content active" id="dashboard-page">
          <div class="row mb-4">
              <div class="col-md-3 col-sm-6">
                  <div class="stat-card member">
                      <div class="icon">
                          <i class="fas fa-users text-info"></i>
                      </div>
                      <div class="number" id="totalMembers">0</div>
                      <div class="label">總會員數</div>
                  </div>
              </div>
              <div class="col-md-3 col-sm-6">
                  <div class="stat-card income">
                      <div class="icon">
                          <i class="fas fa-arrow-up text-success"></i>
                      </div>
                      <div class="number" id="monthlyIncome">$0</div>
                      <div class="label">本月收入</div>
                  </div>
              </div>
              <div class="col-md-3 col-sm-6">
                  <div class="stat-card expense">
                      <div class="icon">
                          <i class="fas fa-arrow-down text-danger"></i>
                      </div>
                      <div class="number" id="monthlyExpenses">$0</div>
                      <div class="label">本月支出</div>
                  </div>
              </div>
              <div class="col-md-3 col-sm-6">
                  <div class="stat-card balance">
                      <div class="icon">
                          <i class="fas fa-wallet text-warning"></i>
                      </div>
                      <div class="number" id="totalBalance">$0</div>
                      <div class="label">帳戶餘額</div>
                  </div>
              </div>
          </div>

          <div class="row">
              <div class="col-md-8">
                  <div class="chart-container">
                      <h5>收支趨勢圖</h5>
                      <canvas id="incomeExpenseChart"></canvas>
                  </div>
              </div>
              <div class="col-md-4">
                  <div class="card">
                      <div class="card-header">
                          <h5>最近交易</h5>
                      </div>
                      <div class="card-body">
                          <div id="recentTransactions">
                              <p class="text-muted">載入中...</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- 會員管理頁面 -->
      <div class="page-content" id="members-page">
          <div class="search-bar">
              <div class="row">
                  <div class="col-md-4">
                      <input type="text" class="form-control" id="memberSearch" placeholder="搜尋會員姓名、電話...">
                  </div>
                  <div class="col-md-3">
                      <select class="form-control" id="memberStatusFilter">
                          <option value="">所有狀態</option>
                          <option value="正常">正常</option>
                          <option value="停權">停權</option>
                      </select>
                  </div>
                  <div class="col-md-3">
                      <button class="btn btn-primary" onclick="searchMembers()">
                          <i class="fas fa-search"></i> 搜尋
                      </button>
                  </div>
                  <div class="col-md-2">
                      <button class="btn btn-success" onclick="showAddMemberModal()">
                          <i class="fas fa-plus"></i> 新增會員
                      </button>
                  </div>
              </div>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>會員列表</h5>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-hover">
                          <thead>
                              <tr>
                                  <th>會員編號</th>
                                  <th>姓名</th>
                                  <th>電話</th>
                                  <th>電子郵件</th>
                                  <th>會員狀態</th>
                                  <th>加入日期</th>
                                  <th>操作</th>
                              </tr>
                          </thead>
                          <tbody id="membersTableBody">
                              <tr>
                                  <td colspan="7" class="text-center">載入中...</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
                  <nav>
                      <ul class="pagination" id="membersPagination"></ul>
                  </nav>
              </div>
          </div>
      </div>

      <!-- 收入管理頁面 -->
      <div class="page-content" id="income-page">
          <div class="search-bar">
              <div class="row">
                  <div class="col-md-3">
                      <input type="date" class="form-control" id="incomeStartDate">
                  </div>
                  <div class="col-md-3">
                      <input type="date" class="form-control" id="incomeEndDate">
                  </div>
                  <div class="col-md-3">
                      <select class="form-control" id="incomeAccountFilter">
                          <option value="">所有科目</option>
                      </select>
                  </div>
                  <div class="col-md-3">
                      <button class="btn btn-primary" onclick="searchIncome()">
                          <i class="fas fa-search"></i> 搜尋
                      </button>
                      <button class="btn btn-success" onclick="showAddIncomeModal()">
                          <i class="fas fa-plus"></i> 新增收入
                      </button>
                  </div>
              </div>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>收入記錄</h5>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-hover">
                          <thead>
                              <tr>
                                  <th>日期</th>
                                  <th>會計科目</th>
                                  <th>金額</th>
                                  <th>付款人</th>
                                  <th>付款方式</th>
                                  <th>收據編號</th>
                                  <th>操作</th>
                              </tr>
                          </thead>
                          <tbody id="incomeTableBody">
                              <tr>
                                  <td colspan="7" class="text-center">載入中...</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
                  <nav>
                      <ul class="pagination" id="incomePagination"></ul>
                  </nav>
              </div>
          </div>
      </div>

      <!-- 支出管理頁面 -->
      <div class="page-content" id="expenses-page">
          <div class="search-bar">
              <div class="row">
                  <div class="col-md-3">
                      <input type="date" class="form-control" id="expenseStartDate">
                  </div>
                  <div class="col-md-3">
                      <input type="date" class="form-control" id="expenseEndDate">
                  </div>
                  <div class="col-md-3">
                      <select class="form-control" id="expenseStatusFilter">
                          <option value="">所有狀態</option>
                          <option value="待審核">待審核</option>
                          <option value="已核准">已核准</option>
                          <option value="已拒絕">已拒絕</option>
                      </select>
                  </div>
                  <div class="col-md-3">
                      <button class="btn btn-primary" onclick="searchExpenses()">
                          <i class="fas fa-search"></i> 搜尋
                      </button>
                      <button class="btn btn-success" onclick="showAddExpenseModal()">
                          <i class="fas fa-plus"></i> 新增支出
                      </button>
                  </div>
              </div>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>支出記錄</h5>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-hover">
                          <thead>
                              <tr>
                                  <th>日期</th>
                                  <th>會計科目</th>
                                  <th>金額</th>
                                  <th>收款人</th>
                                  <th>付款方式</th>
                                  <th>狀態</th>
                                  <th>操作</th>
                              </tr>
                          </thead>
                          <tbody id="expensesTableBody">
                              <tr>
                                  <td colspan="7" class="text-center">載入中...</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
                  <nav>
                      <ul class="pagination" id="expensesPagination"></ul>
                  </nav>
              </div>
          </div>
      </div>

      <!-- 電子收據頁面 -->
      <div class="page-content" id="receipts-page">
          <div class="search-bar">
              <div class="row">
                  <div class="col-md-4">
                      <input type="text" class="form-control" id="receiptSearch" placeholder="搜尋收據編號...">
                  </div>
                  <div class="col-md-3">
                      <select class="form-control" id="receiptStatusFilter">
                          <option value="">所有狀態</option>
                          <option value="已開立">已開立</option>
                          <option value="已發送">已發送</option>
                      </select>
                  </div>
                  <div class="col-md-3">
                      <button class="btn btn-primary" onclick="searchReceipts()">
                          <i class="fas fa-search"></i> 搜尋
                      </button>
                  </div>
                  <div class="col-md-2">
                      <button class="btn btn-info" onclick="batchSendReceipts()">
                          <i class="fas fa-envelope"></i> 批量發送
                      </button>
                  </div>
              </div>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>電子收據列表</h5>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-hover">
                          <thead>
                              <tr>
                                  <th><input type="checkbox" id="selectAllReceipts"></th>
                                  <th>收據編號</th>
                                  <th>金額</th>
                                  <th>開立日期</th>
                                  <th>收據狀態</th>
                                  <th>郵件狀態</th>
                                  <th>操作</th>
                              </tr>
                          </thead>
                          <tbody id="receiptsTableBody">
                              <tr>
                                  <td colspan="7" class="text-center">載入中...</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
                  <nav>
                      <ul class="pagination" id="receiptsPagination"></ul>
                  </nav>
              </div>
          </div>
      </div>

      <!-- 會計科目頁面 -->
      <div class="page-content" id="accounts-page">
          <div class="action-buttons">
              <button class="btn btn-success" onclick="showAddAccountModal()">
                  <i class="fas fa-plus"></i> 新增科目
              </button>
              <button class="btn btn-info" onclick="importAccounts()">
                  <i class="fas fa-upload"></i> 匯入科目
              </button>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>會計科目樹狀結構</h5>
              </div>
              <div class="card-body">
                  <div id="accountsTree">
                      <p class="text-muted">載入中...</p>
                  </div>
              </div>
          </div>
      </div>

      <!-- 銀行帳戶頁面 -->
      <div class="page-content" id="bank-accounts-page">
          <div class="action-buttons">
              <button class="btn btn-success" onclick="showAddBankAccountModal()">
                  <i class="fas fa-plus"></i> 新增帳戶
              </button>
              <button class="btn btn-warning" onclick="reconcileAccounts()">
                  <i class="fas fa-balance-scale"></i> 帳戶對帳
              </button>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>銀行帳戶列表</h5>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-hover">
                          <thead>
                              <tr>
                                  <th>帳戶名稱</th>
                                  <th>銀行名稱</th>
                                  <th>帳戶類型</th>
                                  <th>目前餘額</th>
                                  <th>幣別</th>
                                  <th>狀態</th>
                                  <th>操作</th>
                              </tr>
                          </thead>
                          <tbody id="bankAccountsTableBody">
                              <tr>
                                  <td colspan="7" class="text-center">載入中...</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>

      <!-- 報表分析頁面 -->
      <div class="page-content" id="reports-page">
          <div class="row mb-4">
              <div class="col-md-3">
                  <div class="card">
                      <div class="card-body text-center">
                          <i class="fas fa-chart-line fa-2x text-primary mb-2"></i>
                          <h6>財務報表</h6>
                          <button class="btn btn-primary btn-sm" onclick="generateFinancialReport()">
                              產生報表
                          </button>
                      </div>
                  </div>
              </div>
              <div class="col-md-3">
                  <div class="card">
                      <div class="card-body text-center">
                          <i class="fas fa-balance-scale fa-2x text-success mb-2"></i>
                          <h6>資產負債表</h6>
                          <button class="btn btn-success btn-sm" onclick="generateBalanceSheet()">
                              產生報表
                          </button>
                      </div>
                  </div>
              </div>
              <div class="col-md-3">
                  <div class="card">
                      <div class="card-body text-center">
                          <i class="fas fa-hand-holding-usd fa-2x text-info mb-2"></i>
                          <h6>現金流量表</h6>
                          <button class="btn btn-info btn-sm" onclick="generateCashFlowReport()">
                              產生報表
                          </button>
                      </div>
                  </div>
              </div>
              <div class="col-md-3">
                  <div class="card">
                      <div class="card-body text-center">
                          <i class="fas fa-heart fa-2x text-danger mb-2"></i>
                          <h6>捐款報表</h6>
                          <button class="btn btn-danger btn-sm" onclick="generateDonationReport()">
                              產生報表
                          </button>
                      </div>
                  </div>
              </div>
          </div>

          <div class="card">
              <div class="card-header">
                  <h5>報表內容</h5>
              </div>
              <div class="card-body">
                  <div id="reportContent">
                      <p class="text-muted text-center">請選擇上方的報表類型來產生報表</p>
                  </div>
              </div>
          </div>
      </div>

      <!-- 系統設定頁面 -->
      <div class="page-content" id="settings-page">
          <div class="row">
              <div class="col-md-6">
                  <div class="card">
                      <div class="card-header">
                          <h5>組織基本資訊</h5>
                      </div>
                      <div class="card-body">
                          <form id="organizationForm">
                              <div class="mb-3">
                                  <label class="form-label">組織名稱</label>
                                  <input type="text" class="form-control" id="orgName" name="name" required>
                              </div>
                              <div class="mb-3">
                                  <label class="form-label">組織地址</label>
                                  <textarea class="form-control" id="orgAddress" name="address" rows="3"></textarea>
                              </div>
                              <div class="mb-3">
                                  <label class="form-label">聯絡電話</label>
                                  <input type="tel" class="form-control" id="orgPhone" name="phone">
                              </div>
                              <div class="mb-3">
                                  <label class="form-label">電子郵件</label>
                                  <input type="email" class="form-control" id="orgEmail" name="email">
                              </div>
                              <div class="mb-3">
                                  <label class="form-label">統一編號</label>
                                  <input type="text" class="form-control" id="orgTaxId" name="taxId">
                              </div>
                              <button type="submit" class="btn btn-primary">
                                  <i class="fas fa-save"></i> 儲存設定
                              </button>
                          </form>
                      </div>
                  </div>
              </div>
              <div class="col-md-6">
                  <div class="card">
                      <div class="card-header">
                          <h5>系統管理</h5>
                      </div>
                      <div class="card-body">
                          <div class="d-grid gap-2">
                              <button class="btn btn-info" onclick="createBackup()">
                                  <i class="fas fa-download"></i> 建立系統備份
                              </button>
                              <button class="btn btn-warning" onclick="cleanupSystem()">
                                  <i class="fas fa-broom"></i> 清理系統資料
                              </button>
                              <button class="btn btn-secondary" onclick="checkSystemHealth()">
                                  <i class="fas fa-heartbeat"></i> 系統健康檢查
                              </button>
                              <button class="btn btn-danger" onclick="resetSystem()">
                                  <i class="fas fa-redo"></i> 重置系統設定
                              </button>
                          </div>
                      </div>
                  </div>

                  <div class="card mt-3">
                      <div class="card-header">
                          <h5>系統狀態</h5>
                      </div>
                      <div class="card-body">
                          <div id="systemStatus">
                              <p class="text-muted">載入中...</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增會員模態框 -->
  <div class="modal fade" id="addMemberModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">新增會員</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addMemberForm">
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">姓名 *</label>
                                  <input type="text" class="form-control" name="姓名" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">身分證字號</label>
                                  <input type="text" class="form-control" name="身分證字號">
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">電話</label>
                                  <input type="tel" class="form-control" name="電話">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">電子郵件</label>
                                  <input type="email" class="form-control" name="電子郵件">
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">地址</label>
                          <textarea class="form-control" name="地址" rows="2"></textarea>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">會員類型</label>
                                  <select class="form-control" name="會員類型">
                                      <option value="一般會員">一般會員</option>
                                      <option value="榮譽會員">榮譽會員</option>
                                      <option value="贊助會員">贊助會員</option>
                                  </select>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">會員狀態</label>
                                  <select class="form-control" name="會員狀態">
                                      <option value="正常">正常</option>
                                      <option value="停權">停權</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="saveMember()">儲存</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增收入模態框 -->
  <div class="modal fade" id="addIncomeModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">新增收入記錄</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addIncomeForm">
                      <div class="mb-3">
                          <label class="form-label">日期 *</label>
                          <input type="date" class="form-control" name="日期" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">會計科目 *</label>
                          <select class="form-control" name="會計科目" id="incomeAccountSelect" required>
                              <option value="">請選擇會計科目</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">金額 *</label>
                          <input type="number" class="form-control" name="金額" min="0" step="0.01" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款人</label>
                          <input type="text" class="form-control" name="付款人">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款方式</label>
                          <select class="form-control" name="付款方式">
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="備註" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="saveIncome()">儲存</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增支出模態框 -->
  <div class="modal fade" id="addExpenseModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">新增支出記錄</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addExpenseForm">
                      <div class="mb-3">
                          <label class="form-label">日期 *</label>
                          <input type="date" class="form-control" name="日期" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">會計科目 *</label>
                          <select class="form-control" name="會計科目" id="expenseAccountSelect" required>
                              <option value="">請選擇會計科目</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">金額 *</label>
                          <input type="number" class="form-control" name="金額" min="0" step="0.01" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">收款人</label>
                          <input type="text" class="form-control" name="收款人">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款方式</label>
                          <select class="form-control" name="付款方式">
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="備註" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="saveExpense()">儲存</button>
              </div>
          </div>
      </div>
  </div>

  <!-- JavaScript 引用 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
      // 全域變數
      const API_URL = 'https://script.google.com/macros/s/AKfycbwhrflp3ePgjNaYmB414tUFIqZhTA_URng6IWCof21dFga3grM7PE1DuLbPwIWgTWTg/exec'; // 請替換為您的 GAS Web App URL
      let currentPage = 'dashboard';
      let currentMemberPage = 1;
      let currentIncomePage = 1;
      let currentExpensePage = 1;

      // 初始化
      document.addEventListener('DOMContentLoaded', function() {
          initializeApp();
          setupEventListeners();
          loadDashboardData();
      });

      // 設定事件監聽器
      function setupEventListeners() {
          // 側邊欄切換
          document.getElementById('menuToggle').addEventListener('click', toggleSidebar);
          
          // 頁面導航
          document.querySelectorAll('.sidebar-menu a').forEach(link => {
              link.addEventListener('click', function(e) {
                  e.preventDefault();
                  const page = this.dataset.page;
                  if (page) {
                      navigateToPage(page);
                  }
              });
          });

          // 表單提交
          document.getElementById('organizationForm').addEventListener('submit', function(e) {
              e.preventDefault();
              saveOrganizationInfo();
          });

          // 搜尋功能
          document.getElementById('memberSearch').addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                  searchMembers();
              }
          });
      }

      // 初始化應用程式
      function initializeApp() {
          // 設定當前日期
          const today = new Date().toISOString().split('T')[0];
          document.querySelectorAll('input[type="date"]').forEach(input => {
              if (!input.value) {
                  input.value = today;
              }
          });

          // 載入會計科目選項
          loadAccountOptions();
      }

      // 側邊欄切換
      function toggleSidebar() {
          const sidebar = document.getElementById('sidebar');
          const mainContent = document.getElementById('mainContent');
          
          sidebar.classList.toggle('active');
          mainContent.classList.toggle('sidebar-open');
      }

      // 頁面導航
      function navigateToPage(page) {
          // 隱藏所有頁面
          document.querySelectorAll('.page-content').forEach(content => {
              content.classList.remove('active');
          });

          // 顯示目標頁面
          document.getElementById(page + '-page').classList.add('active');

          // 更新側邊欄選中狀態
          document.querySelectorAll('.sidebar-menu a').forEach(link => {
              link.classList.remove('active');
          });
          document.querySelector(`[data-page="${page}"]`).classList.add('active');

          currentPage = page;

          // 載入頁面資料
          loadPageData(page);
      }

      // 載入頁面資料
      function loadPageData(page) {
          switch (page) {
              case 'dashboard':
                  loadDashboardData();
                  break;
              case 'members':
                  loadMembers();
                  break;
              case 'income':
                  loadIncome();
                  break;
              case 'expenses':
                  loadExpenses();
                  break;
              case 'receipts':
                  loadReceipts();
                  break;
              case 'accounts':
                  loadAccounts();
                  break;
              case 'bank-accounts':
                  loadBankAccounts();
                  break;
              case 'settings':
                  loadSystemSettings();
                  break;
          }
      }

      // API 呼叫函數
      async function apiCall(action, data = {}) {
          showLoading();
          try {
              const response = await fetch(API_URL, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      action: action,
                      data: data
                  })
              });

              const result = await response.json();
              
              if (!result.success) {
                  throw new Error(result.message || '操作失敗');
              }

              return result;
          } catch (error) {
              console.error('API 呼叫錯誤:', error);
              showAlert('錯誤: ' + error.message, 'danger');
              throw error;
          } finally {
              hideLoading();
          }
      }

      // 載入儀表板資料
      async function loadDashboardData() {
          try {
              // 載入統計資料
              const [membersResult, incomeResult, expensesResult] = await Promise.all([
                  apiCall('getMembers', { limit: 1 }),
                  apiCall('getIncomeStatistics', { month: new Date().toISOString().slice(0, 7) }),
                  apiCall('getExpensesStatistics', { month: new Date().toISOString().slice(0, 7) })
              ]);

              // 更新統計卡片
              document.getElementById('totalMembers').textContent = membersResult.pagination?.totalCount || 0;
              document.getElementById('monthlyIncome').textContent = '$' + (incomeResult.data?.totalAmount || 0).toLocaleString();
              document.getElementById('monthlyExpenses').textContent = '$' + (expensesResult.data?.totalAmount || 0).toLocaleString();
              
              const balance = (incomeResult.data?.totalAmount || 0) - (expensesResult.data?.totalAmount || 0);
              document.getElementById('totalBalance').textContent = '$' + balance.toLocaleString();

              // 載入圖表
              loadIncomeExpenseChart();
              loadRecentTransactions();

          } catch (error) {
              console.error('載入儀表板資料錯誤:', error);
          }
      }

      // 載入收支趨勢圖
      function loadIncomeExpenseChart() {
          const ctx = document.getElementById('incomeExpenseChart').getContext('2d');
          
          new Chart(ctx, {
              type: 'line',
              data: {
                  labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                  datasets: [{
                      label: '收入',
                      data: [50000, 45000, 60000, 55000, 70000, 65000],
                      borderColor: '#28a745',
                      backgroundColor: 'rgba(40, 167, 69, 0.1)',
                      tension: 0.4
                  }, {
                      label: '支出',
                      data: [30000, 35000, 40000, 38000, 45000, 42000],
                      borderColor: '#dc3545',
                      backgroundColor: 'rgba(220, 53, 69, 0.1)',
                      tension: 0.4
                  }]
              },
              options: {
                  responsive: true,
                  plugins: {
                      title: {
                          display: true,
                          text: '月度收支趨勢'
                      }
                  },
                  scales: {
                      y: {
                          beginAtZero: true,
                          ticks: {
                              callback: function(value) {
                                  return '$' + value.toLocaleString();
                              }
                          }
                      }
                  }
              }
          });
      }

      // 載入最近交易
      async function loadRecentTransactions() {
          try {
              const result = await apiCall('getIncome', { limit: 5 });
              const transactions = result.data || [];

              const html = transactions.map(transaction => `
                  <div class="d-flex justify-content-between align-items-center mb-2">
                      <div>
                          <small class="text-muted">${transaction['日期']}</small><br>
                          <strong>${transaction['會計科目']}</strong>
                      </div>
                      <div class="text-end">
                          <span class="amount-positive">+$${parseFloat(transaction['金額'] || 0).toLocaleString()}</span>
                      </div>
                  </div>
              `).join('');

              document.getElementById('recentTransactions').innerHTML = html || '<p class="text-muted">暫無交易記錄</p>';

          } catch (error) {
              document.getElementById('recentTransactions').innerHTML = '<p class="text-danger">載入失敗</p>';
          }
      }

      // 載入會員資料
      async function loadMembers(page = 1) {
          try {
              const result = await apiCall('getMembers', { 
                  page: page, 
                  limit: 10,
                  search: document.getElementById('memberSearch')?.value,
                  status: document.getElementById('memberStatusFilter')?.value
              });

              const members = result.data || [];
              const tbody = document.getElementById('membersTableBody');

              if (members.length === 0) {
                  tbody.innerHTML = '<tr><td colspan="7" class="text-center">暫無資料</td></tr>';
              } else {
                  tbody.innerHTML = members.map(member => `
                      <tr>
                          <td>${member['會員編號'] || ''}</td>
                          <td>${member['姓名'] || ''}</td>
                          <td>${member['電話'] || ''}</td>
                          <td>${member['電子郵件'] || ''}</td>
                          <td><span class="status-badge ${member['會員狀態'] === '正常' ? 'status-active' : 'status-inactive'}">${member['會員狀態'] || ''}</span></td>
                          <td>${member['加入日期'] || ''}</td>
                          <td>
                              <button class="btn btn-sm btn-outline-primary" onclick="editMember('${member['ID']}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-outline-danger" onclick="deleteMember('${member['ID']}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </td>
                      </tr>
                  `).join('');
              }

              // 更新分頁
              updatePagination('membersPagination', result.pagination, loadMembers);
              currentMemberPage = page;

          } catch (error) {
              document.getElementById('membersTableBody').innerHTML = '<tr><td colspan="7" class="text-center text-danger">載入失敗</td></tr>';
          }
      }

      // 載入收入資料
      async function loadIncome(page = 1) {
          try {
              const result = await apiCall('getIncome', { 
                  page: page, 
                  limit: 10,
                  startDate: document.getElementById('incomeStartDate')?.value,
                  endDate: document.getElementById('incomeEndDate')?.value,
                  account: document.getElementById('incomeAccountFilter')?.value
              });

              const income = result.data || [];
              const tbody = document.getElementById('incomeTableBody');

              if (income.length === 0) {
                  tbody.innerHTML = '<tr><td colspan="7" class="text-center">暫無資料</td></tr>';
              } else {
                  tbody.innerHTML = income.map(record => `
                      <tr>
                          <td>${record['日期'] || ''}</td>
                          <td>${record['會計科目'] || ''}</td>
                          <td class="amount-positive">$${parseFloat(record['金額'] || 0).toLocaleString()}</td>
                          <td>${record['付款人'] || ''}</td>
                          <td>${record['付款方式'] || ''}</td>
                          <td>${record['收據編號'] || ''}</td>
                          <td>
                              <button class="btn btn-sm btn-outline-primary" onclick="editIncome('${record['ID']}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-outline-danger" onclick="deleteIncome('${record['ID']}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </td>
                      </tr>
                  `).join('');
              }

              updatePagination('incomePagination', result.pagination, loadIncome);
              currentIncomePage = page;

          } catch (error) {
              document.getElementById('incomeTableBody').innerHTML = '<tr><td colspan="7" class="text-center text-danger">載入失敗</td></tr>';
          }
      }

      // 載入會計科目選項
      async function loadAccountOptions() {
          try {
              const result = await apiCall('getAccounts', { enabledOnly: true });
              const accounts = result.data || [];

              const incomeAccounts = accounts.filter(acc => acc['科目類型'] === '收入');
              const expenseAccounts = accounts.filter(acc => acc['科目類型'] === '支出');

              // 更新收入科目選項
              const incomeSelect = document.getElementById('incomeAccountSelect');
              if (incomeSelect) {
                  incomeSelect.innerHTML = '<option value="">請選擇會計科目</option>' +
                      incomeAccounts.map(acc => `<option value="${acc['科目名稱']}">${acc['科目名稱']}</option>`).join('');
              }

              // 更新支出科目選項
              const expenseSelect = document.getElementById('expenseAccountSelect');
              if (expenseSelect) {
                  expenseSelect.innerHTML = '<option value="">請選擇會計科目</option>' +
                      expenseAccounts.map(acc => `<option value="${acc['科目名稱']}">${acc['科目名稱']}</option>`).join('');
              }

              // 更新篩選選項
              const incomeFilter = document.getElementById('incomeAccountFilter');
              if (incomeFilter) {
                  incomeFilter.innerHTML = '<option value="">所有科目</option>' +
                      incomeAccounts.map(acc => `<option value="${acc['科目名稱']}">${acc['科目名稱']}</option>`).join('');
              }

          } catch (error) {
              console.error('載入會計科目選項錯誤:', error);
          }
      }

      // 顯示新增會員模態框
      function showAddMemberModal() {
          const modal = new bootstrap.Modal(document.getElementById('addMemberModal'));
          document.getElementById('addMemberForm').reset();
          modal.show();
      }

      // 儲存會員
      async function saveMember() {
          try {
              const form = document.getElementById('addMemberForm');
              const formData = new FormData(form);
              const memberData = {};
              
              for (let [key, value] of formData.entries()) {
                  memberData[key] = value;
              }

              await apiCall('addMember', memberData);
              
              bootstrap.Modal.getInstance(document.getElementById('addMemberModal')).hide();
              showAlert('會員新增成功', 'success');
              loadMembers(currentMemberPage);

          } catch (error) {
              showAlert('新增會員失敗: ' + error.message, 'danger');
          }
      }

      // 顯示載入動畫
      function showLoading() {
          document.getElementById('loadingOverlay').classList.add('show');
      }

      // 隱藏載入動畫
      function hideLoading() {
          document.getElementById('loadingOverlay').classList.remove('show');
      }

      // 顯示提示訊息
      function showAlert(message, type = 'info') {
          const alertDiv = document.createElement('div');
          alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
          alertDiv.innerHTML = `
              ${message}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          `;

          const container = document.querySelector('.main-content');
          container.insertBefore(alertDiv, container.firstChild);

          // 自動移除提示
          setTimeout(() => {
              alertDiv.remove();
          }, 5000);
      }

      // 更新分頁
      function updatePagination(elementId, pagination, loadFunction) {
          const paginationElement = document.getElementById(elementId);
          if (!paginationElement || !pagination) return;

          let html = '';

          // 上一頁
          if (pagination.hasPreviousPage) {
              html += `<li class="page-item"><a class="page-link" href="#" onclick="${loadFunction.name}(${pagination.currentPage - 1}); return false;">上一頁</a></li>`;
          }

          // 頁碼
          const startPage = Math.max(1, pagination.currentPage - 2);
          const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);

          for (let i = startPage; i <= endPage; i++) {
              html += `<li class="page-item ${i === pagination.currentPage ? 'active' : ''}">
                  <a class="page-link" href="#" onclick="${loadFunction.name}(${i}); return false;">${i}</a>
              </li>`;
          }

          // 下一頁
          if (pagination.hasNextPage) {
              html += `<li class="page-item"><a class="page-link" href="#" onclick="${loadFunction.name}(${pagination.currentPage + 1}); return false;">下一頁</a></li>`;
          }

          paginationElement.innerHTML = html;
      }

      // 搜尋會員
      function searchMembers() {
          loadMembers(1);
      }

      // 其他功能函數（簡化版）
      function showAddIncomeModal() {
          const modal = new bootstrap.Modal(document.getElementById('addIncomeModal'));
          document.getElementById('addIncomeForm').reset();
          modal.show();
      }

      function showAddExpenseModal() {
          const modal = new bootstrap.Modal(document.getElementById('addExpenseModal'));
          document.getElementById('addExpenseForm').reset();
          modal.show();
      }

      async function saveIncome() {
          // 實作收入儲存邏輯
          showAlert('功能開發中', 'info');
      }

      async function saveExpense() {
          // 實作支出儲存邏輯
          showAlert('功能開發中', 'info');
      }

      function loadExpenses() {
          // 實作載入支出邏輯
          console.log('載入支出資料');
      }

      function loadReceipts() {
          // 實作載入收據邏輯
          console.log('載入收據資料');
      }

      function loadAccounts() {
          // 實作載入會計科目邏輯
          console.log('載入會計科目');
      }

      function loadBankAccounts() {
          // 實作載入銀行帳戶邏輯
          console.log('載入銀行帳戶');
      }

      function loadSystemSettings() {
          // 實作載入系統設定邏輯
          console.log('載入系統設定');
      }

      // 確保 API_URL 已設定的提示
      if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL') {
          console.warn('請設定正確的 Google Apps Script Web App URL');
          showAlert('請在程式碼中設定正確的 API URL', 'warning');
      }
  </script>
</body>
</html>

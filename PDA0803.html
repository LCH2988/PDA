<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>台灣帕金森病友權益促進會 - 管理系統</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232c3e50'/%3E%3Cpath d='M30 40h40v20H30z' fill='%23fff'/%3E%3Ccircle cx='40' cy='50' r='8' fill='%23e74c3c'/%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232c3e50'/%3E%3Cpath d='M30 40h40v20H30z' fill='%23fff'/%3E%3Ccircle cx='40' cy='50' r='8' fill='%23e74c3c'/%3E%3C/svg%3E">
  
  <!-- Meta tags for SEO and social sharing -->
  <meta name="description" content="台灣帕金森病友權益促進會管理系統 - 會員管理、財務管理、報表分析">
  <meta name="keywords" content="帕金森,病友會,會員管理,財務管理">
  <meta name="author" content="台灣帕金森病友權益促進會">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lch2988.github.io/PDA/PDA0803.html">
  <meta property="og:title" content="台灣帕金森病友權益促進會 - 管理系統">
  <meta property="og:description" content="專業的病友會管理系統，提供會員管理、財務管理、報表分析等功能">
  <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232c3e50'/%3E%3Cpath d='M30 40h40v20H30z' fill='%23fff'/%3E%3Ccircle cx='40' cy='50' r='8' fill='%23e74c3c'/%3E%3C/svg%3E">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://lch2988.github.io/PDA/PDA0803.html">
  <meta property="twitter:title" content="台灣帕金森病友權益促進會 - 管理系統">
  <meta property="twitter:description" content="專業的病友會管理系統，提供會員管理、財務管理、報表分析等功能">
  
  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  
  <!-- CSS Libraries -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  
  <style>
      :root {
          --primary-color: #2c3e50;
          --secondary-color: #3498db;
          --success-color: #27ae60;
          --warning-color: #f39c12;
          --danger-color: #e74c3c;
          --light-bg: #ecf0f1;
      }

      body {
          font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f8f9fa;
          margin: 0;
          padding: 0;
      }

      .navbar {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .navbar-brand {
          font-weight: bold;
          font-size: 1.3rem;
      }

      .sidebar {
          background: white;
          min-height: calc(100vh - 76px);
          box-shadow: 2px 0 10px rgba(0,0,0,0.1);
          padding: 0;
      }

      .sidebar .nav-link {
          color: var(--primary-color);
          padding: 15px 20px;
          border-bottom: 1px solid #eee;
          transition: all 0.3s ease;
      }

      .sidebar .nav-link:hover {
          background-color: var(--light-bg);
          color: var(--secondary-color);
          transform: translateX(5px);
      }

      .sidebar .nav-link.active {
          background-color: var(--secondary-color);
          color: white;
          border-left: 4px solid var(--primary-color);
      }

      .main-content {
          padding: 30px;
          min-height: calc(100vh - 76px);
      }

      .page-header {
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }

      .page-header h2 {
          color: var(--primary-color);
          margin: 0;
          font-weight: 600;
      }

      .stats-card {
          background: white;
          border-radius: 10px;
          padding: 25px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          transition: transform 0.3s ease;
          border-left: 4px solid;
      }

      .stats-card:hover {
          transform: translateY(-5px);
      }

      .stats-card.primary { border-left-color: var(--primary-color); }
      .stats-card.success { border-left-color: var(--success-color); }
      .stats-card.warning { border-left-color: var(--warning-color); }
      .stats-card.danger { border-left-color: var(--danger-color); }

      .stats-card .icon {
          font-size: 2.5rem;
          opacity: 0.7;
      }

      .stats-card .number {
          font-size: 2rem;
          font-weight: bold;
          margin: 10px 0;
      }

      .card {
          border: none;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }

      .card-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          border-radius: 10px 10px 0 0 !important;
          padding: 15px 20px;
      }

      .btn-primary {
          background: var(--secondary-color);
          border-color: var(--secondary-color);
      }

      .btn-primary:hover {
          background: var(--primary-color);
          border-color: var(--primary-color);
      }

      .table {
          background: white;
      }

      .table th {
          background-color: var(--light-bg);
          color: var(--primary-color);
          font-weight: 600;
          border: none;
      }

      .badge {
          font-size: 0.8rem;
          padding: 5px 10px;
      }

      .form-control:focus {
          border-color: var(--secondary-color);
          box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      }

      .modal-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
      }

      .loading {
          display: none;
          text-align: center;
          padding: 50px;
      }

      .spinner-border {
          color: var(--secondary-color);
      }

      .search-box {
          background: white;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .action-buttons .btn {
          margin-right: 5px;
          margin-bottom: 5px;
      }

      .loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
          display: none;
          justify-content: center;
          align-items: center;
          z-index: 9999;
      }

      .loading-spinner {
          background: white;
          padding: 30px;
          border-radius: 10px;
          text-align: center;
      }

      @media (max-width: 768px) {
          .sidebar {
              position: fixed;
              left: -250px;
              width: 250px;
              z-index: 1000;
              transition: left 0.3s ease;
          }

          .sidebar.show {
              left: 0;
          }

          .main-content {
              margin-left: 0;
              padding: 20px 15px;
          }

          .stats-card {
              margin-bottom: 20px;
          }
      }

      .page-section {
          display: none;
      }

      .page-section.active {
          display: block;
      }

      .chart-container {
          background: white;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }

      .btn:focus,
      .form-control:focus,
      .nav-link:focus {
          outline: 2px solid var(--secondary-color);
          outline-offset: 2px;
      }

      @media print {
          .sidebar,
          .navbar,
          .btn,
          .modal {
              display: none !important;
          }
          
          .main-content {
              margin-left: 0;
              padding: 0;
          }
      }
  </style>
</head>
<body>
  <!-- 載入覆蓋層 -->
  <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner">
          <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">載入中...</span>
          </div>
          <div class="mt-3">處理中，請稍候...</div>
      </div>
  </div>

  <!-- 導航列 -->
  <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
          <button class="navbar-toggler d-lg-none" type="button" id="sidebarToggle" aria-label="切換側邊欄">
              <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="#" aria-label="回到首頁">
              <i class="fas fa-heartbeat me-2" aria-hidden="true"></i>
              台灣帕金森病友權益促進會
          </a>
          <div class="navbar-nav ms-auto">
              <div class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fas fa-user-circle me-1" aria-hidden="true"></i>管理員
                  </a>
                  <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2" aria-hidden="true"></i>系統設定</a></li>
                      <li><a class="dropdown-item" href="#"><i class="fas fa-download me-2" aria-hidden="true"></i>資料備份</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2" aria-hidden="true"></i>登出</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </nav>

  <div class="container-fluid">
      <div class="row">
          <!-- 側邊欄 -->
          <div class="col-lg-2 p-0">
              <div class="sidebar" id="sidebar">
                  <nav class="nav flex-column" role="navigation">
                      <a class="nav-link active" href="#" data-page="dashboard" role="button" aria-current="page">
                          <i class="fas fa-tachometer-alt me-2" aria-hidden="true"></i>儀表板
                      </a>
                      <a class="nav-link" href="#" data-page="members" role="button">
                          <i class="fas fa-users me-2" aria-hidden="true"></i>會員管理
                      </a>
                      <a class="nav-link" href="#" data-page="finance" role="button">
                          <i class="fas fa-money-bill-wave me-2" aria-hidden="true"></i>財務管理
                      </a>
                      <a class="nav-link" href="#" data-page="reports" role="button">
                          <i class="fas fa-chart-bar me-2" aria-hidden="true"></i>報表分析
                      </a>
                      <a class="nav-link" href="#" data-page="settings" role="button">
                          <i class="fas fa-cog me-2" aria-hidden="true"></i>系統設定
                      </a>
                  </nav>
              </div>
          </div>

          <!-- 主要內容區 -->
          <div class="col-lg-10">
              <div class="main-content">
                  <!-- 儀表板頁面 -->
                  <div id="dashboard" class="page-section active">
                      <div class="page-header">
                          <h2><i class="fas fa-tachometer-alt me-2" aria-hidden="true"></i>系統儀表板</h2>
                          <p class="mb-0 text-muted">歡迎使用台灣帕金森病友權益促進會管理系統</p>
                      </div>

                      <!-- 統計卡片 -->
                      <div class="row mb-4">
                          <div class="col-md-3">
                              <div class="stats-card primary">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">會員總數</h6>
                                          <div class="number text-primary" id="totalMembers" aria-label="會員總數">0</div>
                                      </div>
                                      <div class="icon text-primary" aria-hidden="true">
                                          <i class="fas fa-users"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-3">
                              <div class="stats-card success">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">有效會員</h6>
                                          <div class="number text-success" id="activeMembers" aria-label="有效會員數">0</div>
                                      </div>
                                      <div class="icon text-success" aria-hidden="true">
                                          <i class="fas fa-user-check"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-3">
                              <div class="stats-card warning">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">本月收入</h6>
                                          <div class="number text-warning" id="monthlyIncome" aria-label="本月收入">$0</div>
                                      </div>
                                      <div class="icon text-warning" aria-hidden="true">
                                          <i class="fas fa-arrow-up"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-3">
                              <div class="stats-card danger">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="text-muted">當前餘額</h6>
                                          <div class="number text-info" id="currentBalance" aria-label="當前餘額">$0</div>
                                      </div>
                                      <div class="icon text-info" aria-hidden="true">
                                          <i class="fas fa-wallet"></i>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- 快速操作 -->
                      <div class="row">
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0"><i class="fas fa-plus-circle me-2" aria-hidden="true"></i>快速操作</h5>
                                  </div>
                                  <div class="card-body">
                                      <div class="d-grid gap-2">
                                          <button class="btn btn-primary" onclick="showAddMemberModal()" type="button">
                                              <i class="fas fa-user-plus me-2" aria-hidden="true"></i>新增會員
                                          </button>
                                          <button class="btn btn-success" onclick="showAddFeeModal()" type="button">
                                              <i class="fas fa-money-bill me-2" aria-hidden="true"></i>記錄會費
                                          </button>
                                          <button class="btn btn-info" onclick="showAddDonationModal()" type="button">
                                              <i class="fas fa-heart me-2" aria-hidden="true"></i>記錄捐款
                                          </button>
                                          <button class="btn btn-warning" onclick="showAddExpenseModal()" type="button">
                                              <i class="fas fa-receipt me-2" aria-hidden="true"></i>記錄支出
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0"><i class="fas fa-bell me-2" aria-hidden="true"></i>系統通知</h5>
                                  </div>
                                  <div class="card-body">
                                      <div id="notifications">
                                          <div class="alert alert-info alert-sm">
                                              <i class="fas fa-info-circle me-2" aria-hidden="true"></i>系統運行正常
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 會員管理頁面 -->
                  <div id="members" class="page-section">
                      <div class="page-header">
                          <div class="d-flex justify-content-between align-items-center">
                              <div>
                                  <h2><i class="fas fa-users me-2"></i>會員管理</h2>
                                  <p class="mb-0 text-muted">管理會員資料與狀態</p>
                              </div>
                              <button class="btn btn-primary" onclick="showAddMemberModal()">
                                  <i class="fas fa-plus me-2"></i>新增會員
                              </button>
                          </div>
                      </div>

                      <!-- 搜尋區域 -->
                      <div class="search-box">
                          <div class="row">
                              <div class="col-md-4">
                                  <input type="text" class="form-control" id="memberSearch" placeholder="搜尋會員姓名或編號">
                              </div>
                              <div class="col-md-3">
                                  <select class="form-control" id="memberStatusFilter">
                                      <option value="">所有狀態</option>
                                      <option value="有效">有效</option>
                                      <option value="停權">停權</option>
                                      <option value="退會">退會</option>
                                  </select>
                              </div>
                              <div class="col-md-3">
                                  <select class="form-control" id="memberFeeFilter">
                                      <option value="">所有繳費狀態</option>
                                      <option value="已繳費">已繳費</option>
                                      <option value="未繳費">未繳費</option>
                                  </select>
                              </div>
                              <div class="col-md-2">
                                  <button class="btn btn-secondary w-100" onclick="searchMembers()">
                                      <i class="fas fa-search"></i> 搜尋
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- 會員列表 -->
                      <div class="card">
                          <div class="card-header">
                              <h5 class="mb-0">會員列表</h5>
                          </div>
                          <div class="card-body">
                              <div class="table-responsive">
                                  <table class="table table-hover">
                                      <thead>
                                          <tr>
                                              <th>會員編號</th>
                                              <th>姓名</th>
                                              <th>電話</th>
                                              <th>電子郵件</th>
                                              <th>入會日期</th>
                                              <th>會員狀態</th>
                                              <th>會費狀態</th>
                                              <th>操作</th>
                                          </tr>
                                      </thead>
                                      <tbody id="membersTable">
                                          <tr>
                                              <td colspan="8" class="text-center">載入中...</td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 財務管理頁面 -->
                  <div id="finance" class="page-section">
                      <div class="page-header">
                          <div class="d-flex justify-content-between align-items-center">
                              <div>
                                  <h2><i class="fas fa-money-bill-wave me-2"></i>財務管理</h2>
                                  <p class="mb-0 text-muted">管理收入支出與財務記錄</p>
                              </div>
                              <div class="btn-group">
                                  <button class="btn btn-success" onclick="showAddFeeModal()">
                                      <i class="fas fa-plus me-2"></i>會費記錄
                                  </button>
                                  <button class="btn btn-info" onclick="showAddDonationModal()">
                                      <i class="fas fa-plus me-2"></i>捐款記錄
                                  </button>
                                  <button class="btn btn-warning" onclick="showAddExpenseModal()">
                                      <i class="fas fa-plus me-2"></i>支出記錄
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- 財務統計 -->
                      <div class="row mb-4">
                          <div class="col-md-4">
                              <div class="stats-card success">
                                  <h6 class="text-muted">本月總收入</h6>
                                  <div class="number text-success" id="financeIncome">$0</div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="stats-card danger">
                                  <h6 class="text-muted">本月總支出</h6>
                                  <div class="number text-danger" id="financeExpense">$0</div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="stats-card primary">
                                  <h6 class="text-muted">當前餘額</h6>
                                  <div class="number text-primary" id="financeBalance">$0</div>
                              </div>
                          </div>
                      </div>

                      <!-- 財務記錄 -->
                      <div class="card">
                          <div class="card-header">
                              <div class="d-flex justify-content-between align-items-center">
                                  <h5 class="mb-0">財務記錄</h5>
                                  <div>
                                      <input type="date" class="form-control d-inline-block" style="width: auto;" id="financeStartDate">
                                      <span class="mx-2">至</span>
                                      <input type="date" class="form-control d-inline-block" style="width: auto;" id="financeEndDate">
                                      <button class="btn btn-secondary ms-2" onclick="filterFinanceRecords()">篩選</button>
                                  </div>
                              </div>
                          </div>
                          <div class="card-body">
                              <div class="table-responsive">
                                  <table class="table table-hover">
                                      <thead>
                                          <tr>
                                              <th>日期</th>
                                              <th>類型</th>
                                              <th>項目</th>
                                              <th>收入</th>
                                              <th>支出</th>
                                              <th>餘額</th>
                                              <th>相關人員</th>
                                              <th>備註</th>
                                          </tr>
                                      </thead>
                                      <tbody id="financeTable">
                                          <tr>
                                              <td colspan="8" class="text-center">載入中...</td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 報表分析頁面 -->
                  <div id="reports" class="page-section">
                      <div class="page-header">
                          <h2><i class="fas fa-chart-bar me-2"></i>報表分析</h2>
                          <p class="mb-0 text-muted">查看各種統計報表與分析圖表</p>
                      </div>

                      <!-- 報表選項 -->
                      <div class="row mb-4">
                          <div class="col-md-4">
                              <div class="card">
                                  <div class="card-body text-center">
                                      <i class="fas fa-calendar-alt fa-3x text-primary mb-3"></i>
                                      <h5>月度報表</h5>
                                      <button class="btn btn-primary" onclick="generateMonthlyReport()">生成報表</button>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="card">
                                  <div class="card-body text-center">
                                      <i class="fas fa-users fa-3x text-success mb-3"></i>
                                      <h5>會員分析</h5>
                                      <button class="btn btn-success" onclick="generateMemberAnalysis()">分析報告</button>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="card">
                                  <div class="card-body text-center">
                                      <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
                                      <h5>財務趨勢</h5>
                                      <button class="btn btn-warning" onclick="generateFinanceTrend()">趨勢分析</button>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- 圖表區域 -->
                      <div class="row">
                          <div class="col-md-6">
                              <div class="chart-container">
                                  <h5>會員年齡分布</h5>
                                  <canvas id="ageChart" width="400" height="200"></canvas>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="chart-container">
                                  <h5>財務收支趨勢</h5>
                                  <canvas id="financeChart" width="400" height="200"></canvas>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 系統設定頁面 -->
                  <div id="settings" class="page-section">
                      <div class="page-header">
                          <h2><i class="fas fa-cog me-2"></i>系統設定</h2>
                          <p class="mb-0 text-muted">系統配置與維護功能</p>
                      </div>

                      <div class="row">
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0">系統維護</h5>
                                  </div>
                                  <div class="card-body">
                                      <div class="d-grid gap-2">
                                          <button class="btn btn-info" onclick="systemHealthCheck()">
                                              <i class="fas fa-heartbeat me-2"></i>系統健康檢查
                                          </button>
                                          <button class="btn btn-warning" onclick="createBackup()">
                                              <i class="fas fa-download me-2"></i>建立資料備份
                                          </button>
                                          <button class="btn btn-secondary" onclick="cleanupTestData()">
                                              <i class="fas fa-trash me-2"></i>清理測試資料
                                          </button>
                                          <button class="btn btn-success" onclick="testSystem()">
                                              <i class="fas fa-vial me-2"></i>系統功能測試
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="mb-0">系統資訊</h5>
                                  </div>
                                  <div class="card-body">
                                      <div id="systemInfo">
                                          <p><strong>系統版本：</strong>v1.0.0</p>
                                          <p><strong>最後更新：</strong><span id="lastUpdate">-</span></p>
                                          <p><strong>資料庫狀態：</strong><span class="badge bg-success">正常</span></p>
                                          <p><strong>備份狀態：</strong><span class="badge bg-success">已啟用</span></p>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增會員 Modal -->
  <div class="modal fade" id="addMemberModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">新增會員</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addMemberForm">
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">姓名 *</label>
                                  <input type="text" class="form-control" name="name" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">身分證字號 *</label>
                                  <input type="text" class="form-control" name="idNumber" required>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">出生日期</label>
                                  <input type="date" class="form-control" name="birthDate">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">性別</label>
                                  <select class="form-control" name="gender">
                                      <option value="">請選擇</option>
                                      <option value="男">男</option>
                                      <option value="女">女</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">電話</label>
                                  <input type="tel" class="form-control" name="phone">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">手機</label>
                                  <input type="tel" class="form-control" name="mobile">
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">電子郵件</label>
                          <input type="email" class="form-control" name="email">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">地址</label>
                          <textarea class="form-control" name="address" rows="2"></textarea>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">緊急聯絡人</label>
                                  <input type="text" class="form-control" name="emergencyContact">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">緊急聯絡電話</label>
                                  <input type="tel" class="form-control" name="emergencyPhone">
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">病況描述</label>
                          <textarea class="form-control" name="medicalCondition" rows="3"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">用藥情況</label>
                          <textarea class="form-control" name="medication" rows="2"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="addMember()">新增會員</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 會費記錄 Modal -->
  <div class="modal fade" id="addFeeModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">記錄會費</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addFeeForm">
                      <div class="mb-3">
                          <label class="form-label">會員編號 *</label>
                          <input type="text" class="form-control" name="memberId" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">繳費年度 *</label>
                          <select class="form-control" name="year" required>
                              <option value="">請選擇年度</option>
                          </select>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">應繳金額 *</label>
                                  <input type="number" class="form-control" name="amount" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">實繳金額 *</label>
                                  <input type="number" class="form-control" name="paidAmount" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">繳費日期 *</label>
                          <input type="date" class="form-control" name="paymentDate" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款方式 *</label>
                          <select class="form-control" name="paymentMethod" required>
                              <option value="">請選擇</option>
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">收據號碼</label>
                          <input type="text" class="form-control" name="receiptNumber">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-success" onclick="recordFee()">記錄會費</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 捐款記錄 Modal -->
  <div class="modal fade" id="addDonationModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">記錄捐款</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addDonationForm">
                      <div class="mb-3">
                          <label class="form-label">捐款日期 *</label>
                          <input type="date" class="form-control" name="date" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">捐款人姓名 *</label>
                          <input type="text" class="form-control" name="donorName" required>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">捐款人電話</label>
                                  <input type="tel" class="form-control" name="donorPhone">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">捐款金額 *</label>
                                  <input type="number" class="form-control" name="amount" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">捐款人地址</label>
                          <textarea class="form-control" name="donorAddress" rows="2"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">捐款用途 *</label>
                          <select class="form-control" name="purpose" required>
                              <option value="">請選擇</option>
                              <option value="一般捐款">一般捐款</option>
                              <option value="活動支持">活動支持</option>
                              <option value="醫療補助">醫療補助</option>
                              <option value="設備購置">設備購置</option>
                              <option value="其他">其他</option>
                          </select>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">付款方式 *</label>
                          <select class="form-control" name="paymentMethod" required>
                              <option value="">請選擇</option>
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">收據號碼</label>
                                  <input type="text" class="form-control" name="receiptNumber">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">是否開立收據</label>
                                  <select class="form-control" name="needReceipt">
                                      <option value="true">是</option>
                                      <option value="false">否</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-info" onclick="recordDonation()">記錄捐款</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 支出記錄 Modal -->
  <div class="modal fade" id="addExpenseModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">記錄支出</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addExpenseForm">
                      <div class="mb-3">
                          <label class="form-label">支出日期 *</label>
                          <input type="date" class="form-control" name="date" required>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">支出類別 *</label>
                                  <select class="form-control" name="category" required>
                                      <option value="">請選擇</option>
                                      <option value="活動支出">活動支出</option>
                                      <option value="行政支出">行政支出</option>
                                      <option value="設備購置">設備購置</option>
                                      <option value="醫療補助">醫療補助</option>
                                      <option value="其他支出">其他支出</option>
                                  </select>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">金額 *</label>
                                  <input type="number" class="form-control" name="amount" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">支出項目 *</label>
                          <input type="text" class="form-control" name="item" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">廠商名稱</label>
                          <input type="text" class="form-control" name="vendor">
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">發票號碼</label>
                                  <input type="text" class="form-control" name="invoiceNumber">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">經辦人 *</label>
                                  <input type="text" class="form-control" name="handler" required>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">核准人</label>
                          <input type="text" class="form-control" name="approver">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="notes" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-warning" onclick="recordExpense()">記錄支出</button>
              </div>
          </div>
      </div>
  </div>

  <!-- JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
      // 錯誤處理和性能優化
      window.addEventListener('error', function(e) {
          console.error('JavaScript 錯誤:', e.error);
          showError('系統發生錯誤，請重新整理頁面');
      });

      window.addEventListener('unhandledrejection', function(e) {
          console.error('未處理的 Promise 錯誤:', e.reason);
          showError('網路請求失敗，請檢查網路連線');
      });

      // 全域變數
      const GAS_URL = 'https://script.google.com/macros/s/AKfycbxpOB0MRzusv5wAkgXQEA5zKWINSNromvnvLmNRikuWWUZ8v3l_MwO4GGsDeTgDIkUwdA/exec';
      let currentMembers = [];
      let currentFinanceRecords = [];

      // 頁面初始化
      document.addEventListener('DOMContentLoaded', function() {
          try {
              initializePage();
              loadDashboardData();
              setupEventListeners();
              updateSystemInfo();
          } catch (error) {
              console.error('頁面初始化失敗:', error);
              showError('頁面載入失敗，請重新整理');
          }
      });

      // 初始化頁面
      function initializePage() {
          const today = new Date().toISOString().split('T')[0];
          document.querySelectorAll('input[type="date"]').forEach(input => {
              if (!input.value) {
                  input.value = today;
              }
          });

          const currentYear = new Date().getFullYear();
          document.querySelectorAll('select[name="year"]').forEach(select => {
              for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                  const option = document.createElement('option');
                  option.value = year;
                  option.textContent = year + '年';
                  if (year === currentYear) option.selected = true;
                  select.appendChild(option);
              }
          });
      }

      // 載入狀態管理
      function showLoading(show) {
          const overlay = document.getElementById('loadingOverlay');
          if (show) {
              overlay.style.display = 'flex';
          } else {
              overlay.style.display = 'none';
          }
      }

      // 錯誤處理
      function showError(message) {
          Swal.fire({
              title: '錯誤',
              text: message,
              icon: 'error',
              confirmButtonText: '確定',
              customClass: {
                  confirmButton: 'btn btn-primary'
              }
          });
      }

      function showSuccess(message) {
          Swal.fire({
              title: '成功',
              text: message,
              icon: 'success',
              confirmButtonText: '確定',
              customClass: {
                  confirmButton: 'btn btn-primary'
              }
          });
      }

      // 載入儀表板資料
      async function loadDashboardData() {
          try {
              showLoading(true);
              const stats = await mockApiCall('getDashboardStats');
              
              document.getElementById('totalMembers').textContent = stats.totalMembers || 0;
              document.getElementById('activeMembers').textContent = stats.activeMembers || 0;
              document.getElementById('monthlyIncome').textContent = '$' + (stats.monthlyIncome || 0).toLocaleString();
              document.getElementById('currentBalance').textContent = '$' + (stats.currentBalance || 0).toLocaleString();

              showLoading(false);
          } catch (error) {
              console.error('載入儀表板資料失敗:', error);
              showError('載入資料失敗');
              showLoading(false);
          }
      }

      // 模擬 API 呼叫
      async function mockApiCall(functionName, data) {
          await new Promise(resolve => setTimeout(resolve, 800));
          
          switch(functionName) {
              case 'getDashboardStats':
                  return {
                      totalMembers: 105,
                      activeMembers: 98,
                      monthlyIncome: 65000,
                      currentBalance: 250000
                  };
              default:
                  return { success: true, message: '操作完成' };
          }
      }

      // 設定事件監聽器
      function setupEventListeners() {
          document.querySelectorAll('.sidebar .nav-link').forEach(link => {
              link.addEventListener('click', function(e) {
                  e.preventDefault();
                  const page = this.dataset.page;
                  showPage(page);
                  
                  document.querySelectorAll('.sidebar .nav-link').forEach(l => {
                      l.classList.remove('active');
                      l.removeAttribute('aria-current');
                  });
                  this.classList.add('active');
                  this.setAttribute('aria-current', 'page');
              });
          });

          const sidebarToggle = document.getElementById('sidebarToggle');
          if (sidebarToggle) {
              sidebarToggle.addEventListener('click', function() {
                  document.getElementById('sidebar').classList.toggle('show');
              });
          }
      }

      // 顯示頁面
      function showPage(pageId) {
          document.querySelectorAll('.page-section').forEach(section => {
              section.classList.remove('active');
          });
          
          const targetPage = document.getElementById(pageId);
          if (targetPage) {
              targetPage.classList.add('active');
          }
      }

      // Modal 顯示函數
      function showAddMemberModal() {
          const modal = new bootstrap.Modal(document.getElementById('addMemberModal'));
          modal.show();
      }

      function showAddFeeModal() {
          const modal = new bootstrap.Modal(document.getElementById('addFeeModal'));
          modal.show();
      }

      function showAddDonationModal() {
          const modal = new bootstrap.Modal(document.getElementById('addDonationModal'));
          modal.show();
      }

      function showAddExpenseModal() {
          const modal = new bootstrap.Modal(document.getElementById('addExpenseModal'));
          modal.show();
      }

      // 功能函數
      function addMember() {
          const form = document.getElementById('addMemberForm');
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          if (!data.name || !data.idNumber) {
              showError('請填寫必填欄位');
              return;
          }
          
          showSuccess('會員新增成功！');
          bootstrap.Modal.getInstance(document.getElementById('addMemberModal')).hide();
          form.reset();
      }

      function recordFee() {
          const form = document.getElementById('addFeeForm');
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          if (!data.memberId || !data.year || !data.amount) {
              showError('請填寫必填欄位');
              return;
          }
          
          showSuccess('會費記錄成功！');
          bootstrap.Modal.getInstance(document.getElementById('addFeeModal')).hide();
          form.reset();
      }

      function recordDonation() {
          const form = document.getElementById('addDonationForm');
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          if (!data.date || !data.donorName || !data.amount) {
              showError('請填寫必填欄位');
              return;
          }
          
          showSuccess('捐款記錄成功！');
          bootstrap.Modal.getInstance(document.getElementById('addDonationModal')).hide();
          form.reset();
      }

      function recordExpense() {
          const form = document.getElementById('addExpenseForm');
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
          
          if (!data.date || !data.category || !data.amount || !data.item) {
              showError('請填寫必填欄位');
              return;
          }
          
          showSuccess('支出記錄成功！');
          bootstrap.Modal.getInstance(document.getElementById('addExpenseModal')).hide();
          form.reset();
      }

      function searchMembers() {
          showSuccess('搜尋功能執行中');
      }

      function filterFinanceRecords() {
          showSuccess('篩選功能執行中');
      }

      function generateMonthlyReport() {
          showSuccess('月度報表生成中');
      }

      function generateMemberAnalysis() {
          showSuccess('會員分析報告生成中');
      }

      function generateFinanceTrend() {
          showSuccess('財務趨勢分析生成中');
      }

      function systemHealthCheck() {
          showLoading(true);
          setTimeout(() => {
              showLoading(false);
              showSuccess('系統健康檢查完成，一切正常！');
          }, 2000);
      }

        function createBackup() {
            showLoading(true);
            setTimeout(() => {
                showLoading(false);
                showSuccess('資料備份完成！');
            }, 3000);
        }

        function cleanupTestData() {
            Swal.fire({
                title: '確認清理',
                text: '確定要清理測試資料嗎？此操作無法復原。',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '確定清理',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading(true);
                    setTimeout(() => {
                        showLoading(false);
                        showSuccess('測試資料清理完成！');
                    }, 2000);
                }
            });
        }

        function testSystem() {
            showLoading(true);
            setTimeout(() => {
                showLoading(false);
                showSuccess('系統功能測試完成，所有功能正常！');
            }, 2500);
        }

        // 更新系統資訊
        function updateSystemInfo() {
            const lastUpdateElement = document.getElementById('lastUpdate');
            if (lastUpdateElement) {
                lastUpdateElement.textContent = new Date().toLocaleString('zh-TW');
            }
        }

        // 鍵盤導航支援
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.show');
                modals.forEach(modal => {
                    const modalInstance = bootstrap.Modal.getInstance(modal);
                    if (modalInstance) modalInstance.hide();
                });
            }
        });

        // 性能監控
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const loadTime = performance.now();
                console.log(`頁面載入時間: ${loadTime.toFixed(2)}ms`);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>非營利組織財務管理系統</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <style>
      :root {
          --primary-color: #2c3e50;
          --secondary-color: #3498db;
          --success-color: #27ae60;
          --danger-color: #e74c3c;
          --warning-color: #f39c12;
          --info-color: #17a2b8;
          --light-color: #f8f9fa;
          --dark-color: #343a40;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: var(--light-color);
      }

      .navbar {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .navbar-brand {
          font-weight: bold;
          font-size: 1.5rem;
      }

      .sidebar {
          background: white;
          min-height: calc(100vh - 76px);
          box-shadow: 2px 0 10px rgba(0,0,0,0.1);
          padding: 0;
      }

      .sidebar .nav-link {
          color: var(--dark-color);
          padding: 15px 20px;
          border-bottom: 1px solid #eee;
          transition: all 0.3s;
      }

      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
          background-color: var(--secondary-color);
          color: white;
          transform: translateX(5px);
      }

      .sidebar .nav-link i {
          width: 20px;
          margin-right: 10px;
      }

      .main-content {
          padding: 30px;
          background-color: var(--light-color);
          min-height: calc(100vh - 76px);
      }

      .card {
          border: none;
          border-radius: 15px;
          box-shadow: 0 5px 20px rgba(0,0,0,0.1);
          transition: transform 0.3s;
      }

      .card:hover {
          transform: translateY(-5px);
      }

      .card-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          border-radius: 15px 15px 0 0 !important;
          padding: 20px;
      }

      .stats-card {
          background: linear-gradient(135deg, var(--success-color), #2ecc71);
          color: white;
          border-radius: 15px;
          padding: 25px;
          margin-bottom: 20px;
      }

      .stats-card.income {
          background: linear-gradient(135deg, var(--success-color), #2ecc71);
      }

      .stats-card.expense {
          background: linear-gradient(135deg, var(--danger-color), #c0392b);
      }

      .stats-card.balance {
          background: linear-gradient(135deg, var(--info-color), #3498db);
      }

      .stats-card.members {
          background: linear-gradient(135deg, var(--warning-color), #e67e22);
      }

      .btn-primary {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          border: none;
          border-radius: 25px;
          padding: 10px 25px;
          transition: all 0.3s;
      }

      .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      }

      .table {
          border-radius: 10px;
          overflow: hidden;
      }

      .table thead th {
          background-color: var(--primary-color);
          color: white;
          border: none;
      }

      .modal-content {
          border-radius: 15px;
          border: none;
      }

      .modal-header {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          border-radius: 15px 15px 0 0;
      }

      .form-control, .form-select {
          border-radius: 10px;
          border: 2px solid #e9ecef;
          transition: border-color 0.3s;
      }

      .form-control:focus, .form-select:focus {
          border-color: var(--secondary-color);
          box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      }

      .loading {
          display: none;
          text-align: center;
          padding: 50px;
      }

      .spinner-border {
          color: var(--secondary-color);
      }

      .alert {
          border-radius: 10px;
          border: none;
      }

      .page-title {
          color: var(--primary-color);
          margin-bottom: 30px;
          font-weight: bold;
      }

      .action-buttons {
          margin-bottom: 20px;
      }

      .search-box {
          max-width: 300px;
          margin-left: auto;
      }

      .tab-content {
          background: white;
          border-radius: 0 15px 15px 15px;
          padding: 30px;
          box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      }

      .nav-tabs .nav-link {
          border-radius: 15px 15px 0 0;
          border: none;
          color: var(--dark-color);
          margin-right: 5px;
      }

      .nav-tabs .nav-link.active {
          background-color: white;
          color: var(--primary-color);
          font-weight: bold;
      }

      .chart-container {
          position: relative;
          height: 400px;
          margin: 20px 0;
      }

      @media (max-width: 768px) {
          .sidebar {
              position: fixed;
              top: 76px;
              left: -250px;
              width: 250px;
              z-index: 1000;
              transition: left 0.3s;
          }

          .sidebar.show {
              left: 0;
          }

          .main-content {
              margin-left: 0;
              padding: 15px;
          }
      }
  </style>
</head>
<body>
  <!-- 導航列 -->
  <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
          <button class="navbar-toggler d-lg-none" type="button" id="sidebarToggle">
              <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="#">
              <i class="fas fa-chart-line me-2"></i>
              財務管理系統
          </a>
          <div class="navbar-nav ms-auto">
              <div class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                      <i class="fas fa-user-circle me-1"></i>
                      管理員
                  </a>
                  <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" onclick="showSystemSettings()">
                          <i class="fas fa-cog me-2"></i>系統設定
                      </a></li>
                      <li><a class="dropdown-item" href="#" onclick="systemHealthCheck()">
                          <i class="fas fa-heartbeat me-2"></i>系統檢查
                      </a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="#" onclick="logout()">
                          <i class="fas fa-sign-out-alt me-2"></i>登出
                      </a></li>
                  </ul>
              </div>
          </div>
      </div>
  </nav>

  <div class="container-fluid">
      <div class="row">
          <!-- 側邊欄 -->
          <nav class="col-lg-2 sidebar" id="sidebar">
              <div class="nav flex-column">
                  <a class="nav-link active" href="#" onclick="showDashboard()">
                      <i class="fas fa-tachometer-alt"></i>
                      儀表板
                  </a>
                  <a class="nav-link" href="#" onclick="showMembers()">
                      <i class="fas fa-users"></i>
                      會員管理
                  </a>
                  <a class="nav-link" href="#" onclick="showIncome()">
                      <i class="fas fa-plus-circle"></i>
                      收入管理
                  </a>
                  <a class="nav-link" href="#" onclick="showExpenses()">
                      <i class="fas fa-minus-circle"></i>
                      支出管理
                  </a>
                  <a class="nav-link" href="#" onclick="showBankAccounts()">
                      <i class="fas fa-university"></i>
                      銀行帳戶
                  </a>
                  <a class="nav-link" href="#" onclick="showReceipts()">
                      <i class="fas fa-receipt"></i>
                      電子收據
                  </a>
                  <a class="nav-link" href="#" onclick="showAccounts()">
                      <i class="fas fa-list-alt"></i>
                      會計科目
                  </a>
                  <a class="nav-link" href="#" onclick="showReports()">
                      <i class="fas fa-chart-bar"></i>
                      報表分析
                  </a>
                  <a class="nav-link" href="#" onclick="showSystemManagement()">
                      <i class="fas fa-tools"></i>
                      系統管理
                  </a>
              </div>
          </nav>

          <!-- 主要內容區 -->
          <main class="col-lg-10 main-content">
              <!-- 載入中提示 -->
              <div id="loading" class="loading">
                  <div class="spinner-border" role="status">
                      <span class="visually-hidden">載入中...</span>
                  </div>
                  <p class="mt-3">載入中，請稍候...</p>
              </div>

              <!-- 儀表板 -->
              <div id="dashboard" class="content-section">
                  <h2 class="page-title">
                      <i class="fas fa-tachometer-alt me-2"></i>
                      系統儀表板
                  </h2>
                  
                  <!-- 統計卡片 -->
                  <div class="row mb-4">
                      <div class="col-lg-3 col-md-6">
                          <div class="stats-card members">
                              <div class="d-flex justify-content-between align-items-center">
                                  <div>
                                      <h3 id="totalMembers">0</h3>
                                      <p class="mb-0">總會員數</p>
                                  </div>
                                  <i class="fas fa-users fa-2x opacity-75"></i>
                              </div>
                          </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                          <div class="stats-card income">
                              <div class="d-flex justify-content-between align-items-center">
                                  <div>
                                      <h3 id="monthlyIncome">NT$ 0</h3>
                                      <p class="mb-0">本月收入</p>
                                  </div>
                                  <i class="fas fa-plus-circle fa-2x opacity-75"></i>
                              </div>
                          </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                          <div class="stats-card expense">
                              <div class="d-flex justify-content-between align-items-center">
                                  <div>
                                      <h3 id="monthlyExpenses">NT$ 0</h3>
                                      <p class="mb-0">本月支出</p>
                                  </div>
                                  <i class="fas fa-minus-circle fa-2x opacity-75"></i>
                              </div>
                          </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                          <div class="stats-card balance">
                              <div class="d-flex justify-content-between align-items-center">
                                  <div>
                                      <h3 id="totalBalance">NT$ 0</h3>
                                      <p class="mb-0">銀行餘額</p>
                                  </div>
                                  <i class="fas fa-university fa-2x opacity-75"></i>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 圖表區域 -->
                  <div class="row">
                      <div class="col-lg-8">
                          <div class="card">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-chart-line me-2"></i>
                                      收支趨勢圖
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <div class="chart-container">
                                      <canvas id="incomeExpenseChart"></canvas>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <div class="col-lg-4">
                          <div class="card">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-chart-pie me-2"></i>
                                      收入來源分布
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <div class="chart-container">
                                      <canvas id="incomeSourceChart"></canvas>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 最近活動 -->
                  <div class="row mt-4">
                      <div class="col-12">
                          <div class="card">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-clock me-2"></i>
                                      最近活動
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <div id="recentActivities">
                                      <p class="text-muted">載入中...</p>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 會員管理 -->
              <div id="members" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-users me-2"></i>
                      會員管理
                  </h2>

                  <div class="action-buttons d-flex justify-content-between align-items-center">
                      <div>
                          <button class="btn btn-primary" onclick="showAddMemberModal()">
                              <i class="fas fa-plus me-2"></i>新增會員
                          </button>
                          <button class="btn btn-success" onclick="exportMembers()">
                              <i class="fas fa-download me-2"></i>匯出資料
                          </button>
                          <button class="btn btn-info" onclick="showImportMembersModal()">
                              <i class="fas fa-upload me-2"></i>批量匯入
                          </button>
                      </div>
                      <div class="search-box">
                          <input type="text" class="form-control" id="memberSearch" placeholder="搜尋會員...">
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-body">
                          <div class="table-responsive">
                              <table id="membersTable" class="table table-striped table-hover">
                                  <thead>
                                      <tr>
                                          <th>姓名</th>
                                          <th>電話</th>
                                          <th>電子郵件</th>
                                          <th>會員類型</th>
                                          <th>加入日期</th>
                                          <th>狀態</th>
                                          <th>操作</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <!-- 動態載入 -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 收入管理 -->
              <div id="income" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-plus-circle me-2"></i>
                      收入管理
                  </h2>

                  <div class="action-buttons d-flex justify-content-between align-items-center">
                      <div>
                          <button class="btn btn-primary" onclick="showAddIncomeModal()">
                              <i class="fas fa-plus me-2"></i>新增收入
                          </button>
                          <button class="btn btn-success" onclick="exportIncome()">
                              <i class="fas fa-download me-2"></i>匯出資料
                          </button>
                      </div>
                      <div class="d-flex gap-2">
                          <input type="month" class="form-control" id="incomeMonthFilter" style="width: 150px;">
                          <select class="form-select" id="incomeCategoryFilter" style="width: 150px;">
                              <option value="">所有類別</option>
                          </select>
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-body">
                          <div class="table-responsive">
                              <table id="incomeTable" class="table table-striped table-hover">
                                  <thead>
                                      <tr>
                                          <th>日期</th>
                                          <th>捐款人</th>
                                          <th>金額</th>
                                          <th>收入類別</th>
                                          <th>銀行帳戶</th>
                                          <th>收據編號</th>
                                          <th>操作</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <!-- 動態載入 -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 支出管理 -->
              <div id="expenses" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-minus-circle me-2"></i>
                      支出管理
                  </h2>

                  <div class="action-buttons d-flex justify-content-between align-items-center">
                      <div>
                          <button class="btn btn-primary" onclick="showAddExpenseModal()">
                              <i class="fas fa-plus me-2"></i>新增支出
                          </button>
                          <button class="btn btn-success" onclick="exportExpenses()">
                              <i class="fas fa-download me-2"></i>匯出資料
                          </button>
                      </div>
                      <div class="d-flex gap-2">
                          <input type="month" class="form-control" id="expenseMonthFilter" style="width: 150px;">
                          <select class="form-select" id="expenseStatusFilter" style="width: 120px;">
                              <option value="">所有狀態</option>
                              <option value="待核准">待核准</option>
                              <option value="已核准">已核准</option>
                              <option value="已拒絕">已拒絕</option>
                          </select>
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-body">
                          <div class="table-responsive">
                              <table id="expensesTable" class="table table-striped table-hover">
                                  <thead>
                                      <tr>
                                          <th>日期</th>
                                          <th>項目</th>
                                          <th>金額</th>
                                          <th>類別</th>
                                          <th>申請人</th>
                                          <th>狀態</th>
                                          <th>操作</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <!-- 動態載入 -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 銀行帳戶管理 -->
              <div id="bankAccounts" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-university me-2"></i>
                      銀行帳戶管理
                  </h2>

                  <div class="action-buttons d-flex justify-content-between align-items-center">
                      <div>
                          <button class="btn btn-primary" onclick="showAddBankAccountModal()">
                              <i class="fas fa-plus me-2"></i>新增帳戶
                          </button>
                          <button class="btn btn-info" onclick="showReconcileModal()">
                              <i class="fas fa-balance-scale me-2"></i>帳戶對帳
                          </button>
                      </div>
                  </div>

                  <div class="row mb-4">
                      <div class="col-12">
                          <div class="card">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-chart-pie me-2"></i>
                                      帳戶餘額總覽
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <div id="bankAccountsSummary">
                                      <p class="text-muted">載入中...</p>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-body">
                          <div class="table-responsive">
                              <table id="bankAccountsTable" class="table table-striped table-hover">
                                  <thead>
                                      <tr>
                                          <th>帳戶名稱</th>
                                          <th>銀行名稱</th>
                                          <th>帳號</th>
                                          <th>類型</th>
                                          <th>目前餘額</th>
                                          <th>狀態</th>
                                          <th>操作</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <!-- 動態載入 -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 電子收據管理 -->
              <div id="receipts" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-receipt me-2"></i>
                      電子收據管理
                  </h2>

                  <div class="action-buttons d-flex justify-content-between align-items-center">
                      <div>
                          <button class="btn btn-primary" onclick="showGenerateReceiptModal()">
                              <i class="fas fa-plus me-2"></i>生成收據
                          </button>
                          <button class="btn btn-success" onclick="exportReceipts()">
                              <i class="fas fa-download me-2"></i>匯出列表
                          </button>
                      </div>
                      <div class="d-flex gap-2">
                          <input type="month" class="form-control" id="receiptMonthFilter" style="width: 150px;">
                          <select class="form-select" id="receiptStatusFilter" style="width: 120px;">
                              <option value="">所有狀態</option>
                              <option value="已生成">已生成</option>
                              <option value="已發送">已發送</option>
                              <option value="發送失敗">發送失敗</option>
                          </select>
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-body">
                          <div class="table-responsive">
                              <table id="receiptsTable" class="table table-striped table-hover">
                                  <thead>
                                      <tr>
                                          <th>收據編號</th>
                                          <th>捐款人</th>
                                          <th>金額</th>
                                          <th>日期</th>
                                          <th>類型</th>
                                          <th>狀態</th>
                                          <th>操作</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <!-- 動態載入 -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 會計科目管理 -->
              <div id="accounts" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-list-alt me-2"></i>
                      會計科目管理
                  </h2>

                  <div class="action-buttons d-flex justify-content-between align-items-center">
                      <div>
                          <button class="btn btn-primary" onclick="showAddAccountModal()">
                              <i class="fas fa-plus me-2"></i>新增科目
                          </button>
                          <button class="btn btn-success" onclick="exportAccounts()">
                              <i class="fas fa-download me-2"></i>匯出科目表
                          </button>
                      </div>
                      <div>
                          <select class="form-select" id="accountTypeFilter" style="width: 150px;">
                              <option value="">所有類型</option>
                              <option value="資產">資產</option>
                              <option value="負債">負債</option>
                              <option value="淨資產">淨資產</option>
                              <option value="收入">收入</option>
                              <option value="支出">支出</option>
                          </select>
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-body">
                          <div class="table-responsive">
                              <table id="accountsTable" class="table table-striped table-hover">
                                  <thead>
                                      <tr>
                                          <th>科目代碼</th>
                                          <th>科目名稱</th>
                                          <th>類型</th>
                                          <th>層級</th>
                                          <th>上級科目</th>
                                          <th>狀態</th>
                                          <th>操作</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <!-- 動態載入 -->
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 報表分析 -->
              <div id="reports" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-chart-bar me-2"></i>
                      報表分析
                  </h2>

                  <ul class="nav nav-tabs" id="reportTabs">
                      <li class="nav-item">
                          <a class="nav-link active" href="#monthlyReport" data-bs-toggle="tab">月報表</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="#annualReport" data-bs-toggle="tab">年報表</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="#donorReport" data-bs-toggle="tab">捐款人報表</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="#budgetReport" data-bs-toggle="tab">預算報表</a>
                      </li>
                  </ul>

                  <div class="tab-content" id="reportTabContent">
                      <!-- 月報表 -->
                      <div class="tab-pane fade show active" id="monthlyReport">
                          <div class="row mb-3">
                              <div class="col-md-4">
                                  <label class="form-label">選擇年月</label>
                                  <input type="month" class="form-control" id="monthlyReportDate">
                              </div>
                              <div class="col-md-4 d-flex align-items-end">
                                  <button class="btn btn-primary" onclick="generateMonthlyReport()">
                                      <i class="fas fa-chart-line me-2"></i>生成報表
                                  </button>
                              </div>
                          </div>
                          <div id="monthlyReportContent">
                              <p class="text-muted">請選擇年月並點擊生成報表</p>
                          </div>
                      </div>

                      <!-- 年報表 -->
                      <div class="tab-pane fade" id="annualReport">
                          <div class="row mb-3">
                              <div class="col-md-4">
                                  <label class="form-label">選擇年度</label>
                                  <select class="form-select" id="annualReportYear">
                                      <!-- 動態生成年份選項 -->
                                  </select>
                              </div>
                              <div class="col-md-4 d-flex align-items-end">
                                  <button class="btn btn-primary" onclick="generateAnnualReport()">
                                      <i class="fas fa-chart-bar me-2"></i>生成報表
                                  </button>
                              </div>
                          </div>
                          <div id="annualReportContent">
                              <p class="text-muted">請選擇年度並點擊生成報表</p>
                          </div>
                      </div>

                      <!-- 捐款人報表 -->
                      <div class="tab-pane fade" id="donorReport">
                          <div class="row mb-3">
                              <div class="col-md-3">
                                  <label class="form-label">開始日期</label>
                                  <input type="date" class="form-control" id="donorReportStartDate">
                              </div>
                              <div class="col-md-3">
                                  <label class="form-label">結束日期</label>
                                  <input type="date" class="form-control" id="donorReportEndDate">
                              </div>
                              <div class="col-md-3">
                                  <label class="form-label">最低金額</label>
                                  <input type="number" class="form-control" id="donorReportMinAmount" placeholder="0">
                              </div>
                              <div class="col-md-3 d-flex align-items-end">
                                  <button class="btn btn-primary" onclick="generateDonorReport()">
                                      <i class="fas fa-users me-2"></i>生成報表
                                  </button>
                              </div>
                          </div>
                          <div id="donorReportContent">
                              <p class="text-muted">請設定查詢條件並點擊生成報表</p>
                          </div>
                      </div>

                      <!-- 預算報表 -->
                      <div class="tab-pane fade" id="budgetReport">
                          <div class="row mb-3">
                              <div class="col-md-4">
                                  <label class="form-label">預算年度</label>
                                  <select class="form-select" id="budgetReportYear">
                                      <!-- 動態生成年份選項 -->
                                  </select>
                              </div>
                              <div class="col-md-4 d-flex align-items-end">
                                  <button class="btn btn-primary" onclick="generateBudgetReport()">
                                      <i class="fas fa-calculator me-2"></i>生成報表
                                  </button>
                              </div>
                          </div>
                          <div id="budgetReportContent">
                              <p class="text-muted">請選擇預算年度並點擊生成報表</p>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- 系統管理 -->
              <div id="systemManagement" class="content-section" style="display: none;">
                  <h2 class="page-title">
                      <i class="fas fa-tools me-2"></i>
                      系統管理
                  </h2>

                  <div class="row">
                      <!-- 系統狀態 -->
                      <div class="col-lg-6">
                          <div class="card mb-4">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-heartbeat me-2"></i>
                                      系統狀態
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <div id="systemStatus">
                                      <p class="text-muted">載入中...</p>
                                  </div>
                                  <button class="btn btn-info" onclick="systemHealthCheck()">
                                      <i class="fas fa-sync me-2"></i>檢查系統狀態
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- 備份管理 -->
                      <div class="col-lg-6">
                          <div class="card mb-4">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-database me-2"></i>
                                      備份管理
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <div id="backupInfo">
                                      <p class="text-muted">載入中...</p>
                                  </div>
                                  <div class="d-flex gap-2">
                                      <button class="btn btn-success" onclick="createBackup()">
                                          <i class="fas fa-save me-2"></i>立即備份
                                      </button>
                                      <button class="btn btn-warning" onclick="showRestoreModal()">
                                          <i class="fas fa-undo me-2"></i>還原備份
                                      </button>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- 資料清理 -->
                      <div class="col-lg-6">
                          <div class="card mb-4">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-broom me-2"></i>
                                      資料清理
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <p>清理系統中的冗餘資料和暫存檔案</p>
                                  <button class="btn btn-warning" onclick="showCleanupModal()">
                                      <i class="fas fa-trash-alt me-2"></i>開始清理
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- 系統設定 -->
                      <div class="col-lg-6">
                          <div class="card mb-4">
                              <div class="card-header">
                                  <h5 class="mb-0">
                                      <i class="fas fa-cog me-2"></i>
                                      系統設定
                                  </h5>
                              </div>
                              <div class="card-body">
                                  <p>管理系統基本設定和參數</p>
                                  <button class="btn btn-primary" onclick="showSystemSettings()">
                                      <i class="fas fa-edit me-2"></i>編輯設定
                                  </button>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </main>
      </div>
  </div>

  <!-- 模態視窗區域 -->
  
  <!-- 新增會員模態視窗 -->
  <div class="modal fade" id="addMemberModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">
                      <i class="fas fa-user-plus me-2"></i>新增會員
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addMemberForm">
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">姓名 *</label>
                                  <input type="text" class="form-control" name="姓名" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">電話 *</label>
                                  <input type="tel" class="form-control" name="電話" required>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">電子郵件</label>
                                  <input type="email" class="form-control" name="電子郵件">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">會員類型</label>
                                  <select class="form-select" name="會員類型">
                                      <option value="一般會員">一般會員</option>
                                      <option value="贊助會員">贊助會員</option>
                                      <option value="榮譽會員">榮譽會員</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">地址</label>
                          <textarea class="form-control" name="地址" rows="2"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">備註</label>
                          <textarea class="form-control" name="備註" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="addMember()">新增會員</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增收入模態視窗 -->
  <div class="modal fade" id="addIncomeModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">
                      <i class="fas fa-plus-circle me-2"></i>新增收入記錄
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addIncomeForm">
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">日期 *</label>
                                  <input type="date" class="form-control" name="日期" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">金額 *</label>
                                  <input type="number" class="form-control" name="金額" step="0.01" required>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">捐款人</label>
                                  <input type="text" class="form-control" name="捐款人">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">收入類別</label>
                                  <select class="form-select" name="收入類別" id="incomeCategory">
                                      <!-- 動態載入 -->
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">銀行帳戶</label>
                                  <select class="form-select" name="銀行帳戶" id="incomeBankAccount">
                                      <!-- 動態載入 -->
                                  </select>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">會計科目</label>
                                  <select class="form-select" name="會計科目" id="incomeAccount">
                                      <!-- 動態載入 -->
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">說明</label>
                          <textarea class="form-control" name="說明" rows="2"></textarea>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="generateReceipt">
                          <label class="form-check-label" for="generateReceipt">
                              自動生成收據
                          </label>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="addIncome()">新增收入</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增支出模態視窗 -->
  <div class="modal fade" id="addExpenseModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">
                      <i class="fas fa-minus-circle me-2"></i>新增支出記錄
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addExpenseForm">
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">日期 *</label>
                                  <input type="date" class="form-control" name="日期" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">金額 *</label>
                                  <input type="number" class="form-control" name="金額" step="0.01" required>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">項目 *</label>
                                  <input type="text" class="form-control" name="項目" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">支出類別</label>
                                  <select class="form-select" name="支出類別" id="expenseCategory">
                                      <!-- 動態載入 -->
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">申請人</label>
                                  <input type="text" class="form-control" name="申請人">
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">銀行帳戶</label>
                                  <select class="form-select" name="銀行帳戶" id="expenseBankAccount">
                                      <!-- 動態載入 -->
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">說明</label>
                          <textarea class="form-control" name="說明" rows="2"></textarea>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">收據檔案</label>
                          <input type="file" class="form-control" id="expenseReceipt" accept="image/*,application/pdf">
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="addExpense()">新增支出</button>
              </div>
          </div>
      </div>
  </div>

  <!-- 新增銀行帳戶模態視窗 -->
  <div class="modal fade" id="addBankAccountModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">
                      <i class="fas fa-university me-2"></i>新增銀行帳戶
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="addBankAccountForm">
                      <div class="mb-3">
                          <label class="form-label">帳戶名稱 *</label>
                          <input type="text" class="form-control" name="帳戶名稱" required>
                      </div>
                      <div class="row">
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">銀行名稱 *</label>
                                  <input type="text" class="form-control" name="銀行名稱" required>
                              </div>
                          </div>
                          <div class="col-md-6">
                              <div class="mb-3">
                                  <label class="form-label">帳戶類型</label>
                                  <select class="form-select" name="帳戶類型">
                                      <option value="支票帳戶">支票帳戶</option>
                                      <option value="儲蓄帳戶">儲蓄帳戶</option>
                                      <option value="定期存款">定期存款</option>
                                      <option value="外幣帳戶">外幣帳戶</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-8">
                              <div class="mb-3">
                                  <label class="form-label">帳號 *</label>
                                  <input type="text" class="form-control" name="帳號" required>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="mb-3">
                                  <label class="form-label">幣別</label>
                                  <select class="form-select" name="幣別">
                                      <option value="TWD">TWD</option>
                                      <option value="USD">USD</option>
                                      <option value="EUR">EUR</option>
                                      <option value="JPY">JPY</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">初始餘額</label>
                          <input type="number" class="form-control" name="目前餘額" step="0.01" value="0">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">說明</label>
                          <textarea class="form-control" name="說明" rows="2"></textarea>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                  <button type="button" class="btn btn-primary" onclick="addBankAccount()">新增帳戶</button>
              </div>
          </div>
      </div>
  </div>

  <!-- JavaScript 引用 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.min.js"></script>

<script>
// 系統設定
const CONFIG = {
  WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbzYRT0NncXVmd_7ZF7T3VgYB4w_HIJcR6nau_NLbkK9qLwIwaAh0GMr7tBTeeewil5Q/exec',
  OFFLINE_MODE: true, // 預設開啟離線模式
  API_TIMEOUT: 5000,
  CACHE_DURATION: 5 * 60 * 1000,
  MAX_RETRY_ATTEMPTS: 1
};

// 全域變數
let currentSection = 'dashboard';
let charts = {};
let tables = {};
let apiFailureCount = 0;

// 頁面載入完成
$(document).ready(function() {
  console.log('系統初始化開始...');
  
  // 移除可能導致錯誤的未定義變數
  if (typeof sweetAlertCSS !== 'undefined') {
      delete window.sweetAlertCSS;
  }
  
  // 確保 SweetAlert2 已載入
  if (typeof Swal === 'undefined') {
      console.warn('SweetAlert2 未載入，使用原生 alert');
      window.Swal = {
          fire: function(options) {
              if (typeof options === 'string') {
                  alert(options);
              } else {
                  alert(options.text || options.title || '提示');
              }
              return Promise.resolve({ isConfirmed: true });
          }
      };
  }
  
  initializeApp();
});

// 初始化應用程式
function initializeApp() {
  try {
      console.log('開始初始化應用程式...');
      
      // 初始化事件監聽
      initializeEventListeners();
      
      // 載入主題設定
      loadSavedTheme();
      
      // 直接使用離線模式
      console.log('使用離線模式啟動');
      CONFIG.OFFLINE_MODE = true;
      
      // 載入儀表板
      showDashboard();
      
      console.log('系統初始化完成');
      
      // 顯示離線模式提示
      setTimeout(() => {
          showAlert('info', '目前使用離線模式，顯示示範資料');
      }, 1000);
      
  } catch (error) {
      console.error('系統初始化錯誤:', error);
      showAlert('error', '系統初始化失敗，請重新整理頁面');
  }
}

// 初始化事件監聽
function initializeEventListeners() {
  // 側邊欄切換
  $('#sidebarToggle').click(function() {
      $('#sidebar').toggleClass('show');
      $('#mainContent').toggleClass('shifted');
  });

  // 點擊外部關閉側邊欄
  $(document).click(function(e) {
      if (!$(e.target).closest('#sidebar, #sidebarToggle').length) {
          $('#sidebar').removeClass('show');
          $('#mainContent').removeClass('shifted');
      }
  });

  // 表單驗證增強
  enhanceFormValidation();
  
  // 網路狀態檢測
  checkNetworkStatus();
}

// 修正的 API 調用函數
async function callAPI(action, data = {}) {
  // 直接使用離線模式
  if (CONFIG.OFFLINE_MODE) {
      return handleOfflineAPI(action, data);
  }
  
  try {
      // 嘗試 API 調用
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);
      
      const response = await fetch(CONFIG.WEB_APP_URL, {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify({
              action: action,
              ...data
          }),
          signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const result = await response.json();
      
      // 重置失敗計數
      apiFailureCount = 0;
      
      return result;
      
  } catch (error) {
      console.error('API調用錯誤:', error);
      apiFailureCount++;
      
      // 如果連續失敗，切換到離線模式
      if (apiFailureCount >= CONFIG.MAX_RETRY_ATTEMPTS) {
          console.log('API調用多次失敗，切換到離線模式');
          CONFIG.OFFLINE_MODE = true;
          
          // 只在第一次切換時顯示提示
          if (apiFailureCount === CONFIG.MAX_RETRY_ATTEMPTS) {
              showAlert('warning', '網路連線異常，已切換到離線模式');
          }
      }
      
      return handleOfflineAPI(action, data);
  }
}

// 離線模式 API 處理
function handleOfflineAPI(action, data) {
  console.log(`離線模式 API 調用: ${action}`, data);
  
  return new Promise((resolve) => {
      // 模擬網路延遲
      setTimeout(() => {
          resolve(getMockResponse(action, data));
      }, 300 + Math.random() * 200); // 300-500ms 隨機延遲
  });
}

// 獲取模擬回應資料
function getMockResponse(action, data) {
  const currentDate = new Date();
  const formatDate = (date) => date.toISOString().split('T')[0];
  
  const mockData = {
      getDashboardStats: {
          success: true,
          data: {
              totalMembers: 156,
              totalIncome: 2850000,
              totalExpenses: 1920000,
              currentBalance: 930000,
              lastUpdated: formatDate(currentDate)
          }
      },
      
      getTrendData: {
          success: true,
          data: {
              labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
              income: [120000, 150000, 180000, 200000, 220000, 250000],
              expenses: [80000, 95000, 110000, 125000, 140000, 160000]
          }
      },
      
      getIncomeDistribution: {
          success: true,
          data: {
              labels: ['會員費', '捐款', '活動收入', '政府補助', '其他'],
              values: [45, 25, 15, 10, 5],
              colors: ['#4facfe', '#fa709a', '#fee140', '#a8edea', '#c471ed']
          }
      },
      
      getRecentActivities: {
          success: true,
          data: [
              { 
                  id: 1,
                  type: 'income', 
                  description: '收到會員費 - 張小明', 
                  amount: 5000, 
                  date: formatDate(new Date(currentDate.getTime() - 1 * 24 * 60 * 60 * 1000)),
                  category: '會員費'
              },
              { 
                  id: 2,
                  type: 'expense', 
                  description: '辦公用品採購', 
                  amount: 1200, 
                  date: formatDate(new Date(currentDate.getTime() - 2 * 24 * 60 * 60 * 1000)),
                  category: '辦公費用'
              },
              { 
                  id: 3,
                  type: 'member', 
                  description: '新增會員：李小華', 
                  amount: 0, 
                  date: formatDate(new Date(currentDate.getTime() - 3 * 24 * 60 * 60 * 1000)),
                  category: '會員管理'
              },
              { 
                  id: 4,
                  type: 'income', 
                  description: '收到捐款 - 愛心企業', 
                  amount: 50000, 
                  date: formatDate(new Date(currentDate.getTime() - 4 * 24 * 60 * 60 * 1000)),
                  category: '捐款'
              },
              { 
                  id: 5,
                  type: 'expense', 
                  description: '活動場地租金', 
                  amount: 8000, 
                  date: formatDate(new Date(currentDate.getTime() - 5 * 24 * 60 * 60 * 1000)),
                  category: '活動費用'
              }
          ]
      },
      
      getMembers: {
          success: true,
          data: [
              { 
                  id: 1, 
                  name: '張小明', 
                  type: 'individual', 
                  email: 'zhang@example.com', 
                  phone: '0912345678', 
                  status: 'active', 
                  joinDate: '2024-01-15',
                  address: '台北市中正區',
                  notes: '創始會員'
              },
              { 
                  id: 2, 
                  name: '李小華', 
                  type: 'individual', 
                  email: 'li@example.com', 
                  phone: '0987654321', 
                  status: 'active', 
                  joinDate: '2024-02-20',
                  address: '台北市大安區',
                  notes: '積極參與活動'
              },
              { 
                  id: 3, 
                  name: '王大明', 
                  type: 'individual', 
                  email: 'wang@example.com', 
                  phone: '0923456789', 
                  status: 'inactive', 
                  joinDate: '2024-03-10',
                  address: '台北市信義區',
                  notes: '暫停會籍'
              },
              { 
                  id: 4, 
                  name: '陳美麗', 
                  type: 'individual', 
                  email: 'chen@example.com', 
                  phone: '0934567890', 
                  status: 'active', 
                  joinDate: '2024-04-05',
                  address: '新北市板橋區',
                  notes: '志工團隊成員'
              },
              { 
                  id: 5, 
                  name: '財團法人愛心基金會', 
                  type: 'organization', 
                  email: 'info@lovefund.org', 
                  phone: '02-12345678', 
                  status: 'active', 
                  joinDate: '2024-01-01',
                  address: '台北市中山區',
                  notes: '合作夥伴機構'
              },
              { 
                  id: 6, 
                  name: '林志明', 
                  type: 'individual', 
                  email: 'lin@example.com', 
                  phone: '0945678901', 
                  status: 'active', 
                  joinDate: '2024-05-12',
                  address: '台中市西區',
                  notes: '中部地區聯絡人'
              }
          ]
      },
      
      addMember: {
          success: true,
          message: '會員新增成功',
          data: {
              id: Math.floor(Math.random() * 1000) + 100,
              ...data
          }
      },
      
      deleteMember: {
          success: true,
          message: '會員刪除成功'
      },
      
      updateMember: {
          success: true,
          message: '會員資料更新成功'
      }
  };

  const response = mockData[action];
  if (response) {
      return response;
  } else {
      return { 
          success: false, 
          message: `未知的API動作: ${action}`,
          error: 'UNKNOWN_ACTION'
      };
  }
}

// 顯示載入狀態
function showLoading(show = true) {
  const overlay = $('#loadingOverlay');
  if (show) {
      overlay.css('display', 'flex').fadeIn(200);
  } else {
      overlay.fadeOut(200);
  }
}

// 顯示提示訊息（改進版）
function showAlert(type, message, title = '') {
  // 確保 Swal 可用
  if (typeof Swal === 'undefined') {
      alert(message);
      return;
  }

  const icons = {
      success: 'success',
      error: 'error',
      warning: 'warning',
      info: 'info'
  };

  const titles = {
      success: '成功',
      error: '錯誤',
      warning: '警告',
      info: '提示'
  };

  Swal.fire({
      icon: icons[type] || 'info',
      title: title || titles[type] || '提示',
      text: message,
      confirmButtonText: '確定',
      timer: type === 'success' ? 3000 : 0,
      timerProgressBar: type === 'success',
      showConfirmButton: type !== 'success' || message.length > 20
  }).catch(error => {
      console.error('SweetAlert2 錯誤:', error);
      alert(message); // 降級到原生 alert
  });
}

// 顯示區域
function showSection(sectionName) {
  // 隱藏所有區域
  $('.section').removeClass('active');
  
  // 顯示指定區域
  $(`#${sectionName}`).addClass('active');
  
  // 更新導航狀態
  $('.sidebar .nav-link').removeClass('active');
  $(`.sidebar .nav-link[onclick="showSection('${sectionName}')"]`).addClass('active');
  
  currentSection = sectionName;
  
  // 載入對應資料
  switch(sectionName) {
      case 'dashboard':
          showDashboard();
          break;
      case 'members':
          loadMembers();
          break;
      // 其他區域可以在這裡添加
  }
}

// 顯示儀表板
async function showDashboard() {
  try {
      showLoading(true);
      await loadDashboardData();
  } catch (error) {
      console.error('載入儀表板錯誤:', error);
      showAlert('error', '載入儀表板資料失敗');
  } finally {
      showLoading(false);
  }
}

// 載入儀表板資料
async function loadDashboardData() {
  try {
      // 載入統計資料
      const statsResult = await callAPI('getDashboardStats');
      if (statsResult.success) {
          updateDashboardStats(statsResult.data);
      }

      // 載入圖表
      await loadDashboardCharts();
      
      // 載入最近活動
      await loadRecentActivities();
      
  } catch (error) {
      console.error('載入儀表板資料錯誤:', error);
      throw error;
  }
}

// 更新儀表板統計
function updateDashboardStats(stats) {
  $('#totalMembers').text(stats.totalMembers.toLocaleString());
  $('#totalIncome').text('NT$ ' + stats.totalIncome.toLocaleString());
  $('#totalExpenses').text('NT$ ' + stats.totalExpenses.toLocaleString());
  $('#currentBalance').text('NT$ ' + stats.currentBalance.toLocaleString());
}

// 載入儀表板圖表
async function loadDashboardCharts() {
  try {
      // 載入趨勢圖表
      const trendResult = await callAPI('getTrendData');
      if (trendResult.success) {
          createTrendChart(trendResult.data);
      }

      // 載入收入分布圖表
      const incomeResult = await callAPI('getIncomeDistribution');
      if (incomeResult.success) {
          createIncomeChart(incomeResult.data);
      }
      
  } catch (error) {
      console.error('載入圖表錯誤:', error);
  }
}

// 建立趨勢圖表
function createTrendChart(data) {
  const ctx = document.getElementById('trendChart');
  if (!ctx) return;
  
  const context = ctx.getContext('2d');
  
  if (charts.trend) {
      charts.trend.destroy();
  }
  
  charts.trend = new Chart(context, {
      type: 'line',
      data: {
          labels: data.labels,
          datasets: [{
              label: '收入',
              data: data.income,
              borderColor: '#4facfe',
              backgroundColor: 'rgba(79, 172, 254, 0.1)',
              tension: 0.4,
              fill: true
          }, {
              label: '支出',
              data: data.expenses,
              borderColor: '#fa709a',
              backgroundColor: 'rgba(250, 112, 154, 0.1)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
              intersect: false,
              mode: 'index'
          },
          scales: {
              y: {
                  beginAtZero: true,
                  ticks: {
                      callback: function(value) {
                          return 'NT$ ' + value.toLocaleString();
                      }
                  }
              }
          },
          plugins: {
              legend: {
                  position: 'top',
              },
              tooltip: {
                  callbacks: {
                      label: function(context) {
                          return context.dataset.label + ': NT$ ' + context.parsed.y.toLocaleString();
                      }
                  }
              }
          }
      }
  });
}

// 建立收入圖表
function createIncomeChart(data) {
  const ctx = document.getElementById('incomeChart');
  if (!ctx) return;
  
  const context = ctx.getContext('2d');
  
  if (charts.income) {
      charts.income.destroy();
  }
  
  charts.income = new Chart(context, {
      type: 'doughnut',
      data: {
          labels: data.labels,
          datasets: [{
              data: data.values,
              backgroundColor: data.colors || [
                  '#4facfe',
                  '#fa709a',
                  '#fee140',
                  '#a8edea',
                  '#c471ed'
              ],
              borderWidth: 2,
              borderColor: '#ffffff'
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
              legend: {
                  position: 'bottom',
              },
              tooltip: {
                  callbacks: {
                      label: function(context) {
                          return context.label + ': ' + context.parsed + '%';
                      }
                  }
              }
          }
      }
  });
}

// 載入最近活動
async function loadRecentActivities() {
  try {
      const result = await callAPI('getRecentActivities');
      if (result.success) {
          displayRecentActivities(result.data);
      }
  } catch (error) {
      console.error('載入最近活動錯誤:', error);
      $('#recentActivities').html('<div class="text-center text-muted">載入失敗</div>');
  }
}

// 顯示最近活動
function displayRecentActivities(activities) {
  let html = '';
  
  if (activities.length === 0) {
      html = '<div class="text-center text-muted">暫無活動記錄</div>';
  } else {
      activities.forEach(activity => {
          const icon = activity.type === 'income' ? 'fa-arrow-up text-success' : 
                      activity.type === 'expense' ? 'fa-arrow-down text-danger' : 
                      'fa-user text-info';
          
          html += `
              <div class="d-flex align-items-center py-2 border-bottom">
                  <div class="me-3">
                      <i class="fas ${icon}"></i>
                  </div>
                  <div class="flex-grow-1">
                      <div class="fw-medium">${activity.description}</div>
                      <small class="text-muted">${activity.date}</small>
                  </div>
                  ${activity.amount > 0 ? `<div class="text-end">
                      <span class="badge bg-${activity.type === 'income' ? 'success' : 'danger'}">
                          NT$ ${activity.amount.toLocaleString()}
                      </span>
                  </div>` : ''}
              </div>
          `;
      });
  }
  
  $('#recentActivities').html(html);
}

// 載入會員資料
async function loadMembers() {
  try {
      showLoading(true);
      const result = await callAPI('getMembers');
      
      if (result.success) {
          displayMembers(result.data);
          initializeMembersTable();
      } else {
          showAlert('error', '載入會員資料失敗');
      }
  } catch (error) {
      console.error('載入會員錯誤:', error);
      showAlert('error', '載入會員資料失敗');
  } finally {
      showLoading(false);
  }
}

// 顯示會員資料
function displayMembers(members) {
  let html = '';
  
  if (members.length === 0) {
      html = '<tr><td colspan="8" class="text-center text-muted">暫無會員資料</td></tr>';
  } else {
      members.forEach(member => {
          const statusBadge = member.status === 'active' ? 
              '<span class="badge bg-success">啟用</span>' : 
              '<span class="badge bg-secondary">停用</span>';
          
          const typeName = member.type === 'individual' ? '個人' : '機構';
          
          html += `
              <tr>
                  <td>${member.id}</td>
                  <td>${member.name}</td>
                  <td>${typeName}</td>
                  <td>${member.email}</td>
                  <td>${member.phone || '-'}</td>
                  <td>${statusBadge}</td>
                  <td>${member.joinDate}</td>
                  <td>
                      <div class="btn-group btn-group-sm">
                          <button class="btn btn-outline-primary" onclick="editMember(${member.id})" title="編輯">
                              <i class="fas fa-edit"></i>
                          </button>
                          <button class="btn btn-outline-info" onclick="viewMember(${member.id})" title="檢視">
                              <i class="fas fa-eye"></i>
                          </button>
                          <button class="btn btn-outline-danger" onclick="deleteMember(${member.id})" title="刪除">
                              <i class="fas fa-trash"></i>
                          </button>
                      </div>
                  </td>
              </tr>
          `;
      });
  }
  
  $('#membersTableBody').html(html);
}

// 初始化會員表格
function initializeMembersTable() {
  if (tables.members) {
      tables.members.destroy();
  }
  
  // 檢查 DataTables 是否可用
  if (typeof $.fn.DataTable === 'undefined') {
      console.warn('DataTables 未載入，使用基本表格');
      return;
  }
  
  try {
      tables.members = $('#membersTable').DataTable({
          language: {
              url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/zh-HANT.json'
          },
          pageLength: 25,
          responsive: true,
          order: [[0, 'desc']],
          columnDefs: [
              { orderable: false, targets: -1 } // 最後一列（操作列）不可排序
          ]
      });
  } catch (error) {
      console.error('初始化 DataTables 錯誤:', error);
  }
}

// 顯示新增會員模態視窗
function showAddMemberModal() {
  $('#addMemberForm')[0].reset();
  $('#addMemberModal').modal('show');
}

// 儲存會員
async function saveMember() {
  const form = $('#addMemberForm')[0];
  
  if (!form.checkValidity()) {
      form.reportValidity();
      return;
  }
  
  try {
      showLoading(true);
      
      const formData = new FormData(form);
      const memberData = Object.fromEntries(formData.entries());
      
      const result = await callAPI('addMember', memberData);
      
      if (result.success) {
          $('#addMemberModal').modal('hide');
          showAlert('success', '會員新增成功');
          loadMembers(); // 重新載入會員列表
      } else {
          showAlert('error', result.message || '新增會員失敗');
      }
  } catch (error) {
      console.error('新增會員錯誤:', error);
      showAlert('error', '新增會員失敗');
  } finally {
      showLoading(false);
  }
}

// 編輯會員
function editMember(id) {
  showAlert('info', '編輯功能開發中...', '功能提示');
}

// 檢視會員
function viewMember(id) {
  showAlert('info', '檢視功能開發中...', '功能提示');
}

// 刪除會員
function deleteMember(id) {
  Swal.fire({
      title: '確認刪除',
      text: '確定要刪除這個會員嗎？此操作無法復原。',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: '確定刪除',
      cancelButtonText: '取消'
  }).then(async (result) => {
      if (result.isConfirmed) {
          try {
              showLoading(true);
              const deleteResult = await callAPI('deleteMember', { id: id });
              
              if (deleteResult.success) {
                  showAlert('success', '會員刪除成功');
                  loadMembers();
              } else {
                  showAlert('error', deleteResult.message || '刪除會員失敗');
              }
          } catch (error) {
              console.error('刪除會員錯誤:', error);
              showAlert('error', '刪除會員失敗');
          } finally {
              showLoading(false);
          }
      }
  });
}

// 篩選會員
function filterMembers() {
  const search = $('#memberSearch').val();
  const status = $('#memberStatusFilter').val();
  const type = $('#memberTypeFilter').val();
  
  if (tables.members) {
      // 應用篩選條件
      tables.members.search(search).draw();
      
      // 自定義篩選邏輯可以在這裡添加
      console.log('篩選條件:', { search, status, type });
  }
}

// 匯入會員
function importMembers() {
  showAlert('info', '匯入功能開發中...', '功能提示');
}

// 匯出會員
function exportMembers() {
  showAlert('info', '匯出功能開發中...', '功能提示');
}

// 切換主題
function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  
  // 更新按鈕圖示
  const icon = newTheme === 'dark' ? 'fa-sun' : 'fa-moon';
  $('.navbar .btn i').removeClass('fa-moon fa-sun').addClass(icon);
}

// 載入儲存的主題
function loadSavedTheme() {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  
  const icon = savedTheme === 'dark' ? 'fa-sun' : 'fa-moon';
  $('.navbar .btn i').removeClass('fa-moon fa-sun').addClass(icon);
}

// 增強表單驗證
function enhanceFormValidation() {
  // 即時驗證
  $('input[type="email"]').on('blur', function() {
      const email = $(this).val();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email && !emailRegex.test(email)) {
          $(this).addClass('is-invalid');
          if (!$(this).next('.invalid-feedback').length) {
              $(this).after('<div class="invalid-feedback">請輸入有效的電子郵件地址</div>');
          }
      } else {
          $(this).removeClass('is-invalid');
          $(this).next('.invalid-feedback').remove();
      }
  });

  // 電話號碼驗證
  $('input[type="tel"]').on('blur', function() {
      const phone = $(this).val();
      const phoneRegex = /^[0-9\-\+\(\)\s]+$/;
      
      if (phone && !phoneRegex.test(phone)) {
          $(this).addClass('is-invalid');
          if (!$(this).next('.invalid-feedback').length) {
              $(this).after('<div class="invalid-feedback">請輸入有效的電話號碼</div>');
          }
      } else {
          $(this).removeClass('is-invalid');
          $(this).next('.invalid-feedback').remove();
      }
  });

  // 必填欄位驗證
  $('input[required], select[required], textarea[required]').on('blur', function() {
      if (!$(this).val().trim()) {
          $(this).addClass('is-invalid');
          if (!$(this).next('.invalid-feedback').length) {
              $(this).after('<div class="invalid-feedback">此欄位為必填</div>');
          }
      } else {
          $(this).removeClass('is-invalid');
          $(this).next('.invalid-feedback').remove();
      }
  });
}

// 網路狀態檢測
function checkNetworkStatus() {
  if ('navigator' in window && 'onLine' in navigator) {
      const updateStatus = () => {
          if (navigator.onLine) {
              console.log('網路連線已恢復');
              // 可以嘗試重新連接 API，但保持離線模式以確保穩定性
              $('#networkStatus').removeClass('offline').addClass('online');
          } else {
              console.log('網路連線中斷');
              CONFIG.OFFLINE_MODE = true;
              $('#networkStatus').removeClass('online').addClass('offline');
          }
      };
      
      window.addEventListener('online', updateStatus);
      window.addEventListener('offline', updateStatus);
      
      // 初始檢查
      updateStatus();
  }
}

// 錯誤處理增強
function handleError(error, context = '操作') {
  console.error(`${context}錯誤:`, error);
  
  let message = `${context}失敗`;
  
  if (error.name === 'AbortError') {
      message = '請求超時，請檢查網路連線';
  } else if (error.message && error.message.includes('Failed to fetch')) {
      message = '網路連線異常';
  } else if (error.message) {
      message = error.message;
  }
  
  showAlert('error', message);
}

// 列印功能
function printReport(elementId, options = {}) {
  const element = document.getElementById(elementId);
  if (!element) {
      showAlert('error', '找不到要列印的內容');
      return;
  }

  const printWindow = window.open('', '_blank');
  const title = options.title || '報表列印';
  
  printWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
          <title>${title}</title>
          <meta charset="utf-8">
          <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
          <style>
              @media print {
                  .no-print { display: none !important; }
                  body { font-size: 12px; color: #000; }
                  .card { border: 1px solid #ddd; margin-bottom: 20px; page-break-inside: avoid; }
                  table { width: 100% !important; border-collapse: collapse !important; }
                  th, td { border: 1px solid #333 !important; padding: 8px !important; }
                  .btn { display: none !important; }
                  .badge { border: 1px solid #333 !important; }
              }
              @media screen {
                  body { padding: 20px; }
              }
              .print-header {
                  text-align: center;
                  margin-bottom: 30px;
                  border-bottom: 2px solid #333;
                  padding-bottom: 10px;
              }
              .print-footer {
                  margin-top: 30px;
                  border-top: 1px solid #333;
                  padding-top: 10px;
                  text-align: center;
                  font-size: 10px;
              }
          </style>
      </head>
      <body>
          <div class="print-header">
              <h2>${title}</h2>
              <p>列印時間：${new Date().toLocaleString('zh-TW')}</p>
          </div>
          <div class="container-fluid">
              ${element.innerHTML}
          </div>
          <div class="print-footer">
              <p>此報表由系統自動產生</p>
          </div>
          <script>
              window.onload = function() {
                  // 移除不需要的元素
                  const elementsToRemove = document.querySelectorAll('.btn, .no-print, .dropdown');
                  elementsToRemove.forEach(el => el.remove());
                  
                  // 自動列印
                  setTimeout(() => {
                      window.print();
                  }, 500);
                  
                  window.onafterprint = function() {
                      window.close();
                  }
              }
          </script>
      </body>
      </html>
  `);
  printWindow.document.close();
}

// 匯出資料為 CSV
function exportToCSV(data, filename = 'export.csv') {
  if (!data || data.length === 0) {
      showAlert('warning', '沒有資料可以匯出');
      return;
  }

  // 取得欄位標題
  const headers = Object.keys(data[0]);
  
  // 建立 CSV 內容
  let csvContent = '\uFEFF'; // BOM for UTF-8
  csvContent += headers.join(',') + '\n';
  
  data.forEach(row => {
      const values = headers.map(header => {
          const value = row[header] || '';
          // 處理包含逗號或引號的值
          return typeof value === 'string' && (value.includes(',') || value.includes('"')) 
              ? `"${value.replace(/"/g, '""')}"` 
              : value;
      });
      csvContent += values.join(',') + '\n';
  });

  // 建立下載連結
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  
  if (link.download !== undefined) {
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      showAlert('success', '檔案匯出成功');
  } else {
      showAlert('error', '瀏覽器不支援檔案下載功能');
  }
}

// 資料備份功能
function backupData() {
  showAlert('info', '資料備份功能開發中...', '功能提示');
}

// 系統設定功能
function showSettings() {
  showAlert('info', '系統設定功能開發中...', '功能提示');
}

// 使用者說明
function showHelp() {
  Swal.fire({
      title: '系統使用說明',
      html: `
          <div class="text-start">
              <h5>主要功能：</h5>
              <ul>
                  <li><strong>儀表板：</strong>查看系統概況和統計資料</li>
                  <li><strong>會員管理：</strong>新增、編輯、刪除會員資料</li>
                  <li><strong>財務管理：</strong>記錄收入支出（開發中）</li>
                  <li><strong>報表功能：</strong>產生各種統計報表（開發中）</li>
              </ul>
              <h5>快速操作：</h5>
              <ul>
                  <li>點擊左側選單切換功能頁面</li>
                  <li>使用搜尋功能快速找到資料</li>
                  <li>點擊右上角切換深色/淺色主題</li>
              </ul>
              <h5>注意事項：</h5>
              <ul>
                  <li>目前使用離線模式，資料為示範用途</li>
                  <li>實際部署時需要連接後端 API</li>
                  <li>建議定期備份重要資料</li>
              </ul>
          </div>
      `,
      width: '600px',
      confirmButtonText: '了解',
      customClass: {
          htmlContainer: 'text-start'
      }
  });
}

// 關於系統
function showAbout() {
  Swal.fire({
      title: '關於系統',
      html: `
          <div class="text-center">
              <h4>人民團體管理系統</h4>
              <p class="text-muted">版本 1.0.0</p>
              <hr>
              <p>這是一個專為人民團體設計的綜合管理系統，</p>
              <p>提供會員管理、財務管理、活動管理等功能。</p>
              <hr>
              <p><small>開發時間：2024年8月</small></p>
              <p><small>技術架構：HTML5 + Bootstrap 5 + jQuery + Chart.js</small></p>
          </div>
      `,
      confirmButtonText: '確定',
      customClass: {
          htmlContainer: 'text-center'
      }
  });
}

// 鍵盤快捷鍵
function initializeKeyboardShortcuts() {
  $(document).keydown(function(e) {
      // Ctrl + Alt + 組合鍵
      if (e.ctrlKey && e.altKey) {
          switch(e.which) {
              case 68: // D - Dashboard
                  e.preventDefault();
                  showSection('dashboard');
                  break;
              case 77: // M - Members
                  e.preventDefault();
                  showSection('members');
                  break;
              case 78: // N - New Member
                  e.preventDefault();
                  if (currentSection === 'members') {
                      showAddMemberModal();
                  }
                  break;
              case 84: // T - Toggle Theme
                  e.preventDefault();
                  toggleTheme();
                  break;
              case 72: // H - Help
                  e.preventDefault();
                  showHelp();
                  break;
          }
      }
      
      // ESC 鍵關閉模態視窗
      if (e.which === 27) {
          $('.modal').modal('hide');
      }
  });
}

// 自動儲存功能（本地儲存）
function autoSave(key, data) {
  try {
      localStorage.setItem(`pda_${key}`, JSON.stringify({
          data: data,
          timestamp: Date.now()
      }));
      console.log(`自動儲存: ${key}`);
  } catch (error) {
      console.error('自動儲存失敗:', error);
  }
}

// 載入自動儲存的資料
function loadAutoSaved(key) {
  try {
      const saved = localStorage.getItem(`pda_${key}`);
      if (saved) {
          const parsed = JSON.parse(saved);
          // 檢查資料是否過期（24小時）
          if (Date.now() - parsed.timestamp < 24 * 60 * 60 * 1000) {
              return parsed.data;
          }
      }
  } catch (error) {
      console.error('載入自動儲存資料失敗:', error);
  }
  return null;
}

// 清理過期的本地儲存
function cleanupLocalStorage() {
  try {
      const keys = Object.keys(localStorage);
      const pdaKeys = keys.filter(key => key.startsWith('pda_'));
      
      pdaKeys.forEach(key => {
          try {
              const data = JSON.parse(localStorage.getItem(key));
              // 清理超過7天的資料
              if (Date.now() - data.timestamp > 7 * 24 * 60 * 60 * 1000) {
                  localStorage.removeItem(key);
                  console.log(`清理過期資料: ${key}`);
              }
          } catch (e) {
              // 如果解析失敗，直接刪除
              localStorage.removeItem(key);
          }
      });
  } catch (error) {
      console.error('清理本地儲存失敗:', error);
  }
}

// 系統監控
function initializeSystemMonitoring() {
  // 記錄系統啟動時間
  const startTime = Date.now();
  
  // 每5分鐘檢查一次系統狀態
  setInterval(() => {
      const uptime = Date.now() - startTime;
      console.log(`系統運行時間: ${Math.floor(uptime / 1000 / 60)} 分鐘`);
      
      // 檢查記憶體使用（如果瀏覽器支援）
      if (performance.memory) {
          const memory = performance.memory;
          console.log(`記憶體使用: ${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB`);
      }
      
      // 清理過期的本地儲存
      cleanupLocalStorage();
  }, 5 * 60 * 1000);
}

// 全域錯誤處理
window.addEventListener('error', function(e) {
  console.error('全域錯誤:', e.error);
  
  // 忽略特定錯誤
  const ignoredErrors = [
      'sweetAlertCSS',
      'Non-Error promise rejection captured',
      'ResizeObserver loop limit exceeded',
      'Script error'
  ];
  
  const shouldIgnore = ignoredErrors.some(ignored => 
      e.error && e.error.message && e.error.message.includes(ignored)
  );
  
  if (!shouldIgnore && e.error && e.error.message) {
      console.warn('捕獲到錯誤但已處理:', e.error.message);
      
      // 對於嚴重錯誤，可以考慮重新載入頁面
      if (e.error.message.includes('ChunkLoadError') || 
          e.error.message.includes('Loading chunk')) {
          showAlert('warning', '系統資源載入異常，建議重新整理頁面');
      }
  }
});

// 未捕獲的 Promise 拒絕處理
window.addEventListener('unhandledrejection', function(e) {
  console.error('未處理的 Promise 拒絕:', e.reason);
  
  // 防止在控制台顯示錯誤
  e.preventDefault();
  
  // 如果是網路相關錯誤，確保離線模式啟用
  if (e.reason && e.reason.message && 
      (e.reason.message.includes('fetch') || e.reason.message.includes('network'))) {
      if (!CONFIG.OFFLINE_MODE) {
          CONFIG.OFFLINE_MODE = true;
          console.log('檢測到網路錯誤，確保離線模式啟用');
      }
  }
});

// 頁面可見性變化處理
document.addEventListener('visibilitychange', function() {
  if (document.hidden) {
      console.log('頁面隱藏');
      // 可以在這裡暫停一些不必要的操作
  } else {
      console.log('頁面顯示');
      // 頁面重新顯示時，可以檢查資料是否需要更新
      if (currentSection === 'dashboard') {
          // 重新載入儀表板資料
          setTimeout(() => {
              showDashboard();
          }, 1000);
      }
  }
});

// 初始化所有功能
$(document).ready(function() {
  // 初始化鍵盤快捷鍵
  initializeKeyboardShortcuts();
  
  // 初始化系統監控
  initializeSystemMonitoring();
  
  // 顯示快捷鍵提示（首次使用）
  if (!localStorage.getItem('pda_shortcuts_shown')) {
      setTimeout(() => {
          Swal.fire({
              title: '快捷鍵提示',
              html: `
                  <div class="text-start">
                      <p>您可以使用以下快捷鍵快速操作：</p>
                      <ul>
                          <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>D</kbd> - 儀表板</li>
                          <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>M</kbd> - 會員管理</li>
                          <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>N</kbd> - 新增會員</li>
                          <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>T</kbd> - 切換主題</li>
                          <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>H</kbd> - 說明</li>
                          <li><kbd>ESC</kbd> - 關閉彈窗</li>
                      </ul>
                  </div>
              `,
              icon: 'info',
              confirmButtonText: '知道了',
              showClass: {
                  popup: 'animate__animated animate__fadeInDown'
              },
              hideClass: {
                  popup: 'animate__animated animate__fadeOutUp'
              }
          });
          localStorage.setItem('pda_shortcuts_shown', 'true');
      }, 3000);
  }
});

console.log('人民團體管理系統載入完成 v1.0.0');
</script>
</body>
</html>

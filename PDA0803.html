<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台灣帕金森病友權益促進會 - 會員管理系統</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2rem;
            color: #667eea;
        }

        .logo h1 {
            color: #333;
            font-size: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .main-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .nav-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .nav-card i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .nav-card.members { color: #4CAF50; }
        .nav-card.finance { color: #2196F3; }
        .nav-card.activities { color: #FF9800; }
        .nav-card.reports { color: #9C27B0; }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .content-area.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .section-title {
            font-size: 1.8rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid;
        }

        .stat-card.members { border-left-color: #4CAF50; }
        .stat-card.finance { border-left-color: #2196F3; }
        .stat-card.activities { border-left-color: #FF9800; }
        .stat-card.reports { border-left-color: #9C27B0; }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 2rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 500;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .close {
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #333;
        }

        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }

        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .filter-select {
            min-width: 150px;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .main-nav {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .search-filters {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-heart"></i>
                <h1>台灣帕金森病友權益促進會</h1>
            </div>
            <div class="user-info">
                <span>管理員</span>
                <button class="btn btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> 登出
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 主導航 -->
        <div class="main-nav">
            <div class="nav-card members" onclick="showSection('members')">
                <i class="fas fa-users"></i>
                <h3>會員管理</h3>
                <p>會員註冊、資料管理、分級管理</p>
            </div>
            <div class="nav-card finance" onclick="showSection('finance')">
                <i class="fas fa-coins"></i>
                <h3>財務管理</h3>
                <p>會費收繳、捐款管理、財務報表</p>
            </div>
            <div class="nav-card activities" onclick="showSection('activities')">
                <i class="fas fa-calendar-alt"></i>
                <h3>活動管理</h3>
                <p>活動規劃、報名管理、出席記錄</p>
            </div>
            <div class="nav-card reports" onclick="showSection('reports')">
                <i class="fas fa-chart-bar"></i>
                <h3>統計報表</h3>
                <p>會員統計、財務分析、活動成效</p>
            </div>
        </div>

        <!-- 會員管理區域 -->
        <div id="members-section" class="content-area">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    會員管理
                </h2>
                <button class="btn" onclick="showAddMemberModal()">
                    <i class="fas fa-plus"></i> 新增會員
                </button>
            </div>

            <!-- 統計卡片 -->
            <div class="stats-grid">
                <div class="stat-card members">
                    <span class="stat-number" id="totalMembers">0</span>
                    <span class="stat-label">總會員數</span>
                </div>
                <div class="stat-card finance">
                    <span class="stat-number" id="activeMembers">0</span>
                    <span class="stat-label">活躍會員</span>
                </div>
                <div class="stat-card activities">
                    <span class="stat-number" id="newMembers">0</span>
                    <span class="stat-label">本月新增</span>
                </div>
                <div class="stat-card reports">
                    <span class="stat-number" id="unpaidMembers">0</span>
                    <span class="stat-label">未繳費會員</span>
                </div>
            </div>

            <!-- 搜尋和篩選 -->
            <div class="search-filters">
                <div class="search-box">
                    <input type="text" class="form-control" id="memberSearch" placeholder="搜尋會員姓名、電話或電子郵件">
                </div>
                <select class="form-control filter-select" id="memberTypeFilter">
                    <option value="">全部類型</option>
                    <option value="一般會員">一般會員</option>
                    <option value="榮譽會員">榮譽會員</option>
                    <option value="贊助會員">贊助會員</option>
                    <option value="家屬會員">家屬會員</option>
                </select>
                <select class="form-control filter-select" id="memberStatusFilter">
                    <option value="">全部狀態</option>
                    <option value="正常">正常</option>
                    <option value="暫停">暫停</option>
                    <option value="退會">退會</option>
                </select>
                <button class="btn" onclick="searchMembers()">
                    <i class="fas fa-search"></i> 搜尋
                </button>
            </div>

            <!-- 會員列表 -->
            <div class="table-container">
                <table class="data-table" id="membersTable">
                    <thead>
                        <tr>
                            <th>會員編號</th>
                            <th>姓名</th>
                            <th>電話</th>
                            <th>電子郵件</th>
                            <th>會員類型</th>
                            <th>狀態</th>
                            <th>加入日期</th>
                            <th>會費狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody">
                        <!-- 會員資料將由 JavaScript 動態載入 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 財務管理區域 -->
        <div id="finance-section" class="content-area">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-coins"></i>
                    財務管理
                </h2>
                <div>
                    <button class="btn" onclick="showAddIncomeModal()">
                        <i class="fas fa-plus"></i> 新增收入
                    </button>
                    <button class="btn btn-secondary" onclick="showAddExpenseModal()">
                        <i class="fas fa-minus"></i> 新增支出
                    </button>
                </div>
            </div>

            <!-- 財務統計 -->
            <div class="stats-grid">
                <div class="stat-card members">
                    <span class="stat-number" id="totalIncome">$0</span>
                    <span class="stat-label">總收入</span>
                </div>
                <div class="stat-card finance">
                    <span class="stat-number" id="totalExpenses">$0</span>
                    <span class="stat-label">總支出</span>
                </div>
                <div class="stat-card activities">
                    <span class="stat-number" id="netIncome">$0</span>
                    <span class="stat-label">淨收益</span>
                </div>
                <div class="stat-card reports">
                    <span class="stat-number" id="membershipFees">$0</span>
                    <span class="stat-label">會費收入</span>
                </div>
            </div>

            <!-- 財務分頁 -->
            <div class="tabs">
                <div class="tab active" onclick="showFinanceTab('income')">收入記錄</div>
                <div class="tab" onclick="showFinanceTab('expenses')">支出記錄</div>
                <div class="tab" onclick="showFinanceTab('membership')">會費管理</div>
                <div class="tab" onclick="showFinanceTab('donations')">捐款管理</div>
            </div>

            <!-- 收入記錄 -->
            <div id="income-tab" class="tab-content active">
                <div class="table-container">
                    <table class="data-table" id="incomeTable">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>會計科目</th>
                                <th>金額</th>
                                <th>付款人</th>
                                <th>付款方式</th>
                                <th>說明</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="incomeTableBody">
                            <!-- 收入資料將由 JavaScript 動態載入 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 支出記錄 -->
            <div id="expenses-tab" class="tab-content">
                <div class="table-container">
                    <table class="data-table" id="expensesTable">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>會計科目</th>
                                <th>金額</th>
                                <th>收款人</th>
                                <th>付款方式</th>
                                <th>狀態</th>
                                <th>說明</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBody">
                            <!-- 支出資料將由 JavaScript 動態載入 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 會費管理 -->
            <div id="membership-tab" class="tab-content">
                <div class="search-filters">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="搜尋會員">
                    </div>
                    <select class="form-control filter-select">
                        <option value="">全部狀態</option>
                        <option value="已繳費">已繳費</option>
                        <option value="未繳費">未繳費</option>
                        <option value="逾期">逾期</option>
                    </select>
                    <button class="btn" onclick="generateMembershipBills()">
                        <i class="fas fa-file-invoice"></i> 產生帳單
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="membershipTable">
                        <thead>
                            <tr>
                                <th>會員姓名</th>
                                <th>會員類型</th>
                                <th>年度</th>
                                <th>應繳金額</th>
                                <th>已繳金額</th>
                                <th>繳費狀態</th>
                                <th>到期日</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="membershipTableBody">
                            <!-- 會費資料將由 JavaScript 動態載入 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 捐款管理 -->
            <div id="donations-tab" class="tab-content">
                <div class="table-container">
                    <table class="data-table" id="donationsTable">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>捐款人</th>
                                <th>捐款類型</th>
                                <th>金額</th>
                                <th>付款方式</th>
                                <th>收據狀態</th>
                                <th>說明</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="donationsTableBody">
                            <!-- 捐款資料將由 JavaScript 動態載入 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 活動管理區域 -->
        <div id="activities-section" class="content-area">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    活動管理
                </h2>
                <button class="btn" onclick="showAddActivityModal()">
                    <i class="fas fa-plus"></i> 新增活動
                </button>
            </div>

            <!-- 活動統計 -->
            <div class="stats-grid">
                <div class="stat-card members">
                    <span class="stat-number" id="totalActivities">0</span>
                    <span class="stat-label">總活動數</span>
                </div>
                <div class="stat-card finance">
                    <span class="stat-number" id="upcomingActivities">0</span>
                    <span class="stat-label">即將舉行</span>
                </div>
                <div class="stat-card activities">
                    <span class="stat-number" id="totalParticipants">0</span>
                    <span class="stat-label">總參與人次</span>
                </div>
                <div class="stat-card reports">
                    <span class="stat-number" id="activityRevenue">$0</span>
                    <span class="stat-label">活動收入</span>
                </div>
            </div>

            <!-- 活動列表 -->
            <div class="table-container">
                <table class="data-table" id="activitiesTable">
                    <thead>
                        <tr>
                            <th>活動名稱</th>
                            <th>活動日期</th>
                            <th>地點</th>
                            <th>報名人數</th>
                            <th>費用</th>
                            <th>狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="activitiesTableBody">
                        <!-- 活動資料將由 JavaScript 動態載入 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 統計報表區域 -->
        <div id="reports-section" class="content-area">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    統計報表
                </h2>
                <button class="btn" onclick="exportReports()">
                    <i class="fas fa-download"></i> 匯出報表
                </button>
            </div>

            <!-- 報表類型選擇 -->
            <div class="form-grid">
                <div class="form-group">
                    <label>報表類型</label>
                    <select class="form-control" id="reportType">
                        <option value="member-analysis">會員分析報表</option>
                        <option value="financial-summary">財務摘要報表</option>
                        <option value="activity-analysis">活動分析報表</option>
                        <option value="income-statement">損益表</option>
                        <option value="membership-status">會員狀態報表</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>開始日期</label>
                    <input type="date" class="form-control" id="reportStartDate">
                </div>
                <div class="form-group">
                    <label>結束日期</label>
                    <input type="date" class="form-control" id="reportEndDate">
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button class="btn" onclick="generateReport()">
                        <i class="fas fa-chart-line"></i> 產生報表
                    </button>
                </div>
            </div>

              <!-- 報表顯示區域 -->
              <div id="reportDisplay" class="table-container">
                  <!-- 報表內容將由 JavaScript 動態載入 -->
              </div>
          </div>
      </div>

      <!-- 新增會員模態框 -->
      <div id="addMemberModal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h3>新增會員</h3>
                  <span class="close" onclick="closeModal('addMemberModal')">&times;</span>
              </div>
              <form id="addMemberForm">
                  <div class="form-grid">
                      <div class="form-group">
                          <label>姓名 *</label>
                          <input type="text" class="form-control" name="name" required>
                      </div>
                      <div class="form-group">
                          <label>身分證號</label>
                          <input type="text" class="form-control" name="idNumber">
                      </div>
                      <div class="form-group">
                          <label>生日</label>
                          <input type="date" class="form-control" name="birthday">
                      </div>
                      <div class="form-group">
                          <label>性別</label>
                          <select class="form-control" name="gender">
                              <option value="">請選擇</option>
                              <option value="男">男</option>
                              <option value="女">女</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>電話 *</label>
                          <input type="tel" class="form-control" name="phone" required>
                      </div>
                      <div class="form-group">
                          <label>電子郵件</label>
                          <input type="email" class="form-control" name="email">
                      </div>
                      <div class="form-group">
                          <label>地址</label>
                          <input type="text" class="form-control" name="address">
                      </div>
                      <div class="form-group">
                          <label>會員類型 *</label>
                          <select class="form-control" name="memberType" required>
                              <option value="">請選擇</option>
                              <option value="一般會員">一般會員</option>
                              <option value="榮譽會員">榮譽會員</option>
                              <option value="贊助會員">贊助會員</option>
                              <option value="家屬會員">家屬會員</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>緊急聯絡人</label>
                          <input type="text" class="form-control" name="emergencyContact">
                      </div>
                      <div class="form-group">
                          <label>緊急聯絡人電話</label>
                          <input type="tel" class="form-control" name="emergencyPhone">
                      </div>
                      <div class="form-group">
                          <label>病情狀況</label>
                          <select class="form-control" name="condition">
                              <option value="">請選擇</option>
                              <option value="初期">初期</option>
                              <option value="中期">中期</option>
                              <option value="晚期">晚期</option>
                              <option value="家屬">家屬</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>特殊需求</label>
                          <textarea class="form-control" name="specialNeeds" rows="3"></textarea>
                      </div>
                  </div>
                  <div style="text-align: right; margin-top: 2rem;">
                      <button type="button" class="btn btn-secondary" onclick="closeModal('addMemberModal')">取消</button>
                      <button type="submit" class="btn">儲存</button>
                  </div>
              </form>
          </div>
      </div>

      <!-- 新增活動模態框 -->
      <div id="addActivityModal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h3>新增活動</h3>
                  <span class="close" onclick="closeModal('addActivityModal')">&times;</span>
              </div>
              <form id="addActivityForm">
                  <div class="form-grid">
                      <div class="form-group">
                          <label>活動名稱 *</label>
                          <input type="text" class="form-control" name="activityName" required>
                      </div>
                      <div class="form-group">
                          <label>活動類型</label>
                          <select class="form-control" name="activityType">
                              <option value="">請選擇</option>
                              <option value="講座">講座</option>
                              <option value="復健課程">復健課程</option>
                              <option value="聯誼活動">聯誼活動</option>
                              <option value="戶外活動">戶外活動</option>
                              <option value="義診">義診</option>
                              <option value="其他">其他</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>活動日期 *</label>
                          <input type="datetime-local" class="form-control" name="activityDate" required>
                      </div>
                      <div class="form-group">
                          <label>結束時間</label>
                          <input type="datetime-local" class="form-control" name="endDate">
                      </div>
                      <div class="form-group">
                          <label>活動地點 *</label>
                          <input type="text" class="form-control" name="location" required>
                      </div>
                      <div class="form-group">
                          <label>報名人數限制</label>
                          <input type="number" class="form-control" name="maxParticipants">
                      </div>
                      <div class="form-group">
                          <label>活動費用</label>
                          <input type="number" class="form-control" name="fee" step="0.01">
                      </div>
                      <div class="form-group">
                          <label>報名截止日期</label>
                          <input type="date" class="form-control" name="registrationDeadline">
                      </div>
                  </div>
                  <div class="form-group">
                      <label>活動說明</label>
                      <textarea class="form-control" name="description" rows="4"></textarea>
                  </div>
                  <div class="form-group">
                      <label>注意事項</label>
                      <textarea class="form-control" name="notes" rows="3"></textarea>
                  </div>
                  <div style="text-align: right; margin-top: 2rem;">
                      <button type="button" class="btn btn-secondary" onclick="closeModal('addActivityModal')">取消</button>
                      <button type="submit" class="btn">儲存</button>
                  </div>
              </form>
          </div>
      </div>

      <!-- 新增收入模態框 -->
      <div id="addIncomeModal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h3>新增收入</h3>
                  <span class="close" onclick="closeModal('addIncomeModal')">&times;</span>
              </div>
              <form id="addIncomeForm">
                  <div class="form-grid">
                      <div class="form-group">
                          <label>日期 *</label>
                          <input type="date" class="form-control" name="date" required>
                      </div>
                      <div class="form-group">
                          <label>會計科目 *</label>
                          <select class="form-control" name="account" required>
                              <option value="">請選擇</option>
                              <option value="一般會費">一般會費</option>
                              <option value="榮譽會費">榮譽會費</option>
                              <option value="贊助會費">贊助會費</option>
                              <option value="家屬會費">家屬會費</option>
                              <option value="一般捐款">一般捐款</option>
                              <option value="指定捐款">指定捐款</option>
                              <option value="活動收入">活動收入</option>
                              <option value="政府補助">政府補助</option>
                              <option value="其他收入">其他收入</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>金額 *</label>
                          <input type="number" class="form-control" name="amount" step="0.01" required>
                      </div>
                      <div class="form-group">
                          <label>付款人</label>
                          <input type="text" class="form-control" name="payer">
                      </div>
                      <div class="form-group">
                          <label>付款方式</label>
                          <select class="form-control" name="paymentMethod">
                              <option value="">請選擇</option>
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                              <option value="線上支付">線上支付</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>發票號碼</label>
                          <input type="text" class="form-control" name="invoiceNumber">
                      </div>
                  </div>
                  <div class="form-group">
                      <label>說明</label>
                      <textarea class="form-control" name="description" rows="3"></textarea>
                  </div>
                  <div style="text-align: right; margin-top: 2rem;">
                      <button type="button" class="btn btn-secondary" onclick="closeModal('addIncomeModal')">取消</button>
                      <button type="submit" class="btn">儲存</button>
                  </div>
              </form>
          </div>
      </div>

      <!-- 新增支出模態框 -->
      <div id="addExpenseModal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h3>新增支出</h3>
                  <span class="close" onclick="closeModal('addExpenseModal')">&times;</span>
              </div>
              <form id="addExpenseForm">
                  <div class="form-grid">
                      <div class="form-group">
                          <label>日期 *</label>
                          <input type="date" class="form-control" name="date" required>
                      </div>
                      <div class="form-group">
                          <label>會計科目 *</label>
                          <select class="form-control" name="account" required>
                              <option value="">請選擇</option>
                              <option value="辦公費用">辦公費用</option>
                              <option value="活動費用">活動費用</option>
                              <option value="場地租金">場地租金</option>
                              <option value="講師費">講師費</option>
                              <option value="交通費">交通費</option>
                              <option value="餐飲費">餐飲費</option>
                              <option value="印刷費">印刷費</option>
                              <option value="醫療費用">醫療費用</option>
                              <option value="設備費">設備費</option>
                              <option value="其他支出">其他支出</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>金額 *</label>
                          <input type="number" class="form-control" name="amount" step="0.01" required>
                      </div>
                      <div class="form-group">
                          <label>收款人</label>
                          <input type="text" class="form-control" name="payee">
                      </div>
                      <div class="form-group">
                          <label>付款方式</label>
                          <select class="form-control" name="paymentMethod">
                              <option value="">請選擇</option>
                              <option value="現金">現金</option>
                              <option value="轉帳">轉帳</option>
                              <option value="支票">支票</option>
                              <option value="信用卡">信用卡</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label>發票號碼</label>
                          <input type="text" class="form-control" name="invoiceNumber">
                      </div>
                  </div>
                  <div class="form-group">
                      <label>說明</label>
                      <textarea class="form-control" name="description" rows="3"></textarea>
                  </div>
                  <div style="text-align: right; margin-top: 2rem;">
                      <button type="button" class="btn btn-secondary" onclick="closeModal('addExpenseModal')">取消</button>
                      <button type="submit" class="btn">儲存</button>
                  </div>
              </form>
          </div>
      </div>

      <script>
          // 系統配置
          const CONFIG = {
              GAS_URL: 'https://script.google.com/macros/s/AKfycbyaFihfqT2-3GkNA4pHIcbaMkZOhLcBqKqHrN3uaDnGjdmMBDexpVTAt5nZFEZJzQXO/exec' // 請替換為實際的 GAS URL
          };

          // 全域變數
          let currentSection = 'members';
          let membersData = [];
          let activitiesData = [];
          let financeData = { income: [], expenses: [] };

          // 初始化系統
          document.addEventListener('DOMContentLoaded', function() {
              initializeSystem();
          });

          function initializeSystem() {
              loadDashboardData();
              setupEventListeners();
              showSection('members');
          }

          function setupEventListeners() {
              // 表單提交事件
              document.getElementById('addMemberForm').addEventListener('submit', handleAddMember);
              document.getElementById('addActivityForm').addEventListener('submit', handleAddActivity);
              document.getElementById('addIncomeForm').addEventListener('submit', handleAddIncome);
              document.getElementById('addExpenseForm').addEventListener('submit', handleAddExpense);

              // 搜尋事件
              document.getElementById('memberSearch').addEventListener('input', debounce(searchMembers, 300));
              document.getElementById('memberTypeFilter').addEventListener('change', searchMembers);
              document.getElementById('memberStatusFilter').addEventListener('change', searchMembers);
          }

          // API 呼叫函數
          async function callGAS(action, data = {}) {
              try {
                  showLoading();
                  const response = await fetch(CONFIG.GAS_URL, {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ action, data })
                  });

                  const result = await response.json();
                  hideLoading();

                  if (result.error) {
                      throw new Error(result.error);
                  }

                  return result;
              } catch (error) {
                  hideLoading();
                  showAlert('系統錯誤: ' + error.message, 'danger');
                  throw error;
              }
          }

          // 載入儀表板資料
          async function loadDashboardData() {
              try {
                  const [members, activities, income, expenses] = await Promise.all([
                      callGAS('getMembers'),
                      callGAS('getActivities'),
                      callGAS('getIncome'),
                      callGAS('getExpenses')
                  ]);

                  membersData = members;
                  activitiesData = activities;
                  financeData.income = income;
                  financeData.expenses = expenses;

                  updateDashboardStats();
                  loadCurrentSectionData();
              } catch (error) {
                  console.error('載入資料失敗:', error);
              }
          }

          // 更新儀表板統計
          function updateDashboardStats() {
              // 會員統計
              const activeMembers = membersData.filter(m => m.status === '正常').length;
              const thisMonth = new Date().toISOString().slice(0, 7);
              const newMembers = membersData.filter(m => m.joinDate && m.joinDate.startsWith(thisMonth)).length;
              const unpaidMembers = membersData.filter(m => m.membershipStatus === '未繳費').length;

              document.getElementById('totalMembers').textContent = membersData.length;
              document.getElementById('activeMembers').textContent = activeMembers;
              document.getElementById('newMembers').textContent = newMembers;
              document.getElementById('unpaidMembers').textContent = unpaidMembers;

              // 財務統計
              const totalIncome = financeData.income.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
              const totalExpenses = financeData.expenses.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
              const membershipFees = financeData.income
                  .filter(item => item.account && item.account.includes('會費'))
                  .reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);

              document.getElementById('totalIncome').textContent = '$' + totalIncome.toLocaleString();
              document.getElementById('totalExpenses').textContent = '$' + totalExpenses.toLocaleString();
              document.getElementById('netIncome').textContent = '$' + (totalIncome - totalExpenses).toLocaleString();
              document.getElementById('membershipFees').textContent = '$' + membershipFees.toLocaleString();

              // 活動統計
              const upcomingActivities = activitiesData.filter(a => 
                  new Date(a.activityDate) > new Date()
              ).length;
              const totalParticipants = activitiesData.reduce((sum, activity) => 
                  sum + parseInt(activity.registeredCount || 0), 0
              );
              const activityRevenue = financeData.income
                  .filter(item => item.account === '活動收入')
                  .reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);

              document.getElementById('totalActivities').textContent = activitiesData.length;
              document.getElementById('upcomingActivities').textContent = upcomingActivities;
              document.getElementById('totalParticipants').textContent = totalParticipants;
              document.getElementById('activityRevenue').textContent = '$' + activityRevenue.toLocaleString();
          }

          // 顯示區段
          function showSection(section) {
              // 隱藏所有區段
              document.querySelectorAll('.content-area').forEach(area => {
                  area.classList.remove('active');
              });

              // 顯示選中的區段
              document.getElementById(section + '-section').classList.add('active');
              currentSection = section;

              // 更新導航樣式
              document.querySelectorAll('.nav-card').forEach(card => {
                  card.style.transform = '';
                  card.style.boxShadow = '';
              });

              loadCurrentSectionData();
          }

          // 載入當前區段資料
          function loadCurrentSectionData() {
              switch (currentSection) {
                  case 'members':
                      loadMembersTable();
                      break;
                  case 'finance':
                      loadFinanceTables();
                      break;
                  case 'activities':
                      loadActivitiesTable();
                      break;
                  case 'reports':
                      // 報表區段不需要預載資料
                      break;
              }
          }

          // 載入會員表格
          function loadMembersTable() {
              const tbody = document.getElementById('membersTableBody');
              tbody.innerHTML = '';

              membersData.forEach(member => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                      <td>${member.memberNumber || ''}</td>
                      <td>${member.name}</td>
                      <td>${member.phone}</td>
                      <td>${member.email || ''}</td>
                      <td><span class="badge badge-info">${member.memberType}</span></td>
                      <td><span class="badge ${getStatusBadgeClass(member.status)}">${member.status}</span></td>
                      <td>${member.joinDate || ''}</td>
                      <td><span class="badge ${getMembershipStatusBadgeClass(member.membershipStatus)}">${member.membershipStatus || '未設定'}</span></td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm" onclick="editMember('${member.id}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-danger" onclick="deleteMember('${member.id}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                              <button class="btn btn-sm btn-warning" onclick="viewMemberDetails('${member.id}')">
                                  <i class="fas fa-eye"></i>
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          // 載入財務表格
          function loadFinanceTables() {
              loadIncomeTable();
              loadExpensesTable();
              loadMembershipTable();
              loadDonationsTable();
          }

          function loadIncomeTable() {
              const tbody = document.getElementById('incomeTableBody');
              tbody.innerHTML = '';

              financeData.income.forEach(item => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                      <td>${item.date}</td>
                      <td>${item.account}</td>
                      <td>$${parseFloat(item.amount || 0).toLocaleString()}</td>
                      <td>${item.payer || ''}</td>
                      <td>${item.paymentMethod || ''}</td>
                      <td>${item.description || ''}</td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm" onclick="editIncome('${item.id}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-danger" onclick="deleteIncome('${item.id}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          function loadExpensesTable() {
              const tbody = document.getElementById('expensesTableBody');
              tbody.innerHTML = '';

              financeData.expenses.forEach(item => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                      <td>${item.date}</td>
                      <td>${item.account}</td>
                      <td>$${parseFloat(item.amount || 0).toLocaleString()}</td>
                      <td>${item.payee || ''}</td>
                      <td>${item.paymentMethod || ''}</td>
                      <td><span class="badge ${getStatusBadgeClass(item.status)}">${item.status || '已支付'}</span></td>
                      <td>${item.description || ''}</td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm" onclick="editExpense('${item.id}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-danger" onclick="deleteExpense('${item.id}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          function loadMembershipTable() {
              const tbody = document.getElementById('membershipTableBody');
              tbody.innerHTML = '';

              // 這裡應該從後端載入會費資料
              // 暫時使用會員資料模擬
              membersData.forEach(member => {
                  const row = document.createElement('tr');
                  const currentYear = new Date().getFullYear();
                  const membershipFee = getMembershipFee(member.memberType);
                  
                  row.innerHTML = `
                      <td>${member.name}</td>
                      <td>${member.memberType}</td>
                      <td>${currentYear}</td>
                      <td>$${membershipFee.toLocaleString()}</td>
                      <td>$${member.paidAmount || 0}</td>
                      <td><span class="badge ${getMembershipStatusBadgeClass(member.membershipStatus)}">${member.membershipStatus || '未繳費'}</span></td>
                      <td>${member.membershipDueDate || ''}</td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm btn-success" onclick="recordPayment('${member.id}')">
                                  <i class="fas fa-dollar-sign"></i> 記錄繳費
                              </button>
                              <button class="btn btn-sm" onclick="sendBill('${member.id}')">
                                  <i class="fas fa-paper-plane"></i> 發送帳單
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          function loadDonationsTable() {
              const tbody = document.getElementById('donationsTableBody');
              tbody.innerHTML = '';

              const donations = financeData.income.filter(item => 
                  item.account && item.account.includes('捐款')
              );

              donations.forEach(item => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                      <td>${item.date}</td>
                      <td>${item.payer || ''}</td>
                      <td>${item.account}</td>
                      <td>$${parseFloat(item.amount || 0).toLocaleString()}</td>
                      <td>${item.paymentMethod || ''}</td>
                      <td><span class="badge badge-info">${item.receiptStatus || '未開立'}</span></td>
                      <td>${item.description || ''}</td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm" onclick="issueReceipt('${item.id}')">
                                  <i class="fas fa-receipt"></i> 開立收據
                              </button>
                              <button class="btn btn-sm btn-warning" onclick="sendThankYou('${item.id}')">
                                  <i class="fas fa-heart"></i> 感謝函
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          // 載入活動表格
          function loadActivitiesTable() {
              const tbody = document.getElementById('activitiesTableBody');
              tbody.innerHTML = '';

              activitiesData.forEach(activity => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                      <td>${activity.activityName}</td>
                      <td>${formatDateTime(activity.activityDate)}</td>
                      <td>${activity.location}</td>
                      <td>${activity.registeredCount || 0}/${activity.maxParticipants || '無限制'}</td>
                      <td>$${parseFloat(activity.fee || 0).toLocaleString()}</td>
                      <td><span class="badge ${getActivityStatusBadgeClass(activity.status)}">${activity.status || '報名中'}</span></td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm" onclick="editActivity('${activity.id}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-warning" onclick="viewParticipants('${activity.id}')">
                                  <i class="fas fa-users"></i> 參與者
                              </button>
                              <button class="btn btn-sm btn-danger" onclick="deleteActivity('${activity.id}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          // 表單處理函數
          async function handleAddMember(e) {
              e.preventDefault();
              const formData = new FormData(e.target);
              const memberData = Object.fromEntries(formData.entries());

              try {
                  await callGAS('addMember', memberData);
                  showAlert('會員新增成功！', 'success');
                  closeModal('addMemberModal');
                  loadDashboardData();
              } catch (error) {
                  showAlert('新增會員失敗: ' + error.message, 'danger');
              }
          }

          async function handleAddActivity(e) {
              e.preventDefault();
              const formData = new FormData(e.target);
              const activityData = Object.fromEntries(formData.entries());

              try {
                  await callGAS('addActivity', activityData);
                  showAlert('活動新增成功！', 'success');
                  closeModal('addActivityModal');
                  loadDashboardData();
              } catch (error) {
                  showAlert('新增活動失敗: ' + error.message, 'danger');
              }
          }

          async function handleAddIncome(e) {
              e.preventDefault();
              const formData = new FormData(e.target);
              const incomeData = Object.fromEntries(formData.entries());

              try {
                  await callGAS('addIncome', incomeData);
                  showAlert('收入記錄新增成功！', 'success');
                  closeModal('addIncomeModal');
                  loadDashboardData();
              } catch (error) {
                  showAlert('新增收入記錄失敗: ' + error.message, 'danger');
              }
          }

          async function handleAddExpense(e) {
              e.preventDefault();
              const formData = new FormData(e.target);
              const expenseData = Object.fromEntries(formData.entries());

              try {
                  await callGAS('addExpense', expenseData);
                  showAlert('支出記錄新增成功！', 'success');
                  closeModal('addExpenseModal');
                  loadDashboardData();
              } catch (error) {
                  showAlert('新增支出記錄失敗: ' + error.message, 'danger');
              }
          }

          // 搜尋和篩選功能
          function searchMembers() {
              const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
              const typeFilter = document.getElementById('memberTypeFilter').value;
              const statusFilter = document.getElementById('memberStatusFilter').value;

              const filteredMembers = membersData.filter(member => {
                  const matchesSearch = !searchTerm || 
                      member.name.toLowerCase().includes(searchTerm) ||
                      (member.phone && member.phone.includes(searchTerm)) ||
                      (member.email && member.email.toLowerCase().includes(searchTerm));
                  
                  const matchesType = !typeFilter || member.memberType === typeFilter;
                  const matchesStatus = !statusFilter || member.status === statusFilter;

                  return matchesSearch && matchesType && matchesStatus;
              });

              loadMembersTableWithData(filteredMembers);
          }

          function loadMembersTableWithData(data) {
              const tbody = document.getElementById('membersTableBody');
              tbody.innerHTML = '';

              data.forEach(member => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                      <td>${member.memberNumber || ''}</td>
                      <td>${member.name}</td>
                      <td>${member.phone}</td>
                      <td>${member.email || ''}</td>
                      <td><span class="badge badge-info">${member.memberType}</span></td>
                      <td><span class="badge ${getStatusBadgeClass(member.status)}">${member.status}</span></td>
                      <td>${member.joinDate || ''}</td>
                      <td><span class="badge ${getMembershipStatusBadgeClass(member.membershipStatus)}">${member.membershipStatus || '未設定'}</span></td>
                      <td>
                          <div class="action-buttons">
                              <button class="btn btn-sm" onclick="editMember('${member.id}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-danger" onclick="deleteMember('${member.id}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                              <button class="btn btn-sm btn-warning" onclick="viewMemberDetails('${member.id}')">
                                  <i class="fas fa-eye"></i>
                              </button>
                          </div>
                      </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          // 財務分頁切換
          function showFinanceTab(tabName) {
              // 移除所有活躍狀態
              document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
              document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

              // 啟用選中的分頁
              event.target.classList.add('active');
              document.getElementById(tabName + '-tab').classList.add('active');
          }

          // 報表產生
          async function generateReport() {
              const reportType = document.getElementById('reportType').value;
              const startDate = document.getElementById('reportStartDate').value;
              const endDate = document.getElementById('reportEndDate').value;

              if (!startDate || !endDate) {
                  showAlert('請選擇報表日期範圍', 'warning');
                  return;
              }

              try {
                  const reportData = await callGAS('generateAdvancedReports', {
                      reportType,
                      startDate,
                      endDate
                  });

                  displayReport(reportData);
              } catch (error) {
                  showAlert('產生報表失敗: ' + error.message, 'danger');
              }
          }

          function displayReport(reportData) {
              const reportDisplay = document.getElementById('reportDisplay');
              
              switch (reportData.reportType) {
                  case '會員分析報表':
                      displayMemberAnalysisReport(reportData, reportDisplay);
                      break;
                  case '損益表':
                      displayIncomeStatementReport(reportData, reportDisplay);
                      break;
                  default:
                      displayGenericReport(reportData, reportDisplay);
              }
          }

          function displayMemberAnalysisReport(reportData, container) {
              container.innerHTML = `
                  <h3>${reportData.reportType}</h3>
                  <p>報表期間: ${reportData.period}</p>
                  
                  <div class="stats-grid">
                      <div class="stat-card">
                          <span class="stat-number">${reportData.memberStats.total}</span>
                          <span class="stat-label">總會員數</span>
                      </div>
                      <div class="stat-card">
                          <span class="stat-number">${reportData.memberStats.newMembers}</span>
                          <span class="stat-label">新增會員</span>
                      </div>
                      <div class="stat-card">
                          <span class="stat-number">$${reportData.membershipIncome.total.toLocaleString()}</span>
                          <span class="stat-label">會費收入</span>
                      </div>
                  </div>

                  <h4>會員類型分布</h4>
                  <table class="data-table">
                      <thead>
                          <tr><th>會員類型</th><th>人數</th></tr>
                      </thead>
                      <tbody>
                          ${Object.entries(reportData.memberStats.byType).map(([type, count]) => 
                              `<tr><td>${type}</td><td>${count}</td></tr>`
                          ).join('')}
                      </tbody>
                  </table>
              `;
          }

          function displayIncomeStatementReport(reportData, container) {
              container.innerHTML = `
                  <h3>${reportData.reportType}</h3>
                  <p>報表期間: ${reportData.period}</p>
                  
                  <div class="form-grid">
                      <div>
                          <h4>收入明細</h4>
                          <table class="data-table">
                              <thead>
                                  <tr><th>科目</th><th>金額</th></tr>
                              </thead>
                              <tbody>
                                  ${reportData.income.details.map(item => 
                                      `<tr><td>${item.account}</td><td>$${item.amount.toLocaleString()}</td></tr>`
                                  ).join('')}
                                  <tr style="font-weight: bold; background: #f8f9fa;">
                                      <td>收入總計</td>
                                      <td>$${reportData.income.total.toLocaleString()}</td>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                      
                      <div>
                          <h4>支出明細</h4>
                          <table class="data-table">
                              <thead>
                                  <tr><th>科目</th><th>金額</th></tr>
                              </thead>
                              <tbody>
                                  ${reportData.expenses.details.map(item => 
                                      `<tr><td>${item.account}</td><td>$${item.amount.toLocaleString()}</td></tr>`
                                  ).join('')}
                                  <tr style="font-weight: bold; background: #f8f9fa;">
                                      <td>支出總計</td>
                                      <td>$${reportData.expenses.total.toLocaleString()}</td>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                  </div>

                  <div class="alert ${reportData.netIncome >= 0 ? 'alert-success' : 'alert-danger'}">
                      <strong>淨收益: $${reportData.netIncome.toLocaleString()}</strong>
                  </div>
              `;
          }

          // 輔助函數
          function getMembershipFee(memberType) {
              const fees = {
                  '一般會員': 1000,
                  '榮譽會員': 0,
                  '贊助會員': 5000,
                  '家屬會員': 500
              };
              return fees[memberType] || 1000;
          }

          function getStatusBadgeClass(status) {
              const classes = {
                  '正常': 'badge-success',
                  '暫停': 'badge-warning',
                  '退會': 'badge-danger',
                  '已支付': 'badge-success',
                  '待審核': 'badge-warning'
              };
              return classes[status] || 'badge-info';
          }

          function getMembershipStatusBadgeClass(status) {
              const classes = {
                  '已繳費': 'badge-success',
                  '未繳費': 'badge-danger',
                  '逾期': 'badge-warning'
              };
              return classes[status] || 'badge-info';
          }

          function getActivityStatusBadgeClass(status) {
              const classes = {
                  '報名中': 'badge-success',
                  '已結束': 'badge-info',
                  '已取消': 'badge-danger'
              };
              return classes[status] || 'badge-info';
          }

          function formatDateTime(dateTime) {
              if (!dateTime) return '';
              const date = new Date(dateTime);
              return date.toLocaleString('zh-TW');
          }

          // 模態框控制
          function showAddMemberModal() {
              document.getElementById('addMemberModal').style.display = 'block';
          }

          function showAddActivityModal() {
              document.getElementById('addActivityModal').style.display = 'block';
          }

          function showAddIncomeModal() {
              document.getElementById('addIncomeModal').style.display = 'block';
          }

          function showAddExpenseModal() {
              document.getElementById('addExpenseModal').style.display = 'block';
          }

          function closeModal(modalId) {
              document.getElementById(modalId).style.display = 'none';
          }

          // 載入和錯誤處理
          function showLoading() {
              // 可以添加載入指示器
          }

          function hideLoading() {
              // 隱藏載入指示器
          }

          function showAlert(message, type = 'info') {
              const alertDiv = document.createElement('div');
              alertDiv.className = `alert alert-${type}`;
              alertDiv.textContent = message;
              
              document.body.insertBefore(alertDiv, document.body.firstChild);
              
              setTimeout(() => {
                  alertDiv.remove();
              }, 5000);
          }

          function debounce(func, wait) {
              let timeout;
              return function executedFunction(...args) {
                  const later = () => {
                      clearTimeout(timeout);
                      func(...args);
                  };
                  clearTimeout(timeout);
                  timeout = setTimeout(later, wait);
              };
          }

          // 其他操作函數（需要實作）
          async function editMember(id) {
              // 實作編輯會員功能
          }

          async function deleteMember(id) {
              if (confirm('確定要刪除此會員嗎？')) {
                  try {
                      await callGAS('deleteMember', { id });
                      showAlert('會員刪除成功', 'success');
                      loadDashboardData();
                  } catch (error) {
                      showAlert('刪除失敗: ' + error.message, 'danger');
                  }
              }
          }

          async function recordPayment(memberId) {
              // 實作記錄繳費功能
          }

          async function generateMembershipBills() {
              try {
                  await callGAS('generateMembershipBills');
                  showAlert('帳單產生成功', 'success');
              } catch (error) {
                  showAlert('產生帳單失敗: ' + error.message, 'danger');
              }
          }

          async function exportReports() {
              // 實作匯出報表功能
          }

          function logout() {
              if (confirm('確定要登出嗎？')) {
                  window.location.reload();
              }
          }

          // 點擊模態框外部關閉
          window.onclick = function(event) {
              const modals = document.querySelectorAll('.modal');
              modals.forEach(modal => {
                  if (event.target === modal) {
                      modal.style.display = 'none';
                  }
              });
          }
      </script>
  </body>
  </html>


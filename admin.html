<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸•é‡‘æ£®ç—…å‹å”æœƒ - ç®¡ç†å¾Œå°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f7fa;
    }
    
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 250px;
      height: 100vh;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      overflow-y: auto;
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .menu-item {
      padding: 12px 15px;
      margin-bottom: 5px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .menu-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .menu-item.active {
      background: rgba(255,255,255,0.2);
      font-weight: bold;
    }
    
    .main-content {
      margin-left: 250px;
      padding: 30px;
    }
    
    .header {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      font-size: 28px;
      color: #333;
    }
    
    .page-content {
      display: none;
    }
    
    .page-content.active {
      display: block;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .stat-value {
      font-size: 36px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: #666;
      font-size: 14px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .card-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .btn-success {
      background: #28a745;
      color: white;
    }
    
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    
    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
      margin-right: 5px;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th {
      background: #f8f9fa;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #333;
      border-bottom: 2px solid #dee2e6;
    }
    
    td {
      padding: 12px;
      border-bottom: 1px solid #dee2e6;
    }
    
    tr:hover {
      background: #f8f9fa;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .badge-success {
      background: #d4edda;
      color: #155724;
    }
    
    .badge-warning {
      background: #fff3cd;
      color: #856404;
    }
    
    .badge-danger {
      background: #f8d7da;
      color: #721c24;
    }
    
    .badge-info {
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .search-box {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      width: 300px;
      margin-bottom: 20px;
    }
    
    .chart-container {
      height: 300px;
      margin-top: 20px;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: bold;
    }
    
    .modal-close {
      font-size: 28px;
      cursor: pointer;
      color: #999;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="logo">ğŸŒŸ ç®¡ç†å¾Œå°</div>
    <div class="menu-item active" onclick="showPage('dashboard')">ğŸ“Š å„€è¡¨æ¿</div>
    <div class="menu-item" onclick="showPage('members')">ğŸ‘¥ æœƒå“¡ç®¡ç†</div>
    <div class="menu-item" onclick="showPage('activities')">ğŸ“… æ´»å‹•ç®¡ç†</div>
    <div class="menu-item" onclick="showPage('registrations')">ğŸ“ å ±åç®¡ç†</div>
    <div class="menu-item" onclick="showPage('volunteers')">ğŸ¤ å¿—å·¥ç®¡ç†</div>
    <div class="menu-item" onclick="showPage('finances')">ğŸ’° è²¡å‹™ç®¡ç†</div>
    <div class="menu-item" onclick="showPage('statistics')">ğŸ“ˆ çµ±è¨ˆå ±è¡¨</div>
    <div class="menu-item" onclick="showPage('settings')">âš™ï¸ ç³»çµ±è¨­å®š</div>
  </div>

  <div class="main-content">
    <!-- å„€è¡¨æ¿ -->
    <div id="dashboard" class="page-content active">
      <div class="header">
        <h1>å„€è¡¨æ¿</h1>
        <button class="btn btn-primary" onclick="loadDashboard()">ğŸ”„ é‡æ–°æ•´ç†</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalMembers">0</div>
          <div class="stat-label">ç¸½æœƒå“¡æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalActivities">0</div>
          <div class="stat-label">ç¸½æ´»å‹•æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalVolunteerHours">0</div>
          <div class="stat-label">å¿—å·¥ç¸½æ™‚æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="balance">NT$ 0</div>
          <div class="stat-label">è²¡å‹™é¤˜é¡</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">æœƒå“¡é¡å‹åˆ†å¸ƒ</div>
        <canvas id="memberTypeChart"></canvas>
      </div>

      <div class="card">
        <div class="card-title">æ´»å‹•ç‹€æ…‹çµ±è¨ˆ</div>
        <canvas id="activityStatusChart"></canvas>
      </div>

      <div class="card">
        <div class="card-title">æœ€è¿‘æ´»å‹•</div>
        <div id="recentActivities"></div>
      </div>
    </div>

    <!-- æœƒå“¡ç®¡ç† -->
    <div id="members" class="page-content">
      <div class="header">
        <h1>æœƒå“¡ç®¡ç†</h1>
      </div>

      <div class="card">
        <input type="text" id="memberSearch" class="search-box" placeholder="æœå°‹æœƒå“¡å§“åæˆ–é›»è©±..." onkeyup="searchMembers()">
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>å§“å</th>
                <th>é›»è©±</th>
                <th>Email</th>
                <th>æœƒå“¡é¡å‹</th>
                <th>è§’è‰²</th>
                <th>ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="membersTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- æ´»å‹•ç®¡ç† -->
    <div id="activities" class="page-content">
      <div class="header">
        <h1>æ´»å‹•ç®¡ç†</h1>
        <button class="btn btn-primary" onclick="showCreateActivity()">â• æ–°å¢æ´»å‹•</button>
      </div>

      <div class="card">
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>æ´»å‹•åç¨±</th>
                <th>é¡å‹</th>
                <th>æ—¥æœŸ</th>
                <th>åœ°é»</th>
                <th>å ±åäººæ•¸</th>
                <th>ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="activitiesTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- å ±åç®¡ç† -->
    <div id="registrations" class="page-content">
      <div class="header">
        <h1>å ±åç®¡ç†</h1>
      </div>

      <div class="card">
        <select id="activityFilter" class="form-select" style="width: 300px; margin-bottom: 20px;" onchange="loadRegistrations()">
          <option value="">å…¨éƒ¨æ´»å‹•</option>
        </select>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>æ´»å‹•åç¨±</th>
                <th>æœƒå“¡å§“å</th>
                <th>å ±åæ™‚é–“</th>
                <th>ç°½åˆ°ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="registrationsTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- å¿—å·¥ç®¡ç† -->
    <div id="volunteers" class="page-content">
      <div class="header">
        <h1>å¿—å·¥ç®¡ç†</h1>
        <span class="badge badge-warning" id="pendingCount">å¾…å¯©æ ¸: 0</span>
      </div>

      <div class="card">
        <div class="card-title">å¾…å¯©æ ¸è¨˜éŒ„</div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>æœƒå“¡å§“å</th>
                <th>æœå‹™æ—¥æœŸ</th>
                <th>æ™‚æ•¸</th>
                <th>èªªæ˜</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="pendingVolunteers"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- è²¡å‹™ç®¡ç† -->
    <div id="finances" class="page-content">
      <div class="header">
        <h1>è²¡å‹™ç®¡ç†</h1>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalIncome">NT$ 0</div>
          <div class="stat-label">ç¸½æ”¶å…¥</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalExpense">NT$ 0</div>
          <div class="stat-label">ç¸½æ”¯å‡º</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="financialBalance">NT$ 0</div>
          <div class="stat-label">é¤˜é¡</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">
          ææ¬¾è¨˜éŒ„
          <button class="btn btn-primary btn-sm" onclick="showAddDonation()" style="float: right;">â• æ–°å¢ææ¬¾</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>æ—¥æœŸ</th>
                <th>ææ¬¾äºº</th>
                <th>é‡‘é¡</th>
                <th>èªªæ˜</th>
              </tr>
            </thead>
            <tbody id="donationsTable"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-title">
          æ”¯å‡ºè¨˜éŒ„
          <button class="btn btn-primary btn-sm" onclick="showAddExpense()" style="float: right;">â• æ–°å¢æ”¯å‡º</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>æ—¥æœŸ</th>
                <th>é¡åˆ¥</th>
                <th>å°è±¡</th>
                <th>é‡‘é¡</th>
                <th>èªªæ˜</th>
                <th>ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="expensesTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- çµ±è¨ˆå ±è¡¨ -->
    <div id="statistics" class="page-content">
      <div class="header">
        <h1>çµ±è¨ˆå ±è¡¨</h1>
      </div>

      <div class="card">
        <div class="card-title">æœˆåº¦æ´»å‹•çµ±è¨ˆ</div>
        <canvas id="monthlyActivityChart"></canvas>
      </div>

      <div class="card">
        <div class="card-title">æœƒå“¡æˆé•·è¶¨å‹¢</div>
        <canvas id="memberGrowthChart"></canvas>
      </div>

      <div class="card">
        <div class="card-title">å¿—å·¥æœå‹™çµ±è¨ˆ</div>
        <canvas id="volunteerStatsChart"></canvas>
      </div>

      <div class="card">
        <div class="card-title">è²¡å‹™æ”¶æ”¯çµ±è¨ˆ</div>
        <canvas id="financialStatsChart"></canvas>
      </div>
    </div>

    <!-- ç³»çµ±è¨­å®š -->
    <div id="settings" class="page-content">
      <div class="header">
        <h1>ç³»çµ±è¨­å®š</h1>
      </div>

      <div class="card">
        <div class="card-title">åŸºæœ¬è¨­å®š</div>
        <div class="form-group">
          <label class="form-label">çµ„ç¹”åç¨±</label>
          <input type="text" id="orgName" class="form-input" value="å¸•é‡‘æ£®ç—…å‹å”æœƒ">
        </div>
        <div class="form-group">
          <label class="form-label">è¯çµ¡é›»è©±</label>
          <input type="tel" id="orgPhone" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" id="orgEmail" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">åœ°å€</label>
          <input type="text" id="orgAddress" class="form-input">
        </div>
        <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ å„²å­˜è¨­å®š</button>
      </div>

      <div class="card">
        <div class="card-title">è³‡æ–™å‚™ä»½</div>
        <p style="color: #666; margin-bottom: 15px;">å‚™ä»½æ‰€æœ‰ç³»çµ±è³‡æ–™ç‚º JSON æ ¼å¼</p>
        <button class="btn btn-success" onclick="backupData()">ğŸ“¥ ä¸‹è¼‰å‚™ä»½æª”</button>
      </div>
    </div>
  </div>

  <!-- æ–°å¢/ç·¨è¼¯æ´»å‹• Modal -->
  <div id="activityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="activityModalTitle">æ–°å¢æ´»å‹•</div>
        <span class="modal-close" onclick="closeModal('activityModal')">&times;</span>
      </div>
      <div class="form-group">
        <label class="form-label">æ´»å‹•åç¨± *</label>
        <input type="text" id="activityName" class="form-input">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">æ´»å‹•é¡å‹ *</label>
          <select id="activityType" class="form-select">
            <option value="è¬›åº§">è¬›åº§</option>
            <option value="é‹å‹•èª²ç¨‹">é‹å‹•èª²ç¨‹</option>
            <option value="ç¤¾äº¤æ´»å‹•">ç¤¾äº¤æ´»å‹•</option>
            <option value="å¥åº·æª¢æŸ¥">å¥åº·æª¢æŸ¥</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">æ—¥æœŸ *</label>
          <input type="date" id="activityDate" class="form-input">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">é–‹å§‹æ™‚é–“ *</label>
          <input type="time" id="activityStartTime" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">çµæŸæ™‚é–“ *</label>
          <input type="time" id="activityEndTime" class="form-input">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">åœ°é» *</label>
        <input type="text" id="activityLocation" class="form-input">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">äººæ•¸ä¸Šé™ (0=ä¸é™)</label>
          <input type="number" id="activityMaxParticipants" class="form-input" value="0" min="0">
        </div>
        <div class="form-group">
          <label class="form-label">è²»ç”¨ (0=å…è²»)</label>
          <input type="number" id="activityFee" class="form-input" value="0" min="0">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">å ±åæˆªæ­¢æ—¥ *</label>
        <input type="date" id="activityDeadline" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">æ´»å‹•èªªæ˜</label>
        <textarea id="activityDescription" class="form-textarea" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">æ³¨æ„äº‹é …</label>
        <textarea id="activityNotes" class="form-textarea" rows="3"></textarea>
      </div>
      <button class="btn btn-primary" onclick="saveActivity()">ğŸ’¾ å„²å­˜</button>
    </div>
  </div>

  <!-- å¯©æ ¸å¿—å·¥ Modal -->
  <div id="reviewVolunteerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">å¯©æ ¸å¿—å·¥è¨˜éŒ„</div>
        <span class="modal-close" onclick="closeModal('reviewVolunteerModal')">&times;</span>
      </div>
      <div id="reviewVolunteerContent"></div>
      <div class="form-group">
        <label class="form-label">å¯©æ ¸å‚™è¨»</label>
        <textarea id="reviewNote" class="form-textarea" rows="3"></textarea>
      </div>
      <button class="btn btn-success" onclick="approveVolunteer()">âœ… é€šé</button>
      <button class="btn btn-danger" onclick="rejectVolunteer()">âŒ æ‹’çµ•</button>
    </div>
  </div>

  <!-- æ–°å¢ææ¬¾ Modal -->
  <div id="donationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">æ–°å¢ææ¬¾è¨˜éŒ„</div>
        <span class="modal-close" onclick="closeModal('donationModal')">&times;</span>
      </div>
      <div class="form-group">
        <label class="form-label">ææ¬¾äººå§“å</label>
        <input type="text" id="donorName" class="form-input" placeholder="åŒ¿åææ¬¾å¯ç•™ç©º">
      </div>
      <div class="form-group">
        <label class="form-label">ææ¬¾é‡‘é¡ *</label>
        <input type="number" id="donationAmount" class="form-input" min="1">
      </div>
      <div class="form-group">
        <label class="form-label">ææ¬¾æ—¥æœŸ *</label>
        <input type="date" id="donationDate" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">èªªæ˜</label>
        <textarea id="donationDescription" class="form-textarea" rows="2"></textarea>
      </div>
      <button class="btn btn-primary" onclick="saveDonation()">ğŸ’¾ å„²å­˜</button>
    </div>
  </div>

  <!-- æ–°å¢æ”¯å‡º Modal -->
  <div id="expenseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">æ–°å¢æ”¯å‡ºè¨˜éŒ„</div>
        <span class="modal-close" onclick="closeModal('expenseModal')">&times;</span>
      </div>
      <div class="form-group">
        <label class="form-label">æ”¯å‡ºé¡åˆ¥ *</label>
        <select id="expenseCategory" class="form-select">
          <option value="æ´»å‹•è²»ç”¨">æ´»å‹•è²»ç”¨</option>
          <option value="å ´åœ°ç§Ÿé‡‘">å ´åœ°ç§Ÿé‡‘</option>
          <option value="è¨­å‚™æ¡è³¼">è¨­å‚™æ¡è³¼</option>
          <option value="è¡Œæ”¿è²»ç”¨">è¡Œæ”¿è²»ç”¨</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">æ”¯ä»˜å°è±¡ *</label>
        <input type="text" id="expensePayee" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">æ”¯å‡ºé‡‘é¡ *</label>
        <input type="number" id="expenseAmount" class="form-input" min="1">
      </div>
      <div class="form-group">
        <label class="form-label">æ”¯å‡ºæ—¥æœŸ *</label>
        <input type="date" id="expenseDate" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">èªªæ˜</label>
        <textarea id="expenseDescription" class="form-textarea" rows="2"></textarea>
      </div>
      <button class="btn btn-primary" onclick="saveExpense()">ğŸ’¾ å„²å­˜</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxabz6vmzwklRir1aTOO3jCVe9LmLARa2hioKJpekaTFr0ppjxmVW3-5CJWyIFeBgckXw/exec'; // è«‹æ›¿æ›ç‚ºæ‚¨çš„ GAS Web App URL
    let currentEditActivityId = null;
    let currentReviewRecordId = null;

    // é é¢åˆ‡æ›
    function showPage(pageName) {
      document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('.page-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(pageName).classList.add('active');
      
      // è¼‰å…¥å°æ‡‰è³‡æ–™
      switch(pageName) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'members':
          loadMembers();
          break;
        case 'activities':
          loadActivities();
          break;
        case 'registrations':
          loadActivityFilter();
          loadRegistrations();
          break;
        case 'volunteers':
          loadPendingVolunteers();
          break;
        case 'finances':
          loadFinances();
          break;
        case 'statistics':
          loadStatistics();
          break;
        case 'settings':
          loadSettings();
          break;
      }
    }

    // è¼‰å…¥å„€è¡¨æ¿
    async function loadDashboard() {
      try {
        const response = await fetch(`${API_URL}?action=getDashboardStats`);
        const data = await response.json();
        
        document.getElementById('totalMembers').textContent = data.totalMembers;
        document.getElementById('totalActivities').textContent = data.totalActivities;
        document.getElementById('totalVolunteerHours').textContent = data.totalVolunteerHours;
        document.getElementById('balance').textContent = `NT$ ${data.balance.toLocaleString()}`;
        
        // æœƒå“¡é¡å‹åœ–è¡¨
        renderPieChart('memberTypeChart', data.memberTypes, 'æœƒå“¡é¡å‹åˆ†å¸ƒ');
        
        // æ´»å‹•ç‹€æ…‹åœ–è¡¨
        renderPieChart('activityStatusChart', data.activityStatus, 'æ´»å‹•ç‹€æ…‹');
        
        // æœ€è¿‘æ´»å‹•
        const container = document.getElementById('recentActivities');
        if (data.recentActivities.length === 0) {
          container.innerHTML = '<p style="color: #999;">æš«ç„¡æ´»å‹•</p>';
        } else {
          container.innerHTML = `
            <table>
              <thead>
                <tr>
                  <th>æ´»å‹•åç¨±</th>
                  <th>æ—¥æœŸ</th>
                  <th>å ±åäººæ•¸</th>
                  <th>ç‹€æ…‹</th>
                </tr>
              </thead>
              <tbody>
                ${data.recentActivities.map(a => `
                  <tr>
                    <td>${a.name}</td>
                    <td>${a.date}</td>
                    <td>${a.registrationCount}/${a.maxParticipants || 'ä¸é™'}</td>
                    <td><span class="badge badge-info">${a.status}</span></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }
      } catch (error) {
        console.error('è¼‰å…¥å„€è¡¨æ¿å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥æœƒå“¡åˆ—è¡¨
    async function loadMembers() {
      try {
        const response = await fetch(`${API_URL}?action=getAllMembers`);
        const members = await response.json();
        
        const tbody = document.getElementById('membersTable');
        tbody.innerHTML = members.map(m => `
          <tr>
            <td>${m.name}</td>
            <td>${m.phone}</td>
            <td>${m.email || '-'}</td>
            <td>${m.memberType}</td>
            <td>
              <select class="form-select" onchange="updateMemberRole('${m.memberId}', this.value)" style="width: 120px;">
                <option value="member" ${m.role === 'member' ? 'selected' : ''}>æœƒå“¡</option>
                <option value="volunteer" ${m.role === 'volunteer' ? 'selected' : ''}>å¿—å·¥</option>
                <option value="admin" ${m.role === 'admin' ? 'selected' : ''}>ç®¡ç†å“¡</option>
              </select>
            </td>
            <td>
              <select class="form-select" onchange="updateMemberStatus('${m.memberId}', this.value)" style="width: 100px;">
                <option value="æ­£å¸¸" ${m.status === 'æ­£å¸¸' ? 'selected' : ''}>æ­£å¸¸</option>
                <option value="åœæ¬Š" ${m.status === 'åœæ¬Š' ? 'selected' : ''}>åœæ¬Š</option>
              </select>
            </td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="viewMemberDetail('${m.memberId}')">è©³æƒ…</button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('è¼‰å…¥æœƒå“¡å¤±æ•—:', error);
      }
    }

    // æœå°‹æœƒå“¡
    function searchMembers() {
      const keyword = document.getElementById('memberSearch').value.toLowerCase();
      const rows = document.querySelectorAll('#membersTable tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(keyword) ? '' : 'none';
      });
    }

    // æ›´æ–°æœƒå“¡è§’è‰²
    async function updateMemberRole(memberId, role) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'updateMemberStatus',
            memberId: memberId,
            role: role
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('æ›´æ–°æˆåŠŸï¼');
        }
      } catch (error) {
        console.error('æ›´æ–°å¤±æ•—:', error);
      }
    }

    // æ›´æ–°æœƒå“¡ç‹€æ…‹
    async function updateMemberStatus(memberId, status) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'updateMemberStatus',
            memberId: memberId,
            status: status
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('æ›´æ–°æˆåŠŸï¼');
        }
      } catch (error) {
        console.error('æ›´æ–°å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥æ´»å‹•åˆ—è¡¨
    async function loadActivities() {
      try {
        const response = await fetch(`${API_URL}?action=getActivities`);
        const activities = await response.json();
        
        const tbody = document.getElementById('activitiesTable');
        tbody.innerHTML = activities.map(a => `
          <tr>
            <td>${a.name}</td>
            <td>${a.type}</td>
            <td>${a.date}</td>
            <td>${a.location}</td>
            <td>${a.registrationCount}/${a.maxParticipants || 'ä¸é™'}</td>
            <td><span class="badge badge-info">${a.status}</span></td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="editActivity('${a.activityId}')">ç·¨è¼¯</button>
              <button class="btn btn-danger btn-sm" onclick="deleteActivity('${a.activityId}')">åˆªé™¤</button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('è¼‰å…¥æ´»å‹•å¤±æ•—:', error);
      }
    }

    // é¡¯ç¤ºæ–°å¢æ´»å‹•
    function showCreateActivity() {
      currentEditActivityId = null;
      document.getElementById('activityModalTitle').textContent = 'æ–°å¢æ´»å‹•';
      document.getElementById('activityName').value = '';
      document.getElementById('activityType').value = 'è¬›åº§';
      document.getElementById('activityDate').value = '';
      document.getElementById('activityStartTime').value = '';
      document.getElementById('activityEndTime').value = '';
      document.getElementById('activityLocation').value = '';
      document.getElementById('activityMaxParticipants').value = '0';
      document.getElementById('activityFee').value = '0';
      document.getElementById('activityDeadline').value = '';
      document.getElementById('activityDescription').value = '';
      document.getElementById('activityNotes').value = '';
      openModal('activityModal');
    }

    // å„²å­˜æ´»å‹•
    async function saveActivity() {
      const data = {
        action: currentEditActivityId ? 'updateActivity' : 'createActivity',
        name: document.getElementById('activityName').value,
        type: document.getElementById('activityType').value,
        date: document.getElementById('activityDate').value,
        startTime: document.getElementById('activityStartTime').value,
        endTime: document.getElementById('activityEndTime').value,
        location: document.getElementById('activityLocation').value,
        maxParticipants: parseInt(document.getElementById('activityMaxParticipants').value),
        fee: parseFloat(document.getElementById('activityFee').value),
        registrationDeadline: document.getElementById('activityDeadline').value,
        description: document.getElementById('activityDescription').value,
        notes: document.getElementById('activityNotes').value
      };
      
      if (currentEditActivityId) {
        data.activityId = currentEditActivityId;
      }
      
      if (!data.name || !data.date || !data.startTime || !data.endTime || !data.location || !data.registrationDeadline) {
        alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
        return;
      }
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        if (result.success) {
          alert('å„²å­˜æˆåŠŸï¼');
          closeModal('activityModal');
          loadActivities();
        }
      } catch (error) {
        console.error('å„²å­˜å¤±æ•—:', error);
        alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }

    // åˆªé™¤æ´»å‹•
    async function deleteActivity(activityId) {
      if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ´»å‹•å—ï¼Ÿ')) return;
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'deleteActivity',
            activityId: activityId
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('åˆªé™¤æˆåŠŸï¼');
          loadActivities();
        }
      } catch (error) {
        console.error('åˆªé™¤å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥æ´»å‹•ç¯©é¸å™¨
    async function loadActivityFilter() {
      try {
        const response = await fetch(`${API_URL}?action=getActivities`);
        const activities = await response.json();
        
        const select = document.getElementById('activityFilter');
        select.innerHTML = '<option value="">å…¨éƒ¨æ´»å‹•</option>' +
          activities.map(a => `<option value="${a.activityId}">${a.name}</option>`).join('');
      } catch (error) {
        console.error('è¼‰å…¥æ´»å‹•ç¯©é¸å™¨å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥å ±åè¨˜éŒ„
    async function loadRegistrations() {
      const activityId = document.getElementById('activityFilter').value;
      
      try {
        const response = await fetch(`${API_URL}?action=getAllRegistrations&activityId=${activityId}`);
        const registrations = await response.json();
        
        const tbody = document.getElementById('registrationsTable');
        if (registrations.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">æš«ç„¡å ±åè¨˜éŒ„</td></tr>';
          return;
        }
        
        tbody.innerHTML = registrations.map(r => `
          <tr>
            <td>${r.activityId}</td>
            <td>${r.memberName}</td>
            <td>${new Date(r.registeredAt).toLocaleString()}</td>
            <td><span class="badge ${r.checkInStatus === 'å·²ç°½åˆ°' ? 'badge-success' : 'badge-warning'}">${r.checkInStatus}</span></td>
            <td>
              ${r.checkInStatus === 'æœªç°½åˆ°' ? `<button class="btn btn-success btn-sm" onclick="checkIn('${r.registrationId}')">ç°½åˆ°</button>` : ''}
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('è¼‰å…¥å ±åè¨˜éŒ„å¤±æ•—:', error);
      }
    }

    // ç°½åˆ°
    async function checkIn(registrationId) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'checkIn',
            registrationId: registrationId
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('ç°½åˆ°æˆåŠŸï¼');
          loadRegistrations();
        }
      } catch (error) {
        console.error('ç°½åˆ°å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥å¾…å¯©æ ¸å¿—å·¥
    async function loadPendingVolunteers() {
      try {
        const response = await fetch(`${API_URL}?action=getPendingVolunteers`);
        const pending = await response.json();
        
        document.getElementById('pendingCount').textContent = `å¾…å¯©æ ¸: ${pending.length}`;
        
        const tbody = document.getElementById('pendingVolunteers');
        if (pending.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">æš«ç„¡å¾…å¯©æ ¸è¨˜éŒ„</td></tr>';
          return;
        }
        
        tbody.innerHTML = pending.map(v => `
          <tr>
            <td>${v.memberName}</td>
            <td>${v.serviceDate}</td>
            <td>${v.hours} å°æ™‚</td>
            <td>${v.description}</td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="showReviewVolunteer('${v.recordId}', '${v.memberName}', '${v.serviceDate}', ${v.hours}, '${v.description}')">å¯©æ ¸</button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('è¼‰å…¥å¾…å¯©æ ¸å¿—å·¥å¤±æ•—:', error);
      }
    }

    // é¡¯ç¤ºå¯©æ ¸å¿—å·¥
    function showReviewVolunteer(recordId, name, date, hours, description) {
      currentReviewRecordId = recordId;
      document.getElementById('reviewVolunteerContent').innerHTML = `
        <div class="info-row">
          <span class="info-label">æœƒå“¡å§“å</span>
          <span class="info-value">${name}</span>
        </div>
        <div class="info-row">
          <span class="info-label">æœå‹™æ—¥æœŸ</span>
          <span class="info-value">${date}</span>
        </div>
        <div class="info-row">
          <span class="info-label">æœå‹™æ™‚æ•¸</span>
          <span class="info-value">${hours} å°æ™‚</span>
        </div>
        <div class="info-row">
          <span class="info-label">æœå‹™èªªæ˜</span>
          <span class="info-value">${description}</span>
        </div>
      `;
      document.getElementById('reviewNote').value = '';
      openModal('reviewVolunteerModal');
    }

    // é€šéå¿—å·¥å¯©æ ¸
    async function approveVolunteer() {
      await reviewVolunteer('å·²é€šé');
    }

    // æ‹’çµ•å¿—å·¥å¯©æ ¸
    async function rejectVolunteer() {
      const note = document.getElementById('reviewNote').value;
      if (!note) {
        alert('è«‹å¡«å¯«æ‹’çµ•åŸå› ');
        return;
      }
      await reviewVolunteer('å·²æ‹’çµ•');
    }

    // å¯©æ ¸å¿—å·¥
    async function reviewVolunteer(status) {
      const note = document.getElementById('reviewNote').value;
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'reviewVolunteer',
            recordId: currentReviewRecordId,
            status: status,
            reviewNote: note
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('å¯©æ ¸å®Œæˆï¼');
          closeModal('reviewVolunteerModal');
          loadPendingVolunteers();
        }
      } catch (error) {
        console.error('å¯©æ ¸å¤±æ•—:', error);
        alert('å¯©æ ¸å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }

    // è¼‰å…¥è²¡å‹™è³‡æ–™
    async function loadFinances() {
      try {
        const response = await fetch(`${API_URL}?action=getFinancialOverview`);
        const data = await response.json();
        
        document.getElementById('totalIncome').textContent = `NT$ ${data.totalIncome.toLocaleString()}`;
        document.getElementById('totalExpense').textContent = `NT$ ${data.totalExpense.toLocaleString()}`;
        document.getElementById('financialBalance').textContent = `NT$ ${data.balance.toLocaleString()}`;
        
        // ææ¬¾è¨˜éŒ„
        const donationsTable = document.getElementById('donationsTable');
        if (data.incomeRecords.length === 0) {
          donationsTable.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #999;">æš«ç„¡ææ¬¾è¨˜éŒ„</td></tr>';
        } else {
          donationsTable.innerHTML = data.incomeRecords.map(r => `
            <tr>
              <td>${r.date}</td>
              <td>${r.name || 'åŒ¿å'}</td>
              <td>NT$ ${parseFloat(r.amount).toLocaleString()}</td>
              <td>${r.description || '-'}</td>
            </tr>
          `).join('');
        }
        
        // æ”¯å‡ºè¨˜éŒ„
        const expensesTable = document.getElementById('expensesTable');
        if (data.expenseRecords.length === 0) {
          expensesTable.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">æš«ç„¡æ”¯å‡ºè¨˜éŒ„</td></tr>';
        } else {
          expensesTable.innerHTML = data.expenseRecords.map(r => `
            <tr>
              <td>${r.date}</td>
              <td>${r.category}</td>
              <td>${r.name}</td>
              <td>NT$ ${parseFloat(r.amount).toLocaleString()}</td>
              <td>${r.description || '-'}</td>
              <td><span class="badge badge-info">${r.status}</span></td>
              <td>
                <button class="btn btn-danger btn-sm" onclick="deleteExpense('${r.recordId}')">åˆªé™¤</button>
              </td>
            </tr>
          `).join('');
        }
      } catch (error) {
        console.error('è¼‰å…¥è²¡å‹™è³‡æ–™å¤±æ•—:', error);
      }
    }

    // é¡¯ç¤ºæ–°å¢ææ¬¾
    function showAddDonation() {
      document.getElementById('donorName').value = '';
      document.getElementById('donationAmount').value = '';
      document.getElementById('donationDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('donationDescription').value = '';
      openModal('donationModal');
    }

    // å„²å­˜ææ¬¾
    async function saveDonation() {
      const name = document.getElementById('donorName').value || 'åŒ¿å';
      const amount = document.getElementById('donationAmount').value;
      const date = document.getElementById('donationDate').value;
      const description = document.getElementById('donationDescription').value;
      
      if (!amount || !date) {
        alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½');
        return;
      }
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'addIncome',
            category: 'ææ¬¾',
            amount: parseFloat(amount),
            name: name,
            description: description,
            date: date
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('æ–°å¢æˆåŠŸï¼');
          closeModal('donationModal');
          loadFinances();
        }
      } catch (error) {
        console.error('æ–°å¢å¤±æ•—:', error);
        alert('æ–°å¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }

    // é¡¯ç¤ºæ–°å¢æ”¯å‡º
    function showAddExpense() {
      document.getElementById('expenseCategory').value = 'æ´»å‹•è²»ç”¨';
      document.getElementById('expensePayee').value = '';
      document.getElementById('expenseAmount').value = '';
      document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('expenseDescription').value = '';
      openModal('expenseModal');
    }

    // å„²å­˜æ”¯å‡º
    async function saveExpense() {
      const category = document.getElementById('expenseCategory').value;
      const payee = document.getElementById('expensePayee').value;
      const amount = document.getElementById('expenseAmount').value;
      const date = document.getElementById('expenseDate').value;
      const description = document.getElementById('expenseDescription').value;
      
      if (!category || !payee || !amount || !date) {
        alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½');
        return;
      }
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'addExpense',
            category: category,
            amount: parseFloat(amount),
            name: payee,
            description: description,
            date: date
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('æ–°å¢æˆåŠŸï¼');
          closeModal('expenseModal');
          loadFinances();
        }
      } catch (error) {
        console.error('æ–°å¢å¤±æ•—:', error);
        alert('æ–°å¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }

    // åˆªé™¤æ”¯å‡º
    async function deleteExpense(recordId) {
      if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ”¯å‡ºè¨˜éŒ„å—ï¼Ÿ')) return;
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'deleteFinanceRecord',
            recordId: recordId
          })
        });
        
        const result = await response.json();
        if (result.success) {
          alert('åˆªé™¤æˆåŠŸï¼');
          loadFinances();
        }
      } catch (error) {
        console.error('åˆªé™¤å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥çµ±è¨ˆå ±è¡¨
    async function loadStatistics() {
      try {
        const response = await fetch(`${API_URL}?action=getMonthlyStats`);
        const data = await response.json();
        
        // æœˆåº¦æ´»å‹•çµ±è¨ˆ
        renderLineChart('monthlyActivityChart', data.monthlyActivities, 'æ´»å‹•æ•¸é‡');
        
        // æœƒå“¡æˆé•·è¶¨å‹¢
        renderLineChart('memberGrowthChart', data.monthlyMembers, 'æ–°å¢æœƒå“¡');
        
        // å¿—å·¥æœå‹™çµ±è¨ˆ
        renderLineChart('volunteerStatsChart', data.monthlyVolunteerHours, 'æœå‹™æ™‚æ•¸');
        
        // è²¡å‹™æ”¶æ”¯çµ±è¨ˆ
        renderFinancialChart('financialStatsChart', data.monthlyIncome, data.monthlyExpense);
        
      } catch (error) {
        console.error('è¼‰å…¥çµ±è¨ˆå ±è¡¨å¤±æ•—:', error);
      }
    }

    // è¼‰å…¥ç³»çµ±è¨­å®š
    async function loadSettings() {
      try {
        const response = await fetch(`${API_URL}?action=getSettings`);
        const settings = await response.json();
        
        document.getElementById('orgName').value = settings['çµ„ç¹”åç¨±'] || '';
        document.getElementById('orgPhone').value = settings['è¯çµ¡é›»è©±'] || '';
        document.getElementById('orgEmail').value = settings['Email'] || '';
        document.getElementById('orgAddress').value = settings['åœ°å€'] || '';
      } catch (error) {
        console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
      }
    }

    // å„²å­˜ç³»çµ±è¨­å®š
    async function saveSettings() {
      const data = {
        action: 'updateSettings',
        orgName: document.getElementById('orgName').value,
        phone: document.getElementById('orgPhone').value,
        email: document.getElementById('orgEmail').value,
        address: document.getElementById('orgAddress').value
      };
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        if (result.success) {
          alert('å„²å­˜æˆåŠŸï¼');
        }
      } catch (error) {
        console.error('å„²å­˜å¤±æ•—:', error);
        alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }

    // å‚™ä»½è³‡æ–™
    async function backupData() {
      try {
        const response = await fetch(`${API_URL}?action=backupData`);
        const data = await response.json();
        
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        alert('å‚™ä»½å®Œæˆï¼');
      } catch (error) {
        console.error('å‚™ä»½å¤±æ•—:', error);
        alert('å‚™ä»½å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      }
    }

    // Modal æ§åˆ¶
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    // åœ–è¡¨ç¹ªè£½å‡½æ•¸
    function renderPieChart(canvasId, data, label) {
      const ctx = document.getElementById(canvasId);
      if (ctx.chart) ctx.chart.destroy();
      
      const labels = Object.keys(data);
      const values = Object.values(data);
      
      ctx.chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: values,
            backgroundColor: [
              '#667eea',
              '#764ba2',
              '#f093fb',
              '#4facfe',
              '#43e97b',
              '#fa709a'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function renderLineChart(canvasId, data, label) {
      const ctx = document.getElementById(canvasId);
      if (ctx.chart) ctx.chart.destroy();
      
      const labels = Object.keys(data).sort();
      const values = labels.map(l => data[l]);
      
      ctx.chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: values,
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    function renderFinancialChart(canvasId, income, expense) {
      const ctx = document.getElementById(canvasId);
      if (ctx.chart) ctx.chart.destroy();
      
      const labels = [...new Set([...Object.keys(income), ...Object.keys(expense)])].sort();
      const incomeData = labels.map(l => income[l] || 0);
      const expenseData = labels.map(l => expense[l] || 0);
      
      ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'æ”¶å…¥',
              data: incomeData,
              backgroundColor: '#43e97b'
            },
            {
              label: 'æ”¯å‡º',
              data: expenseData,
              backgroundColor: '#fa709a'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    // åˆå§‹åŒ–
    window.onload = () => {
      loadDashboard();
    };
  </script>
</body>
</html>

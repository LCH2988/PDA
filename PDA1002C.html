<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸•é‡‘æ£®äººå“¡ç®¡ç†ç³»çµ±</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Microsoft JhengHei', Arial, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 20px;
      }

      .container {
          background: white;
          border-radius: 20px;
          box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          max-width: 450px;
          width: 100%;
          overflow: hidden;
      }

      .header {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 30px;
          text-align: center;
      }

      .header h1 {
          font-size: 24px;
          margin-bottom: 10px;
      }

      .header p {
          font-size: 14px;
          opacity: 0.9;
      }

      .content {
          padding: 30px;
      }

      .page {
          display: none;
      }

      .page.active {
          display: block;
      }

      .form-group {
          margin-bottom: 20px;
      }

      .form-group label {
          display: block;
          margin-bottom: 8px;
          color: #333;
          font-weight: 600;
          font-size: 14px;
      }

      .form-group input, .form-group textarea {
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e0e0e0;
          border-radius: 10px;
          font-size: 14px;
          transition: border-color 0.3s;
          font-family: inherit;
      }

      .form-group textarea {
          min-height: 100px;
          resize: vertical;
      }

      .form-group input:focus, .form-group textarea:focus {
          outline: none;
          border-color: #667eea;
      }

      .btn {
          width: 100%;
          padding: 14px;
          border: none;
          border-radius: 10px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
          margin-bottom: 10px;
      }

      .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
      }

      .btn-line {
          background: #06C755;
          color: white;
      }

      .btn-line:hover:not(:disabled) {
          background: #05b34c;
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(6, 199, 85, 0.3);
      }

      .btn-primary {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
      }

      .btn-primary:hover:not(:disabled) {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
          background: white;
          color: #667eea;
          border: 2px solid #667eea;
      }

      .btn-secondary:hover {
          background: #f5f7ff;
      }

      .divider {
          text-align: center;
          margin: 25px 0;
          position: relative;
      }

      .divider::before {
          content: '';
          position: absolute;
          left: 0;
          top: 50%;
          width: 100%;
          height: 1px;
          background: #e0e0e0;
      }

      .divider span {
          background: white;
          padding: 0 15px;
          position: relative;
          color: #999;
          font-size: 14px;
      }

      .link-text {
          text-align: center;
          margin-top: 15px;
          color: #667eea;
          cursor: pointer;
          font-size: 14px;
      }

      .link-text:hover {
          text-decoration: underline;
      }

      .user-info {
          background: #f5f7ff;
          padding: 15px;
          border-radius: 10px;
          margin-bottom: 20px;
      }

      .user-info p {
          margin: 5px 0;
          color: #333;
          font-size: 14px;
      }

      .dashboard {
          display: grid;
          gap: 15px;
      }

      .dashboard-card {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 20px;
          border-radius: 10px;
          cursor: pointer;
          transition: transform 0.3s;
      }

      .dashboard-card:hover {
          transform: translateY(-5px);
      }

      .dashboard-card h3 {
          font-size: 18px;
          margin-bottom: 5px;
      }

      .dashboard-card p {
          font-size: 14px;
          opacity: 0.9;
      }

      .success-message {
          background: #d4edda;
          color: #155724;
          padding: 12px;
          border-radius: 10px;
          margin-bottom: 15px;
          text-align: center;
          animation: slideDown 0.3s ease;
      }

      .error-message {
          background: #f8d7da;
          color: #721c24;
          padding: 12px;
          border-radius: 10px;
          margin-bottom: 15px;
          text-align: center;
          animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
          from {
              opacity: 0;
              transform: translateY(-10px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      .loading {
          text-align: center;
          padding: 20px;
          color: #667eea;
      }

      .activity-item {
          background: #f9f9f9;
          padding: 15px;
          border-radius: 10px;
          margin-bottom: 15px;
          border-left: 4px solid #667eea;
      }

      .activity-item h4 {
          color: #333;
          margin-bottom: 8px;
      }

      .activity-item p {
          color: #666;
          font-size: 14px;
          margin: 5px 0;
      }

      .activity-item .date {
          color: #999;
          font-size: 12px;
          margin-top: 10px;
      }

      .back-btn {
          background: #f0f0f0;
          color: #333;
          padding: 10px 20px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          margin-bottom: 20px;
          font-size: 14px;
      }

      .back-btn:hover {
          background: #e0e0e0;
      }

      .config-warning {
          background: #fff3cd;
          color: #856404;
          padding: 15px;
          border-radius: 10px;
          margin-bottom: 20px;
          border-left: 4px solid #ffc107;
      }

      .config-warning strong {
          display: block;
          margin-bottom: 5px;
      }
  </style>
</head>
<body>
  <div class="container">
      <div class="header">
          <h1>ğŸŒŸ å¸•é‡‘æ£®äººå“¡ç®¡ç†ç³»çµ±</h1>
          <p>é—œæ‡·èˆ‡æ”¯æŒçš„ç¤¾ç¾¤å¹³å°</p>
      </div>

      <div class="content">
          <!-- ç™»å…¥é é¢ -->
          <div id="loginPage" class="page active">
              <h2 style="margin-bottom: 20px; color: #333;">æ­¡è¿ç™»å…¥</h2>
              
              <div id="configWarning" class="config-warning" style="display: none;">
                  <strong>âš ï¸ å°šæœªè¨­å®š API</strong>
                  è«‹åœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®šæ‚¨çš„ Google Apps Script URL
              </div>
              
              <button class="btn btn-line" onclick="lineLogin()" id="lineLoginBtn">
                  <span style="font-size: 20px;">ğŸ“±</span> ä½¿ç”¨ LINE ç™»å…¥
              </button>

              <div class="divider">
                  <span>æˆ–</span>
              </div>

              <div class="form-group">
                  <label>é›»è©±è™Ÿç¢¼</label>
                  <input type="tel" id="loginPhone" placeholder="è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼">
              </div>

              <div class="form-group">
                  <label>å¯†ç¢¼</label>
                  <input type="password" id="loginPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" onkeypress="if(event.key==='Enter') normalLogin()">
              </div>

              <button class="btn btn-primary" onclick="normalLogin()" id="loginBtn">ç™»å…¥</button>

              <div class="link-text" onclick="showPage('registerPage')">
                  é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿç«‹å³è¨»å†Š
              </div>
          </div>

          <!-- LINE é¦–æ¬¡ç™»å…¥ - å¯¦ååˆ¶ -->
          <div id="lineRegisterPage" class="page">
              <h2 style="margin-bottom: 20px; color: #333;">å®Œæˆè¨»å†Š</h2>
              
              <div class="user-info">
                  <p><strong>LINE ID:</strong> <span id="displayLineId">-</span></p>
                  <p><strong>LINE åç¨±:</strong> <span id="displayLineName">-</span></p>
              </div>

              <div class="form-group">
                  <label>çœŸå¯¦å§“å *</label>
                  <input type="text" id="realName" placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å">
              </div>

              <button class="btn btn-primary" onclick="completeLineRegister()" id="lineRegBtn">å®Œæˆè¨»å†Š</button>
          </div>

          <!-- ä¸€èˆ¬è¨»å†Šé é¢ -->
          <div id="registerPage" class="page">
              <h2 style="margin-bottom: 20px; color: #333;">è¨»å†Šå¸³è™Ÿ</h2>

              <div class="form-group">
                  <label>çœŸå¯¦å§“å *</label>
                  <input type="text" id="regName" placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å">
              </div>

              <div class="form-group">
                  <label>é›»è©±è™Ÿç¢¼ *</label>
                  <input type="tel" id="regPhone" placeholder="è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼">
              </div>

              <div class="form-group">
                  <label>å¯†ç¢¼ *</label>
                  <input type="password" id="regPassword" placeholder="è«‹è¨­å®šå¯†ç¢¼ï¼ˆè‡³å°‘6ä½ï¼‰">
              </div>

              <div class="form-group">
                  <label>ç¢ºèªå¯†ç¢¼ *</label>
                  <input type="password" id="regPasswordConfirm" placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼">
              </div>

              <button class="btn btn-primary" onclick="register()" id="registerBtn">è¨»å†Š</button>
              <button class="btn btn-secondary" onclick="showPage('loginPage')">è¿”å›ç™»å…¥</button>
          </div>

          <!-- ä¸»é é¢ -->
          <div id="dashboardPage" class="page">
              <div class="user-info">
                  <p><strong>æ­¡è¿å›ä¾†ï¼</strong></p>
                  <p><strong>å§“å:</strong> <span id="userName">-</span></p>
                  <p><strong>å¸³è™Ÿé¡å‹:</strong> <span id="userType">-</span></p>
              </div>

              <div class="dashboard">
                  <div class="dashboard-card" onclick="showActivities()">
                      <h3>ğŸ“¢ æ´»å‹•å…¬å‘Š</h3>
                      <p>æŸ¥çœ‹æœ€æ–°æ´»å‹•èˆ‡é‡è¦é€šçŸ¥</p>
                  </div>

                  <div class="dashboard-card" onclick="showVolunteerPage()">
                      <h3>ğŸ¤ å¿—å·¥åœ˜éšŠç™»è¨˜</h3>
                      <p>åŠ å…¥å¿—å·¥è¡Œåˆ—ï¼Œè²¢ç»æ‚¨çš„åŠ›é‡</p>
                  </div>

                  <div class="dashboard-card" onclick="showProfile()">
                      <h3>ğŸ‘¤ å€‹äººè³‡æ–™</h3>
                      <p>ç®¡ç†æ‚¨çš„å€‹äººè³‡è¨Š</p>
                  </div>
              </div>

              <button class="btn btn-secondary" onclick="logout()" style="margin-top: 20px;">ç™»å‡º</button>
          </div>

          <!-- æ´»å‹•å…¬å‘Šé é¢ -->
          <div id="activitiesPage" class="page">
              <button class="back-btn" onclick="showPage('dashboardPage')">â† è¿”å›</button>
              <h2 style="margin-bottom: 20px; color: #333;">ğŸ“¢ æ´»å‹•å…¬å‘Š</h2>
              <div id="activitiesList">
                  <div class="loading">è¼‰å…¥ä¸­...</div>
              </div>
          </div>

          <!-- å¿—å·¥ç™»è¨˜é é¢ -->
          <div id="volunteerPage" class="page">
              <button class="back-btn" onclick="showPage('dashboardPage')">â† è¿”å›</button>
              <h2 style="margin-bottom: 20px; color: #333;">ğŸ¤ å¿—å·¥åœ˜éšŠç™»è¨˜</h2>
              
              <div class="form-group">
                  <label>æ´»å‹•åç¨± *</label>
                  <input type="text" id="volunteerActivity" placeholder="è«‹è¼¸å…¥è¦åƒåŠ çš„æ´»å‹•åç¨±">
              </div>

              <div class="form-group">
                  <label>å‚™è¨»</label>
                  <textarea id="volunteerNote" placeholder="å…¶ä»–èªªæ˜ï¼ˆé¸å¡«ï¼‰"></textarea>
              </div>

              <button class="btn btn-primary" onclick="submitVolunteer()" id="volunteerBtn">æäº¤ç™»è¨˜</button>
          </div>

          <!-- å€‹äººè³‡æ–™é é¢ -->
          <div id="profilePage" class="page">
              <button class="back-btn" onclick="showPage('dashboardPage')">â† è¿”å›</button>
              <h2 style="margin-bottom: 20px; color: #333;">ğŸ‘¤ å€‹äººè³‡æ–™</h2>
              
              <div class="user-info">
                  <p><strong>å§“å:</strong> <span id="profileName">-</span></p>
                  <p><strong>é›»è©±:</strong> <span id="profilePhone">-</span></p>
                  <p><strong>LINE ID:</strong> <span id="profileLineId">-</span></p>
                  <p><strong>å¸³è™Ÿé¡å‹:</strong> <span id="profileType">-</span></p>
                  <p><strong>è¨»å†Šæ™‚é–“:</strong> <span id="profileCreated">-</span></p>
              </div>
          </div>
      </div>
  </div>

  <script>
      // ========== ğŸ”§ é…ç½®å€ï¼ˆè«‹åœ¨æ­¤è¨­å®šæ‚¨çš„ API URLï¼‰==========
      const API_URL = 'https://script.google.com/macros/s/AKfycbx19Qknr2V07NPULBRJrEMjKZlMc3wXYZXtaCzx5AsCnnN6YPcXBS2yY_MRiEr_kCrL/exec'; // âš ï¸ è«‹æ›¿æ›ç‚ºæ‚¨çš„ Apps Script URL
      const LIFF_ID = '1656516134-VaGgmaPm'; // å¦‚æœä½¿ç”¨ LINE ç™»å…¥ï¼Œè«‹å¡«å…¥ LIFF ID
      
      // ========== å…¨åŸŸè®Šæ•¸ ==========
      let currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
      let lineUserData = null;

      // ========== æª¢æŸ¥ API é…ç½® ==========
      window.onload = function() {
          if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
              document.getElementById('configWarning').style.display = 'block';
          }
          
          if (currentUser) {
              showDashboard();
          }
      };

      // ========== API å‘¼å«å‡½æ•¸ ==========
      async function callAPI(action, data = {}) {
          if (API_URL === 'https://script.google.com/macros/s/AKfycbxy6dh8yQUnA_eQ1a0NmIi_NPR7XbosVQ1DL0tjeBDUQRn79OE0lGLyqgJKQPjs63P4QA/exec') {
              return { success: false, message: 'è«‹å…ˆè¨­å®š API URL' };
          }

          try {
              const response = await fetch(API_URL, {
                  method: 'POST',
                  mode: 'no-cors',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      action: action,
                      data: data
                  })
              });
              
              // å› ç‚º no-cors æ¨¡å¼ï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥è®€å–å›æ‡‰
              // éœ€è¦ä½¿ç”¨ redirect æ¨¡å¼æˆ–æ”¹ç”¨ JSONP
              // é€™è£¡æˆ‘å€‘æ”¹ç”¨ä¸åŒçš„æ–¹æ³•
              const result = await fetchWithTimeout(API_URL, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'text/plain',
                  },
                  body: JSON.stringify({
                      action: action,
                      data: data
                  })
              });
              
              return result;
          } catch (error) {
              console.error('API å‘¼å«éŒ¯èª¤:', error);
              return { success: false, message: 'ç¶²è·¯é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦' };
          }
      }

      async function fetchWithTimeout(url, options, timeout = 10000) {
          try {
              const response = await fetch(url, options);
              const text = await response.text();
              return JSON.parse(text);
          } catch (error) {
              throw error;
          }
      }

      // ========== é é¢åˆ‡æ› ==========
      function showPage(pageId) {
          document.querySelectorAll('.page').forEach(page => {
              page.classList.remove('active');
          });
          document.getElementById(pageId).classList.add('active');
      }

      // ========== è¨Šæ¯é¡¯ç¤º ==========
      function showMessage(message, type = 'success') {
          // ç§»é™¤èˆŠè¨Šæ¯
          const oldMessages = document.querySelectorAll('.success-message, .error-message');
          oldMessages.forEach(msg => msg.remove());

          const messageDiv = document.createElement('div');
          messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
          messageDiv.textContent = message;
          
          const content = document.querySelector('.content');
          const firstPage = content.querySelector('.page.active');
          firstPage.insertBefore(messageDiv, firstPage.firstChild);
          
          setTimeout(() => messageDiv.remove(), 3000);
      }

      // ========== LINE ç™»å…¥ ==========
      async function lineLogin() {
          const btn = document.getElementById('lineLoginBtn');
          
          if (!LIFF_ID) {
              showMessage('LINE ç™»å…¥åŠŸèƒ½å°šæœªè¨­å®š', 'error');
              return;
          }

          btn.disabled = true;
          btn.textContent = 'è™•ç†ä¸­...';
          
          try {
              await liff.init({ liffId: LIFF_ID });
              
              if (!liff.isLoggedIn()) {
                  liff.login();
                  return;
              }
              
              const profile = await liff.getProfile();
              lineUserData = {
                  lineId: profile.userId,
                  lineName: profile.displayName
              };

              const result = await callAPI('checkLineUser', { lineId: lineUserData.lineId });
              
              if (result.success && result.exists) {
                  currentUser = result.user;
                  sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                  showMessage('ç™»å…¥æˆåŠŸï¼');
                  showDashboard();
              } else {
                  document.getElementById('displayLineId').textContent = lineUserData.lineId;
                  document.getElementById('displayLineName').textContent = lineUserData.lineName;
                  showPage('lineRegisterPage');
              }
          } catch (error) {
              console.error('LINE ç™»å…¥éŒ¯èª¤:', error);
              showMessage('LINE ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              btn.disabled = false;
              btn.innerHTML = '<span style="font-size: 20px;">ğŸ“±</span> ä½¿ç”¨ LINE ç™»å…¥';
          }
      }

      // ========== å®Œæˆ LINE è¨»å†Š ==========
      async function completeLineRegister() {
          const realName = document.getElementById('realName').value.trim();
          const btn = document.getElementById('lineRegBtn');

          if (!realName) {
              showMessage('è«‹è¼¸å…¥çœŸå¯¦å§“å', 'error');
              return;
          }

          btn.disabled = true;
          btn.textContent = 'è™•ç†ä¸­...';

          const result = await callAPI('lineRegister', {
              name: realName,
              lineId: lineUserData.lineId,
              lineName: lineUserData.lineName
          });

          if (result.success) {
              currentUser = result.user;
              sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
              showMessage('è¨»å†ŠæˆåŠŸï¼æ­¡è¿åŠ å…¥');
              showDashboard();
          } else {
              showMessage(result.message, 'error');
              btn.disabled = false;
              btn.textContent = 'å®Œæˆè¨»å†Š';
          }
      }

      // ========== ä¸€èˆ¬è¨»å†Š ==========
      async function register() {
          const name = document.getElementById('regName').value.trim();
          const phone = document.getElementById('regPhone').value.trim();
          const password = document.getElementById('regPassword').value;
          const passwordConfirm = document.getElementById('regPasswordConfirm').value;
          const btn = document.getElementById('registerBtn');

          if (!name || !phone || !password) {
              showMessage('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½', 'error');
              return;
          }

          if (password.length < 6) {
              showMessage('å¯†ç¢¼è‡³å°‘éœ€è¦6ä½', 'error');
              return;
          }

          if (password !== passwordConfirm) {
              showMessage('å…©æ¬¡å¯†ç¢¼è¼¸å…¥ä¸ä¸€è‡´', 'error');
              return;
          }

          btn.disabled = true;
          btn.textContent = 'è™•ç†ä¸­...';

          const result = await callAPI('register', {
              name: name,
              phone: phone,
              password: password
          });

          if (result.success) {
              showMessage('è¨»å†ŠæˆåŠŸï¼è«‹ç™»å…¥');
              showPage('loginPage');
              // æ¸…ç©ºè¡¨å–®
              document.getElementById('regName').value = '';
              document.getElementById('regPhone').value = '';
              document.getElementById('regPassword').value = '';
              document.getElementById('regPasswordConfirm').value = '';
          } else {
              showMessage(result.message, 'error');
          }

          btn.disabled = false;
          btn.textContent = 'è¨»å†Š';
      }

      // ========== ä¸€èˆ¬ç™»å…¥ ==========
      async function normalLogin() {
          const phone = document.getElementById('loginPhone').value.trim();
          const password = document.getElementById('loginPassword').value;
          const btn = document.getElementById('loginBtn');

          if (!phone || !password) {
              showMessage('è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼å’Œå¯†ç¢¼', 'error');
              return;
          }

          btn.disabled = true;
          btn.textContent = 'è™•ç†ä¸­...';

          const result = await callAPI('login', {
              phone: phone,
              password: password
          });

          if (result.success) {
              currentUser = result.user;
              sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
              showMessage('ç™»å…¥æˆåŠŸï¼');
              showDashboard();
          } else {
              showMessage(result.message, 'error');
          }

          btn.disabled = false;
          btn.textContent = 'ç™»å…¥';
      }

      // ========== é¡¯ç¤ºä¸»é é¢ ==========
      function showDashboard() {
          document.getElementById('userName').textContent = currentUser.name;
          document.getElementById('userType').textContent = currentUser.type;
          showPage('dashboardPage');
      }

      // ========== é¡¯ç¤ºæ´»å‹•å…¬å‘Š ==========
      async function showActivities() {
          showPage('activitiesPage');
          
          const listDiv = document.getElementById('activitiesList');
          listDiv.innerHTML = '<div class="loading">è¼‰å…¥ä¸­...</div>';
          
          const result = await callAPI('getActivities');
          
          if (result.success) {
              if (result.activities.length === 0) {
                  listDiv.innerHTML = '<p style="text-align: center; color: #999;">ç›®å‰æ²’æœ‰æ´»å‹•å…¬å‘Š</p>';
              } else {
                  listDiv.innerHTML = result.activities.map(activity => `
                      <div class="activity-item">
                          <h4>${activity.title}</h4>
                          <p>${activity.content}</p>
                          <p class="date">ğŸ“… ${activity.date}</p>
                      </div>
                  `).join('');
              }
          } else {
              listDiv.innerHTML = '<p style="text-align: center; color: #f00;">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';
          }
      }

      // ========== é¡¯ç¤ºå¿—å·¥ç™»è¨˜é é¢ ==========
      function showVolunteerPage() {
          showPage('volunteerPage');
          document.getElementById('volunteerActivity').value = '';
          document.getElementById('volunteerNote').value = '';
      }

      // ========== æäº¤å¿—å·¥ç™»è¨˜ ==========
      async function submitVolunteer() {
          const activity = document.getElementById('volunteerActivity').value.trim();
          const btn = document.getElementById('volunteerBtn');

          if (!activity) {
              showMessage('è«‹è¼¸å…¥æ´»å‹•åç¨±', 'error');
              return;
          }

          btn.disabled = true;
          btn.textContent = 'è™•ç†ä¸­...';

          const result = await callAPI('registerVolunteer', {
              userId: currentUser.id,
              userName: currentUser.name,
              activity: activity
          });

          if (result.success) {
              showMessage('å¿—å·¥ç™»è¨˜æˆåŠŸï¼');
              showPage('dashboardPage');
          } else {
              showMessage(result.message, 'error');
          }

          btn.disabled = false;
          btn.textContent = 'æäº¤ç™»è¨˜';
      }

      // ========== é¡¯ç¤ºå€‹äººè³‡æ–™ ==========
      function showProfile() {
          document.getElementById('profileName').textContent = currentUser.name || '-';
          document.getElementById('profilePhone').textContent = currentUser.phone || '-';
          document.getElementById('profileLineId').textContent = currentUser.lineId || '-';
          document.getElementById('profileType').textContent = currentUser.type || '-';
          document.getElementById('profileCreated').textContent = currentUser.createdAt ? 
              new Date(currentUser.createdAt).toLocaleString('zh-TW') : '-';
          showPage('profilePage');
      }

      // ========== ç™»å‡º ==========
      function logout() {
          if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
              currentUser = null;
              sessionStorage.removeItem('currentUser');
              showMessage('å·²ç™»å‡º');
              showPage('loginPage');
          }
      }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸•é‡‘æ£®å¤šå…ƒåŒ–è«–å£‡ - å°ˆæ¥­ç‰ˆ</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
      :root {
          --primary-color: #4CAF50;
          --secondary-color: #2196F3;
          --accent-color: #FF9800;
          --danger-color: #f44336;
          --success-color: #4CAF50;
          --warning-color: #ff9800;
          --info-color: #2196F3;
          --light-color: #f8f9fa;
          --dark-color: #343a40;
          --border-radius: 12px;
          --box-shadow: 0 4px 20px rgba(0,0,0,0.1);
          --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          line-height: 1.6;
      }

      .loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(255,255,255,0.9);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 9999;
          transition: var(--transition);
      }

      .loading-spinner {
          width: 50px;
          height: 50px;
          border: 4px solid #f3f3f3;
          border-top: 4px solid var(--primary-color);
          border-radius: 50%;
          animation: spin 1s linear infinite;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
      }

      .header {
          background: linear-gradient(135deg, var(--primary-color), #45a049);
          color: white;
          padding: 30px;
          border-radius: var(--border-radius);
          margin-bottom: 20px;
          text-align: center;
          box-shadow: var(--box-shadow);
      }

      .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
          font-weight: 700;
      }

      .header p {
          font-size: 1.2em;
          opacity: 0.9;
      }

      .main-content {
          display: grid;
          grid-template-columns: 250px 1fr;
          gap: 20px;
          background: white;
          border-radius: var(--border-radius);
          box-shadow: var(--box-shadow);
          overflow: hidden;
      }

      .sidebar {
          background: var(--light-color);
          padding: 0;
          border-right: 1px solid #dee2e6;
      }

      .nav-menu {
          list-style: none;
      }

      .nav-item {
          border-bottom: 1px solid #dee2e6;
      }

      .nav-link {
          display: flex;
          align-items: center;
          padding: 15px 20px;
          color: var(--dark-color);
          text-decoration: none;
          transition: var(--transition);
          cursor: pointer;
      }

      .nav-link:hover,
      .nav-link.active {
          background: var(--primary-color);
          color: white;
      }

      .nav-link i {
          margin-right: 10px;
          width: 20px;
      }

      .content-area {
          padding: 30px;
          min-height: 600px;
      }

      .tab-content {
          display: none;
          animation: fadeIn 0.3s ease-in;
      }

      .tab-content.active {
          display: block;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .user-info-card {
          background: linear-gradient(135deg, var(--info-color), #1976D2);
          color: white;
          padding: 20px;
          border-radius: var(--border-radius);
          margin-bottom: 20px;
          display: flex;
          align-items: center;
      }

      .user-avatar {
          width: 60px;
          height: 60px;
          border-radius: 50%;
          background: rgba(255,255,255,0.2);
          display: flex;
          align-items: center;
          justify-content: center;
          margin-right: 15px;
          font-size: 24px;
      }

      .user-details h3 {
          margin-bottom: 5px;
      }

      .user-status {
          display: flex;
          align-items: center;
          font-size: 0.9em;
          opacity: 0.9;
      }

      .status-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: #4CAF50;
          margin-right: 8px;
      }

      .topic-card {
          background: white;
          border: 1px solid #e9ecef;
          border-radius: var(--border-radius);
          padding: 20px;
          margin-bottom: 20px;
          transition: var(--transition);
          position: relative;
          overflow: hidden;
      }

      .topic-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 4px;
          height: 100%;
          background: var(--primary-color);
      }

      .topic-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      }

      .topic-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 15px;
      }

      .topic-title {
          font-size: 1.4em;
          font-weight: 600;
          color: var(--dark-color);
          margin-bottom: 8px;
      }

      .topic-category {
          display: inline-block;
          padding: 4px 12px;
          background: var(--primary-color);
          color: white;
          border-radius: 20px;
          font-size: 0.8em;
          font-weight: 500;
      }

      .topic-meta {
          display: flex;
          align-items: center;
          color: #6c757d;
          font-size: 0.9em;
          margin-bottom: 15px;
          flex-wrap: wrap;
          gap: 15px;
      }

      .meta-item {
          display: flex;
          align-items: center;
      }

      .meta-item i {
          margin-right: 5px;
      }

      .topic-content {
          color: #555;
          line-height: 1.7;
          margin-bottom: 15px;
      }

      .topic-tags {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin-bottom: 15px;
      }

      .tag {
          background: #e9ecef;
          color: #495057;
          padding: 4px 10px;
          border-radius: 15px;
          font-size: 0.8em;
      }

      .topic-actions {
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
      }

      .btn {
          padding: 10px 20px;
          border: none;
          border-radius: 25px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          text-decoration: none;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          transition: var(--transition);
          text-align: center;
      }

      .btn-primary {
          background: var(--primary-color);
          color: white;
      }

      .btn-primary:hover {
          background: #45a049;
          transform: translateY(-1px);
      }

      .btn-secondary {
          background: #6c757d;
          color: white;
      }

      .btn-secondary:hover {
          background: #5a6268;
      }

      .btn-info {
          background: var(--info-color);
          color: white;
      }

      .btn-info:hover {
          background: #1976D2;
      }

      .btn-warning {
          background: var(--warning-color);
          color: white;
      }

      .btn-danger {
          background: var(--danger-color);
          color: white;
      }

      .form-container {
          background: white;
          padding: 30px;
          border-radius: var(--border-radius);
          box-shadow: var(--box-shadow);
      }

      .form-group {
          margin-bottom: 20px;
      }

      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: var(--dark-color);
      }

      .form-control {
          width: 100%;
          padding: 12px 16px;
          border: 2px solid #e9ecef;
          border-radius: var(--border-radius);
          font-size: 16px;
          transition: var(--transition);
          font-family: inherit;
      }

      .form-control:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
      }

      .form-control.error {
          border-color: var(--danger-color);
      }

      .error-message {
          color: var(--danger-color);
          font-size: 0.9em;
          margin-top: 5px;
      }

      .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          animation: fadeIn 0.3s ease;
      }

      .modal-content {
          background-color: white;
          margin: 5% auto;
          padding: 30px;
          border-radius: var(--border-radius);
          width: 90%;
          max-width: 600px;
          max-height: 80vh;
          overflow-y: auto;
          position: relative;
          animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
          from { transform: translateY(-50px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
      }

      .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 15px;
          border-bottom: 1px solid #e9ecef;
      }

      .modal-title {
          font-size: 1.5em;
          font-weight: 600;
          color: var(--dark-color);
      }

      .close {
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #adb5bd;
          padding: 0;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .close:hover {
          color: var(--dark-color);
      }

      .reply-section {
          background: #f8f9fa;
          border-radius: var(--border-radius);
          padding: 20px;
          margin-top: 20px;
      }

      .reply-item {
          background: white;
          padding: 15px;
          border-radius: var(--border-radius);
          margin-bottom: 15px;
          border-left: 3px solid var(--info-color);
      }

      .reply-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 10px;
      }

      .reply-author {
          font-weight: 600;
          color: var(--dark-color);
      }

      .reply-time {
          color: #6c757d;
          font-size: 0.9em;
      }

      .reply-content {
          color: #555;
          line-height: 1.6;
      }

      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }

      .stat-card {
          background: white;
          padding: 25px;
          border-radius: var(--border-radius);
          text-align: center;
          box-shadow: var(--box-shadow);
          transition: var(--transition);
      }

      .stat-card:hover {
          transform: translateY(-2px);
      }

      .stat-icon {
          font-size: 2.5em;
          margin-bottom: 15px;
      }

      .stat-number {
          font-size: 2em;
          font-weight: 700;
          margin-bottom: 5px;
      }

      .stat-label {
          color: #6c757d;
          font-size: 0.9em;
      }

      .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: var(--border-radius);
          color: white;
          font-weight: 500;
          z-index: 1001;
          transform: translateX(400px);
          transition: var(--transition);
      }

      .notification.show {
          transform: translateX(0);
      }

      .notification.success {
          background: var(--success-color);
      }

      .notification.error {
          background: var(--danger-color);
      }

      .notification.info {
          background: var(--info-color);
      }

      .notification.warning {
          background: var(--warning-color);
      }

      .search-container {
          position: relative;
          margin-bottom: 20px;
      }

      .search-input {
          width: 100%;
          padding: 12px 45px 12px 16px;
          border: 2px solid #e9ecef;
          border-radius: 25px;
          font-size: 16px;
      }

      .search-btn {
          position: absolute;
          right: 5px;
          top: 50%;
          transform: translateY(-50%);
          background: var(--primary-color);
          border: none;
          color: white;
          width: 35px;
          height: 35px;
          border-radius: 50%;
          cursor: pointer;
      }

      .filter-bar {
          display: flex;
          gap: 15px;
          margin-bottom: 20px;
          flex-wrap: wrap;
          align-items: center;
      }

      .filter-select {
          padding: 8px 12px;
          border: 1px solid #e9ecef;
          border-radius: var(--border-radius);
          background: white;
      }

      .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
          margin-top: 30px;
      }

      .page-btn {
          padding: 8px 12px;
          border: 1px solid #e9ecef;
          background: white;
          border-radius: 6px;
          cursor: pointer;
          transition: var(--transition);
      }

      .page-btn:hover,
      .page-btn.active {
          background: var(--primary-color);
          color: white;
          border-color: var(--primary-color);
      }

      .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: #6c757d;
      }

      .empty-state i {
          font-size: 4em;
          margin-bottom: 20px;
          opacity: 0.5;
      }

      .checkbox-group {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 10px;
          margin-top: 10px;
      }

      .checkbox-item {
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .checkbox-item input[type="checkbox"] {
          width: 18px;
          height: 18px;
      }

      @media (max-width: 768px) {
          .main-content {
              grid-template-columns: 1fr;
          }

          .sidebar {
              order: 2;
              border-right: none;
              border-top: 1px solid #dee2e6;
          }

          .nav-menu {
              display: flex;
              overflow-x: auto;
          }

          .nav-item {
              border-bottom: none;
              border-right: 1px solid #dee2e6;
              flex-shrink: 0;
          }

          .container {
              padding: 10px;
          }

          .header h1 {
              font-size: 2em;
          }

          .stats-grid {
              grid-template-columns: 1fr;
          }

          .filter-bar {
              flex-direction: column;
              align-items: stretch;
          }

          .modal-content {
              margin: 10% auto;
              width: 95%;
              padding: 20px;
          }
      }

      .admin-panel {
          background: white;
          border-radius: var(--border-radius);
          overflow: hidden;
          box-shadow: var(--box-shadow);
      }

      .admin-header {
          background: linear-gradient(135deg, var(--danger-color), #d32f2f);
          color: white;
          padding: 20px;
          text-align: center;
      }

      .admin-content {
          padding: 30px;
      }

      .admin-section {
          margin-bottom: 30px;
          padding: 20px;
          border: 1px solid #e9ecef;
          border-radius: var(--border-radius);
      }

      .admin-section h3 {
          color: var(--dark-color);
          margin-bottom: 15px;
          padding-bottom: 10px;
          border-bottom: 2px solid var(--primary-color);
      }

      .pending-items {
          max-height: 300px;
          overflow-y: auto;
      }

      .pending-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px;
          border: 1px solid #e9ecef;
          border-radius: var(--border-radius);
          margin-bottom: 10px;
          background: #f8f9fa;
      }

      .item-info {
          flex: 1;
      }

      .item-actions {
          display: flex;
          gap: 10px;
      }
  </style>
</head>
<body>
  <!-- è¼‰å…¥è¦†è“‹å±¤ -->
  <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
  </div>

  <!-- é€šçŸ¥å®¹å™¨ -->
  <div id="notificationContainer"></div>

  <div class="container">
      <!-- æ¨™é¡Œå€ -->
      <div class="header">
          <h1><i class="fas fa-heart"></i> å¸•é‡‘æ£®å¤šå…ƒåŒ–è«–å£‡</h1>
          <p>å°ˆæ¥­é†«ç™‚è³‡è¨Š â€¢ æº«æš–äº’åŠ©ç¤¾ç¾¤ â€¢ å…¨æ–¹ä½ç…§è­·æ”¯æŒ</p>
      </div>

      <!-- ä¸»è¦å…§å®¹å€ -->
      <div class="main-content">
          <!-- å´é‚Šé¸å–® -->
          <div class="sidebar">
              <ul class="nav-menu">
                  <li class="nav-item">
                      <a class="nav-link active" onclick="showTab('dashboard')">
                          <i class="fas fa-home"></i>
                          <span>è«–å£‡é¦–é </span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" onclick="showTab('topics')">
                          <i class="fas fa-comments"></i>
                          <span>è©±é¡Œè¨è«–</span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" onclick="showTab('create')">
                          <i class="fas fa-plus-circle"></i>
                          <span>ç™¼è¡¨ä¸»é¡Œ</span>
                      </a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" onclick="showTab('profile')">
                          <i class="fas fa-user"></i>
                          <span>å€‹äººè³‡æ–™</span>
                      </a>
                  </li>
                  <li class="nav-item" id="adminNavItem" style="display: none;">
                      <a class="nav-link" onclick="showTab('admin')">
                          <i class="fas fa-cog"></i>
                          <span>ç‰ˆä¸»ç®¡ç†</span>
                      </a>
                  </li>
              </ul>
          </div>

          <!-- å…§å®¹å€åŸŸ -->
          <div class="content-area">
              <!-- è«–å£‡é¦–é  -->
              <div id="dashboard" class="tab-content active">
                  <!-- ç”¨æˆ¶è³‡è¨Šå¡ç‰‡ -->
                  <div class="user-info-card">
                      <div class="user-avatar">
                          <i class="fas fa-user"></i>
                      </div>
                      <div class="user-details">
                          <h3 id="welcomeUserName">è¼‰å…¥ä¸­...</h3>
                          <div class="user-status">
                              <span class="status-dot"></span>
                              <span>å·²é€šéLINE LIFFé©—è­‰</span>
                          </div>
                      </div>
                  </div>

                  <!-- çµ±è¨ˆè³‡è¨Š -->
                  <div class="stats-grid">
                      <div class="stat-card">
                          <div class="stat-icon" style="color: var(--primary-color);">
                              <i class="fas fa-comments"></i>
                          </div>
                          <div class="stat-number" id="totalTopics">0</div>
                          <div class="stat-label">ç¸½è©±é¡Œæ•¸</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon" style="color: var(--info-color);">
                              <i class="fas fa-reply"></i>
                          </div>
                          <div class="stat-number" id="totalReplies">0</div>
                          <div class="stat-label">ç¸½å›è¦†æ•¸</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon" style="color: var(--warning-color);">
                              <i class="fas fa-users"></i>
                          </div>
                          <div class="stat-number" id="totalUsers">0</div>
                          <div class="stat-label">æ´»èºç”¨æˆ¶</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon" style="color: var(--success-color);">
                              <i class="fas fa-calendar-day"></i>
                          </div>
                          <div class="stat-number" id="todayTopics">0</div>
                          <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                      </div>
                  </div>

                  <!-- æœ€æ–°è©±é¡Œé è¦½ -->
                  <h2><i class="fas fa-fire"></i> ç†±é–€è©±é¡Œ</h2>
                  <div id="recentTopicsPreview"></div>
                  
                  <div style="text-align: center; margin-top: 20px;">
                      <button class="btn btn-primary" onclick="showTab('topics')">
                          <i class="fas fa-arrow-right"></i>
                          æŸ¥çœ‹æ›´å¤šè©±é¡Œ
                      </button>
                  </div>
              </div>

              <!-- è©±é¡Œè¨è«–å€ -->
              <div id="topics" class="tab-content">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                      <h2><i class="fas fa-comments"></i> è©±é¡Œè¨è«–</h2>
                      <button class="btn btn-primary" onclick="showTab('create')">
                          <i class="fas fa-plus"></i>
                          ç™¼è¡¨æ–°ä¸»é¡Œ
                      </button>
                  </div>

                  <!-- æœå°‹å’Œç¯©é¸ -->
                  <div class="search-container">
                      <input type="text" id="searchInput" class="search-input" placeholder="æœå°‹è©±é¡Œã€å…§å®¹æˆ–ä½œè€…...">
                      <button class="search-btn" onclick="searchTopics()">
                          <i class="fas fa-search"></i>
                      </button>
                  </div>

                  <div class="filter-bar">
                      <select id="categoryFilter" class="filter-select" onchange="filterTopics()">
                          <option value="">æ‰€æœ‰åˆ†é¡</option>
                          <option value="medical">ğŸ’Š é†«ç™‚è³‡è¨Š</option>
                          <option value="rehabilitation">ğŸƒâ€â™‚ï¸ å¾©å¥é‹å‹•</option>
                          <option value="nutrition">ğŸ ç‡Ÿé¤Šé£²é£Ÿ</option>
                          <option value="psychology">ğŸ§  å¿ƒç†æ”¯æŒ</option>
                          <option value="daily">ğŸ  æ—¥å¸¸ç”Ÿæ´»</option>
                          <option value="experience">ğŸ’­ ç¶“é©—åˆ†äº«</option>
                      </select>
                      
                      <select id="sortFilter" class="filter-select" onchange="filterTopics()">
                          <option value="newest">æœ€æ–°ç™¼è¡¨</option>
                          <option value="oldest">æœ€æ—©ç™¼è¡¨</option>
                          <option value="most_replies">æœ€å¤šå›è¦†</option>
                          <option value="most_views">æœ€å¤šç€è¦½</option>
                      </select>

                      <button class="btn btn-secondary" onclick="resetFilters()">
                          <i class="fas fa-undo"></i>
                          é‡ç½®ç¯©é¸
                      </button>
                  </div>

                  <!-- è©±é¡Œåˆ—è¡¨ -->
                  <div id="topicsList"></div>

                  <!-- åˆ†é  -->
                  <div id="pagination" class="pagination"></div>
              </div>

              <!-- ç™¼è¡¨ä¸»é¡Œ -->
              <div id="create" class="tab-content">
                  <div class="form-container">
                      <h2><i class="fas fa-edit"></i> ç™¼è¡¨æ–°ä¸»é¡Œ</h2>
                      <form id="createTopicForm">
                          <div class="form-group">
                              <label for="topicCategory">
                                  <i class="fas fa-folder"></i> ä¸»é¡Œåˆ†é¡ *
                              </label>
                              <select id="topicCategory" class="form-control" required>
                                  <option value="">è«‹é¸æ“‡åˆ†é¡</option>
                                  <option value="medical">ğŸ’Š é†«ç™‚è³‡è¨Š</option>
                                  <option value="rehabilitation">ğŸƒâ€â™‚ï¸ å¾©å¥é‹å‹•</option>
                                  <option value="nutrition">ğŸ ç‡Ÿé¤Šé£²é£Ÿ</option>
                                  <option value="psychology">ğŸ§  å¿ƒç†æ”¯æŒ</option>
                                  <option value="daily">ğŸ  æ—¥å¸¸ç”Ÿæ´»</option>
                                  <option value="experience">ğŸ’­ ç¶“é©—åˆ†äº«</option>
                              </select>
                          </div>

                          <div class="form-group">
                              <label for="topicTitle">
                                  <i class="fas fa-heading"></i> ä¸»é¡Œæ¨™é¡Œ *
                              </label>
                              <input type="text" id="topicTitle" class="form-control" 
                                     placeholder="è«‹è¼¸å…¥æ¸…æ¥šæ˜ç¢ºçš„ä¸»é¡Œæ¨™é¡Œ..." required maxlength="100">
                              <small class="text-muted">å»ºè­°æ¨™é¡Œé•·åº¦ 10-100 å­—å…ƒ</small>
                          </div>

                          <div class="form-group">
                              <label for="topicContent">
                                  <i class="fas fa-align-left"></i> å…§å®¹æè¿° *
                              </label>
                              <textarea id="topicContent" class="form-control" rows="8" 
                                        placeholder="è«‹è©³ç´°æè¿°æ‚¨æƒ³åˆ†äº«çš„å…§å®¹ï¼ŒåŒ…æ‹¬èƒŒæ™¯ã€å•é¡Œã€ç¶“é©—ç­‰..." required></textarea>
                              <small class="text-muted">å»ºè­°å…§å®¹é•·åº¦è‡³å°‘ 50 å­—å…ƒ</small>
                          </div>

                          <div class="form-group">
                              <label for="topicTags">
                                  <i class="fas fa-tags"></i> æ¨™ç±¤ (é¸å¡«)
                              </label>
                              <input type="text" id="topicTags" class="form-control" 
                                     placeholder="ä¾‹å¦‚: è—¥ç‰©, å‰¯ä½œç”¨, ç¶“é©—åˆ†äº« (ç”¨é€—è™Ÿåˆ†éš”)">
                              <small class="text-muted">æ¨™ç±¤æœ‰åŠ©æ–¼å…¶ä»–ç”¨æˆ¶æ‰¾åˆ°æ‚¨çš„ä¸»é¡Œ</small>
                          </div>

                          <div class="form-group">
                              <label>
                                  <i class="fas fa-bell"></i> é€šçŸ¥è¨­å®š
                              </label>
                              <div class="checkbox-group">
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="notifyReplies" checked>
                                      <label for="notifyReplies">æœ‰æ–°å›è¦†æ™‚é€šçŸ¥æˆ‘</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="notifyLine" checked>
                                      <label for="notifyLine">ç™¼é€LINEé€šçŸ¥</label>
                                  </div>
                              </div>
                          </div>

                          <div class="form-group">
                              <button type="submit" class="btn btn-primary">
                                  <i class="fas fa-paper-plane"></i>
                                  ç™¼è¡¨ä¸»é¡Œ
                              </button>
                              <button type="button" class="btn btn-secondary" onclick="resetCreateForm()">
                                  <i class="fas fa-undo"></i>
                                  é‡ç½®è¡¨å–®
                              </button>
                          </div>
                      </form>
                  </div>
              </div>

              <!-- å€‹äººè³‡æ–™ -->
              <div id="profile" class="tab-content">
                  <div class="form-container">
                      <h2><i class="fas fa-user-cog"></i> å€‹äººè³‡æ–™è¨­å®š</h2>
                      <form id="profileForm">
                          <div class="form-group">
                              <label for="displayName">
                                  <i class="fas fa-id-card"></i> é¡¯ç¤ºåç¨±
                              </label>
                              <input type="text" id="displayName" class="form-control" 
                                     placeholder="æ‚¨çš„é¡¯ç¤ºåç¨±" required>
                          </div>

                          <div class="form-group">
                              <label for="userRole">
                                  <i class="fas fa-user-tag"></i> èº«ä»½è§’è‰²
                              </label>
                              <select id="userRole" class="form-control">
                                  <option value="patient">ğŸ¤’ æ‚£è€…</option>
                                  <option value="caregiver">ğŸ‘¨â€âš•ï¸ ç…§è­·è€…</option>
                                  <option value="medical">ğŸ©º é†«ç™‚å°ˆæ¥­äººå“¡</option>
                                  <option value="family">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶å±¬</option>
                                  <option value="volunteer">ğŸ¤ å¿—å·¥</option>
                              </select>
                          </div>

                          <div class="form-group">
                              <label for="userBio">
                                  <i class="fas fa-info-circle"></i> å€‹äººç°¡ä»‹
                              </label>
                              <textarea id="userBio" class="form-control" rows="4" 
                                        placeholder="ç°¡å–®ä»‹ç´¹æ‚¨è‡ªå·±ï¼Œè®“å…¶ä»–ç”¨æˆ¶æ›´äº†è§£æ‚¨..."></textarea>
                          </div>

                          <div class="form-group">
                              <label>
                                  <i class="fas fa-heart"></i> é—œæ³¨é ˜åŸŸ
                              </label>
                              <div class="checkbox-group">
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="interest_medical" value="medical">
                                      <label for="interest_medical">ğŸ’Š é†«ç™‚è³‡è¨Š</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="interest_rehabilitation" value="rehabilitation">
                                      <label for="interest_rehabilitation">ğŸƒâ€â™‚ï¸ å¾©å¥é‹å‹•</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="interest_nutrition" value="nutrition">
                                      <label for="interest_nutrition">ğŸ ç‡Ÿé¤Šé£²é£Ÿ</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="interest_psychology" value="psychology">
                                      <label for="interest_psychology">ğŸ§  å¿ƒç†æ”¯æŒ</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="interest_daily" value="daily">
                                      <label for="interest_daily">ğŸ  æ—¥å¸¸ç”Ÿæ´»</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="interest_experience" value="experience">
                                      <label for="interest_experience">ğŸ’­ ç¶“é©—åˆ†äº«</label>
                                  </div>
                              </div>
                          </div>

                          <div class="form-group">
                              <label>
                                  <i class="fas fa-bell"></i> é€šçŸ¥è¨­å®š
                              </label>
                              <div class="checkbox-group">
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="notify_replies" checked>
                                      <label for="notify_replies">ğŸ“§ æ–°å›è¦†é€šçŸ¥</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="notify_line" checked>
                                      <label for="notify_line">ğŸ“± LINEæ¨é€é€šçŸ¥</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="notify_weekly">
                                      <label for="notify_weekly">ğŸ“Š é€±å ±æ‘˜è¦</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="notify_mentions" checked>
                                      <label for="notify_mentions">ğŸ”” è¢«æåŠé€šçŸ¥</label>
                                  </div>
                              </div>
                          </div>

                          <div class="form-group">
                              <label>
                                  <i class="fas fa-shield-alt"></i> éš±ç§è¨­å®š
                              </label>
                              <div class="checkbox-group">
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="privacy_profile" checked>
                                      <label for="privacy_profile">å…¬é–‹å€‹äººè³‡æ–™</label>
                                  </div>
                                  <div class="checkbox-item">
                                      <input type="checkbox" id="privacy_activity">
                                      <label for="privacy_activity">é¡¯ç¤ºæ´»å‹•ç‹€æ…‹</label>
                                  </div>
                              </div>
                          </div>

                          <div class="form-group">
                              <button type="submit" class="btn btn-primary">
                                  <i class="fas fa-save"></i>
                                  å„²å­˜è¨­å®š
                              </button>
                              <button type="button" class="btn btn-secondary" onclick="loadUserProfile()">
                                  <i class="fas fa-undo"></i>
                                  é‡ç½®è®Šæ›´
                              </button>
                          </div>
                      </form>
                  </div>
              </div>

              <!-- ç‰ˆä¸»ç®¡ç† -->
              <div id="admin" class="tab-content">
                  <div class="admin-panel">
                      <div class="admin-header">
                          <h2><i class="fas fa-shield-alt"></i> ç‰ˆä¸»ç®¡ç†é¢æ¿</h2>
                          <p>è«–å£‡ç®¡ç†èˆ‡ç›£æ§ä¸­å¿ƒ</p>
                      </div>
                      <div class="admin-content">
                          <!-- ç®¡ç†çµ±è¨ˆ -->
                          <div class="admin-section">
                              <h3><i class="fas fa-chart-bar"></i> ç®¡ç†çµ±è¨ˆ</h3>
                              <div class="stats-grid">
                                  <div class="stat-card">
                                      <div class="stat-icon" style="color: var(--info-color);">
                                          <i class="fas fa-eye"></i>
                                      </div>
                                      <div class="stat-number" id="adminTotalViews">0</div>
                                      <div class="stat-label">ç¸½ç€è¦½æ•¸</div>
                                  </div>
                                  <div class="stat-card">
                                      <div class="stat-icon" style="color: var(--warning-color);">
                                          <i class="fas fa-flag"></i>
                                      </div>
                                      <div class="stat-number" id="adminReportedContent">0</div>
                                      <div class="stat-label">æª¢èˆ‰å…§å®¹</div>
                                  </div>
                                  <div class="stat-card">
                                      <div class="stat-icon" style="color: var(--danger-color);">
                                          <i class="fas fa-ban"></i>
                                      </div>
                                      <div class="stat-number" id="adminBlockedUsers">0</div>
                                      <div class="stat-label">å°é–ç”¨æˆ¶</div>
                                  </div>
                                  <div class="stat-card">
                                      <div class="stat-icon" style="color: var(--success-color);">
                                          <i class="fas fa-check-circle"></i>
                                      </div>
                                      <div class="stat-number" id="adminApprovedContent">0</div>
                                      <div class="stat-label">å·²å¯©æ ¸å…§å®¹</div>
                                  </div>
                              </div>
                          </div>

                          <!-- å¾…è™•ç†äº‹é … -->
                          <div class="admin-section">
                              <h3><i class="fas fa-tasks"></i> å¾…è™•ç†äº‹é …</h3>
                              <div class="pending-items" id="pendingItems">
                                  <!-- å‹•æ…‹è¼‰å…¥å¾…è™•ç†é …ç›® -->
                              </div>
                          </div>

                          <!-- ç®¡ç†åŠŸèƒ½ -->
                          <div class="admin-section">
                              <h3><i class="fas fa-tools"></i> ç®¡ç†åŠŸèƒ½</h3>
                              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                  <button class="btn btn-info" onclick="manageCategories()">
                                      <i class="fas fa-folder-open"></i>
                                      åˆ†é¡ç®¡ç†
                                  </button>
                                  <button class="btn btn-info" onclick="manageUsers()">
                                      <i class="fas fa-users-cog"></i>
                                      ç”¨æˆ¶ç®¡ç†
                                  </button>
                                  <button class="btn btn-warning" onclick="moderateContent()">
                                      <i class="fas fa-search"></i>
                                      å…§å®¹å¯©æ ¸
                                  </button>
                                  <button class="btn btn-secondary" onclick="exportData()">
                                      <i class="fas fa-download"></i>
                                      åŒ¯å‡ºæ•¸æ“š
                                  </button>
                                  <button class="btn btn-primary" onclick="sendAnnouncement()">
                                      <i class="fas fa-bullhorn"></i>
                                      ç™¼å¸ƒå…¬å‘Š
                                  </button>
                                  <button class="btn btn-success" onclick="generateReport()">
                                      <i class="fas fa-file-alt"></i>
                                      ç”Ÿæˆå ±å‘Š
                                  </button>
                              </div>
                          </div>

                          <!-- ç³»çµ±è¨­å®š -->
                          <div class="admin-section">
                              <h3><i class="fas fa-cogs"></i> ç³»çµ±è¨­å®š</h3>
                              <form id="systemSettingsForm">
                                  <div class="form-group">
                                      <label for="forumTitle">è«–å£‡æ¨™é¡Œ</label>
                                      <input type="text" id="forumTitle" class="form-control" value="å¸•é‡‘æ£®å¤šå…ƒåŒ–è«–å£‡">
                                  </div>
                                  <div class="form-group">
                                      <label for="maxTopicsPerPage">æ¯é é¡¯ç¤ºä¸»é¡Œæ•¸</label>
                                      <input type="number" id="maxTopicsPerPage" class="form-control" value="10" min="5" max="50">
                                  </div>
                                  <div class="form-group">
                                      <label>åŠŸèƒ½é–‹é—œ</label>
                                      <div class="checkbox-group">
                                          <div class="checkbox-item">
                                              <input type="checkbox" id="enableRegistration" checked>
                                              <label for="enableRegistration">é–‹æ”¾è¨»å†Š</label>
                                          </div>
                                          <div class="checkbox-item">
                                              <input type="checkbox" id="enableGuestView" checked>
                                              <label for="enableGuestView">å…è¨±è¨ªå®¢ç€è¦½</label>
                                          </div>
                                          <div class="checkbox-item">
                                              <input type="checkbox" id="enableAutoApprove">
                                              <label for="enableAutoApprove">è‡ªå‹•å¯©æ ¸é€šé</label>
                                          </div>
                                      </div>
                                  </div>
                                  <button type="submit" class="btn btn-primary">
                                      <i class="fas fa-save"></i>
                                      å„²å­˜è¨­å®š
                                  </button>
                              </form>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- ä¸»é¡Œè©³æƒ…æ¨¡æ…‹æ¡† -->
  <div id="topicModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="modal-title" id="modalTopicTitle">ä¸»é¡Œè©³æƒ…</h3>
              <button class="close" onclick="closeModal('topicModal')">&times;</button>
          </div>
          <div id="modalTopicContent">
              <!-- å‹•æ…‹è¼‰å…¥ä¸»é¡Œå…§å®¹ -->
          </div>
      </div>
  </div>

  <!-- å›è¦†æ¨¡æ…‹æ¡† -->
  <div id="replyModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3 class="modal-title">å›è¦†ä¸»é¡Œ</h3>
              <button class="close" onclick="closeModal('replyModal')">&times;</button>
          </div>
          <form id="replyForm">
              <div class="form-group">
                  <label for="replyContent">å›è¦†å…§å®¹</label>
                  <textarea id="replyContent" class="form-control" rows="6" 
                            placeholder="è«‹è¼¸å…¥æ‚¨çš„å›è¦†å…§å®¹..." required></textarea>
              </div>
              <div class="form-group">
                  <div class="checkbox-item">
                      <input type="checkbox" id="replyNotifyLine" checked>
                      <label for="replyNotifyLine">ç™¼é€LINEé€šçŸ¥çµ¦ä¸»é¡Œä½œè€…</label>
                  </div>
              </div>
              <div class="form-group">
                  <button type="submit" class="btn btn-primary">
                      <i class="fas fa-reply"></i>
                      ç™¼é€å›è¦†
                  </button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('replyModal')">
                      <i class="fas fa-times"></i>
                      å–æ¶ˆ
                  </button>
              </div>
          </form>
      </div>
  </div>

  <script>
      // å…¨åŸŸè®Šæ•¸
      const CONFIG = {
          LIFF_ID: '2001679903-O06mNaLy', // è«‹æ›¿æ›ç‚ºå¯¦éš›çš„LIFF ID
          GAS_URL: 'https://script.google.com/macros/s/AKfycbzD_rAzFiX8oEEFrRYjYr8qRHdNjU5dSqs0s8RxVrmuJ8Tv37OlGuDPseJj9mbBkzUifA/exec', // è«‹æ›¿æ›ç‚ºå¯¦éš›çš„GAS Web App URL
          ITEMS_PER_PAGE: 10,
          MAX_CONTENT_PREVIEW: 150
      };

      let currentUser = {
          id: null,
          name: null,
          role: null,
          isAdmin: false
      };

      let currentPage = 1;
      let totalPages = 1;
      let allTopics = [];
      let filteredTopics = [];
      let currentTopicId = null;

      // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
      document.addEventListener('DOMContentLoaded', async function() {
          showLoading(true);
          await initializeLiff();
          await loadInitialData();
          setupEventListeners();
          showLoading(false);
      });

      // LIFFåˆå§‹åŒ–
      async function initializeLiff() {
          try {
              if (typeof liff !== 'undefined') {
                  await liff.init({ liffId: CONFIG.LIFF_ID });
                  
                  if (liff.isLoggedIn()) {
                      const profile = await liff.getProfile();
                      currentUser.id = profile.userId;
                      currentUser.name = profile.displayName;
                      
                      // æ›´æ–°UI
                      document.getElementById('welcomeUserName').textContent = `æ­¡è¿å›ä¾†ï¼Œ${currentUser.name}ï¼`;
                      document.getElementById('displayName').value = currentUser.name;
                      
                      // æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™
                      await checkAdminPermission();
                  } else {
                      liff.login();
                      return;
                  }
              } else {
                  // é–‹ç™¼æ¨¡å¼æˆ–LIFFä¸å¯ç”¨æ™‚çš„æ¨¡æ“¬æ•¸æ“š
                  currentUser.id = 'test_user_001';
                  currentUser.name = 'æ¸¬è©¦ç”¨æˆ¶';
                  document.getElementById('welcomeUserName').textContent = `æ­¡è¿å›ä¾†ï¼Œ${currentUser.name}ï¼`;
                  document.getElementById('displayName').value = currentUser.name;
              }
          } catch (error) {
              console.error('LIFFåˆå§‹åŒ–å¤±æ•—:', error);
              showNotification('LIFFåˆå§‹åŒ–å¤±æ•—ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ç„¡æ³•æ­£å¸¸ä½¿ç”¨', 'warning');
              
              // ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
              currentUser.id = 'fallback_user';
              currentUser.name = 'è¨ªå®¢ç”¨æˆ¶';
              document.getElementById('welcomeUserName').textContent = `æ­¡è¿ï¼Œ${currentUser.name}ï¼`;
          }
      }

      // æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™
      async function checkAdminPermission() {
          try {
              const response = await apiCall('checkAdminPermission', { userId: currentUser.id });
              if (response.success && response.data.isAdmin) {
                  currentUser.isAdmin = true;
                  currentUser.role = response.data.role;
                  document.getElementById('adminNavItem').style.display = 'block';
              }
          } catch (error) {
              console.error('æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™å¤±æ•—:', error);
          }
      }

      // è¼‰å…¥åˆå§‹æ•¸æ“š
      async function loadInitialData() {
          try {
              await Promise.all([
                  loadForumStats(),
                  loadTopics(),
                  loadUserProfile()
              ]);
          } catch (error) {
              console.error('è¼‰å…¥åˆå§‹æ•¸æ“šå¤±æ•—:', error);
              showNotification('è¼‰å…¥æ•¸æ“šå¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
          }
      }

      // è¼‰å…¥è«–å£‡çµ±è¨ˆ
      async function loadForumStats() {
          try {
              const response = await apiCall('getForumStats');
              if (response.success) {
                  const stats = response.data;
                  document.getElementById('totalTopics').textContent = stats.totalTopics || 0;
                  document.getElementById('totalReplies').textContent = stats.totalReplies || 0;
                  document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                  document.getElementById('todayTopics').textContent = stats.todayTopics || 0;
              }
          } catch (error) {
              console.error('è¼‰å…¥çµ±è¨ˆæ•¸æ“šå¤±æ•—:', error);
          }
      }

      // è¼‰å…¥ä¸»é¡Œåˆ—è¡¨
      async function loadTopics() {
          try {
              const response = await apiCall('getTopics');
              if (response.success) {
                  allTopics = response.data || [];
                  filteredTopics = [...allTopics];
                  updateTopicsDisplay();
                  updateRecentTopicsPreview();
              }
          } catch (error) {
              console.error('è¼‰å…¥ä¸»é¡Œå¤±æ•—:', error);
              showNotification('è¼‰å…¥ä¸»é¡Œå¤±æ•—', 'error');
          }
      }

      // æ›´æ–°ä¸»é¡Œé¡¯ç¤º
      function updateTopicsDisplay() {
          const container = document.getElementById('topicsList');
          const startIndex = (currentPage - 1) * CONFIG.ITEMS_PER_PAGE;
          const endIndex = startIndex + CONFIG.ITEMS_PER_PAGE;
          const pageTopics = filteredTopics.slice(startIndex, endIndex);

          if (pageTopics.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <i class="fas fa-comments"></i>
                      <h3>æš«ç„¡ä¸»é¡Œ</h3>
                      <p>ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ä¸»é¡Œï¼Œä¾†ç™¼è¡¨ç¬¬ä¸€å€‹ä¸»é¡Œå§ï¼</p>
                      <button class="btn btn-primary" onclick="showTab('create')">
                          <i class="fas fa-plus"></i>
                          ç™¼è¡¨ä¸»é¡Œ
                      </button>
                  </div>
              `;
              return;
          }

          container.innerHTML = pageTopics.map(topic => createTopicCard(topic)).join('');
          updatePagination();
      }

      // å‰µå»ºä¸»é¡Œå¡ç‰‡
      function createTopicCard(topic) {
          const categoryNames = {
              'medical': 'ğŸ’Š é†«ç™‚è³‡è¨Š',
              'rehabilitation': 'ğŸƒâ€â™‚ï¸ å¾©å¥é‹å‹•',
              'nutrition': 'ğŸ ç‡Ÿé¤Šé£²é£Ÿ',
              'psychology': 'ğŸ§  å¿ƒç†æ”¯æŒ',
              'daily': 'ğŸ  æ—¥å¸¸ç”Ÿæ´»',
              'experience': 'ğŸ’­ ç¶“é©—åˆ†äº«'
          };

          const categoryName = categoryNames[topic.category] || topic.category;
          const timeAgo = getTimeAgo(topic.timestamp);
          const contentPreview = topic.content.length > CONFIG.MAX_CONTENT_PREVIEW 
              ? topic.content.substring(0, CONFIG.MAX_CONTENT_PREVIEW) + '...' 
              : topic.content;

          const tags = topic.tags ? topic.tags.split(',').map(tag => 
              `<span class="tag">${tag.trim()}</span>`
          ).join('') : '';

          return `
              <div class="topic-card" data-topic-id="${topic.id}">
                  <div class="topic-header">
                      <div>
                          <div class="topic-title">${escapeHtml(topic.title)}</div>
                          <span class="topic-category">${categoryName}</span>
                      </div>
                  </div>
                  
                  <div class="topic-meta">
                      <div class="meta-item">
                          <i class="fas fa-user"></i>
                          <span>${escapeHtml(topic.userName)}</span>
                      </div>
                      <div class="meta-item">
                          <i class="fas fa-clock"></i>
                          <span>${timeAgo}</span>
                      </div>
                      <div class="meta-item">
                          <i class="fas fa-reply"></i>
                          <span>${topic.replyCount || 0} å›è¦†</span>
                      </div>
                      <div class="meta-item">
                          <i class="fas fa-eye"></i>
                          <span>${topic.viewCount || 0} ç€è¦½</span>
                      </div>
                  </div>
                  
                  <div class="topic-content">${escapeHtml(contentPreview)}</div>
                  
                  ${tags ? `<div class="topic-tags">${tags}</div>` : ''}
                  
                  <div class="topic-actions">
                      <button class="btn btn-primary" onclick="viewTopic(${topic.id})">
                          <i class="fas fa-eye"></i>
                          æŸ¥çœ‹è©³æƒ…
                      </button>
                      <button class="btn btn-info" onclick="replyTopic(${topic.id})">
                          <i class="fas fa-reply"></i>
                          å›è¦†
                      </button>
                      ${currentUser.isAdmin || topic.userId === currentUser.id ? `
                          <button class="btn btn-warning" onclick="editTopic(${topic.id})">
                              <i class="fas fa-edit"></i>
                              ç·¨è¼¯
                          </button>
                      ` : ''}
                      ${currentUser.isAdmin ? `
                          <button class="btn btn-danger" onclick="deleteTopic(${topic.id})">
                              <i class="fas fa-trash"></i>
                              åˆªé™¤
                          </button>
                      ` : ''}
                  </div>
              </div>
          `;
      }

      // æ›´æ–°æœ€æ–°ä¸»é¡Œé è¦½
      function updateRecentTopicsPreview() {
          const container = document.getElementById('recentTopicsPreview');
          const recentTopics = allTopics.slice(0, 3);
          
          if (recentTopics.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <i class="fas fa-comments"></i>
                      <p>æš«ç„¡ä¸»é¡Œï¼Œä¾†ç™¼è¡¨ç¬¬ä¸€å€‹ä¸»é¡Œå§ï¼</p>
                  </div>
              `;
              return;
          }

          container.innerHTML = recentTopics.map(topic => createTopicCard(topic)).join('');
      }

      // æ›´æ–°åˆ†é 
      function updatePagination() {
          totalPages = Math.ceil(filteredTopics.length / CONFIG.ITEMS_PER_PAGE);
          const container = document.getElementById('pagination');
          
          if (totalPages <= 1) {
              container.innerHTML = '';
              return;
          }

          let paginationHtml = '';
          
          // ä¸Šä¸€é 
          if (currentPage > 1) {
              paginationHtml += `<button class="page-btn" onclick="changePage(${currentPage - 1})">
                  <i class="fas fa-chevron-left"></i>
              </button>`;
          }

          // é ç¢¼
          const startPage = Math.max(1, currentPage - 2);
          const endPage = Math.min(totalPages, currentPage + 2);

          if (startPage > 1) {
              paginationHtml += `<button class="page-btn" onclick="changePage(1)">1</button>`;
              if (startPage > 2) {
                  paginationHtml += `<span>...</span>`;
              }
          }

          for (let i = startPage; i <= endPage; i++) {
              paginationHtml += `<button class="page-btn ${i === currentPage ? 'active' : ''}" 
                  onclick="changePage(${i})">${i}</button>`;
          }

          if (endPage < totalPages) {
              if (endPage < totalPages - 1) {
                  paginationHtml += `<span>...</span>`;
              }
              paginationHtml += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
          }

          // ä¸‹ä¸€é 
          if (currentPage < totalPages) {
              paginationHtml += `<button class="page-btn" onclick="changePage(${currentPage + 1})">
                  <i class="fas fa-chevron-right"></i>
              </button>`;
          }

          container.innerHTML = paginationHtml;
      }

      // åˆ‡æ›é é¢
      function changePage(page) {
          currentPage = page;
          updateTopicsDisplay();
          document.querySelector('.content-area').scrollTop = 0;
      }

      // è¼‰å…¥ç”¨æˆ¶è³‡æ–™
      async function loadUserProfile() {
          try {
              const response = await apiCall('getUserProfile', { userId: currentUser.id });
              if (response.success && response.data) {
                  const profile = response.data;
                  
                  // æ›´æ–°è¡¨å–®
                  document.getElementById('displayName').value = profile.displayName || currentUser.name;
                  document.getElementById('userRole').value = profile.role || 'patient';
                  document.getElementById('userBio').value = profile.bio || '';
                  
                  // æ›´æ–°é—œæ³¨é ˜åŸŸ
                  const interests = profile.interests || [];
                  interests.forEach(interest => {
                      const checkbox = document.getElementById(`interest_${interest}`);
                      if (checkbox) checkbox.checked = true;
                  });
                  
                  // æ›´æ–°é€šçŸ¥è¨­å®š
                  const notifications = profile.notifications || {};
                  document.getElementById('notify_replies').checked = notifications.replies !== false;
                  document.getElementById('notify_line').checked = notifications.line !== false;
                  document.getElementById('notify_weekly').checked = notifications.weekly === true;
                  document.getElementById('notify_mentions').checked = notifications.mentions !== false;
                  
                  // æ›´æ–°éš±ç§è¨­å®š
                  const privacy = profile.privacy || {};
                  document.getElementById('privacy_profile').checked = privacy.profile !== false;
                  document.getElementById('privacy_activity').checked = privacy.activity === true;
              }
          } catch (error) {
              console.error('è¼‰å…¥ç”¨æˆ¶è³‡æ–™å¤±æ•—:', error);
          }
      }

      // è¨­å®šäº‹ä»¶ç›£è½å™¨
      function setupEventListeners() {
          // ç™¼è¡¨ä¸»é¡Œè¡¨å–®
          document.getElementById('createTopicForm').addEventListener('submit', handleCreateTopic);
          
          // å€‹äººè³‡æ–™è¡¨å–®
          document.getElementById('profileForm').addEventListener('submit', handleUpdateProfile);
          
          // å›è¦†è¡¨å–®
          document.getElementById('replyForm').addEventListener('submit', handleReplyTopic);
          
          // ç³»çµ±è¨­å®šè¡¨å–®
          const systemForm = document.getElementById('systemSettingsForm');
          if (systemForm) {
              systemForm.addEventListener('submit', handleSystemSettings);
          }
          
          // æœå°‹è¼¸å…¥
          document.getElementById('searchInput').addEventListener('input', debounce(searchTopics, 300));
          
          // æ¨¡æ…‹æ¡†é»æ“Šå¤–éƒ¨é—œé–‰
          window.addEventListener('click', function(event) {
              if (event.target.classList.contains('modal')) {
                  event.target.style.display = 'none';
              }
          });
          
          // éµç›¤å¿«æ·éµ
          document.addEventListener('keydown', function(event) {
              if (event.key === 'Escape') {
                  closeAllModals();
              }
          });
      }

      // è™•ç†ç™¼è¡¨ä¸»é¡Œ
      async function handleCreateTopic(event) {
          event.preventDefault();
          
          const formData = {
              category: document.getElementById('topicCategory').value,
              title: document.getElementById('topicTitle').value.trim(),
              content: document.getElementById('topicContent').value.trim(),
              tags: document.getElementById('topicTags').value.trim(),
              notifyReplies: document.getElementById('notifyReplies').checked,
              notifyLine: document.getElementById('notifyLine').checked,
              userId: currentUser.id,
              userName: currentUser.name,
              timestamp: new Date().toISOString()
          };
          
          // è¡¨å–®é©—è­‰
          if (!validateTopicForm(formData)) {
              return;
          }
          
          try {
              showLoading(true);
              const response = await apiCall('createTopic', formData);
              
              if (response.success) {
                  showNotification('ä¸»é¡Œç™¼è¡¨æˆåŠŸï¼', 'success');
                  document.getElementById('createTopicForm').reset();
                  await loadTopics();
                  showTab('topics');
                  
                  // ç™¼é€LINEé€šçŸ¥
                  if (formData.notifyLine) {
                      await sendLineNotification('æ–°ä¸»é¡Œç™¼è¡¨', formData.title);
                  }
              } else {
                  showNotification(response.error || 'ç™¼è¡¨å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
              }
          } catch (error) {
              console.error('ç™¼è¡¨ä¸»é¡Œå¤±æ•—:', error);
              showNotification('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              showLoading(false);
          }
      }

      // è™•ç†æ›´æ–°å€‹äººè³‡æ–™
      async function handleUpdateProfile(event) {
          event.preventDefault();
          
          const interests = Array.from(document.querySelectorAll('[id^="interest_"]:checked'))
              .map(cb => cb.value);
          
          const profileData = {
              userId: currentUser.id,
              displayName: document.getElementById('displayName').value.trim(),
              role: document.getElementById('userRole').value,
              bio: document.getElementById('userBio').value.trim(),
              interests: interests,
              notifications: {
                  replies: document.getElementById('notify_replies').checked,
                  line: document.getElementById('notify_line').checked,
                  weekly: document.getElementById('notify_weekly').checked,
                  mentions: document.getElementById('notify_mentions').checked
              },
              privacy: {
                  profile: document.getElementById('privacy_profile').checked,
                  activity: document.getElementById('privacy_activity').checked
              }
          };
          
          try {
              showLoading(true);
              const response = await apiCall('updateProfile', profileData);
              
              if (response.success) {
                  showNotification('å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸï¼', 'success');
                  currentUser.name = profileData.displayName;
                  document.getElementById('welcomeUserName').textContent = `æ­¡è¿å›ä¾†ï¼Œ${currentUser.name}ï¼`;
              } else {
                  showNotification(response.error || 'æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
              }
          } catch (error) {
              console.error('æ›´æ–°å€‹äººè³‡æ–™å¤±æ•—:', error);
              showNotification('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              showLoading(false);
          }
      }

      // è™•ç†å›è¦†ä¸»é¡Œ
      async function handleReplyTopic(event) {
          event.preventDefault();
          
          const replyData = {
              topicId: currentTopicId,
              content: document.getElementById('replyContent').value.trim(),
              notifyLine: document.getElementById('replyNotifyLine').checked,
              userId: currentUser.id,
              userName: currentUser.name,
              timestamp: new Date().toISOString()
          };
          
          if (!replyData.content) {
              showNotification('è«‹è¼¸å…¥å›è¦†å…§å®¹', 'warning');
              return;
          }
          
          try {
              showLoading(true);
              const response = await apiCall('replyTopic', replyData);
              
              if (response.success) {
                  showNotification('å›è¦†ç™¼è¡¨æˆåŠŸï¼', 'success');
                  closeModal('replyModal');
                  await loadTopics();
                  
                  // å¦‚æœä¸»é¡Œè©³æƒ…æ¨¡æ…‹æ¡†é–‹å•Ÿï¼Œé‡æ–°è¼‰å…¥
                  if (document.getElementById('topicModal').style.display === 'block') {
                      await viewTopic(currentTopicId);
                  }
                  
                  // ç™¼é€LINEé€šçŸ¥
                  if (replyData.notifyLine) {
                      await sendLineNotification('æ–°å›è¦†', `${currentUser.name} å›è¦†äº†æ‚¨çš„ä¸»é¡Œ`);
                  }
              } else {
                  showNotification(response.error || 'å›è¦†å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
              }
          } catch (error) {
              console.error('å›è¦†å¤±æ•—:', error);
              showNotification('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              showLoading(false);
          }
      }

      // æŸ¥çœ‹ä¸»é¡Œè©³æƒ…
      async function viewTopic(topicId) {
          try {
              showLoading(true);
              const response = await apiCall('getTopic', { id: topicId });
              
              if (response.success) {
                  const topic = response.data;
                  displayTopicModal(topic);
                  
                  // å¢åŠ ç€è¦½æ•¸
                  await apiCall('incrementViewCount', { topicId: topicId });
              } else {
                  showNotification('è¼‰å…¥ä¸»é¡Œå¤±æ•—', 'error');
              }
          } catch (error) {
              console.error('è¼‰å…¥ä¸»é¡Œè©³æƒ…å¤±æ•—:', error);
              showNotification('è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              showLoading(false);
          }
      }

      // é¡¯ç¤ºä¸»é¡Œè©³æƒ…æ¨¡æ…‹æ¡†
      function displayTopicModal(topic) {
          const modal = document.getElementById('topicModal');
          const titleElement = document.getElementById('modalTopicTitle');
          const contentElement = document.getElementById('modalTopicContent');
          
          titleElement.textContent = topic.title;
          
          const categoryNames = {
              'medical': 'ğŸ’Š é†«ç™‚è³‡è¨Š',
              'rehabilitation': 'ğŸƒâ€â™‚ï¸ å¾©å¥é‹å‹•',
              'nutrition': 'ğŸ ç‡Ÿé¤Šé£²é£Ÿ',
              'psychology': 'ğŸ§  å¿ƒç†æ”¯æŒ',
              'daily': 'ğŸ  æ—¥å¸¸ç”Ÿæ´»',
              'experience': 'ğŸ’­ ç¶“é©—åˆ†äº«'
          };
          
          const categoryName = categoryNames[topic.category] || topic.category;
          const timeAgo = getTimeAgo(topic.timestamp);
          const tags = topic.tags ? topic.tags.split(',').map(tag => 
              `<span class="tag">${tag.trim()}</span>`
          ).join('') : '';
          
          contentElement.innerHTML = `
              <div class="topic-card">
                  <div class="topic-header">
                      <span class="topic-category">${categoryName}</span>
                  </div>
                  
                  <div class="topic-meta">
                      <div class="meta-item">
                          <i class="fas fa-user"></i>
                          <span>${escapeHtml(topic.userName)}</span>
                      </div>
                      <div class="meta-item">
                          <i class="fas fa-clock"></i>
                          <span>${timeAgo}</span>
                      </div>
                      <div class="meta-item">
                          <i class="fas fa-eye"></i>
                          <span>${(topic.viewCount || 0) + 1} ç€è¦½</span>
                      </div>
                  </div>
                  
                  <div class="topic-content" style="white-space: pre-wrap; margin: 20px 0;">
                      ${escapeHtml(topic.content)}
                  </div>
                  
                  ${tags ? `<div class="topic-tags">${tags}</div>` : ''}
                  
                  <div class="topic-actions">
                      <button class="btn btn-info" onclick="replyTopic(${topic.id})">
                          <i class="fas fa-reply"></i>
                          å›è¦†é€™å€‹ä¸»é¡Œ
                      </button>
                      ${currentUser.isAdmin || topic.userId === currentUser.id ? `
                          <button class="btn btn-warning" onclick="editTopic(${topic.id})">
                              <i class="fas fa-edit"></i>
                              ç·¨è¼¯
                          </button>
                      ` : ''}
                  </div>
              </div>
              
              ${topic.replies && topic.replies.length > 0 ? `
                  <div class="reply-section">
                      <h4><i class="fas fa-comments"></i> å›è¦† (${topic.replies.length})</h4>
                      ${topic.replies.map(reply => `
                          <div class="reply-item">
                              <div class="reply-header">
                                  <span class="reply-author">${escapeHtml(reply.userName)}</span>
                                  <span class="reply-time">${getTimeAgo(reply.timestamp)}</span>
                              </div>
                              <div class="reply-content">${escapeHtml(reply.content)}</div>
                          </div>
                      `).join('')}
                  </div>
              ` : ''}
          `;
          
          modal.style.display = 'block';
      }

      // å›è¦†ä¸»é¡Œ
      function replyTopic(topicId) {
          currentTopicId = topicId;
          document.getElementById('replyContent').value = '';
          document.getElementById('replyModal').style.display = 'block';
      }

      // æœå°‹ä¸»é¡Œ
      function searchTopics() {
          const query = document.getElementById('searchInput').value.toLowerCase().trim();
          
          if (!query) {
              filteredTopics = [...allTopics];
          } else {
              filteredTopics = allTopics.filter(topic => 
                  topic.title.toLowerCase().includes(query) ||
                  topic.content.toLowerCase().includes(query) ||
                  topic.userName.toLowerCase().includes(query) ||
                  (topic.tags && topic.tags.toLowerCase().includes(query))
              );
          }
          
          currentPage = 1;
          updateTopicsDisplay();
      }

      // ç¯©é¸ä¸»é¡Œ
      function filterTopics() {
          const category = document.getElementById('categoryFilter').value;
          const sort = document.getElementById('sortFilter').value;
          const query = document.getElementById('searchInput').value.toLowerCase().trim();
          
          // å…ˆç¯©é¸åˆ†é¡
          let filtered = allTopics;
          if (category) {
              filtered = filtered.filter(topic => topic.category === category);
          }
          
          // å†ç¯©é¸æœå°‹
          if (query) {
              filtered = filtered.filter(topic => 
                  topic.title.toLowerCase().includes(query) ||
                  topic.content.toLowerCase().includes(query) ||
                  topic.userName.toLowerCase().includes(query) ||
                  (topic.tags && topic.tags.toLowerCase().includes(query))
              );
          }
          
          // æ’åº
          switch (sort) {
              case 'newest':
                  filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                  break;
              case 'oldest':
                  filtered.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                  break;
              case 'most_replies':
                  filtered.sort((a, b) => (b.replyCount || 0) - (a.replyCount || 0));
                  break;
              case 'most_views':
                  filtered.sort((a, b) => (b.viewCount || 0) - (a.viewCount || 0));
                  break;
          }
          
          filteredTopics = filtered;
          currentPage = 1;
          updateTopicsDisplay();
      }

      // é‡ç½®ç¯©é¸
      function resetFilters() {
          document.getElementById('searchInput').value = '';
          document.getElementById('categoryFilter').value = '';
          document.getElementById('sortFilter').value = 'newest';
          filteredTopics = [...allTopics];
          currentPage = 1;
          updateTopicsDisplay();
      }

      // åˆ‡æ›æ¨™ç±¤é 
      function showTab(tabName) {
          // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
          const contents = document.querySelectorAll('.tab-content');
          contents.forEach(content => content.classList.remove('active'));
          
          // ç§»é™¤æ‰€æœ‰å°èˆªé€£çµçš„activeç‹€æ…‹
          const navLinks = document.querySelectorAll('.nav-link');
          navLinks.forEach(link => link.classList.remove('active'));
          
          // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹
          const targetTab = document.getElementById(tabName);
          if (targetTab) {
              targetTab.classList.add('active');
          }
          
          // è¨­å®šå°æ‡‰å°èˆªé€£çµç‚ºactive
          const targetNavLink = document.querySelector(`[onclick="showTab('${tabName}')"]`);
          if (targetNavLink) {
              targetNavLink.classList.add('active');
          }
          
          // ç‰¹æ®Šè™•ç†
          if (tabName === 'admin' && currentUser.isAdmin) {
              loadAdminData();
          }
      }

      // è¼‰å…¥ç®¡ç†å“¡æ•¸æ“š
      async function loadAdminData() {
          try {
              const response = await apiCall('getAdminStats');
              if (response.success) {
                  const stats = response.data;
                  document.getElementById('adminTotalViews').textContent = stats.totalViews || 0;
                  document.getElementById('adminReportedContent').textContent = stats.reportedContent || 0;
                  document.getElementById('adminBlockedUsers').textContent = stats.blockedUsers || 0;
                  document.getElementById('adminApprovedContent').textContent = stats.approvedContent || 0;
              }
              
              await loadPendingItems();
          } catch (error) {
              console.error('è¼‰å…¥ç®¡ç†å“¡æ•¸æ“šå¤±æ•—:', error);
          }
      }

      // è¼‰å…¥å¾…è™•ç†äº‹é …
      async function loadPendingItems() {
          try {
              const response = await apiCall('getPendingItems');
              if (response.success) {
                  const container = document.getElementById('pendingItems');
                  const items = response.data || [];
                  
                  if (items.length === 0) {
                      container.innerHTML = '<p class="text-muted">ç›®å‰æ²’æœ‰å¾…è™•ç†äº‹é …</p>';
                      return;
                  }
                  
                  container.innerHTML = items.map(item => `
                      <div class="pending-item">
                          <div class="item-info">
                              <strong>${item.type}</strong>: ${item.description}
                              <br><small class="text-muted">${getTimeAgo(item.timestamp)}</small>
                          </div>
                          <div class="item-actions">
                              <button class="btn btn-success" onclick="approveItem('${item.id}')">
                                  <i class="fas fa-check"></i>
                                  æ‰¹å‡†
                              </button>
                              <button class="btn btn-danger" onclick="rejectItem('${item.id}')">
                                  <i class="fas fa-times"></i>
                                  æ‹’çµ•
                              </button>
                          </div>
                      </div>
                  `).join('');
              }
          } catch (error) {
              console.error('è¼‰å…¥å¾…è™•ç†äº‹é …å¤±æ•—:', error);
          }
      }

      // ç®¡ç†åŠŸèƒ½
      function manageCategories() {
          showNotification('åˆ†é¡ç®¡ç†åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
      }

      function manageUsers() {
          showNotification('ç”¨æˆ¶ç®¡ç†åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
      }

      function moderateContent() {
          showNotification('å…§å®¹å¯©æ ¸åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
      }

      function exportData() {
          showNotification('æ•¸æ“šåŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
      }

      function sendAnnouncement() {
          const message = prompt('è«‹è¼¸å…¥å…¬å‘Šå…§å®¹:');
          if (message && message.trim()) {
              sendLineNotification('è«–å£‡å…¬å‘Š', message.trim());
              showNotification('å…¬å‘Šå·²ç™¼é€', 'success');
          }
      }

      function generateReport() {
          showNotification('å ±å‘Šç”ŸæˆåŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
      }

      // å·¥å…·å‡½æ•¸
      function escapeHtml(text) {
          const div = document.createElement('div');
          div.textContent = text;
          return div.innerHTML;
      }

      function getTimeAgo(timestamp) {
          const now = new Date();
          const time = new Date(timestamp);
          const diff = now - time;
          
          const minutes = Math.floor(diff / 60000);
          const hours = Math.floor(diff / 3600000);
          const days = Math.floor(diff / 86400000);
          
          if (minutes < 1) return 'å‰›å‰›';
          if (minutes < 60) return `${minutes}åˆ†é˜å‰`;
          if (hours < 24) return `${hours}å°æ™‚å‰`;
          if (days < 7) return `${days}å¤©å‰`;
          
          return time.toLocaleDateString('zh-TW');
      }

      function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
              const later = () => {
                  clearTimeout(timeout);
                  func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
          };
      }

      function showLoading(show) {
          const overlay = document.getElementById('loadingOverlay');
          overlay.style.display = show ? 'flex' : 'none';
      }

      function showNotification(message, type = 'info') {
          const container = document.getElementById('notificationContainer');
          const notification = document.createElement('div');
          notification.className = `notification ${type}`;
          notification.innerHTML = `
              <i class="fas fa-${getNotificationIcon(type)}"></i>
              ${message}
          `;
          
          container.appendChild(notification);
          
          // é¡¯ç¤ºå‹•ç•«
          setTimeout(() => notification.classList.add('show'), 100);
          
          // è‡ªå‹•éš±è—
          setTimeout(() => {
              notification.classList.remove('show');
              setTimeout(() => container.removeChild(notification), 300);
          }, 4000);
      }

      function getNotificationIcon(type) {
          const icons = {
              'success': 'check-circle',
              'error': 'exclamation-circle',
              'warning': 'exclamation-triangle',
              'info': 'info-circle'
          };
          return icons[type] || 'info-circle';
      }

      function closeModal(modalId) {
          document.getElementById(modalId).style.display = 'none';
          if (modalId === 'replyModal') {
              document.getElementById('replyContent').value = '';
          }
      }

      function closeAllModals() {
          const modals = document.querySelectorAll('.modal');
          modals.forEach(modal => modal.style.display = 'none');
      }

      function resetCreateForm() {
          document.getElementById('createTopicForm').reset();
      }

      // è¡¨å–®é©—è­‰
      function validateTopicForm(data) {
          if (!data.category) {
              showNotification('è«‹é¸æ“‡ä¸»é¡Œåˆ†é¡', 'warning');
              return false;
          }
          
          if (!data.title || data.title.length < 5) {
              showNotification('ä¸»é¡Œæ¨™é¡Œè‡³å°‘éœ€è¦5å€‹å­—å…ƒ', 'warning');
              return false;
          }
          
          if (!data.content || data.content.length < 10) {
              showNotification('å…§å®¹æè¿°è‡³å°‘éœ€è¦10å€‹å­—å…ƒ', 'warning');
              return false;
          }
          
          return true;
      }

      // APIèª¿ç”¨
      async function apiCall(action, data = {}) {
          const url = CONFIG.GAS_URL;
          const payload = {
              action: action,
              data: data
          };
          
          try {
              const response = await fetch(url, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(payload)
              });
              
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              
              return await response.json();
          } catch (error) {
              console.error('APIèª¿ç”¨å¤±æ•—:', error);
              throw error;
          }
      }

      // LINEé€šçŸ¥
      async function sendLineNotification(type, message) {
          try {
              if (typeof liff !== 'undefined' && liff.isLoggedIn()) {
                  await liff.sendMessages([{
                      type: 'text',
                      text: `ğŸ”” ${type}\n\n${message}\n\nä¾†è‡ªå¸•é‡‘æ£®å¤šå…ƒåŒ–è«–å£‡`
                  }]);
              }
          } catch (error) {
              console.error('LINEé€šçŸ¥ç™¼é€å¤±æ•—:', error);
          }
      }

      // ç·¨è¼¯ä¸»é¡Œ
      function editTopic(topicId) {
          showNotification('ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
      }

      // åˆªé™¤ä¸»é¡Œ
      async function deleteTopic(topicId) {
          if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ä¸»é¡Œå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
              return;
          }
          
          try {
              showLoading(true);
              const response = await apiCall('deleteTopic', { topicId: topicId });
              
              if (response.success) {
                  showNotification('ä¸»é¡Œå·²åˆªé™¤', 'success');
                  await loadTopics();
              } else {
                  showNotification(response.error || 'åˆªé™¤å¤±æ•—', 'error');
              }
          } catch (error) {
              console.error('åˆªé™¤ä¸»é¡Œå¤±æ•—:', error);
              showNotification('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
          } finally {
              showLoading(false);
          }
      }

      // æ‰¹å‡†/æ‹’çµ•å¾…è™•ç†äº‹é …
      async function approveItem(itemId) {
          try {
              const response = await apiCall('moderateItem', { 
                  itemId: itemId, 
                  action: 'approve',
                  moderatorId: currentUser.id 
              });
              
              if (response.success) {
                  showNotification('å·²æ‰¹å‡†', 'success');
                  await loadPendingItems();
              } else {
                  showNotification('æ“ä½œå¤±æ•—', 'error');
              }
          } catch (error) {
              console.error('æ‰¹å‡†å¤±æ•—:', error);
              showNotification('æ“ä½œå¤±æ•—', 'error');
          }
      }

      async function rejectItem(itemId) {
          try {
              const response = await apiCall('moderateItem', { 
                  itemId: itemId, 
                  action: 'reject',
                  moderatorId: currentUser.id 
              });
              
              if (response.success) {
                  showNotification('å·²æ‹’çµ•', 'success');
                  await loadPendingItems();
              } else {
                  showNotification('æ“ä½œå¤±æ•—', 'error');
              }
          } catch (error) {
              console.error('æ‹’çµ•å¤±æ•—:', error);
              showNotification('æ“ä½œå¤±æ•—', 'error');
          }
      }

      // è™•ç†ç³»çµ±è¨­å®š
      async function handleSystemSettings(event) {
          event.preventDefault();
          
          const settings = {
              forumTitle: document.getElementById('forumTitle').value,
              maxTopicsPerPage: parseInt(document.getElementById('maxTopicsPerPage').value),
              enableRegistration: document.getElementById('enableRegistration').checked,
              enableGuestView: document.getElementById('enableGuestView').checked,
              enableAutoApprove: document.getElementById('enableAutoApprove').checked
          };
          
          try {
              showLoading(true);
              const response = await apiCall('updateSystemSettings', settings);
              
              if (response.success) {
                  showNotification('ç³»çµ±è¨­å®šå·²æ›´æ–°', 'success');
                  CONFIG.ITEMS_PER_PAGE = settings.maxTopicsPerPage;
                  updateTopicsDisplay();
              } else {
                  showNotification('æ›´æ–°å¤±æ•—', 'error');
              }
          } catch (error) {
              console.error('æ›´æ–°ç³»çµ±è¨­å®šå¤±æ•—:', error);
              showNotification('æ›´æ–°å¤±æ•—', 'error');
          } finally {
              showLoading(false);
          }
      }
  </script>
</body>
</html>

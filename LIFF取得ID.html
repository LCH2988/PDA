<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å–å¾— LINE ID å·¥å…·</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    .profile-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 15px;
      display: block;
    }
    .line-id {
      background: #e3f2fd;
      border: 2px solid #2196f3;
      border-radius: 10px;
      padding: 15px;
      font-family: monospace;
      font-size: 16px;
      word-break: break-all;
      margin: 15px 0;
    }
    .btn {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    .btn:hover {
      background: #1976d2;
    }
    .btn-success {
      background: #4caf50;
    }
    .btn-success:hover {
      background: #45a049;
    }
    .instructions {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    .code-block {
      background: #f1f3f4;
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 14px;
      overflow-x: auto;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="text-align: center; color: #333;">ğŸ” LINE ID å–å¾—å·¥å…·</h1>
    
    <div class="instructions">
      <h3>ğŸ“‹ ä½¿ç”¨èªªæ˜</h3>
      <ol>
        <li>è«‹åœ¨ LINE ä¸­é–‹å•Ÿæ­¤é é¢</li>
        <li>é»æ“Šã€Œå–å¾—æˆ‘çš„ LINE IDã€æŒ‰éˆ•</li>
        <li>è¤‡è£½é¡¯ç¤ºçš„ LINE ID</li>
        <li>å°‡ LINE ID åŠ å…¥åˆ° GAS å¾Œç«¯çš„ç®¡ç†å“¡æ¸…å–®ä¸­</li>
      </ol>
    </div>

    <div style="text-align: center;">
      <button class="btn" onclick="getLineId()">ğŸ” å–å¾—æˆ‘çš„ LINE ID</button>
    </div>

    <div id="profileInfo" style="display: none;">
      <div class="profile-card">
        <img id="userAvatar" class="avatar" src="" alt="é ­åƒ">
        <h3 id="userName"></h3>
        <p id="userStatus"></p>
        
        <div class="line-id">
          <strong>æ‚¨çš„ LINE IDï¼š</strong><br>
          <span id="lineId"></span>
        </div>
        
        <button class="btn btn-success" onclick="copyLineId()">ğŸ“‹ è¤‡è£½ LINE ID</button>
        <button class="btn" onclick="downloadConfig()">â¬‡ï¸ ä¸‹è¼‰è¨­å®šæª”</button>
      </div>
    </div>

    <div class="instructions">
      <h3>âš™ï¸ è¨­å®šæ­¥é©Ÿ</h3>
      <p><strong>1. è¤‡è£½ LINE ID å¾Œï¼Œè«‹åœ¨ GAS å¾Œç«¯ç¨‹å¼ä¸­æ‰¾åˆ°ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š</strong></p>
      <div class="code-block">
ADMIN_USERS: ['ç®¡ç†å“¡çš„LINE_ID'], // è«‹æ›¿æ›ç‚ºå¯¦éš›çš„ç®¡ç†å“¡LINE ID
      </div>
      
      <p><strong>2. å°‡å…¶æ›¿æ›ç‚ºï¼š</strong></p>
      <div class="code-block" id="configExample">
ADMIN_USERS: ['æ‚¨çš„LINE_ID'], // è«‹æ›¿æ›ç‚ºå¯¦éš›çš„ç®¡ç†å“¡LINE ID
      </div>
      
      <p><strong>3. å¦‚æœæœ‰å¤šå€‹ç®¡ç†å“¡ï¼Œå¯ä»¥é€™æ¨£è¨­å®šï¼š</strong></p>
      <div class="code-block">
ADMIN_USERS: [
'LINE_ID_1',
'LINE_ID_2', 
'LINE_ID_3'
],
      </div>
    </div>

    <div class="instructions">
      <h3>ğŸ”§ LIFF è¨­å®šè³‡è¨Š</h3>
      <p>è«‹ç¢ºä¿æ­¤é é¢ä½¿ç”¨çš„ LIFF ID èˆ‡ä¸»ç³»çµ±ç›¸åŒï¼š</p>
      <div class="code-block" id="liffInfo">
        LIFF ID: <span id="currentLiffId">è¼‰å…¥ä¸­...</span>
      </div>
    </div>
  </div>

  <script>
    // è«‹æ›¿æ›ç‚ºæ‚¨çš„å¯¦éš› LIFF ID
    const LIFF_ID = '1656516134-VaGgmaPm';
    
    let userProfile = null;

    async function initLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        document.getElementById('currentLiffId').textContent = LIFF_ID;
        
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        
        console.log('LIFF åˆå§‹åŒ–æˆåŠŸ');
      } catch (error) {
        console.error('LIFF åˆå§‹åŒ–å¤±æ•—:', error);
        alert('LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹ç¢ºèª LIFF ID æ˜¯å¦æ­£ç¢º');
      }
    }

    async function getLineId() {
      try {
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        userProfile = await liff.getProfile();
        
        document.getElementById('userAvatar').src = userProfile.pictureUrl || 'https://via.placeholder.com/80';
        document.getElementById('userName').textContent = userProfile.displayName;
        document.getElementById('userStatus').textContent = userProfile.statusMessage || 'ç„¡ç‹€æ…‹è¨Šæ¯';
        document.getElementById('lineId').textContent = userProfile.userId;
        
        // æ›´æ–°è¨­å®šç¯„ä¾‹
        document.getElementById('configExample').innerHTML = 
          `ADMIN_USERS: ['${userProfile.userId}'], // æ‚¨çš„ LINE ID`;
        
        document.getElementById('profileInfo').style.display = 'block';
        
        console.log('LINE ID:', userProfile.userId);
      } catch (error) {
        console.error('å–å¾— LINE ID å¤±æ•—:', error);
        alert('å–å¾— LINE ID å¤±æ•—: ' + error.message);
      }
    }

    function copyLineId() {
      if (!userProfile) return;
      
      const lineId = userProfile.userId;
      
      // å˜—è©¦ä½¿ç”¨æ–°çš„ Clipboard API
      if (navigator.clipboard) {
        navigator.clipboard.writeText(lineId).then(() => {
          alert('LINE ID å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(err => {
          fallbackCopyTextToClipboard(lineId);
        });
      } else {
        fallbackCopyTextToClipboard(lineId);
      }
    }

    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.top = "0";
      textArea.style.left = "0";
      textArea.style.position = "fixed";
      
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        const successful = document.execCommand('copy');
        if (successful) {
          alert('LINE ID å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        } else {
          alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ LINE ID');
        }
      } catch (err) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ LINE ID');
      }
      
      document.body.removeChild(textArea);
    }

    function downloadConfig() {
      if (!userProfile) return;
      
      const configText = `// å¸•é‡‘æ£®ç—…å‹æœƒç®¡ç†ç³»çµ± - ç®¡ç†å“¡è¨­å®š
// è«‹å°‡ä»¥ä¸‹è¨­å®šè¤‡è£½åˆ°æ‚¨çš„ GAS å¾Œç«¯ç¨‹å¼ä¸­

const CONFIG = {
// ... å…¶ä»–è¨­å®š ...
ADMIN_USERS: ['${userProfile.userId}'], // ${userProfile.displayName} çš„ LINE ID
// ... å…¶ä»–è¨­å®š ...
};

// è¨­å®šæ—¥æœŸ: ${new Date().toLocaleString('zh-TW')}
// ç®¡ç†å“¡: ${userProfile.displayName}
// LINE ID: ${userProfile.userId}
`;
      
      const blob = new Blob([configText], { type: 'text/plain' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = url;
      a.download = 'admin-config.js';
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
    }

    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ– LIFF
    window.addEventListener('load', initLiff);
  </script>
</body>
</html>

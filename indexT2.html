<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOGOå¤šç¦æ°£ åœ˜éšŠåˆ†æç³»çµ±</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 10px;
    min-height: 100vh;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .header {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    margin-bottom: 20px;
    text-align: center;
  }
  
  .header h1 {
    color: #667eea;
    font-size: 2em;
    margin-bottom: 10px;
  }
  
  /* åˆ†é æŒ‰éˆ• */
  .tab-buttons {
    display: flex;
    background: white;
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .tab-btn {
    flex: 1;
    min-width: 150px;
    padding: 12px 20px;
    background: #f3f4f6;
    color: #6b7280;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: all 0.3s;
  }
  
  .tab-btn:hover {
    background: #e5e7eb;
  }
  
  .tab-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }
  
  /* åˆ†é å…§å®¹ */
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
    animation: fadeIn 0.3s;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .btn {
    padding: 12px 20px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: background 0.3s;
    margin: 5px;
  }
  
  .btn:hover {
    background: #5568d3;
  }
  
  .team-container {
    background: white;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    page-break-inside: avoid;
  }
  
  .team-header {
    background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    font-size: 1.5em;
    font-weight: bold;
  }
  
  .section-title {
    background: #8b5cf6;
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: bold;
    margin: 15px 0 10px 0;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .stat-card {
    background: #f9fafb;
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid #8b5cf6;
    text-align: center;
  }
  
  .stat-card .label {
    color: #6b7280;
    font-size: 0.85em;
    margin-bottom: 5px;
  }
  
  .stat-card .value {
    color: #8b5cf6;
    font-size: 1.5em;
    font-weight: bold;
  }
  
  /* ç”¢å“éŠ·å”®ç‹€æ³è¡¨ */
  .product-status-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    font-size: 0.9em;
    background: white;
  }
  
  .product-status-table thead {
    background: #10b981;
    color: white;
  }
  
  .product-status-table th {
    padding: 10px 8px;
    text-align: left;
    font-weight: 600;
    color: #000 !important;
  }
  
  .product-status-table td {
    padding: 8px;
    border-bottom: 1px solid #e5e7eb;
    color: #000 !important;
  }
  
  .product-status-table tbody tr:hover {
    background: #f0fdf4;
  }
  
  /* çµ„åˆ¥çµ±è¨ˆè¡¨ */
  .group-summary-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
    font-size: 0.95em;
  }
  
  .group-summary-table thead {
    background: #8b5cf6;
    color: white;
  }
  
  .group-summary-table th {
    padding: 10px 8px;
    text-align: left;
    font-weight: 600;
    color: #000 !important;
  }
  
  .group-summary-table td {
    padding: 8px;
    border-bottom: 1px solid #e5e7eb;
    color: #000 !important;
  }
  
  .group-summary-table tbody tr:hover {
    background: #faf5ff;
  }
  
  /* äººå“¡æ˜ç´°è¡¨ */
  .person-block {
    border: 2px solid #8b5cf6;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    background: #faf5ff;
    page-break-inside: avoid;
  }
  
  .person-name {
    font-size: 1.2em;
    font-weight: bold;
    color: #6b21a8;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 2px solid #8b5cf6;
  }
  
  .person-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    font-size: 0.9em;
  }
  
  .person-table thead {
    background: #e9d5ff;
    color: #6b21a8;
  }
  
  .person-table th {
    padding: 8px;
    text-align: left;
    font-weight: 600;
    font-size: 0.9em;
    color: #000 !important;
  }
  
  .person-table td {
    padding: 6px 8px;
    border-bottom: 1px solid #f3f4f6;
    color: #000 !important;
  }
  
  .person-table .total-row {
    background: #fef3c7;
    font-weight: bold;
    color: #92400e !important;
  }
  
  .person-table .total-row td {
    padding: 8px;
    border-top: 2px solid #f59e0b;
    color: #92400e !important;
  }
  
  /* æ¯”è¼ƒè¡¨æ ¼ */
  .comparison-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    font-size: 0.85em;
  }
  
  .comparison-table thead {
    background: #10b981;
    color: white;
  }
  
  .comparison-table th {
    padding: 10px 6px;
    text-align: center;
    font-weight: 600;
    border: 1px solid white;
    color: #000 !important;
  }
  
  .comparison-table td {
    padding: 8px 6px;
    text-align: center;
    border: 1px solid #e5e7eb;
    color: #000 !important;
  }
  
  .comparison-table td:first-child {
    text-align: left;
    font-weight: 600;
    background: #f9fafb;
  }
  
  .comparison-table .total-row {
    background: #fef3c7 !important;
    font-weight: bold;
  }
  
  .comparison-table .total-row td {
    color: #92400e !important;
    border-top: 2px solid #f59e0b;
  }
  
  .comparison-table .subtotal-col {
    background: #e0f2fe !important;
    font-weight: 600;
  }
  
  .team-color-1 { background: #fef3c7 !important; }
  .team-color-2 { background: #dbeafe !important; }
  .team-color-3 { background: #fce7f3 !important; }
  .team-color-4 { background: #d1fae5 !important; }
  .team-color-5 { background: #fef2f2 !important; }
  .team-color-6 { background: #f3e8ff !important; }
  
  /* æœå°‹å€åŸŸ */
  .search-bar {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  .search-input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1em;
    margin-bottom: 10px;
  }
  
  .search-input:focus {
    outline: none;
    border-color: #667eea;
  }
  
  .search-results {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: #f9fafb;
  }
  
  .search-result-item {
    padding: 12px 15px;
    border-bottom: 1px solid #e5e7eb;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  .search-result-item:hover {
    background: #e0f2fe;
  }
  
  .search-result-item:last-child {
    border-bottom: none;
  }
  
  .filter-bar {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  select {
    padding: 10px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1em;
  }
  
  .loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
  }
  
  .loading.show {
    display: flex;
  }
  
  .spinner {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #667eea;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .sync-status {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85em;
    margin-left: 10px;
  }
  
  .sync-status.synced {
    background: #d1fae5;
    color: #065f46;
  }
  
  .maintenance-warning {
    color: #dc2626;
    font-size: 0.9em;
    font-weight: bold;
    margin-left: 10px;
  }
  
  /* åˆ—å°æ¨£å¼ */
  @media print {
    body {
      background: white;
      padding: 0;
    }
    
    .header, .filter-bar, .tab-buttons, .search-bar {
      display: none;
    }
    
    .container {
      max-width: 100%;
    }
    
    .team-container {
      page-break-inside: avoid;
      box-shadow: none;
      border: 1px solid #ddd;
    }
    
    .person-block {
      page-break-inside: avoid;
    }
  }
  
  @media (max-width: 768px) {
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .tab-btn {
      min-width: 120px;
      font-size: 0.9em;
      padding: 10px 15px;
    }
  }
</style>
</head>
<body>
<div class="loading" id="loading">
  <div class="spinner"></div>
  <div style="color: white; font-size: 1.2em;">è¼‰å…¥ä¸­...</div>
</div>

<div class="container">
  <div class="header">
    <h1>ğŸ¯ BOGOå¤šç¦æ°£ åœ˜éšŠåˆ†æç³»çµ±</h1>
    <p>ä»¥åœ˜éšŠç‚ºä¸»è»¸çš„å®Œæ•´è¨‚è³¼èˆ‡æ¶è³¼åˆ†æ
      <span class="sync-status synced" id="syncStatus">â— å·²åŒæ­¥</span>
    </p>
  </div>
  
  <!-- åˆ†é æŒ‰éˆ• -->
  <div class="tab-buttons">
    <button class="tab-btn active" onclick="switchTab('overview')">ğŸ“Š ç¸½åˆ†æç‹€æ³</button>
    <button class="tab-btn" onclick="switchTab('orderSummary')">ğŸ“¦ è¨‚è³¼çµ„åˆ¥çµ±è¨ˆ</button>
    <button class="tab-btn" onclick="switchTab('orderDetail')">ğŸ“‹ è¨‚è³¼è©³ç´°æ¸…å–®</button>
    <button class="tab-btn" onclick="switchTab('reportSummary')">ğŸ¯ æ¶è³¼çµ„åˆ¥çµ±è¨ˆ</button>
    <button class="tab-btn" onclick="switchTab('reportDetail')">ğŸ æ¶è³¼è©³ç´°æ¸…å–®</button>
    <button class="tab-btn" onclick="switchTab('search')">ğŸ” æœå°‹</button>
  </div>
  
  <!-- åˆ†é å…§å®¹ -->
  
  <!-- 1. ç¸½åˆ†æç‹€æ³ -->
  <div id="overviewTab" class="tab-content active">
    <div class="filter-bar">
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
    </div>
    
    <div class="team-container">
      <h3 style="color: #000; font-size: 1.3em; margin-bottom: 15px;">ğŸ“¦ ç”¢å“éŠ·å”®ç‹€æ³</h3>
      <table class="product-status-table" id="productStatusTable"></table>
    </div>
    
    <div class="team-container">
      <h3 style="color: #000; font-size: 1.3em; margin-bottom: 15px;">
        ğŸ“Š åœ˜éšŠç”¢å“çµ„æ•¸çµ±è¨ˆ
        <span class="maintenance-warning" id="maintenanceWarning" style="display: none;">âš ï¸ éœ€ç¶­è­·åœ˜éšŠåå–®</span>
      </h3>
      <div style="overflow-x: auto;">
        <table class="comparison-table" id="comparisonTable"></table>
      </div>
    </div>
  </div>
  
  <!-- 2. è¨‚è³¼çµ„åˆ¥çµ±è¨ˆ -->
  <div id="orderSummaryTab" class="tab-content">
    <div class="filter-bar">
      <label>åœ˜éšŠï¼š</label>
      <select id="orderSummaryTeamFilter" onchange="displayOrderSummary()">
        <option value="all">å…¨éƒ¨åœ˜éšŠ</option>
      </select>
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
    </div>
    <div id="orderSummaryContent"></div>
  </div>
  
  <!-- 3. è¨‚è³¼è©³ç´°æ¸…å–® -->
  <div id="orderDetailTab" class="tab-content">
    <div class="filter-bar">
      <label>åœ˜éšŠï¼š</label>
      <select id="orderDetailTeamFilter" onchange="displayOrderDetail()">
        <option value="all">å…¨éƒ¨åœ˜éšŠ</option>
      </select>
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
    </div>
    <div id="orderDetailContent"></div>
  </div>
  
  <!-- 4. æ¶è³¼çµ„åˆ¥çµ±è¨ˆ -->
  <div id="reportSummaryTab" class="tab-content">
    <div class="filter-bar">
      <label>åœ˜éšŠï¼š</label>
      <select id="reportSummaryTeamFilter" onchange="displayReportSummary()">
        <option value="all">å…¨éƒ¨åœ˜éšŠ</option>
      </select>
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
    </div>
    <div id="reportSummaryContent"></div>
  </div>
  
  <!-- 5. æ¶è³¼è©³ç´°æ¸…å–® -->
  <div id="reportDetailTab" class="tab-content">
    <div class="filter-bar">
      <label>åœ˜éšŠï¼š</label>
      <select id="reportDetailTeamFilter" onchange="displayReportDetail()">
        <option value="all">å…¨éƒ¨åœ˜éšŠ</option>
      </select>
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
    </div>
    <div id="reportDetailContent"></div>
  </div>
  
  <!-- 6. æœå°‹ -->
  <div id="searchTab" class="tab-content">
    <div class="search-bar">
      <input type="text" class="search-input" id="searchInput" 
             placeholder="è¼¸å…¥å§“åé—œéµå­—æœå°‹..." 
             oninput="performSearch()">
      <div class="search-results" id="searchResults" style="display: none;"></div>
    </div>
    <div id="searchDetailContent"></div>
  </div>
</div>

<script>
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbx4xr4X6lfiGzc7Bh--vlgrWgS-t9gcG73zAfqEmFHlkb5Moz0SXBEZTWLJhtupf-GB9A/exec';
  
  let allOrders = [];
  let allReports = [];
  let maintenanceData = [];
  let teamAnalysisData = {};
  let productNameMap = {};
  let productSalesData = {};
  let needsMaintenance = false;
  let allPeople = new Set();
  
  const TEAM_ORDER = ['è¯è±', 'æ€¡æ–‡', 'å°é¡', 'å®¶å˜‰', 'è‹”ç'];
  
  function sortTeams(teams) {
    return teams.sort((a, b) => {
      const indexA = TEAM_ORDER.indexOf(a);
      const indexB = TEAM_ORDER.indexOf(b);
      
      if (indexA !== -1 && indexB !== -1) {
        return indexA - indexB;
      }
      if (indexA !== -1) return -1;
      if (indexB !== -1) return 1;
      return a.localeCompare(b);
    });
  }
  
  function sortGroupCode(a, b) {
    const order = ['1A', '1B', '2A', '2B', '3A', '3B', '4A', '4B', '5A', '5B'];
    const indexA = order.indexOf(a);
    const indexB = order.indexOf(b);
    
    if (indexA !== -1 && indexB !== -1) return indexA - indexB;
    if (indexA !== -1) return -1;
    if (indexB !== -1) return 1;
    return a.localeCompare(b);
  }
  
  function showLoading(show) {
    document.getElementById('loading').classList.toggle('show', show);
  }
  
  function updateSyncStatus() {
    const syncStatus = document.getElementById('syncStatus');
    const now = new Date();
    syncStatus.textContent = `â— å·²åŒæ­¥ ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
  }
  
  // åˆ‡æ›åˆ†é 
  function switchTab(tabName) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + 'Tab').classList.add('active');
    
    switch(tabName) {
      case 'orderSummary':
        displayOrderSummary();
        break;
      case 'orderDetail':
        displayOrderDetail();
        break;
      case 'reportSummary':
        displayReportSummary();
        break;
      case 'reportDetail':
        displayReportDetail();
        break;
    }
  }
  
  async function autoConnectAndAnalyze(silent = false) {
    if (!silent) showLoading(true);
    
    try {
      const [ordersRes, reportsRes, maintenanceRes] = await Promise.all([
        fetch(WEB_APP_URL + '?action=getOrders'),
        fetch(WEB_APP_URL + '?action=getReports'),
        fetch(WEB_APP_URL + '?action=getMaintenance')
      ]);
      
      const ordersResult = await ordersRes.json();
      const reportsResult = await reportsRes.json();
      const maintenanceResult = await maintenanceRes.json();
      
      if (!ordersResult.success || !reportsResult.success) {
        throw new Error('è¼‰å…¥è³‡æ–™å¤±æ•—');
      }
      
      allOrders = ordersResult.data;
      allReports = reportsResult.data;
      maintenanceData = maintenanceResult.success ? maintenanceResult.data : [];
      
      allOrders.forEach(order => {
        const groupCode = order.çµ„åˆ¥ä»£è™Ÿ || order.çµ„åˆ¥;
        const productName = order['ç”¢å“åç¨±( BOGOå°ˆç”¨ )'] || groupCode;
        if (groupCode && !productNameMap[groupCode]) {
          productNameMap[groupCode] = productName;
        }
      });
      
      analyzeProductSales();
      analyzeByTeam();
      updateSyncStatus();
      updateTeamFilters();
      
    } catch (error) {
      console.error(error);
      alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message);
    } finally {
      if (!silent) showLoading(false);
    }
  }
  
  function analyzeProductSales() {
    productSalesData = {};
    
    allOrders.forEach(order => {
      const groupCode = order.çµ„åˆ¥ä»£è™Ÿ || order.çµ„åˆ¥ || 'æœªåˆ†çµ„';
      const productName = order['ç”¢å“åç¨±( BOGOå°ˆç”¨ )'] || groupCode;
      const qty = parseInt(order.è¨‚è³¼æ•¸é‡) || 0;
      const amount = parseInt(order.åˆè¨ˆ) || 0;
      
      if (!productSalesData[groupCode]) {
        productSalesData[groupCode] = {
          productName: productName,
          orderQty: 0,
          orderAmount: 0,
          reportQty: 0,
          reportAmount: 0
        };
      }
      
      productSalesData[groupCode].orderQty += qty;
      productSalesData[groupCode].orderAmount += amount;
    });
    
    allReports.forEach(report => {
      const groupCode = report.çµ„åˆ¥ä»£è™Ÿ || 'æœªåˆ†çµ„';
      const qty = parseInt(report.æ¶è³¼çµ„æ•¸) || 0;
      const price = parseInt(report.å–®åƒ¹) || 0;
      const amount = qty * price;
      
      if (!productSalesData[groupCode]) {
        productSalesData[groupCode] = {
          productName: productNameMap[groupCode] || groupCode,
          orderQty: 0,
          orderAmount: 0,
          reportQty: 0,
          reportAmount: 0
        };
      }
      
      productSalesData[groupCode].reportQty += qty;
      productSalesData[groupCode].reportAmount += amount;
    });
    
    displayProductStatus();
  }
  
  function displayProductStatus() {
    const table = document.getElementById('productStatusTable');
    
    let html = '<thead><tr>';
    html += '<th style="color: #000;">çµ„åˆ¥ä»£è™Ÿ</th>';
    html += '<th style="color: #000;">ç”¢å“åç¨±</th>';
    html += '<th style="text-align: center; color: #000;">è¨‚è³¼æ•¸é‡</th>';
    html += '<th style="text-align: right; color: #000;">è¨‚è³¼é‡‘é¡</th>';
    html += '<th style="text-align: center; color: #000;">æ¶è³¼æ•¸é‡</th>';
    html += '<th style="text-align: right; color: #000;">æ¶è³¼é‡‘é¡</th>';
    html += '<th style="text-align: center; color: #000;">ç¸½æ•¸é‡</th>';
    html += '<th style="text-align: right; color: #000;">ç¸½é‡‘é¡</th>';
    html += '</tr></thead><tbody>';
    
    const sortedGroups = Object.keys(productSalesData).sort(sortGroupCode);
    
    let totalOrderQty = 0, totalOrderAmount = 0;
    let totalReportQty = 0, totalReportAmount = 0;
    
    sortedGroups.forEach(groupCode => {
      const data = productSalesData[groupCode];
      
      html += '<tr>';
      html += `<td style="color: #000;"><strong>${groupCode}</strong></td>`;
      html += `<td style="color: #000;">${data.productName}</td>`;
      html += `<td style="text-align: center; color: #000;">${data.orderQty}</td>`;
      html += `<td style="text-align: right; color: #000;">$${data.orderAmount.toLocaleString()}</td>`;
      html += `<td style="text-align: center; color: #000;">${data.reportQty}</td>`;
      html += `<td style="text-align: right; color: #000;">$${data.reportAmount.toLocaleString()}</td>`;
      
      const totalQty = data.orderQty + data.reportQty;
      const totalAmount = data.orderAmount + data.reportAmount;
      html += `<td style="text-align: center; color: #000;"><strong>${totalQty}</strong></td>`;
      html += `<td style="text-align: right; color: #000;"><strong>$${totalAmount.toLocaleString()}</strong></td>`;
      html += '</tr>';
      
      totalOrderQty += data.orderQty;
      totalOrderAmount += data.orderAmount;
      totalReportQty += data.reportQty;
      totalReportAmount += data.reportAmount;
    });
    
    html += '<tr style="background: #fef3c7; font-weight: bold;">';
    html += '<td colspan="2" style="color: #92400e;">ç¸½è¨ˆ</td>';
    html += `<td style="text-align: center; color: #92400e;">${totalOrderQty}</td>`;
    html += `<td style="text-align: right; color: #92400e;">$${totalOrderAmount.toLocaleString()}</td>`;
    html += `<td style="text-align: center; color: #92400e;">${totalReportQty}</td>`;
    html += `<td style="text-align: right; color: #92400e;">$${totalReportAmount.toLocaleString()}</td>`;
    html += `<td style="text-align: center; color: #92400e;">${totalOrderQty + totalReportQty}</td>`;
    html += `<td style="text-align: right; color: #92400e;">$${(totalOrderAmount + totalReportAmount).toLocaleString()}</td>`;
    html += '</tr>';
    html += '</tbody>';
    
    table.innerHTML = html;
  }
  
  function analyzeByTeam() {
    teamAnalysisData = {};
    needsMaintenance = false;
    allPeople.clear();
    
    const nameToTeamMap = {};
    maintenanceData.forEach(item => {
      if (item.è¨‚è³¼åå–® && item.åœ˜éšŠ) {
        nameToTeamMap[item.è¨‚è³¼åå–®] = item.åœ˜éšŠ;
        if (item.åœ˜éšŠ.includes('è«‹ç¶­è­·')) {
          needsMaintenance = true;
        }
      }
    });
    
    allReports.forEach(report => {
      if (report.æ¶è³¼è€… && report.åœ˜éšŠ) {
        nameToTeamMap[report.æ¶è³¼è€…] = report.åœ˜éšŠ;
        if (report.åœ˜éšŠ.includes('è«‹ç¶­è­·')) {
          needsMaintenance = true;
        }
      }
    });
    
    const warningElement = document.getElementById('maintenanceWarning');
    if (needsMaintenance) {
      warningElement.style.display = 'inline';
    } else {
      warningElement.style.display = 'none';
    }
    
    allOrders.forEach(order => {
      const name = order.LINEåç¨±.split('(ä»£)')[0].trim();
      allPeople.add(name);
      let team = order.åœ˜éšŠ || nameToTeamMap[name] || nameToTeamMap[order.LINEåç¨±] || 'æœªåˆ†é…';
      team = team.replace(/è«‹ç¶­è­·\s*-*>\s*/g, '').trim();
      
      const groupCode = order.çµ„åˆ¥ä»£è™Ÿ || order.çµ„åˆ¥ || 'æœªåˆ†çµ„';
      const productName = order['ç”¢å“åç¨±( BOGOå°ˆç”¨ )'] || groupCode;
      
      if (!teamAnalysisData[team]) {
        teamAnalysisData[team] = {
          orders: {},
          reports: {},
          groupSummary: {},
          reportGroupSummary: {},
          totalOrderQty: 0,
          totalOrderAmount: 0,
          totalReportQty: 0,
          totalReportAmount: 0
        };
      }
      
      if (!teamAnalysisData[team].orders[name]) {
        teamAnalysisData[team].orders[name] = {};
      }
      
      if (!teamAnalysisData[team].orders[name][groupCode]) {
        teamAnalysisData[team].orders[name][groupCode] = {
          productName: productName,
          qty: 0,
          amount: 0,
          price: 0
        };
      }
      
      const qty = parseInt(order.è¨‚è³¼æ•¸é‡) || 0;
      const price = parseInt(order.å–®åƒ¹) || 0;
      const amount = parseInt(order.åˆè¨ˆ) || (qty * price);
      
      teamAnalysisData[team].orders[name][groupCode].qty += qty;
      teamAnalysisData[team].orders[name][groupCode].amount += amount;
      teamAnalysisData[team].orders[name][groupCode].price = price;
      
      if (!teamAnalysisData[team].groupSummary[groupCode]) {
        teamAnalysisData[team].groupSummary[groupCode] = { qty: 0, amount: 0 };
      }
      teamAnalysisData[team].groupSummary[groupCode].qty += qty;
      teamAnalysisData[team].groupSummary[groupCode].amount += amount;
      
      teamAnalysisData[team].totalOrderQty += qty;
      teamAnalysisData[team].totalOrderAmount += amount;
    });
    
    allReports.forEach(report => {
      const buyer = report.æ¶è³¼è€…;
      allPeople.add(buyer);
      let team = report.åœ˜éšŠ || 'æœªåˆ†é…';
      team = team.replace(/è«‹ç¶­è­·\s*-*>\s*/g, '').trim();
      
      const groupCode = report.çµ„åˆ¥ä»£è™Ÿ || 'æœªåˆ†çµ„';
      
      if (!teamAnalysisData[team]) {
        teamAnalysisData[team] = {
          orders: {},
          reports: {},
          groupSummary: {},
          reportGroupSummary: {},
          totalOrderQty: 0,
          totalOrderAmount: 0,
          totalReportQty: 0,
          totalReportAmount: 0
        };
      }
      
      if (!teamAnalysisData[team].reports[buyer]) {
        teamAnalysisData[team].reports[buyer] = {};
      }
      
      if (!teamAnalysisData[team].reports[buyer][groupCode]) {
        teamAnalysisData[team].reports[buyer][groupCode] = {
          qty: 0,
          amount: 0,
          price: 0,
          buySend: report['è²·/é€'] || ''
        };
      }
      
      const qty = parseInt(report.æ¶è³¼çµ„æ•¸) || 0;
      const price = parseInt(report.å–®åƒ¹) || 0;
      const amount = qty * price;
      
      teamAnalysisData[team].reports[buyer][groupCode].qty += qty;
      teamAnalysisData[team].reports[buyer][groupCode].amount += amount;
      teamAnalysisData[team].reports[buyer][groupCode].price = price;
      
      if (!teamAnalysisData[team].reportGroupSummary[groupCode]) {
        teamAnalysisData[team].reportGroupSummary[groupCode] = { qty: 0, amount: 0 };
      }
      teamAnalysisData[team].reportGroupSummary[groupCode].qty += qty;
      teamAnalysisData[team].reportGroupSummary[groupCode].amount += amount;
      
      teamAnalysisData[team].totalReportQty += qty;
      teamAnalysisData[team].totalReportAmount += amount;
    });
    
    displayComparisonTable();
  }
  
  function displayComparisonTable() {
    const table = document.getElementById('comparisonTable');
    const teams = sortTeams(Object.keys(teamAnalysisData));
    
    const allGroups = new Set();
    teams.forEach(team => {
      Object.keys(teamAnalysisData[team].groupSummary).forEach(g => allGroups.add(g));
      Object.keys(teamAnalysisData[team].reportGroupSummary).forEach(g => allGroups.add(g));
    });
    
    const sortedGroups = Array.from(allGroups).sort(sortGroupCode);
    
    let html = '<thead><tr><th style="color: #000;">çµ„åˆ¥</th>';
    html += '<th style="color: #000; background: #e0f2fe;">è¨‚è³¼åˆè¨ˆ</th>';
    html += '<th style="color: #000; background: #e0f2fe;">æ¶è³¼åˆè¨ˆ</th>';
    
    teams.forEach((team, index) => {
      const colorClass = `team-color-${(index % 6) + 1}`;
      html += `<th class="${colorClass}" colspan="2" style="color: #000;">${team}</th>`;
    });
    
    html += '</tr>';
    html += '<tr><th style="color: #000;"></th>';
    html += '<th style="color: #000; background: #e0f2fe;"></th>';
    html += '<th style="color: #000; background: #e0f2fe;"></th>';
    teams.forEach((team, index) => {
      const colorClass = `team-color-${(index % 6) + 1}`;
      html += `<th class="${colorClass}" style="color: #000;">è¨‚è³¼</th><th class="${colorClass}" style="color: #000;">æ¶è³¼</th>`;
    });
    html += '</tr></thead><tbody>';
    
    sortedGroups.forEach(group => {
      html += `<tr><td style="color: #000;"><strong>${group}</strong></td>`;
      
      let groupOrderTotal = 0;
      let groupReportTotal = 0;
      
      teams.forEach(team => {
        const data = teamAnalysisData[team];
        groupOrderTotal += data.groupSummary[group]?.qty || 0;
        groupReportTotal += data.reportGroupSummary[group]?.qty || 0;
      });
      
      html += `<td class="subtotal-col" style="color: #000;"><strong>${groupOrderTotal}</strong></td>`;
      html += `<td class="subtotal-col" style="color: #000;"><strong>${groupReportTotal}</strong></td>`;
      
      teams.forEach((team, index) => {
        const data = teamAnalysisData[team];
        const colorClass = `team-color-${(index % 6) + 1}`;
        
        const orderQty = data.groupSummary[group]?.qty || 0;
        const reportQty = data.reportGroupSummary[group]?.qty || 0;
        html += `<td class="${colorClass}" style="color: #000;">${orderQty > 0 ? orderQty : '-'}</td>`;
        html += `<td class="${colorClass}" style="color: #000;">${reportQty > 0 ? reportQty : '-'}</td>`;
      });
      
      html += '</tr>';
    });
    
    html += '<tr class="total-row"><td style="color: #92400e;"><strong>åˆè¨ˆçµ„æ•¸</strong></td>';
    
    let grandOrderTotal = 0;
    let grandReportTotal = 0;
    teams.forEach(team => {
      const data = teamAnalysisData[team];
      grandOrderTotal += data.totalOrderQty;
      grandReportTotal += data.totalReportQty;
    });
    
    html += `<td class="subtotal-col" style="color: #92400e;"><strong>${grandOrderTotal}</strong></td>`;
    html += `<td class="subtotal-col" style="color: #92400e;"><strong>${grandReportTotal}</strong></td>`;
    
    teams.forEach((team, index) => {
      const data = teamAnalysisData[team];
      const colorClass = `team-color-${(index % 6) + 1}`;
      html += `<td class="${colorClass}" style="color: #92400e;"><strong>${data.totalOrderQty}</strong></td>`;
      html += `<td class="${colorClass}" style="color: #92400e;"><strong>${data.totalReportQty}</strong></td>`;
    });
    
    html += '</tr>';
    html += '</tbody>';
    table.innerHTML = html;
  }
  
  function updateTeamFilters() {
    const teams = sortTeams(Object.keys(teamAnalysisData));
    const filters = [
      'orderSummaryTeamFilter',
      'orderDetailTeamFilter',
      'reportSummaryTeamFilter',
      'reportDetailTeamFilter'
    ];
    
    filters.forEach(filterId => {
      const filter = document.getElementById(filterId);
      filter.innerHTML = '<option value="all">å…¨éƒ¨åœ˜éšŠ</option>';
      teams.forEach(team => {
        filter.innerHTML += `<option value="${team}">${team}</option>`;
      });
    });
  }
  
  function displayOrderSummary() {
    const selectedTeam = document.getElementById('orderSummaryTeamFilter').value;
    const container = document.getElementById('orderSummaryContent');
    
    const teamsToShow = selectedTeam === 'all' 
      ? sortTeams(Object.keys(teamAnalysisData))
      : [selectedTeam];
    
    let html = '';
    
    teamsToShow.forEach(team => {
      const data = teamAnalysisData[team];
      
      if (Object.keys(data.groupSummary).length === 0) return;
      
      html += `
        <div class="team-container">
          <div class="team-header">ğŸ¢ ${team} - è¨‚è³¼çµ„åˆ¥çµ±è¨ˆ</div>
          <table class="group-summary-table">
            <thead>
              <tr>
                <th style="color: #000;">çµ„åˆ¥</th>
                <th style="color: #000;">ç”¢å“åç¨±</th>
                <th style="text-align: center; color: #000;">æ•¸é‡</th>
                <th style="text-align: right; color: #000;">é‡‘é¡</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      const sortedGroups = Object.keys(data.groupSummary).sort(sortGroupCode);
      sortedGroups.forEach(groupCode => {
        const stats = data.groupSummary[groupCode];
        const productName = productNameMap[groupCode] || groupCode;
        html += `
          <tr>
            <td style="color: #000;"><strong>${groupCode}</strong></td>
            <td style="color: #000;">${productName}</td>
            <td style="text-align: center; color: #000;">${stats.qty} çµ„</td>
            <td style="text-align: right; color: #000;">$${stats.amount.toLocaleString()}</td>
          </tr>
        `;
      });
      
      html += `
            <tr style="background: #fef3c7; font-weight: bold;">
              <td colspan="2" style="color: #92400e;">ç¸½è¨ˆ</td>
              <td style="text-align: center; color: #92400e;">${data.totalOrderQty} çµ„</td>
              <td style="text-align: right; color: #92400e;">$${data.totalOrderAmount.toLocaleString()}</td>
            </tr>
          </tbody>
        </table>
      </div>
      `;
    });
    
    container.innerHTML = html || '<div class="team-container"><p style="text-align: center; color: #999;">æš«ç„¡è¨‚è³¼è³‡æ–™</p></div>';
  }
  
  function displayOrderDetail() {
    const selectedTeam = document.getElementById('orderDetailTeamFilter').value;
    const container = document.getElementById('orderDetailContent');
    
    const teamsToShow = selectedTeam === 'all' 
      ? sortTeams(Object.keys(teamAnalysisData))
      : [selectedTeam];
    
    let html = '';
    
    teamsToShow.forEach(team => {
      const data = teamAnalysisData[team];
      
      if (Object.keys(data.orders).length === 0) return;
      
      html += `<div class="team-container"><div class="team-header">ğŸ¢ ${team} - è¨‚è³¼è©³ç´°æ¸…å–®</div>`;
      
      for (const [person, groups] of Object.entries(data.orders)) {
        html += `
          <div class="person-block">
            <div class="person-name">ğŸ‘¤ ${person}</div>
            <table class="person-table">
              <thead>
                <tr>
                  <th style="color: #000;">çµ„åˆ¥</th>
                  <th style="color: #000;">ç”¢å“åç¨±</th>
                  <th style="text-align: center; color: #000;">æ•¸é‡</th>
                  <th style="text-align: right; color: #000;">å–®åƒ¹</th>
                  <th style="text-align: right; color: #000;">é‡‘é¡</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        let personTotal = { qty: 0, amount: 0 };
        const sortedGroupCodes = Object.keys(groups).sort(sortGroupCode);
        
        for (const groupCode of sortedGroupCodes) {
          const groupData = groups[groupCode];
          html += `
            <tr>
              <td style="color: #000;">${groupCode}</td>
              <td style="color: #000;">${groupData.productName}</td>
              <td style="text-align: center; color: #000;">${groupData.qty}</td>
              <td style="text-align: right; color: #000;">$${groupData.price.toLocaleString()}</td>
              <td style="text-align: right; color: #000;">$${groupData.amount.toLocaleString()}</td>
            </tr>
          `;
          personTotal.qty += groupData.qty;
          personTotal.amount += groupData.amount;
        }
        
        html += `
            <tr class="total-row">
              <td colspan="2" style="color: #92400e;"><strong>ç¸½è¨ˆ</strong></td>
              <td style="text-align: center; color: #92400e;"><strong>${personTotal.qty}</strong></td>
              <td style="color: #92400e;"></td>
              <td style="text-align: right; color: #92400e;"><strong>$${personTotal.amount.toLocaleString()}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
        `;
      }
      
      html += `</div>`;
    });
    
    container.innerHTML = html || '<div class="team-container"><p style="text-align: center; color: #999;">æš«ç„¡è¨‚è³¼è³‡æ–™</p></div>';
  }
  
  function displayReportSummary() {
    const selectedTeam = document.getElementById('reportSummaryTeamFilter').value;
    const container = document.getElementById('reportSummaryContent');
    
    const teamsToShow = selectedTeam === 'all' 
      ? sortTeams(Object.keys(teamAnalysisData))
      : [selectedTeam];
    
    let html = '';
    
    teamsToShow.forEach(team => {
      const data = teamAnalysisData[team];
      
      if (Object.keys(data.reportGroupSummary).length === 0) return;
      
      html += `
        <div class="team-container">
          <div class="team-header">ğŸ¢ ${team} - æ¶è³¼çµ„åˆ¥çµ±è¨ˆ</div>
          <table class="group-summary-table">
            <thead>
              <tr>
                <th style="color: #000;">çµ„åˆ¥</th>
                <th style="color: #000;">ç”¢å“åç¨±</th>
                <th style="text-align: center; color: #000;">æ•¸é‡</th>
                <th style="text-align: right; color: #000;">é‡‘é¡</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      const sortedReportGroups = Object.keys(data.reportGroupSummary).sort(sortGroupCode);
      sortedReportGroups.forEach(groupCode => {
        const stats = data.reportGroupSummary[groupCode];
        const productName = productNameMap[groupCode] || groupCode;
        html += `
          <tr>
            <td style="color: #000;"><strong>${groupCode}</strong></td>
            <td style="color: #000;">${productName}</td>
            <td style="text-align: center; color: #000;">${stats.qty} çµ„</td>
            <td style="text-align: right; color: #000;">$${stats.amount.toLocaleString()}</td>
          </tr>
        `;
      });
      
      html += `
            <tr style="background: #fef3c7; font-weight: bold;">
              <td colspan="2" style="color: #92400e;">ç¸½è¨ˆ</td>
              <td style="text-align: center; color: #92400e;">${data.totalReportQty} çµ„</td>
              <td style="text-align: right; color: #92400e;">$${data.totalReportAmount.toLocaleString()}</td>
            </tr>
          </tbody>
        </table>
      </div>
      `;
    });
    
    container.innerHTML = html || '<div class="team-container"><p style="text-align: center; color: #999;">æš«ç„¡æ¶è³¼è³‡æ–™</p></div>';
  }
  
  function displayReportDetail() {
    const selectedTeam = document.getElementById('reportDetailTeamFilter').value;
    const container = document.getElementById('reportDetailContent');
    
    const teamsToShow = selectedTeam === 'all' 
      ? sortTeams(Object.keys(teamAnalysisData))
      : [selectedTeam];
    
    let html = '';
    
    teamsToShow.forEach(team => {
      const data = teamAnalysisData[team];
      
      if (Object.keys(data.reports).length === 0) return;
      
      html += `<div class="team-container"><div class="team-header">ğŸ¢ ${team} - æ¶è³¼è©³ç´°æ¸…å–®</div>`;
      
      for (const [buyer, groups] of Object.entries(data.reports)) {
        html += `
          <div class="person-block">
            <div class="person-name">ğŸ‘¤ ${buyer}</div>
            <table class="person-table">
              <thead>
                <tr>
                  <th style="color: #000;">çµ„åˆ¥</th>
                  <th style="color: #000;">è²·/é€</th>
                  <th style="text-align: center; color: #000;">æ•¸é‡</th>
                  <th style="text-align: right; color: #000;">å–®åƒ¹</th>
                  <th style="text-align: right; color: #000;">é‡‘é¡</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        let buyerTotal = { qty: 0, amount: 0 };
        const sortedGroupCodes = Object.keys(groups).sort(sortGroupCode);
        
        for (const groupCode of sortedGroupCodes) {
          const groupData = groups[groupCode];
          html += `
            <tr>
              <td style="color: #000;">${groupCode}</td>
              <td style="color: #000;">${groupData.buySend}</td>
              <td style="text-align: center; color: #000;">${groupData.qty}</td>
              <td style="text-align: right; color: #000;">$${groupData.price.toLocaleString()}</td>
              <td style="text-align: right; color: #000;">$${groupData.amount.toLocaleString()}</td>
            </tr>
          `;
          buyerTotal.qty += groupData.qty;
          buyerTotal.amount += groupData.amount;
        }
        
        html += `
            <tr class="total-row">
              <td colspan="2" style="color: #92400e;"><strong>ç¸½è¨ˆ</strong></td>
              <td style="text-align: center; color: #92400e;"><strong>${buyerTotal.qty}</strong></td>
              <td style="color: #92400e;"></td>
              <td style="text-align: right; color: #92400e;"><strong>$${buyerTotal.amount.toLocaleString()}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
        `;
      }
      
      html += `</div>`;
    });
    
    container.innerHTML = html || '<div class="team-container"><p style="text-align: center; color: #999;">æš«ç„¡æ¶è³¼è³‡æ–™</p></div>';
  }
  
  function performSearch() {
    const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
    const resultsDiv = document.getElementById('searchResults');
    const detailDiv = document.getElementById('searchDetailContent');
    
    if (keyword.length === 0) {
      resultsDiv.style.display = 'none';
      detailDiv.innerHTML = '';
      return;
    }
    
    const matchedPeople = Array.from(allPeople).filter(name => 
      name.toLowerCase().includes(keyword)
    );
    
    if (matchedPeople.length === 0) {
      resultsDiv.innerHTML = '<div class="search-result-item">æ‰¾ä¸åˆ°ç¬¦åˆçš„äººå“¡</div>';
      resultsDiv.style.display = 'block';
      detailDiv.innerHTML = '';
      return;
    }
    
    let html = '';
    matchedPeople.forEach(person => {
      html += `<div class="search-result-item" onclick="showPersonDetail('${person}')">${person}</div>`;
    });
    
    resultsDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
  }
  
  function showPersonDetail(personName) {
    const detailDiv = document.getElementById('searchDetailContent');
    document.getElementById('searchResults').style.display = 'none';
    
    let html = `<div class="team-container">`;
    html += `<div class="team-header">ğŸ‘¤ ${personName} - å€‹äººè¨‚è³¼è©³ç´°æ¸…å–®</div>`;
    
    let foundOrders = false;
    let foundReports = false;
    
    for (const [team, data] of Object.entries(teamAnalysisData)) {
      if (data.orders[personName]) {
        foundOrders = true;
        const groups = data.orders[personName];
        
        html += `
          <div class="section-title">ğŸ“¦ è¨‚è³¼æ¸…å–®ï¼ˆåœ˜éšŠï¼š${team}ï¼‰</div>
          <table class="person-table">
            <thead>
              <tr>
                <th style="color: #000;">çµ„åˆ¥</th>
                <th style="color: #000;">ç”¢å“åç¨±</th>
                <th style="text-align: center; color: #000;">æ•¸é‡</th>
                <th style="text-align: right; color: #000;">å–®åƒ¹</th>
                <th style="text-align: right; color: #000;">é‡‘é¡</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        let personTotal = { qty: 0, amount: 0 };
        const sortedGroupCodes = Object.keys(groups).sort(sortGroupCode);
        
        for (const groupCode of sortedGroupCodes) {
          const groupData = groups[groupCode];
          html += `
            <tr>
              <td style="color: #000;">${groupCode}</td>
              <td style="color: #000;">${groupData.productName}</td>
              <td style="text-align: center; color: #000;">${groupData.qty}</td>
              <td style="text-align: right; color: #000;">$${groupData.price.toLocaleString()}</td>
              <td style="text-align: right; color: #000;">$${groupData.amount.toLocaleString()}</td>
            </tr>
          `;
          personTotal.qty += groupData.qty;
          personTotal.amount += groupData.amount;
        }
        
        html += `
            <tr class="total-row">
              <td colspan="2" style="color: #92400e;"><strong>è¨‚è³¼ç¸½è¨ˆ</strong></td>
              <td style="text-align: center; color: #92400e;"><strong>${personTotal.qty}</strong></td>
              <td style="color: #92400e;"></td>
              <td style="text-align: right; color: #92400e;"><strong>$${personTotal.amount.toLocaleString()}</strong></td>
            </tr>
          </tbody>
        </table>
        `;
      }
      
      if (data.reports[personName]) {
        foundReports = true;
        const groups = data.reports[personName];
        
        html += `
          <div class="section-title">ğŸ¯ æ¶è³¼æ¸…å–®ï¼ˆåœ˜éšŠï¼š${team}ï¼‰</div>
          <table class="person-table">
            <thead>
              <tr>
                <th style="color: #000;">çµ„åˆ¥</th>
                <th style="color: #000;">è²·/é€</th>
                <th style="text-align: center; color: #000;">æ•¸é‡</th>
                <th style="text-align: right; color: #000;">å–®åƒ¹</th>
                <th style="text-align: right; color: #000;">é‡‘é¡</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        let buyerTotal = { qty: 0, amount: 0 };
        const sortedGroupCodes = Object.keys(groups).sort(sortGroupCode);
        
        for (const groupCode of sortedGroupCodes) {
          const groupData = groups[groupCode];
          html += `
            <tr>
              <td style="color: #000;">${groupCode}</td>
              <td style="color: #000;">${groupData.buySend}</td>
              <td style="text-align: center; color: #000;">${groupData.qty}</td>
              <td style="text-align: right; color: #000;">$${groupData.price.toLocaleString()}</td>
              <td style="text-align: right; color: #000;">$${groupData.amount.toLocaleString()}</td>
            </tr>
          `;
          buyerTotal.qty += groupData.qty;
          buyerTotal.amount += groupData.amount;
        }
        
        html += `
            <tr class="total-row">
              <td colspan="2" style="color: #92400e;"><strong>æ¶è³¼ç¸½è¨ˆ</strong></td>
              <td style="text-align: center; color: #92400e;"><strong>${buyerTotal.qty}</strong></td>
              <td style="color: #92400e;"></td>
              <td style="text-align: right; color: #92400e;"><strong>$${buyerTotal.amount.toLocaleString()}</strong></td>
            </tr>
          </tbody>
        </table>
        `;
      }
    }
    
    if (!foundOrders && !foundReports) {
      html += '<p style="text-align: center; color: #999; padding: 20px;">æŸ¥ç„¡æ­¤äººå“¡çš„è¨‚è³¼æˆ–æ¶è³¼è³‡æ–™</p>';
    }
    
    html += `</div>`;
    detailDiv.innerHTML = html;
  }
  
  window.addEventListener('DOMContentLoaded', () => {
    autoConnectAndAnalyze();
    setInterval(() => autoConnectAndAnalyze(true), 30000);
  });
</script>
</body>
</html>

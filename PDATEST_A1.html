<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LINE群組管理系統</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
      .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
      .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
      .btn-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
      .loading { animation: spin 1s linear infinite; }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      .fade-in { animation: fadeIn 0.5s ease-in; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- 載入畫面 -->
  <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
      <div class="text-center">
          <div class="loading w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
          <p class="text-gray-600">載入中...</p>
      </div>
  </div>

  <!-- 主要內容 -->
  <div id="app" class="hidden">
      <!-- 標題列 -->
      <header class="bg-white shadow-sm border-b">
          <div class="max-w-md mx-auto px-4 py-3">
              <div class="flex items-center justify-between">
                  <h1 class="text-lg font-bold text-gray-800">
                      <i class="fas fa-users text-blue-500 mr-2"></i>
                      群組管理系統
                  </h1>
                  <button id="menuBtn" class="p-2 text-gray-600 hover:text-blue-500">
                      <i class="fas fa-bars"></i>
                  </button>
              </div>
          </div>
      </header>

      <!-- 導航選單 -->
      <nav id="navMenu" class="hidden bg-white border-b shadow-sm">
          <div class="max-w-md mx-auto px-4 py-2">
              <div class="grid grid-cols-4 gap-2">
                  <button class="nav-btn p-3 text-center rounded-lg hover:bg-gray-50" data-page="dashboard">
                      <i class="fas fa-home text-blue-500 mb-1"></i>
                      <div class="text-xs text-gray-600">首頁</div>
                  </button>
                  <button class="nav-btn p-3 text-center rounded-lg hover:bg-gray-50" data-page="members">
                      <i class="fas fa-users text-green-500 mb-1"></i>
                      <div class="text-xs text-gray-600">成員</div>
                  </button>
                  <button class="nav-btn p-3 text-center rounded-lg hover:bg-gray-50" data-page="events">
                      <i class="fas fa-calendar text-purple-500 mb-1"></i>
                      <div class="text-xs text-gray-600">活動</div>
                  </button>
                  <button class="nav-btn p-3 text-center rounded-lg hover:bg-gray-50" data-page="announcements">
                      <i class="fas fa-bullhorn text-red-500 mb-1"></i>
                      <div class="text-xs text-gray-600">公告</div>
                  </button>
              </div>
          </div>
      </nav>

      <!-- 頁面內容 -->
      <main class="max-w-md mx-auto px-4 py-4">
          <!-- 儀表板頁面 -->
          <div id="dashboard" class="page">
              <div class="space-y-4">
                  <!-- 歡迎卡片 -->
                  <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-xl card-shadow">
                      <h2 class="text-xl font-bold mb-2">歡迎使用群組管理系統</h2>
                      <p class="text-blue-100">輕鬆管理您的LINE群組</p>
                  </div>

                  <!-- 快速統計 -->
                  <div class="grid grid-cols-2 gap-4">
                      <div class="bg-white p-4 rounded-lg card-shadow">
                          <div class="flex items-center">
                              <div class="bg-green-100 p-3 rounded-full">
                                  <i class="fas fa-users text-green-600"></i>
                              </div>
                              <div class="ml-3">
                                  <p class="text-sm text-gray-600">總成員</p>
                                  <p class="text-xl font-bold" id="totalMembers">0</p>
                              </div>
                          </div>
                      </div>
                      <div class="bg-white p-4 rounded-lg card-shadow">
                          <div class="flex items-center">
                              <div class="bg-purple-100 p-3 rounded-full">
                                  <i class="fas fa-calendar text-purple-600"></i>
                              </div>
                              <div class="ml-3">
                                  <p class="text-sm text-gray-600">活動數</p>
                                  <p class="text-xl font-bold" id="totalEvents">0</p>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 快速操作 -->
                  <div class="bg-white rounded-lg card-shadow p-4">
                      <h3 class="font-bold text-gray-800 mb-3">快速操作</h3>
                      <div class="space-y-2">
                          <button class="quick-action-btn w-full p-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors" data-action="add-member">
                              <i class="fas fa-user-plus mr-2"></i>新增成員
                          </button>
                          <button class="quick-action-btn w-full p-3 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors" data-action="create-event">
                              <i class="fas fa-plus mr-2"></i>建立活動
                          </button>
                          <button class="quick-action-btn w-full p-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors" data-action="create-announcement">
                              <i class="fas fa-bullhorn mr-2"></i>發布公告
                          </button>
                      </div>
                  </div>
              </div>
          </div>

          <!-- 成員管理頁面 -->
          <div id="members" class="page hidden">
              <div class="space-y-4">
                  <div class="flex justify-between items-center">
                      <h2 class="text-xl font-bold text-gray-800">成員管理</h2>
                      <button id="addMemberBtn" class="btn-primary text-white px-4 py-2 rounded-lg">
                          <i class="fas fa-plus mr-1"></i>新增
                      </button>
                  </div>
                  
                  <!-- 搜尋框 -->
                  <div class="relative">
                      <input type="text" id="memberSearch" placeholder="搜尋成員..." 
                             class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                      <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                  </div>

                  <!-- 成員列表 -->
                  <div id="membersList" class="space-y-3">
                      <!-- 成員項目將在這裡動態載入 -->
                  </div>
              </div>
          </div>

          <!-- 活動管理頁面 -->
          <div id="events" class="page hidden">
              <div class="space-y-4">
                  <div class="flex justify-between items-center">
                      <h2 class="text-xl font-bold text-gray-800">活動管理</h2>
                      <button id="createEventBtn" class="btn-primary text-white px-4 py-2 rounded-lg">
                          <i class="fas fa-plus mr-1"></i>建立
                      </button>
                  </div>
                  
                  <!-- 活動篩選 -->
                  <div class="flex space-x-2">
                      <button class="event-filter active px-3 py-1 rounded-full text-sm bg-blue-500 text-white" data-filter="all">全部</button>
                      <button class="event-filter px-3 py-1 rounded-full text-sm bg-gray-200 text-gray-700" data-filter="upcoming">即將到來</button>
                      <button class="event-filter px-3 py-1 rounded-full text-sm bg-gray-200 text-gray-700" data-filter="ongoing">進行中</button>
                      <button class="event-filter px-3 py-1 rounded-full text-sm bg-gray-200 text-gray-700" data-filter="completed">已結束</button>
                  </div>

                  <!-- 活動列表 -->
                  <div id="eventsList" class="space-y-3">
                      <!-- 活動項目將在這裡動態載入 -->
                  </div>
              </div>
          </div>

          <!-- 公告管理頁面 -->
          <div id="announcements" class="page hidden">
              <div class="space-y-4">
                  <div class="flex justify-between items-center">
                      <h2 class="text-xl font-bold text-gray-800">公告管理</h2>
                      <button id="createAnnouncementBtn" class="btn-primary text-white px-4 py-2 rounded-lg">
                          <i class="fas fa-plus mr-1"></i>發布
                      </button>
                  </div>

                  <!-- 公告列表 -->
                  <div id="announcementsList" class="space-y-3">
                      <!-- 公告項目將在這裡動態載入 -->
                  </div>
              </div>
          </div>
      </main>

      <!-- 模態框 -->
      <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
          <div class="flex items-center justify-center min-h-screen p-4">
              <div class="bg-white rounded-lg max-w-md w-full max-h-screen overflow-y-auto">
                  <div class="p-4 border-b">
                      <div class="flex justify-between items-center">
                          <h3 id="modalTitle" class="text-lg font-bold"></h3>
                          <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                              <i class="fas fa-times"></i>
                          </button>
                      </div>
                  </div>
                  <div id="modalContent" class="p-4">
                      <!-- 模態框內容將在這裡動態載入 -->
                  </div>
              </div>
          </div>
      </div>
  </div>

  <script>
      // 全域變數
      let liff;
      let currentPage = 'dashboard';
      let currentGroupId = null;
      let userData = null;

      // LIFF 初始化
      document.addEventListener('DOMContentLoaded', function() {
          initializeLiff();
      });

      async function initializeLiff() {
          try {
              await liff.init({ liffId: 'YOUR_LIFF_ID' }); // 請替換為實際的 LIFF ID
              
              if (!liff.isLoggedIn()) {
                  liff.login();
                  return;
              }

              // 獲取用戶資訊
              userData = await liff.getProfile();
              
              // 獲取群組ID（如果在群組中）
              const context = liff.getContext();
              if (context && context.type === 'group') {
                  currentGroupId = context.groupId;
              }

              // 初始化應用程式
              initializeApp();
              
          } catch (error) {
              console.error('LIFF初始化失敗:', error);
              showError('系統初始化失敗，請重新整理頁面');
          }
      }

      function initializeApp() {
          // 隱藏載入畫面
          document.getElementById('loading').classList.add('hidden');
          document.getElementById('app').classList.remove('hidden');

          // 綁定事件監聽器
          bindEventListeners();
          
          // 載入初始數據
          loadDashboardData();
          
          // 根據URL參數顯示特定頁面
          const urlParams = new URLSearchParams(window.location.search);
          const page = urlParams.get('page');
          if (page) {
              showPage(page);
          }
      }

      function bindEventListeners() {
          // 選單按鈕
          document.getElementById('menuBtn').addEventListener('click', toggleMenu);
          
          // 導航按鈕
          document.querySelectorAll('.nav-btn').forEach(btn => {
              btn.addEventListener('click', (e) => {
                  const page = e.currentTarget.dataset.page;
                  showPage(page);
                  toggleMenu();
              });
          });

          // 快速操作按鈕
          document.querySelectorAll('.quick-action-btn').forEach(btn => {
              btn.addEventListener('click', (e) => {
                  const action = e.currentTarget.dataset.action;
                  handleQuickAction(action);
              });
          });

          // 模態框關閉
          document.getElementById('closeModal').addEventListener('click', closeModal);
          document.getElementById('modal').addEventListener('click', (e) => {
              if (e.target.id === 'modal') {
                  closeModal();
              }
          });

          // 成員搜尋
          document.getElementById('memberSearch').addEventListener('input', (e) => {
              filterMembers(e.target.value);
          });

          // 活動篩選
          document.querySelectorAll('.event-filter').forEach(btn => {
              btn.addEventListener('click', (e) => {
                  const filter = e.currentTarget.dataset.filter;
                  filterEvents(filter);
                  
                  // 更新按鈕狀態
                  document.querySelectorAll('.event-filter').forEach(b => b.classList.remove('active', 'bg-blue-500', 'text-white'));
                  e.currentTarget.classList.add('active', 'bg-blue-500', 'text-white');
              });
          });

          // 新增按鈕
          document.getElementById('addMemberBtn').addEventListener('click', () => showAddMemberForm());
          document.getElementById('createEventBtn').addEventListener('click', () => showCreateEventForm());
          document.getElementById('createAnnouncementBtn').addEventListener('click', () => showCreateAnnouncementForm());
      }

      function toggleMenu() {
          const menu = document.getElementById('navMenu');
          menu.classList.toggle('hidden');
      }

      function showPage(pageName) {
          // 隱藏所有頁面
          document.querySelectorAll('.page').forEach(page => {
              page.classList.add('hidden');
          });

          // 顯示指定頁面
          document.getElementById(pageName).classList.remove('hidden');
          currentPage = pageName;

          // 載入頁面數據
          switch (pageName) {
              case 'members':
                  loadMembers();
                  break;
              case 'events':
                  loadEvents();
                  break;
              case 'announcements':
                  loadAnnouncements();
                  break;
          }
      }

      async function loadDashboardData() {
          try {
              const [members, events] = await Promise.all([
                  fetchData('members'),
                  fetchData('events')
              ]);

              document.getElementById('totalMembers').textContent = members.length;
              document.getElementById('totalEvents').textContent = events.length;
          } catch (error) {
              console.error('載入儀表板數據失敗:', error);
          }
      }

      async function loadMembers() {
          try {
              const members = await fetchData('members');
              renderMembers(members);
          } catch (error) {
              console.error('載入成員失敗:', error);
              showError('載入成員資料失敗');
          }
      }

      function renderMembers(members) {
          const container = document.getElementById('membersList');
          
          if (members.length === 0) {
              container.innerHTML = `
                  <div class="text-center py-8 text-gray-500">
                      <i class="fas fa-users text-4xl mb-4"></i>
                      <p>尚無成員資料</p>
                  </div>
              `;
              return;
          }

          container.innerHTML = members.map(member => `
              <div class="bg-white p-4 rounded-lg card-shadow member-item" data-member-id="${member.用戶ID}">
                  <div class="flex items-center justify-between">
                      <div class="flex items-center">
                          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                              <i class="fas fa-user text-blue-600"></i>
                          </div>
                          <div class="ml-3">
                              <h4 class="font-medium text-gray-800">${member.顯示名稱}</h4>
                              <p class="text-sm text-gray-500">${member.角色}</p>
                          </div>
                      </div>
                      <div class="flex items-center space-x-2">
                          <span class="px-2 py-1 text-xs rounded-full ${member.狀態 === '活躍' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                              ${member.狀態}
                          </span>
                          <button class="text-gray-400 hover:text-blue-500" onclick="editMember('${member.用戶ID}')">
                              <i class="fas fa-edit"></i>
                          </button>
                      </div>
                  </div>
              </div>
          `).join('');
      }

      async function loadEvents() {
          try {
              const events = await fetchData('events');
              renderEvents(events);
          } catch (error) {
              console.error('載入活動失敗:', error);
              showError('載入活動資料失敗');
          }
      }

      function renderEvents(events) {
          const container = document.getElementById('eventsList');
          
          if (events.length === 0) {
              container.innerHTML = `
                  <div class="text-center py-8 text-gray-500">
                      <i class="fas fa-calendar text-4xl mb-4"></i>
                      <p>尚無活動資料</p>
                  </div>
              `;
              return;
          }

          container.innerHTML = events.map(event => `
              <div class="bg-white p-4 rounded-lg card-shadow event-item" data-event-id="${event.活動ID}">
                  <div class="flex justify-between items-start">
                      <div class="flex-1">
                          <h4 class="font-medium text-gray-800 mb-1">${event.活動名稱}</h4>
                          <p class="text-sm text-gray-600 mb-2">${event.描述}</p>
                          <div class="flex items-center text-xs text-gray-500">
                              <i class="fas fa-clock mr-1"></i>
                              ${formatDateTime(event.開始時間)} - ${formatDateTime(event.結束時間)}
                          </div>
                      </div>
                      <div class="ml-4 text-right">
                          <span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">
                              ${event.參與人數} 人參與
                          </span>
                          <div class="mt-2">
                              <button class="text-gray-400 hover:text-blue-500 mr-2" onclick="editEvent('${event.活動ID}')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="text-gray-400 hover:text-red-500" onclick="deleteEvent('${event.活動ID}')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </div>
                  </div>
              </div>
          `).join('');
      }

      async function loadAnnouncements() {
          try {
              const announcements = await fetchData('announcements');
              renderAnnouncements(announcements);
          } catch (error) {
              console.error('載入公告失敗:', error);
              showError('載入公告資料失敗');
          }
      }

      function renderAnnouncements(announcements) {
          const container = document.getElementById('announcementsList');
          
          if (announcements.length === 0) {
              container.innerHTML = `
                  <div class="text-center py-8 text-gray-500">
                      <i class="fas fa-bullhorn text-4xl mb-4"></i>
                      <p>尚無公告資料</p>
                  </div>
              `;
              return;
          }

          container.innerHTML = announcements.map(announcement => `
              <div class="bg-white p-4 rounded-lg card-shadow announcement-item" data-announcement-id="${announcement.公告ID}">
                  <div class="flex justify-between items-start">
                      <div class="flex-1">
                          <h4 class="font-medium text-gray-800 mb-2">${announcement.標題}</h4>
                          <p class="text-sm text-gray-600 mb-3">${announcement.內容}</p>
                          <div class="flex items-center text-xs text-gray-500">
                              <i class="fas fa-user mr-1"></i>
                              ${announcement.發布者}
                              <span class="mx-2">•</span>
                              <i class="fas fa-clock mr-1"></i>
                              ${formatDateTime(announcement.發布時間)}
                          </div>
                      </div>
                      <div class="ml-4">
                          <button class="text-gray-400 hover:text-blue-500 mr-2" onclick="editAnnouncement('${announcement.公告ID}')">
                              <i class="fas fa-edit"></i>
                          </button>
                          <button class="text-gray-400 hover:text-red-500" onclick="deleteAnnouncement('${announcement.公告ID}')">
                              <i class="fas fa-trash"></i>
                          </button>
                      </div>
                  </div>
              </div>
          `).join('');
      }

      // 表單顯示函數
      function showAddMemberForm() {
          const content = `
              <form id="addMemberForm" class="space-y-4">
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">用戶ID</label>
                      <input type="text" name="userId" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">顯示名稱</label>
                      <input type="text" name="displayName" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">角色</label>
                      <select name="role" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                          <option value="成員">成員</option>
                          <option value="管理員">管理員</option>
                          <option value="版主">版主</option>
                      </select>
                  </div>
                  <div class="flex space-x-2 pt-4">
                      <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                          取消
                      </button>
                      <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-lg">
                          新增成員
                      </button>
                  </div>
              </form>
          `;
          
          showModal('新增成員', content);
          
          document.getElementById('addMemberForm').addEventListener('submit', async (e) => {
              e.preventDefault();
              const formData = new FormData(e.target);
              const memberData = {
                  userId: formData.get('userId'),
                  displayName: formData.get('displayName'),
                  role: formData.get('role'),
                  groupId: currentGroupId
              };
              
              try {
                  await saveData('member', memberData);
                  closeModal();
                  showSuccess('成員新增成功');
                  loadMembers();
              } catch (error) {
                  showError('新增成員失敗');
              }
          });
      }

      function showCreateEventForm() {
          const content = `
              <form id="createEventForm" class="space-y-4">
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">活動名稱</label>
                      <input type="text" name="eventName" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">活動描述</label>
                      <textarea name="description" rows="3" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                  </div>
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">開始時間</label>
                      <input type="datetime-local" name="startTime" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">結束時間</label>
                      <input type="datetime-local" name="endTime" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div class="flex space-x-2 pt-4">
                      <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                          取消
                      </button>
                      <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-lg">
                          建立活動
                      </button>
                  </div>
              </form>
          `;
          
          showModal('建立活動', content);
          
          document.getElementById('createEventForm').addEventListener('submit', async (e) => {
              e.preventDefault();
              const formData = new FormData(e.target);
              const eventData = {
                  eventName: formData.get('eventName'),
                  description: formData.get('description'),
                  startTime: formData.get('startTime'),
                  endTime: formData.get('endTime'),
                  groupId: currentGroupId,
                  creator: userData.displayName
              };
              
              try {
                  await saveData('event', eventData);
                  closeModal();
                  showSuccess('活動建立成功');
                  loadEvents();
              } catch (error) {
                  showError('建立活動失敗');
              }
          });
      }
      function showCreateAnnouncementForm() {
          const content = `
              <form id="createAnnouncementForm" class="space-y-4">
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">公告標題</label>
                      <input type="text" name="title" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">公告內容</label>
                      <textarea name="content" rows="4" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                  </div>
                  <div class="flex items-center">
                      <input type="checkbox" name="sendNotification" id="sendNotification" class="mr-2">
                      <label for="sendNotification" class="text-sm text-gray-700">立即發送通知給所有成員</label>
                  </div>
                  <div class="flex space-x-2 pt-4">
                      <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                          取消
                      </button>
                      <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-lg">
                          發布公告
                      </button>
                  </div>
              </form>
          `;
          
          showModal('發布公告', content);
          
          document.getElementById('createAnnouncementForm').addEventListener('submit', async (e) => {
              e.preventDefault();
              const formData = new FormData(e.target);
              const announcementData = {
                  title: formData.get('title'),
                  content: formData.get('content'),
                  groupId: currentGroupId,
                  publisher: userData.displayName,
                  sendNotification: formData.get('sendNotification') === 'on'
              };
              
              try {
                  await saveData('announcement', announcementData);
                  closeModal();
                  showSuccess('公告發布成功');
                  loadAnnouncements();
              } catch (error) {
                  showError('發布公告失敗');
              }
          });
      }

      // 快速操作處理
      function handleQuickAction(action) {
          switch (action) {
              case 'add-member':
                  showAddMemberForm();
                  break;
              case 'create-event':
                  showCreateEventForm();
                  break;
              case 'create-announcement':
                  showCreateAnnouncementForm();
                  break;
          }
      }

      // 篩選功能
      function filterMembers(searchTerm) {
          const members = document.querySelectorAll('.member-item');
          members.forEach(member => {
              const name = member.querySelector('h4').textContent.toLowerCase();
              const role = member.querySelector('p').textContent.toLowerCase();
              const matches = name.includes(searchTerm.toLowerCase()) || role.includes(searchTerm.toLowerCase());
              member.style.display = matches ? 'block' : 'none';
          });
      }

      function filterEvents(filter) {
          const events = document.querySelectorAll('.event-item');
          const now = new Date();
          
          events.forEach(event => {
              const eventId = event.dataset.eventId;
              // 這裡需要根據實際的事件數據來判斷狀態
              // 簡化版本，實際應用中需要從數據中獲取時間信息
              event.style.display = 'block';
          });
      }

      // 編輯功能
      async function editMember(memberId) {
          try {
              const members = await fetchData('members');
              const member = members.find(m => m.用戶ID === memberId);
              
              if (!member) {
                  showError('找不到成員資料');
                  return;
              }

              const content = `
                  <form id="editMemberForm" class="space-y-4">
                      <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">顯示名稱</label>
                          <input type="text" name="displayName" value="${member.顯示名稱}" required class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">角色</label>
                          <select name="role" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                              <option value="成員" ${member.角色 === '成員' ? 'selected' : ''}>成員</option>
                              <option value="管理員" ${member.角色 === '管理員' ? 'selected' : ''}>管理員</option>
                              <option value="版主" ${member.角色 === '版主' ? 'selected' : ''}>版主</option>
                          </select>
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">狀態</label>
                          <select name="status" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                              <option value="活躍" ${member.狀態 === '活躍' ? 'selected' : ''}>活躍</option>
                              <option value="暫停" ${member.狀態 === '暫停' ? 'selected' : ''}>暫停</option>
                              <option value="離開" ${member.狀態 === '離開' ? 'selected' : ''}>離開</option>
                          </select>
                      </div>
                      <div class="flex space-x-2 pt-4">
                          <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                              取消
                          </button>
                          <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-lg">
                              更新
                          </button>
                      </div>
                  </form>
              `;
              
              showModal('編輯成員', content);
              
              document.getElementById('editMemberForm').addEventListener('submit', async (e) => {
                  e.preventDefault();
                  const formData = new FormData(e.target);
                  const updateData = {
                      userId: memberId,
                      displayName: formData.get('displayName'),
                      role: formData.get('role'),
                      status: formData.get('status')
                  };
                  
                  try {
                      await updateData('member', updateData);
                      closeModal();
                      showSuccess('成員資料更新成功');
                      loadMembers();
                  } catch (error) {
                      showError('更新成員資料失敗');
                  }
              });
              
          } catch (error) {
              showError('載入成員資料失敗');
          }
      }

      async function editEvent(eventId) {
          // 類似 editMember 的實作
          showInfo('編輯活動功能開發中');
      }

      async function editAnnouncement(announcementId) {
          // 類似 editMember 的實作
          showInfo('編輯公告功能開發中');
      }

      // 刪除功能
      async function deleteEvent(eventId) {
          if (confirm('確定要刪除此活動嗎？')) {
              try {
                  await deleteData('event', eventId);
                  showSuccess('活動刪除成功');
                  loadEvents();
              } catch (error) {
                  showError('刪除活動失敗');
              }
          }
      }

      async function deleteAnnouncement(announcementId) {
          if (confirm('確定要刪除此公告嗎？')) {
              try {
                  await deleteData('announcement', announcementId);
                  showSuccess('公告刪除成功');
                  loadAnnouncements();
              } catch (error) {
                  showError('刪除公告失敗');
              }
          }
      }

      // API 呼叫函數
      async function fetchData(type) {
          const response = await fetch(`${getScriptUrl()}?action=getData&type=${type}&groupId=${currentGroupId}`);
          const result = await response.json();
          
          if (!result.success) {
              throw new Error(result.error);
          }
          
          return result.data;
      }

      async function saveData(type, data) {
          const response = await fetch(`${getScriptUrl()}?action=saveData&type=${type}`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: `data=${encodeURIComponent(JSON.stringify(data))}`
          });
          
          const result = await response.json();
          
          if (!result.success) {
              throw new Error(result.error);
          }
          
          return result.result;
      }

      async function updateData(type, data) {
          const response = await fetch(`${getScriptUrl()}?action=updateData&type=${type}`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: `data=${encodeURIComponent(JSON.stringify(data))}`
          });
          
          const result = await response.json();
          
          if (!result.success) {
              throw new Error(result.error);
          }
          
          return result.result;
      }

      async function deleteData(type, id) {
          const response = await fetch(`${getScriptUrl()}?action=deleteData&type=${type}&id=${id}`, {
              method: 'DELETE'
          });
          
          const result = await response.json();
          
          if (!result.success) {
              throw new Error(result.error);
          }
          
          return result.result;
      }

      function getScriptUrl() {
          // 請替換為實際的 Google Apps Script Web App URL
          return 'https://script.google.com/macros/s/AKfycbzND1iFBVJivJJN9rFeQtyqcSXmyrCd5o7mFDFCRouKwTM8Ib6l4wMoEUO_DxzJsPov/exec';
      }

      // 模態框函數
      function showModal(title, content) {
          document.getElementById('modalTitle').textContent = title;
          document.getElementById('modalContent').innerHTML = content;
          document.getElementById('modal').classList.remove('hidden');
          document.body.style.overflow = 'hidden';
      }

      function closeModal() {
          document.getElementById('modal').classList.add('hidden');
          document.body.style.overflow = 'auto';
      }

      // 通知函數
      function showSuccess(message) {
          showNotification(message, 'success');
      }

      function showError(message) {
          showNotification(message, 'error');
      }

      function showInfo(message) {
          showNotification(message, 'info');
      }

      function showNotification(message, type) {
          const notification = document.createElement('div');
          notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 fade-in ${
              type === 'success' ? 'bg-green-500' : 
              type === 'error' ? 'bg-red-500' : 'bg-blue-500'
          }`;
          notification.innerHTML = `
              <div class="flex items-center">
                  <i class="fas ${
                      type === 'success' ? 'fa-check-circle' : 
                      type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'
                  } mr-2"></i>
                  <span>${message}</span>
              </div>
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
              notification.remove();
          }, 3000);
      }

      // 工具函數
      function formatDateTime(dateString) {
          if (!dateString) return '';
          const date = new Date(dateString);
          return date.toLocaleString('zh-TW', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit'
          });
      }

      // 初始化時自動執行
      window.addEventListener('load', () => {
          // 檢查是否在 LINE 環境中
          if (typeof liff === 'undefined') {
              showError('請在 LINE 應用程式中開啟此頁面');
              return;
          }
      });

      // 處理頁面可見性變化
      document.addEventListener('visibilitychange', () => {
          if (!document.hidden && currentPage === 'dashboard') {
              loadDashboardData();
          }
      });

      // 處理返回按鈕
      window.addEventListener('popstate', (e) => {
          const urlParams = new URLSearchParams(window.location.search);
          const page = urlParams.get('page') || 'dashboard';
          showPage(page);
      });
  </script>
</body>
</html>

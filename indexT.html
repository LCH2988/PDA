<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOGO æ¶è³¼è¨‚å–®åˆ†æç³»çµ±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 30px;
      text-align: center;
    }
    
    .header h1 {
      color: #667eea;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    
    .header p {
      color: #666;
      font-size: 1.1em;
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      margin-top: 10px;
    }
    
    .status-connected {
      background: #d1fae5;
      color: #065f46;
    }
    
    .status-disconnected {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .stat-card h3 {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 10px;
      text-transform: uppercase;
    }
    
    .stat-card .value {
      font-size: 2.5em;
      font-weight: bold;
      color: #667eea;
    }
    
    .stat-card .label {
      color: #999;
      font-size: 0.9em;
      margin-top: 5px;
    }
    
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 968px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .card h2 {
      color: #667eea;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .table-container {
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
    }
    
    thead {
      position: sticky;
      top: 0;
      background: #667eea;
      color: white;
      z-index: 10;
    }
    
    th {
      padding: 12px 8px;
      text-align: left;
      font-weight: 600;
    }
    
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    tbody tr:hover {
      background: #f8f9ff;
    }
    
    .product-a {
      color: #10b981;
      font-weight: bold;
    }
    
    .product-b {
      color: #f59e0b;
      font-weight: bold;
    }
    
    .chart-bar {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .chart-label {
      width: 150px;
      font-size: 0.9em;
      color: #666;
    }
    
    .chart-bar-container {
      flex: 1;
      height: 30px;
      background: #f0f0f0;
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    
    .chart-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      color: white;
      font-weight: bold;
      font-size: 0.85em;
      transition: width 1s ease;
    }
    
    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .filter-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .filter-group label {
      color: #666;
      font-weight: 600;
    }
    
    .filter-group select,
    .filter-group input {
      padding: 10px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      outline: none;
      transition: border-color 0.3s;
    }
    
    .filter-group select:focus,
    .filter-group input:focus {
      border-color: #667eea;
    }
    
    .btn {
      padding: 10px 25px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: background 0.3s;
    }
    
    .btn:hover {
      background: #5568d3;
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: #6b7280;
    }
    
    .btn-secondary:hover {
      background: #4b5563;
    }
    
    .btn-success {
      background: #10b981;
    }
    
    .btn-success:hover {
      background: #059669;
    }
    
    .sync-info {
      background: #e0e7ff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      color: #4338ca;
    }
    
    .sync-info strong {
      display: block;
      margin-bottom: 5px;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
    }
    
    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .loading-overlay.show {
      display: flex;
    }
    
    .spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .alert {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    
    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
    }
    
    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #3b82f6;
    }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>
  
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>ğŸ¯ BOGO æ¶è³¼è¨‚å–®åˆ†æç³»çµ±</h1>
      <p id="headerSubtitle">å³æ™‚æ•¸æ“šåˆ†æå„€è¡¨æ¿</p>
      <span class="status-badge status-disconnected" id="statusBadge">â— æœªé€£æ¥</span>
    </div>
    
    <!-- Connection Setup -->
    <div class="card" style="margin-bottom: 30px;">
      <h2>ğŸ”— Google Sheets é€£æ¥è¨­å®š</h2>
      
      <div id="alertContainer"></div>
      
      <div class="filter-group">
        <label>Web App URLï¼š</label>
        <input type="text" id="webAppUrl" placeholder="è²¼ä¸Š Apps Script éƒ¨ç½²çš„ Web App URL" style="flex: 1; min-width: 400px;">
        <button class="btn btn-success" onclick="connectAndLoad()">ğŸ”Œ é€£æ¥ä¸¦è¼‰å…¥</button>
        <button class="btn" onclick="testConnection()">ğŸ” æ¸¬è©¦é€£ç·š</button>
        <button class="btn btn-secondary" onclick="refreshData()" id="refreshBtn" disabled>ğŸ”„ é‡æ–°æ•´ç†</button>
      </div>
      
      <div class="sync-info">
        <strong>ğŸ“Œ å¿«é€Ÿè¨­å®šæŒ‡å—ï¼š</strong>
        <ol style="text-align: left; margin-top: 10px; padding-left: 20px;">
          <li>åœ¨ Google Sheets é–‹å•Ÿï¼š<strong>æ“´å……åŠŸèƒ½ â†’ Apps Script</strong></li>
          <li>è²¼ä¸Šæä¾›çš„ Apps Script ç¨‹å¼ç¢¼ä¸¦å„²å­˜</li>
          <li>é»æ“Š <strong>éƒ¨ç½² â†’ æ–°å¢éƒ¨ç½²ä½œæ¥­ â†’ ç¶²é æ‡‰ç”¨ç¨‹å¼</strong></li>
          <li>è¨­å®šã€ŒåŸ·è¡Œèº«åˆ†ã€ç‚ºã€Œæˆ‘ã€ï¼Œã€Œå­˜å–æ¬Šã€ç‚ºã€Œä»»ä½•äººã€</li>
          <li>è¤‡è£½éƒ¨ç½² URL ä¸¦è²¼åˆ°ä¸Šæ–¹è¼¸å…¥æ¡†</li>
          <li>é»æ“Šã€Œé€£æ¥ä¸¦è¼‰å…¥ã€æŒ‰éˆ•</li>
        </ol>
      </div>
    </div>
    
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>ç¸½è¨‚å–®æ•¸</h3>
        <div class="value" id="totalOrders">0</div>
        <div class="label">ç­†è¨‚å–®</div>
      </div>
      <div class="stat-card">
        <h3>ç¸½éŠ·å”®é¡</h3>
        <div class="value" id="totalSales">$0</div>
        <div class="label">æ–°å°å¹£</div>
      </div>
      <div class="stat-card">
        <h3>ç¸½ PV æ•¸</h3>
        <div class="value" id="totalPV">0</div>
        <div class="label">ç©åˆ†</div>
      </div>
      <div class="stat-card">
        <h3>åƒèˆ‡äººæ•¸</h3>
        <div class="value" id="totalUsers">0</div>
        <div class="label">ä½æœƒå“¡</div>
      </div>
    </div>
    
    <!-- Filter Section -->
    <div class="filter-section">
      <h2 style="color: #667eea; margin-bottom: 15px;">ğŸ” ç¯©é¸èˆ‡æœå°‹</h2>
      <div class="filter-group">
        <label>ç”¢å“é¡å‹ï¼š</label>
        <select id="productFilter">
          <option value="all">å…¨éƒ¨</option>
          <option value="1A">1A - é †æš¢æ¸…æ–°è¤‡æ–¹</option>
          <option value="1B">1B - å¤å·´é¦™è„‚</option>
        </select>
        
        <label>æœå°‹å§“åï¼š</label>
        <input type="text" id="nameSearch" placeholder="è¼¸å…¥å§“å...">
        
        <button class="btn" onclick="applyFilters()">å¥—ç”¨ç¯©é¸</button>
        <button class="btn btn-secondary" onclick="resetFilters()">é‡ç½®</button>
      </div>
    </div>
    
    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Product Analysis -->
      <div class="card">
        <h2>ğŸ“¦ ç”¢å“éŠ·å”®åˆ†æ</h2>
        <div id="productChart">
          <p style="color: #999; text-align: center; padding: 40px;">è¼‰å…¥æ•¸æ“šå¾Œé¡¯ç¤º</p>
        </div>
      </div>
      
      <!-- Top Buyers -->
      <div class="card">
        <h2>ğŸ† æ¶è³¼æ’è¡Œæ¦œ TOP 10</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>æ’å</th>
                <th>å§“å</th>
                <th>è¨‚è³¼æ•¸é‡</th>
                <th>ç¸½é‡‘é¡</th>
              </tr>
            </thead>
            <tbody id="topBuyersTable">
              <tr>
                <td colspan="4" style="text-align: center; padding: 40px; color: #999;">
                  è¼‰å…¥æ•¸æ“šå¾Œé¡¯ç¤º
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Orders Table -->
    <div class="card">
      <h2>ğŸ“‹ è¨‚å–®æ˜ç´°åˆ—è¡¨ (<span id="orderCount">0</span> ç­†)</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ç·¨è™Ÿ</th>
              <th>LINEåç¨±</th>
              <th>ç”¢å“</th>
              <th>æ•¸é‡</th>
              <th>å–®åƒ¹</th>
              <th>PV</th>
              <th>åˆè¨ˆ</th>
              <th>æ™‚é–“</th>
            </tr>
          </thead>
          <tbody id="ordersTable">
            <tr>
              <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                è«‹å…ˆé€£æ¥ Google Sheets ä»¥è¼‰å…¥æ•¸æ“š
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <script>
    // å…¨åŸŸè®Šæ•¸
    let WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzEbNDwieQTXqyOhH6wyVzBAkk4D7AcaCkIpHirZu9q4ryRbo-yufvLGSAT-gTS4wGyZw/exec';
    let allOrders = [];
    let allOrdersRaw = [];
    
    // é¡¯ç¤º/éš±è—è¼‰å…¥å‹•ç•«
    function showLoading(show) {
      const overlay = document.getElementById('loadingOverlay');
      if (show) {
        overlay.classList.add('show');
      } else {
        overlay.classList.remove('show');
      }
    }
    
    // é¡¯ç¤ºæç¤ºè¨Šæ¯
    function showAlert(message, type = 'info') {
      const container = document.getElementById('alertContainer');
      const alertClass = `alert-${type}`;
      const alert = document.createElement('div');
      alert.className = `alert ${alertClass}`;
      alert.textContent = message;
      container.innerHTML = '';
      container.appendChild(alert);
      
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }
    
    // æ›´æ–°é€£æ¥ç‹€æ…‹
    function updateStatus(connected) {
      const badge = document.getElementById('statusBadge');
      const refreshBtn = document.getElementById('refreshBtn');
      
      if (connected) {
        badge.className = 'status-badge status-connected';
        badge.textContent = 'â— å·²é€£æ¥';
        refreshBtn.disabled = false;
      } else {
        badge.className = 'status-badge status-disconnected';
        badge.textContent = 'â— æœªé€£æ¥';
        refreshBtn.disabled = true;
      }
    }
    
    // é€£æ¥ä¸¦è¼‰å…¥æ•¸æ“š
    async function connectAndLoad() {
      const url = document.getElementById('webAppUrl').value.trim();
      
      if (!url) {
        showAlert('è«‹è¼¸å…¥ Web App URL', 'error');
        return;
      }
      
      WEB_APP_URL = url;
      localStorage.setItem('webAppUrl', url);
      
      await loadOrders();
    }
    
    // æ¸¬è©¦é€£ç·š
    async function testConnection() {
      const url = document.getElementById('webAppUrl').value.trim();
      
      if (!url) {
        showAlert('è«‹è¼¸å…¥ Web App URL', 'error');
        return;
      }
      
      try {
        showLoading(true);
        
        const response = await fetch(url + '?action=test');
        const result = await response.json();
        
        if (result.success) {
          showAlert(`âœ… é€£ç·šæˆåŠŸï¼è©¦ç®—è¡¨ï¼š${result.data.spreadsheetName}ï¼Œå…± ${result.data.totalRows} åˆ—`, 'success');
          WEB_APP_URL = url;
          localStorage.setItem('webAppUrl', url);
          updateStatus(true);
        } else {
          showAlert('âŒ é€£ç·šå¤±æ•—ï¼š' + result.data, 'error');
          updateStatus(false);
        }
      } catch (error) {
        showAlert('âŒ é€£ç·šéŒ¯èª¤ï¼š' + error.message, 'error');
        updateStatus(false);
      } finally {
        showLoading(false);
      }
    }
    
    // è¼‰å…¥è¨‚å–®è³‡æ–™
    async function loadOrders() {
      if (!WEB_APP_URL) {
        showAlert('è«‹å…ˆè¨­å®š Web App URL', 'error');
        return;
      }
      
      try {
        showLoading(true);
        
        const response = await fetch(WEB_APP_URL + '?action=getOrders');
        const result = await response.json();
        
        if (result.success) {
          allOrdersRaw = result.data;
          allOrders = result.data.map(order => ({
            id: order.id,
            name: order.LINEåç¨± || '',
            product: order.ç”¢å“ç·¨è™Ÿ || '',
            qty: parseInt(order.è¨‚è³¼æ•¸é‡) || 0,
            price: parseInt(order.å–®åƒ¹) || 0,
            pv: parseInt(order.PV) || 0,
            time: order.æ™‚é–“ || '',
            group: order.ç¾¤çµ„ID || '',
            total: parseInt(order.åˆè¨ˆè²»ç”¨) || 0
          }));
          
          renderOrders(allOrders);
          updateStats(allOrders);
          updateProductChart(allOrders);
          updateTopBuyers(allOrders);
          updateStatus(true);
          
          showAlert(`âœ… æˆåŠŸè¼‰å…¥ ${allOrders.length} ç­†è¨‚å–®`, 'success');
          
          // æ›´æ–°æ¨™é¡Œ
          if (allOrders.length > 0 && allOrders[0].time) {
            const date = allOrders[0].time.split('_')[0];
            document.getElementById('headerSubtitle').textContent = `${date} æ¶è³¼æ´»å‹•æ•¸æ“š`;
          }
        } else {
          showAlert('âŒ è¼‰å…¥å¤±æ•—ï¼š' + result.data, 'error');
          updateStatus(false);
        }
      } catch (error) {
        showAlert('âŒ é€£ç·šéŒ¯èª¤ï¼š' + error.message, 'error');
        updateStatus(false);
      } finally {
        showLoading(false);
      }
    }
    
    // é‡æ–°æ•´ç†æ•¸æ“š
    async function refreshData() {
      await loadOrders();
    }
    
    // æ¸²æŸ“è¨‚å–®è¡¨æ ¼
    function renderOrders(orders) {
      const tbody = document.getElementById('ordersTable');
      tbody.innerHTML = '';
      
      if (orders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #999;">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„è¨‚å–®</td></tr>';
        document.getElementById('orderCount').textContent = '0';
        return;
      }
      
      orders.forEach(order => {
        const productClass = order.product === '1A' ? 'product-a' : 'product-b';
        const badge = order.product === '1A' ? 'badge-success' : 'badge-warning';
        
        tbody.innerHTML += `
          <tr>
            <td>${order.id}</td>
            <td>${order.name}</td>
            <td><span class="badge ${badge}">${order.product}</span></td>
            <td class="${productClass}">${order.qty}</td>
            <td>$${order.price.toLocaleString()}</td>
            <td>${order.pv}</td>
            <td><strong>$${order.total.toLocaleString()}</strong></td>
            <td style="font-size: 0.85em;">${order.time}</td>
          </tr>
        `;
      });
      
      document.getElementById('orderCount').textContent = orders.length;
    }
    
    // æ›´æ–°çµ±è¨ˆæ•¸æ“š
    function updateStats(orders) {
      const totalOrders = orders.length;
      const totalSales = orders.reduce((sum, order) => sum + order.total, 0);
      const totalPV = orders.reduce((sum, order) => sum + (order.pv * order.qty), 0);
      const uniqueUsers = new Set(orders.map(o => o.name)).size;
      
      document.getElementById('totalOrders').textContent = totalOrders;
      document.getElementById('totalSales').textContent = '$' + totalSales.toLocaleString();
      document.getElementById('totalPV').textContent = totalPV.toLocaleString();
      document.getElementById('totalUsers').textContent = uniqueUsers;
    }
    
    // æ›´æ–°ç”¢å“åœ–è¡¨
    function updateProductChart(orders) {
      const productStats = {};
      
      orders.forEach(order => {
        if (!productStats[order.product]) {
          productStats[order.product] = { count: 0, sales: 0 };
        }
        productStats[order.product].count += order.qty;
        productStats[order.product].sales += order.total;
      });
      
      const total = Object.values(productStats).reduce((sum, p) => sum + p.count, 0);
      
      let html = '';
      for (const [product, stats] of Object.entries(productStats)) {
        const percentage = total > 0 ? (stats.count / total * 100).toFixed(0) : 0;
        const productName = product === '1A' ? '1A é †æš¢æ¸…æ–°è¤‡æ–¹' : '1B å¤å·´é¦™è„‚';
        
        html += `
          <div class="chart-bar">
            <div class="chart-label">${productName}</div>
            <div class="chart-bar-container">
              <div class="chart-bar-fill" style="width: ${percentage}%;">${stats.count} çµ„</div>
            </div>
          </div>
        `;
      }
      
      html += `
        <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
          <p style="color: #666; margin-bottom: 10px;"><strong>ç”¢å“è©³æƒ…ï¼š</strong></p>
      `;
      
      for (const [product, stats] of Object.entries(productStats)) {
        const color = product === '1A' ? '#10b981' : '#f59e0b';
        const price = product === '1A' ? 1095 : 1445;
        const pv = product === '1A' ? 34 : 44;
        
        html += `<p style="color: ${color}; margin-bottom: 5px;">âœ“ ${product}ï¼šå–®åƒ¹ $${price.toLocaleString()} | PV ${pv} | éŠ·å”® $${stats.sales.toLocaleString()}</p>`;
      }
      
      html += '</div>';
      
      document.getElementById('productChart').innerHTML = html;
    }
    
    // æ›´æ–°æ’è¡Œæ¦œ
    function updateTopBuyers(orders) {
      const buyerStats = {};
      
      orders.forEach(order => {
        // ç§»é™¤ "(ä»£)" å¾Œé¢çš„æ–‡å­—ï¼Œåªä¿ç•™ä¸»è¦åç¨±
        const mainName = order.name.split('(ä»£)')[0].trim();
        
        if (!buyerStats[mainName]) {
          buyerStats[mainName] = { qty: 0, sales: 0 };
        }
        buyerStats[mainName].qty += order.qty;
        buyerStats[mainName].sales += order.total;
      });
      
      const sorted = Object.entries(buyerStats)
        .sort((a, b) => b[1].sales - a[1].sales)
        .slice(0, 10);
      
      const tbody = document.getElementById('topBuyersTable');
      tbody.innerHTML = '';
      
      sorted.forEach(([name, stats], index) => {
        tbody.innerHTML += `
          <tr>
            <td><strong>${index + 1}</strong></td>
            <td>${name}</td>
            <td>${stats.qty} çµ„</td>
            <td><strong>$${stats.sales.toLocaleString()}</strong></td>
          </tr>
        `;
      });
    }
    
    // å¥—ç”¨ç¯©é¸
    function applyFilters() {
      const productFilter = document.getElementById('productFilter').value;
      const nameSearch = document.getElementById('nameSearch').value.toLowerCase();
      
      let filtered = allOrders.filter(order => {
        const matchProduct = productFilter === 'all' || order.product === productFilter;
        const matchName = nameSearch === '' || order.name.toLowerCase().includes(nameSearch);
        
        return matchProduct && matchName;
      });
      
      renderOrders(filtered);
      updateStats(filtered);
      updateProductChart(filtered);
      updateTopBuyers(filtered);
    }
    
    // é‡ç½®ç¯©é¸
    function resetFilters() {
      document.getElementById('productFilter').value = 'all';
      document.getElementById('nameSearch').value = '';
      
      if (allOrders.length > 0) {
        renderOrders(allOrders);
        updateStats(allOrders);
        updateProductChart(allOrders);
        updateTopBuyers(allOrders);
      }
    }
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¢å¾©è¨­å®š
    window.addEventListener('DOMContentLoaded', () => {
      const savedUrl = localStorage.getItem('webAppUrl');
      if (savedUrl) {
        document.getElementById('webAppUrl').value = savedUrl;
        WEB_APP_URL = savedUrl;
        
        // è‡ªå‹•è¼‰å…¥æ•¸æ“š
        loadOrders();
      }
    });
  </script>
</body>
</html>
